(()=>{"use strict";var e,t={774:(e,t,r)=>{function i(e,t){const r={standard:n,gurps:a};return e in r?new r[e](t):new o}r.d(t,{c:()=>c});const s="/icons/svg/light.svg";class n{quantityField="quantity";constructor(e){this.quantityField=e??"quantity"}_getQuantity(e){let t=e.system;for(const e of this.quantityField.split("."))t=t[e];return t}_findMatchingItem(e,t){return Array.from(e.items).find((e=>e.name.toLowerCase()===t.toLowerCase()))}actorHasLightSource(e,t){return!!this._findMatchingItem(e,t.name)}getImage(e,t){let r=this._findMatchingItem(e,t.name);return r?r.img:s}getInventory(e,t){if(!t.consumable)return;let r=this._findMatchingItem(e,t.name);return r?this._getQuantity(r):void 0}async decrementInventory(e,t){if(!t.consumable)return Promise.resolve();let r=this._findMatchingItem(e,t.name);if(r&&this._getQuantity(r)>0){let e={};return e["system."+this.quantityField]=this._getQuantity(r)-1,r.update(e)}return Promise.resolve()}async setInventory(e,t,r){if(!t.consumable)return Promise.resolve();let i=this._findMatchingItem(e,t.name),s={};return s["system."+this.quantityField]=r,i.update(s)}}class a{quantityField="quantity";constructor(e){this.quantityField=e??"quantity"}actorHasLightSource(e,t){let[r]=e.findEquipmentByName(t.name);return!!r}getImage(){return s}getInventory(e,t){let[r]=e.findEquipmentByName(t.name);return r?r.count:void 0}async decrementInventory(e,t){if(!t.consumable)return Promise.resolve();let[r,i]=e.findEquipmentByName(t.name);return r&&r.count>0&&e.updateEqtCount(i,r.count-1),Promise.resolve()}async setInventory(e,t,r){if(!t.consumable)return Promise.resolve();let[i,s]=e.findEquipmentByName(t.name);return i&&e.updateEqtCount(s,r),Promise.resolve()}}class o{quantityField="quantity";constructor(){}actorHasLightSource(e,t){return"Self"===t.name}getImage(e,t){return s}getInventory(e,t){return 1}async decrementInventory(e,t){return Promise.resolve()}}class c{static commonLibrary;library;constructor(e){this.library=e}static applyFieldDefaults(e,t){for(const r in e){const i=t&&t.hasOwnProperty(r)?t[r]:null;e[r].system||(e[r].system=r),e[r].topology||(e[r].topology=i?i.topology:"standard"),e[r].quantity||(e[r].quantity=i?i.quantity:"quantity"),e[r].sources||(e[r].sources={});const s=e[r].sources;for(const e in s){const t=i?i.sources[e]:null;s[e].name||(s[e].name=e),s[e].type||(s[e].type=t?t.type:"equipment"),void 0===s[e].consumable&&(s[e].consumable=!!t&&t.consumable),"true"===s[e].consumable&&(s[e].consumable=!0),"false"===s[e].consumable&&(s[e].consumable=!1),s[e].light&&s[e].light.constructor!==Array&&(s[e].light=[s[e].light]),s[e].light&&s[e].light.constructor===Array&&!s[e].states&&(s[e].states=s[e].light.length+1)}if(e[r].aliases){e[r].sources||(e[r].sources={});let t=e[r].sources,s=e[r].aliases;for(const e in s){let r=s[e],n=t[r]?t[r]:i&&i.sources[r]?i.sources[r]:null;n&&(t[e]=Object.assign({},n,{name:e}))}}}}static async load(e,t,r,s,n,a){c.commonLibrary||(c.commonLibrary=await fetch("modules/torch/sources.json").then((e=>e.json())),this.applyFieldDefaults(c.commonLibrary));let o=Object.assign({},a);o.bright=t,o.dim=r;let u={system:e,name:s,states:2,light:[o]},g=n?await fetch(n).then((e=>e.json())).then((e=>(this.applyFieldDefaults(e,c.commonLibrary),l(e,c.commonLibrary,u)))).catch((e=>{console.warn("Failed loading user library: ",e)})):l({},c.commonLibrary,u);if(g[e])return g[e].topology=i(g[e].topology,g[e].quantity),new c(g[e]);{g.default.topology=i(g.default.topology,g.default.quantity);let e=g.default;return e.sources.Self.light[0].bright=t,e.sources.Self.light[0].dim=r,new c(e)}}get lightSources(){return this.library.sources}getLightSource(e){if(e)for(let t in this.library.sources)if(t.toLowerCase()===e.toLowerCase())return this.library.sources[t]}getInventory(e,t){let r=this.getLightSource(t);return this.library.topology.getInventory(e,r)}async _presetInventory(e,t,r){let i=this.getLightSource(t);return this.library.topology.setInventory(e,i,r)}async decrementInventory(e,t){let r=this.getLightSource(t);return this.library.topology.decrementInventory(e,r)}getImage(e,t){let r=this.getLightSource(t);return this.library.topology.getImage(e,r)}actorHasLightSource(e,t){let r=this.getLightSource(t);return this.library.topology.actorHasLightSource(e,r)}actorLightSources(e){let t=[];for(let r in this.library.sources)if(this.library.topology.actorHasLightSource(e,this.library.sources[r])){let i=Object.assign({image:this.library.topology.getImage(e,this.library.sources[r])},this.library.sources[r]);t.push(i)}return t}}let l=function(e,t,r){let i={};for(let e in t)i[e]={system:t[e].system,topology:t[e].topology,quantity:t[e].quantity,sources:{}};if(e)for(let r in e)r in t||(i[r]={system:e[r].system,topology:e[r].topology,quantity:e[r].quantity,sources:{}});for(let s in i){if(e&&s in e)for(let t in e[s].sources){let r=e[s].sources[t];i[s].sources[t]={name:r.name,type:r.type,consumable:r.consumable,states:r.states,light:Object.assign({},r.light)}}let n="";if(r.name){let e=!1,a=null;if(s===r.system){for(let t in i[s].sources)if(t.toLowerCase()===r.name.toLowerCase()){e=!0;break}if(!e&&t[s]){for(let e in t[s].sources)if(e.toLowerCase()===r.name.toLowerCase()){n=e,a=t[s].sources[e];break}n||(n=r.name),i[s].sources[n]={name:n,type:a?a.type:"equipment",consumable:!a||a.consumable,states:r.states,light:r.light}}}}if(s in t)for(let r in t[s].sources)if(!(e&&s in e&&r in e[s].sources||n&&r===n)){let e=t[s].sources[r];i[s].sources[r]={name:e.name,type:e.type,consumable:e.consumable,states:e.states,light:Object.assign({},e.light)}}}return i}},548:(e,t,r)=>{r.d(t,{c:()=>i});class i{static get playerTorches(){return game.settings.get("torch","playerTorches")}static get gmUsesInventory(){return game.settings.get("torch","gmUsesInventory")}static get userUsesInventory(){return game.settings.get("torch","playerUsesInventory")}static get inventoryItemName(){return game.settings.get("torch","gmInventoryItemName")}static get lightRadii(){return{bright:game.settings.get("torch","brightRadius"),dim:game.settings.get("torch","dimRadius")}}static get gameLightSources(){return game.settings.get("torch","gameLightSources")}static get dancingLightsVision(){return"dnd5e"===game.system.id&&game.settings.get("torch","dancingLightVision")}static get helpText(){return`\n<h3>Torch</h3>\n<ol class="hotkey-list">\n\t<li>\n\t\t<h4>${game.i18n.localize("torch.turnOffAllLights")}</h4>\n\t\t<div class="keys">${game.i18n.localize("torch.holdCtrlOnClick")}</div>\n\t</li>\n</ol>\n`}static register(){game.settings.register("torch","playerTorches",{name:game.i18n.localize("torch.playerTorches.name"),hint:game.i18n.localize("torch.playerTorches.hint"),scope:"world",config:!0,default:!0,type:Boolean}),game.settings.register("torch","gmUsesInventory",{name:game.i18n.localize("torch.gmUsesInventory.name"),hint:game.i18n.localize("torch.gmUsesInventory.hint"),scope:"world",config:!0,default:!1,type:Boolean}),game.settings.register("torch","playerUsesInventory",{name:game.i18n.localize("torch.playerUsesInventory.name"),hint:game.i18n.localize("torch.playerUsesInventory.hint"),scope:"world",config:!0,default:!0,type:Boolean}),game.settings.register("torch","gmInventoryItemName",{name:game.i18n.localize("torch.gmInventoryItemName.name"),hint:game.i18n.localize("torch.gmInventoryItemName.hint"),scope:"world",config:!0,default:"torch",type:String}),game.settings.register("torch","gameLightSources",{name:game.i18n.localize("torch.gameLightSources.name"),hint:game.i18n.localize("torch.gameLightSources.hint"),filePicker:"any",scope:"world",config:!0,default:"",type:String}),game.settings.register("torch","brightRadius",{name:game.i18n.localize("torch.brightRadius.name"),hint:game.i18n.localize("torch.brightRadius.hint"),scope:"world",config:!0,default:20,type:Number}),game.settings.register("torch","dimRadius",{name:game.i18n.localize("torch.dimRadius.name"),hint:game.i18n.localize("torch.dimRadius.hint"),scope:"world",config:!0,default:40,type:Number}),"dnd5e"===game.system.id&&game.settings.register("torch","dancingLightVision",{name:game.i18n.localize("torch.dancingLightVision.name"),hint:game.i18n.localize("torch.dancingLightVision.hint"),scope:"world",config:!0,default:!1,type:Boolean})}}},2:(e,t,r)=>{r.d(t,{c:()=>n});const i={"create:dnd5e:Dancing Lights":["TOKEN_CREATE","TOKEN_DELETE"],"delete:dnd5e:Dancing Lights":["TOKEN_DELETE"]};class s{static ACTIONS={"create:dnd5e:Dancing Lights":s.createDancingLights,"delete:dnd5e:Dancing Lights":s.removeDancingLights};static isPermitted(e,t){return!(t in i)||i[t].every((t=>e.can(t)))}static supports(e){return e in s.ACTIONS}static perform(e,t,r,i){s.ACTIONS[e](t,r,i)}static async createDancingLights(e,t,r){let i=game.settings.get("torch","dancingLightVision"),s={actorData:{},actorId:t.actor.id,actorLink:!1,bar1:{attribute:""},bar2:{attribute:""},displayBars:CONST.TOKEN_DISPLAY_MODES.NONE,displayName:CONST.TOKEN_DISPLAY_MODES.HOVER,disposition:CONST.TOKEN_DISPOSITIONS.FRIENDLY,flags:{},height:1,hidden:!1,light:r,lockRotation:!1,name:"Dancing Light",randomimg:!1,rotation:0,sight:{bright:0,dim:0,angle:360},texture:{src:"icons/magic/light/explosion-star-glow-orange.webp",scaleX:.25,scaleY:.25,rotation:0},mirrorX:!1,vision:i,width:1},n=e.grid.size*t.height,a=e.grid.size*t.width,o={x:t.x+a/2,y:t.y+n/2},c=[Object.assign({x:o.x-a,y:o.y-n},s),Object.assign({x:o.x,y:o.y-n},s),Object.assign({x:o.x-a,y:o.y},s),Object.assign({x:o.x,y:o.y},s)];await e.createEmbeddedDocuments("Token",c,{temporary:!1,renderSheet:!1})}static async removeDancingLights(e,t,r){let i=[];e.tokens.forEach((r=>{t.actor.id===r.actor.id&&"Dancing Light"===r.name&&i.push(e.getEmbeddedDocument("Token",r.id).id)})),await e.deleteEmbeddedDocuments("Token",i)}}class n{static async handleSocketRequest(e){if(void 0===e.addressTo||e.addressTo===game.user.id){let t=game.scenes.get(e.sceneId),r=t.tokens.get(e.tokenId);s.supports(e.requestType)?await s.perform(e.requestType,t,r,e.lightSettings):console.warning(`Torch | --- Attempted unregistered socket action ${e.requestType}`)}}static requestSupported(e,t){return s.supports(`${e}:${game.system.id}:${t}`)}static async sendRequest(e,t,r,i){let a={requestType:`${t}:${game.system.id}:${r}`,sceneId:canvas.scene.id,tokenId:e,lightSettings:i};if(s.supports(a.requestType)){if(s.isPermitted(game.user,a.requestType))return n.handleSocketRequest(a),!0;{let e=game.users.contents.find((e=>e.active&&s.isPermitted(e,a.requestType)));return e?(a.addressTo=e.id,game.socket.emit("module.torch",a),!0):(ui.notifications.error("No GM available for Dancing Lights!"),!1)}}console.warning(`Torch | --- Requested unregistered socket action ${a.requestType}`)}}},64:(e,t,r)=>{r.d(t,{c:()=>a});var i=r(2),s=r(548);const n=function(e){let t={};for(let r in e)t["light."+r]=e[r];return t};class a{STATE_ON="on";STATE_DIM="dim";STATE_OFF="off";_token;_library;_ownedSources;constructor(e,t){this._token=e,this._library=t,this._ownedSources=t.actorLightSources(this._token.actor)}get ownedLightSources(){return this._ownedSources}get lightSourceState(){let e=this._token.getFlag("torch","lightSourceState");return void 0===e?this.STATE_OFF:e}get currentLightSource(){let e=this._token.getFlag("torch","lightSource");if(e&&this._ownedSources.find((t=>t.name===e)))return e;let t=s.c.inventoryItemName,r=t?this._ownedSources.find((e=>e.name.toLowerCase()===t.toLowerCase())):void 0;return t&&r?r.name:this._ownedSources.length>0?this._ownedSources[0].name:void 0}async setCurrentLightSource(e){await this._token.setFlag("torch","lightSource",e)}lightSourceIsExhausted(e){return!!this._library.getLightSource(e).consumable&&0===this._library.getInventory(this._token.actor,e)}getInventory(e){let t=this._library.getLightSource(e);return t&&t.consumable?this._library.getInventory(this._token.actor,e):t?-1:void 0}async forceStateOff(){await this._token.setFlag("torch","lightSourceState",this.STATE_OFF),await this._turnOffSource()}async advanceState(){let e=this.currentLightSource,t=this.lightSourceState;switch(t=3===this._library.getLightSource(e).states?t===this.STATE_OFF?this.STATE_ON:t===this.STATE_ON?this.STATE_DIM:this.STATE_OFF:t===this.STATE_OFF?this.STATE_ON:this.STATE_OFF,await this._token.setFlag("torch","lightSourceState",t),t){case this.STATE_OFF:await this._turnOffSource();break;case this.STATE_ON:await this._turnOnSource();break;case this.STATE_DIM:await this._dimSource();break;default:await this._turnOffSource()}return t}async _turnOffSource(){let e=this._library.getLightSource(this.currentLightSource);if(i.c.requestSupported("delete",this.currentLightSource))i.c.sendRequest(this._token.id,"delete",this.currentLightSource,e.light);else{let t=game.actors.get(this._token.actorId).prototypeToken;await this._token.update(n(t.light)),e.consumable&&await this._consumeSource(e)}}async _turnOnSource(){let e=this._library.getLightSource(this.currentLightSource);i.c.requestSupported("create",this.currentLightSource)?i.c.sendRequest(this._token.id,"create",this.currentLightSource,e.light[0]):await this._token.update(n(e.light[0]))}async _dimSource(){let e=this._library.getLightSource(this.currentLightSource);3===e.states&&await this._token.update(n(e.light[1]))}async _consumeSource(e){(game.user.isGM&&s.c.gmUsesInventory||!game.user.isGM&&s.c.userUsesInventory)&&this._library.getInventory(this._token.actor,e.name)&&await this._library.decrementInventory(this._token.actor,e.name)}}}},r={};function i(e){var s=r[e];if(void 0!==s)return s.exports;var n=r[e]={exports:{}};return t[e](n,n.exports,i),n.exports}i.m=t,i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,r)=>(i.f[r](e,t),t)),[])),i.u=e=>e+".js",i.miniCssF=e=>{},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},i.l=(t,r,s,n)=>{if(e[t])e[t].push(r);else{var a,o;if(void 0!==s)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var u=c[l];if(u.getAttribute("src")==t){a=u;break}}a||(o=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,i.nc&&a.setAttribute("nonce",i.nc),a.src=t),e[t]=[r];var g=(r,i)=>{a.onerror=a.onload=null,clearTimeout(h);var s=e[t];if(delete e[t],a.parentNode&&a.parentNode.removeChild(a),s&&s.forEach((e=>e(i))),r)return r(i)},h=setTimeout(g.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=g.bind(null,a.onerror),a.onload=g.bind(null,a.onload),o&&document.head.appendChild(a)}},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var s=r.length-1;s>-1&&!e;)e=r[s--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),(()=>{var e={728:0};i.f.j=(t,r)=>{var s=i.o(e,t)?e[t]:void 0;if(0!==s)if(s)r.push(s[2]);else{var n=new Promise(((r,i)=>s=e[t]=[r,i]));r.push(s[2]=n);var a=i.p+i.u(t),o=new Error;i.l(a,(r=>{if(i.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var n=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.src;o.message="Loading chunk "+t+" failed.\n("+n+": "+a+")",o.name="ChunkLoadError",o.type=n,o.request=a,s[1](o)}}),"chunk-"+t,t)}};var t=(t,r)=>{var s,n,[a,o,c]=r,l=0;if(a.some((t=>0!==e[t]))){for(s in o)i.o(o,s)&&(i.m[s]=o[s]);c&&c(i)}for(t&&t(r);l<a.length;l++)n=a[l],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0},r=self.webpackChunk=self.webpackChunk||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),(()=>{var e=i(548),t=i(2);const r='<i class="fas fa-slash"></i>';class s{static async addQueryButton(e,t){let r=$('<div class="control-icon torch"><i class="fas fa-question"></i></div>');t.find(".col.left").prepend(r),r.find("i").click((async e=>{e.preventDefault(),e.stopPropagation(),new Dialog({title:game.i18n.localize("torch.help.setupSources.title"),content:game.i18n.localize("torch.help.setupSources.body"),buttons:{close:{icon:'<i class="fas fa-check"></i>',label:game.i18n.localize("Close")}},default:"close"}).render(!0)}))}static async addFlameButton(e,t,i,n,a,o){let c=e.lightSourceState,l=e.lightSourceIsExhausted(e.currentLightSource),u=$('<div class="control-icon torch"><i class="fas fa-fire"></i></div>');if(c===e.STATE_ON)u.addClass("active");else if(c===e.STATE_DIM)u.addClass("active");else if(l){let e=$(r);u.addClass("fa-stack"),u.find("i").addClass("fa-stack-1x"),e.addClass("fa-stack-1x"),u.prepend(e)}t.find(".col.left").prepend(u),u.find("i.fa-fire").contextmenu((async t=>{t.preventDefault(),t.stopPropagation(),e.lightSourceState===e.STATE_OFF&&s.toggleSourceMenu(u,e,o)})),u.find("i").click((async t=>{t.preventDefault(),t.stopPropagation(),u.next().hasClass("light-source-menu")||(e.lightSourceIsExhausted(e.currentLightSource)?new Dialog({title:game.i18n.localize("torch.help.supplyExhausted.title"),content:game.i18n.localize("torch.help.supplyExhausted.body"),buttons:{close:{icon:'<i class="fas fa-check"></i>',label:"Close"}},default:"close"}).render(!0):t.shiftKey?a(e):t.altKey?(await i(e),s.syncFlameButtonState(u,e)):(await n(e),s.syncFlameButtonState(u,e)))}))}static toggleSourceMenu(e,t,r){let i=e.next();if(i.hasClass("light-source-menu"))return void i.remove();let n=$('<div class="control-icon light-source-menu"></div>'),a=t.ownedLightSources,o=t.currentLightSource;for(let i of a){let a=$(`<button type="button" class="light-source-menu-item" >\n\t  <img src="${i.image}" title="${i.name}" />\n\t</button>`);i.name===o&&a.addClass("active"),t.lightSourceIsExhausted(i.name)&&a.addClass("exhausted"),a.click((async n=>{let a=$(n.currentTarget.parentElement);await r(t,i.name),s.syncDisabledState(e,t),a.remove()})),n.append(a)}e.after(n)}static syncDisabledState(e,t){let i=e.find(".fa-slash"),s=i.length>0,n=t.lightSourceIsExhausted(t.currentLightSource);if(!s&&n){let t=$(r);e.addClass("fa-stack"),e.find("i").addClass("fa-stack-1x"),t.addClass("fa-stack-1x"),e.prepend(t)}else s&&!n&&(i.remove(),e.find("i").removeClass("fa-stack-1x"),e.removeClass("fa-stack"))}static syncFlameButtonState(e,t){let r=t.lightSourceState;r===t.STATE_ON||r===t.STATE_DIM?e.addClass("active"):e.removeClass("active")}}var n=i(64),a=i(774);class o{async#e(t,r){let i=game.scenes.get(t).tokens.get(r),s=game.actors.get(i.actorId),o=await a.c.load(game.system.id,e.c.lightRadii.bright,e.c.lightRadii.dim,e.c.inventoryItemName,e.c.gameLightSources,s.prototypeToken.light);return new n.c(i,o)}#t(e,t,r){const i=/[A-Za-z0-9]+/;let s;if("string"==typeof t&&i.test(t)||(s="first parm - scene id - isn't an id string"),"string"==typeof r&&i.test(r)||(s="second parm - token id - isn't an id string"),s)throw`${e} : ${s}`}#r(e,t,r,i){const s=/[A-Za-z0-9]+/;let n;if("string"==typeof t&&s.test(t)||(rresult="first parm - scene id - isn't an id string"),"string"==typeof r&&s.test(r)||(n="second parm - token id - isn't an id string"),("string"!=typeof i||i.length<1)&&(n="third parm - source name - isn't the name of a light source"),n)throw`${e} : ${n}`}async toggle(e,t){this.#t("toggle",e,t);let r=await this.#e(e,t);return await r.advanceState()}async extinguish(e,t){this.#t("extinguish",e,t);let r=await this.#e(e,t);return await r.forceStateOff()}async currentSource(e,t){this.#t("currentSource",e,t);let r=await this.#e(e,t);return await r.currentLightSource}async currentState(e,t){this.#t("currentState",e,t);let r=await this.#e(e,t);return await r.lightSourceState}async equippedSources(e,t){this.#t("equippedSources",e,t);let r=await this.#e(e,t);return await r.ownedLightSources.map((e=>e.name))}async selectSource(e,t,r){this.#r("selectSource",e,t,r);let i=await this.#e(e,t);return await i.setCurrentLightSource(r)}async inventory(e,t,r){this.#r("inventory",e,t,r);let i=await this.#e(e,t);return await i.getInventory(r)}async sourceExhausted(e,t,r){this.#r("sourceExhausted",e,t,r);let i=await this.#e(e,t);return await i.lightSourceIsExhausted(r)}}let c=(...e)=>{console.log(...e)};class l{static async addTorchButton(t,r,i){let o=game.actors.get(t.object.document.actorId),c=await a.c.load(game.system.id,e.c.lightRadii.bright,e.c.lightRadii.dim,e.c.inventoryItemName,e.c.gameLightSources,o.prototypeToken.light),u=new n.c(t.object.document,c),g=u.ownedLightSources;t.object.document.name in g||(game.user.isGM||e.c.playerTorches)&&(u.currentLightSource?s.addFlameButton(u,r,l.forceSourceOff,l.toggleLightSource,l.toggleLightHeld,l.changeLightSource):s.addQueryButton(u,r))}static async toggleLightSource(e){let t=await e.advanceState();c(`${e.currentLightSource} is now ${t}`)}static async forceSourceOff(e){await e.forceSourceOff(),c(`Forced ${e.currentLightSource} off`)}static async toggleLightHeld(e){}static async changeLightSource(e,t){await e.setCurrentLightSource(t)}static setupQuenchTesting(){console.log("Torch | --- In test environment - load test code..."),i.e(408).then(i.bind(i,408)).then((e=>{try{e.hookTests(),console.log("Torch | --- Tests ready")}catch(e){console.log("Torch | --- Error registering test code",e)}})).catch((e=>{console.log("Torch | --- No test code found",e)}))}}Hooks.on("ready",(()=>{Hooks.on("renderTokenHUD",((e,t,r)=>{l.addTorchButton(e,t,r)})),Hooks.on("renderControlsReference",((t,r,i)=>{r.find("div").first().append(e.c.helpText)})),game.socket.on("module.torch",(e=>{t.c.handleSocketRequest(e)}))})),Hooks.once("init",(()=>{game.world.id.startsWith("torch-test-")&&l.setupQuenchTesting(),e.c.register(),game.Torch=new o})),console.log("Torch | --- Module loaded")})()})();
//# sourceMappingURL=torch.js.map