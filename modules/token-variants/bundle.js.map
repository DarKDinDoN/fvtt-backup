{"mappings":"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","sources":["token-variants/applications/overlayConfig.js","token-variants/scripts/models.js","token-variants/scripts/hooks/effectMappingHooks.js","token-variants/scripts/settings.js","token-variants/scripts/utils.js","token-variants/token-variants.mjs","token-variants/applications/artSelect.js","token-variants/applications/tokenCustomConfig.js","token-variants/scripts/token/overlay.js","token-variants/scripts/sprite/TVAOverlay.js","token-variants/scripts/hooks/overlayHooks.js","token-variants/scripts/sprite/HTMLOverlay.js","token-variants/scripts/hooks/hooks.js","token-variants/scripts/hooks/effectIconHooks.js","token-variants/scripts/hooks/artSelectButtonHooks.js","token-variants/scripts/hooks/hudHooks.js","token-variants/applications/tileHUD.js","token-variants/applications/flagsConfig.js","token-variants/scripts/search.js","token-variants/scripts/fuse/fuse.js","token-variants/applications/userList.js","token-variants/applications/tokenHUD.js","token-variants/applications/effectMappingForm.js","token-variants/applications/configJsonEdit.js","token-variants/applications/configScriptEdit.js","token-variants/applications/dialogs.js","token-variants/scripts/mappingTemplates.js","token-variants/applications/templates.js","token-variants/applications/randomizerConfig.js","token-variants/scripts/hooks/userMappingHooks.js","token-variants/scripts/hooks/wildcardHooks.js","token-variants/scripts/hooks/popUpRandomizeHooks.js","token-variants/scripts/wrappers/wrappers.js","token-variants/scripts/wrappers/effectIconWrappers.js","token-variants/scripts/wrappers/hideElementWrappers.js","token-variants/scripts/wrappers/hudWrappers.js","token-variants/scripts/reticle.js","token-variants/scripts/wrappers/userMappingWrappers.js","token-variants/applications/compendiumMap.js","token-variants/applications/configureSettings.js","token-variants/applications/missingImageConfig.js","token-variants/applications/forgeSearchPaths.js","token-variants/applications/tokenHUDClientSettings.js","token-variants/applications/importExport.js"],"sourcesContent":["import { CORE_SHAPE, DEFAULT_OVERLAY_CONFIG, OVERLAY_SHAPES } from '../scripts/models.js';\r\nimport { VALID_EXPRESSION, getAllEffectMappings } from '../scripts/hooks/effectMappingHooks.js';\r\nimport { evaluateOverlayExpressions, genTexture } from '../scripts/token/overlay.js';\r\nimport { SEARCH_TYPE } from '../scripts/utils.js';\r\nimport { showArtSelect } from '../token-variants.mjs';\r\nimport { sortMappingsToGroups } from './effectMappingForm.js';\r\nimport { getFlagMappings } from '../scripts/settings.js';\r\nimport { Reticle } from '../scripts/reticle.js';\r\n\r\nexport class OverlayConfig extends FormApplication {\r\n  constructor(config, callback, id, token) {\r\n    super({}, {});\r\n    this.config = config ?? {};\r\n    this.config.id = id;\r\n    this.callback = callback;\r\n    this.token = canvas.tokens.get(token._id);\r\n    this.previewConfig = deepClone(this.config);\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-overlay-config',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/overlayConfig.html',\r\n      resizable: false,\r\n      minimizable: false,\r\n      title: 'Overlay Settings',\r\n      width: 500,\r\n      height: 'auto',\r\n      tabs: [{ navSelector: '.sheet-tabs', contentSelector: '.content', initial: 'misc' }],\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n\r\n    html.find('.reticle').on('click', (event) => {\r\n      const icons = this.getPreviewIcons();\r\n      if (icons.length) {\r\n        Reticle.activate({ tvaOverlay: icons[0].icon, app: this, config: this.previewConfig });\r\n      }\r\n    });\r\n\r\n    const imgLinkDisable = function (disabled) {\r\n      html.find('.img-link-disable').prop('disabled', disabled);\r\n    };\r\n\r\n    html.find('.image-link').on('click', (event) => {\r\n      const chkBox = $(event.target).closest('.form-group').find('[name=\"imgLinked\"]');\r\n      const button = $(event.target).closest('button');\r\n      if (chkBox.is(':checked')) {\r\n        chkBox.prop('checked', false);\r\n        button.removeClass('active');\r\n        imgLinkDisable(false);\r\n      } else {\r\n        chkBox.prop('checked', true);\r\n        button.addClass('active');\r\n        imgLinkDisable(true);\r\n      }\r\n    });\r\n    imgLinkDisable(Boolean(this.config.imgLinked));\r\n\r\n    html.find('.repeat').on('change', (event) => {\r\n      const fieldset = $(event.target).closest('fieldset');\r\n      const content = fieldset.find('.content');\r\n      if (event.target.checked) {\r\n        content.show();\r\n        fieldset.addClass('active');\r\n      } else {\r\n        content.hide();\r\n        fieldset.removeClass('active');\r\n      }\r\n      this.setPosition();\r\n    });\r\n\r\n    // Insert Controls to the Shape Legend\r\n    const shapeLegends = html.find('.shape-legend');\r\n    let config = this.config;\r\n    shapeLegends.each(function (i) {\r\n      const legend = $(this);\r\n      legend.append(\r\n        `&nbsp;<a class=\"cloneShape\" data-index=\"${i}\" title=\"Clone\"><i class=\"fas fa-clone\"></i></a>\r\n         &nbsp;<a class=\"deleteShape\" data-index=\"${i}\" title=\"Remove\"><i class=\"fas fa-trash-alt\"></i></a>`\r\n      );\r\n      if (i != 0) {\r\n        legend.append(\r\n          `&nbsp;<a class=\"moveShapeUp\" data-index=\"${i}\" title=\"Move Up\"><i class=\"fas fa-arrow-up\"></i></a>`\r\n        );\r\n      }\r\n      if (i != shapeLegends.length - 1) {\r\n        legend.append(\r\n          `&nbsp;<a class=\"moveShapeDown\" data-index=\"${i}\" title=\"Move Down\"><i class=\"fas fa-arrow-down\"></i></a>`\r\n        );\r\n      }\r\n      legend.append(\r\n        `<input class=\"shape-legend-input\" type=\"text\" name=\"shapes.${i}.label\" value=\"${\r\n          config.shapes?.[i]?.label ?? ''\r\n        }\">`\r\n      );\r\n    });\r\n\r\n    // Shape listeners\r\n    html.find('.addShape').on('click', this._onAddShape.bind(this));\r\n    html.find('.addEvent').on('click', this._onAddEvent.bind(this));\r\n    html.find('.deleteShape').on('click', this._onDeleteShape.bind(this));\r\n    html.find('.deleteEvent').on('click', this._onDeleteEvent.bind(this));\r\n    html.find('.moveShapeUp').on('click', this._onMoveShapeUp.bind(this));\r\n    html.find('.moveShapeDown').on('click', this._onMoveShapeDown.bind(this));\r\n    html.find('.cloneShape').on('click', this._onCloneShape.bind(this));\r\n\r\n    html.find('input,select').on('change', this._onInputChange.bind(this));\r\n    html.find('textarea').on('input', this._onInputChange.bind(this));\r\n    const parentId = html.find('[name=\"parentID\"]');\r\n    parentId.on('change', (event) => {\r\n      if (event.target.value === 'TOKEN') {\r\n        html.find('.token-specific-fields').show();\r\n      } else {\r\n        html.find('.token-specific-fields').hide();\r\n      }\r\n      this.setPosition();\r\n    });\r\n    parentId.trigger('change');\r\n    html\r\n      .find('[name=\"ui\"]')\r\n      .on('change', (event) => {\r\n        if (parentId.val() === 'TOKEN') {\r\n          if (event.target.checked) {\r\n            html.find('.ui-hide').hide();\r\n          } else {\r\n            html.find('.ui-hide').show();\r\n          }\r\n          this.setPosition();\r\n        }\r\n      })\r\n      .trigger('change');\r\n\r\n    html.find('[name=\"filter\"]').on('change', (event) => {\r\n      html.find('.filterOptions').empty();\r\n      const filterOptions = $(genFilterOptionControls(event.target.value));\r\n      html.find('.filterOptions').append(filterOptions);\r\n      this.setPosition({ height: 'auto' });\r\n      this.activateListeners(filterOptions);\r\n    });\r\n\r\n    html.find('.token-variants-image-select-button').click((event) => {\r\n      showArtSelect(this.token?.name ?? 'overlay', {\r\n        searchType: SEARCH_TYPE.TOKEN,\r\n        callback: (imgSrc, imgName) => {\r\n          if (imgSrc) $(event.target).closest('.form-group').find('input').val(imgSrc).trigger('change');\r\n        },\r\n      });\r\n    });\r\n\r\n    html.find('.presetImport').on('click', (event) => {\r\n      const presetName = $(event.target).closest('.form-group').find('.tmfxPreset').val();\r\n      if (presetName) {\r\n        const preset = TokenMagic.getPreset(presetName);\r\n        if (preset) {\r\n          $(event.target).closest('.form-group').find('textarea').val(JSON.stringify(preset, null, 2)).trigger('input');\r\n        }\r\n      }\r\n    });\r\n\r\n    // Controls for locking scale sliders together\r\n    let scaleState = { locked: true };\r\n\r\n    // Range inputs need to be triggered when slider moves to initiate preview\r\n    html\r\n      .find('.range-value')\r\n      .siblings('[type=\"range\"]')\r\n      .on('change', (event) => {\r\n        $(event.target).siblings('.range-value').val(event.target.value).trigger('change');\r\n      });\r\n\r\n    const lockButtons = $(html).find('.scaleLock > a');\r\n    const sliderScaleWidth = $(html).find('[name=\"scaleX\"]');\r\n    const sliderScaleHeight = $(html).find('[name=\"scaleY\"]');\r\n    const sliderWidth = html.find('.scaleX');\r\n    const sliderHeight = html.find('.scaleY');\r\n\r\n    lockButtons.on('click', function () {\r\n      scaleState.locked = !scaleState.locked;\r\n      lockButtons.html(scaleState.locked ? '<i class=\"fas fa-link\"></i>' : '<i class=\"fas fa-unlink\"></i>');\r\n    });\r\n\r\n    sliderScaleWidth.on('change', function () {\r\n      if (scaleState.locked && sliderScaleWidth.val() !== sliderScaleHeight.val()) {\r\n        sliderScaleHeight.val(sliderScaleWidth.val()).trigger('change');\r\n        sliderHeight.val(sliderScaleWidth.val());\r\n      }\r\n    });\r\n    sliderScaleHeight.on('change', function () {\r\n      if (scaleState.locked && sliderScaleWidth.val() !== sliderScaleHeight.val()) {\r\n        sliderScaleWidth.val(sliderScaleHeight.val()).trigger('change');\r\n        sliderWidth.val(sliderScaleHeight.val());\r\n      }\r\n    });\r\n    html.on('change', '.scaleX', () => {\r\n      sliderScaleWidth.trigger('change');\r\n    });\r\n    html.on('change', '.scaleY', () => {\r\n      sliderScaleHeight.trigger('change');\r\n    });\r\n\r\n    html.find('.me-edit-json').on('click', async (event) => {\r\n      const textarea = $(event.target).closest('.form-group').find('textarea');\r\n      let params;\r\n      try {\r\n        params = eval(textarea.val());\r\n      } catch (e) {\r\n        console.warn('TVA |', e);\r\n      }\r\n\r\n      if (params) {\r\n        let param;\r\n        if (Array.isArray(params)) {\r\n          if (params.length === 1) param = params[0];\r\n          else {\r\n            let i = await promptParamChoice(params);\r\n            if (i < 0) return;\r\n            param = params[i];\r\n          }\r\n        } else {\r\n          param = params;\r\n        }\r\n\r\n        if (param)\r\n          game.modules.get('multi-token-edit').api.showGenericForm(param, param.filterType ?? 'TMFX', {\r\n            inputChangeCallback: (selected) => {\r\n              mergeObject(param, selected, { inplace: true });\r\n              textarea.val(JSON.stringify(params, null, 2)).trigger('input');\r\n            },\r\n          });\r\n      }\r\n    });\r\n\r\n    const underlay = html.find('[name=\"underlay\"]');\r\n    const top = html.find('[name=\"top\"]');\r\n    const bottom = html.find('[name=\"bottom\"]');\r\n    underlay.change(function () {\r\n      if (this.checked) top.prop('checked', false);\r\n      else bottom.prop('checked', false);\r\n    });\r\n    top.change(function () {\r\n      if (this.checked) {\r\n        underlay.prop('checked', false);\r\n        bottom.prop('checked', false);\r\n      }\r\n    });\r\n    bottom.change(function () {\r\n      if (this.checked) {\r\n        underlay.prop('checked', true);\r\n        top.prop('checked', false);\r\n      }\r\n    });\r\n\r\n    const linkScale = html.find('[name=\"linkScale\"]');\r\n    const linkDimensions = html.find('[name=\"linkDimensionsX\"], [name=\"linkDimensionsY\"]');\r\n    const linkStageScale = html.find('[name=\"linkStageScale\"]');\r\n    linkScale.change(function () {\r\n      if (this.checked) {\r\n        linkDimensions.prop('checked', false);\r\n        linkStageScale.prop('checked', false);\r\n      }\r\n    });\r\n    linkDimensions.change(function () {\r\n      if (this.checked) {\r\n        linkScale.prop('checked', false);\r\n        linkStageScale.prop('checked', false);\r\n      }\r\n    });\r\n    linkStageScale.change(function () {\r\n      if (this.checked) {\r\n        linkScale.prop('checked', false);\r\n        linkDimensions.prop('checked', false);\r\n      }\r\n    });\r\n\r\n    // Setting border color for property expression\r\n    const limitOnProperty = html.find('[name=\"limitOnProperty\"]');\r\n    limitOnProperty.on('input', (event) => {\r\n      const input = $(event.target);\r\n      if (input.val() === '') {\r\n        input.removeClass('tvaValid');\r\n        input.removeClass('tvaInvalid');\r\n      } else if (input.val().match(VALID_EXPRESSION)) {\r\n        input.addClass('tvaValid');\r\n        input.removeClass('tvaInvalid');\r\n      } else {\r\n        input.addClass('tvaInvalid');\r\n        input.removeClass('tvaValid');\r\n      }\r\n    });\r\n    limitOnProperty.trigger('input');\r\n\r\n    html.find('.create-variable').on('click', this._onCreateVariable.bind(this));\r\n    html.find('.delete-variable').on('click', this._onDeleteVariable.bind(this));\r\n  }\r\n\r\n  _onDeleteVariable(event) {\r\n    let index = $(event.target).closest('tr').data('index');\r\n    if (index != null) {\r\n      this.config = this._getSubmitData();\r\n      if (!this.config.variables) this.config.variables = [];\r\n      this.config.variables.splice(index, 1);\r\n      this.render(true);\r\n    }\r\n  }\r\n\r\n  _onCreateVariable(event) {\r\n    this.config = this._getSubmitData();\r\n    if (!this.config.variables) this.config.variables = [];\r\n    this.config.variables.push({ name: '', value: '' });\r\n    this.render(true);\r\n  }\r\n\r\n  _onAddShape(event) {\r\n    let shape = $(event.target).siblings('select').val();\r\n    shape = deepClone(OVERLAY_SHAPES[shape]);\r\n    shape = mergeObject(deepClone(CORE_SHAPE), { shape });\r\n\r\n    this.config = this._getSubmitData();\r\n\r\n    if (!this.config.shapes) this.config.shapes = [];\r\n    this.config.shapes.push(shape);\r\n\r\n    this.render(true);\r\n  }\r\n\r\n  _onAddEvent(event) {\r\n    let listener = $(event.target).siblings('select').val();\r\n\r\n    this.config = this._getSubmitData();\r\n    if (!this.config.interactivity) this.config.interactivity = [];\r\n    this.config.interactivity.push({ listener, macro: '', script: '' });\r\n\r\n    this.render(true);\r\n  }\r\n\r\n  _onDeleteShape(event) {\r\n    const index = $(event.target).closest('.deleteShape').data('index');\r\n    if (index == null) return;\r\n\r\n    this.config = this._getSubmitData();\r\n    if (!this.config.shapes) this.config.shapes = [];\r\n    this.config.shapes.splice(index, 1);\r\n\r\n    this.render(true);\r\n  }\r\n\r\n  _onDeleteEvent(event) {\r\n    const index = $(event.target).closest('.deleteEvent').data('index');\r\n    if (index == null) return;\r\n\r\n    this.config = this._getSubmitData();\r\n    if (!this.config.interactivity) this.config.interactivity = [];\r\n    this.config.interactivity.splice(index, 1);\r\n\r\n    this.render(true);\r\n  }\r\n\r\n  _onCloneShape(event) {\r\n    const index = $(event.target).closest('.cloneShape').data('index');\r\n    if (!index && index != 0) return;\r\n\r\n    this.config = this._getSubmitData();\r\n    if (!this.config.shapes) return;\r\n    const nShape = deepClone(this.config.shapes[index]);\r\n    if (nShape.label) {\r\n      nShape.label = nShape.label + ' - Copy';\r\n    }\r\n    this.config.shapes.push(nShape);\r\n\r\n    this.render(true);\r\n  }\r\n\r\n  _onMoveShapeUp(event) {\r\n    const index = $(event.target).closest('.moveShapeUp').data('index');\r\n    if (!index) return;\r\n\r\n    this.config = this._getSubmitData();\r\n    if (!this.config.shapes) this.config.shapes = [];\r\n    if (this.config.shapes.length >= 2) this._swapShapes(index, index - 1);\r\n\r\n    this.render(true);\r\n  }\r\n\r\n  _onMoveShapeDown(event) {\r\n    const index = $(event.target).closest('.moveShapeDown').data('index');\r\n    if (!index && index != 0) return;\r\n\r\n    this.config = this._getSubmitData();\r\n    if (!this.config.shapes) this.config.shapes = [];\r\n    if (this.config.shapes.length >= 2) this._swapShapes(index, index + 1);\r\n\r\n    this.render(true);\r\n  }\r\n\r\n  _swapShapes(i1, i2) {\r\n    let temp = this.config.shapes[i1];\r\n    this.config.shapes[i1] = this.config.shapes[i2];\r\n    this.config.shapes[i2] = temp;\r\n  }\r\n\r\n  _convertColor(colString) {\r\n    try {\r\n      const c = Color.fromString(colString);\r\n      const rgba = c.rgb;\r\n      rgba.push(1);\r\n      return rgba;\r\n    } catch (e) {\r\n      return [1, 1, 1, 1];\r\n    }\r\n  }\r\n\r\n  async _onInputChange(event) {\r\n    this.previewConfig = this._getSubmitData();\r\n    if (event.target.type === 'color') {\r\n      const color = $(event.target).siblings('.color');\r\n      color.val(event.target.value).trigger('change');\r\n      return;\r\n    }\r\n    this._applyPreviews();\r\n  }\r\n\r\n  getPreviewIcons() {\r\n    if (!this.config.id) return [];\r\n    const tokens = this.token ? [this.token] : canvas.tokens.placeables;\r\n    const previewIcons = [];\r\n    for (const tkn of tokens) {\r\n      if (tkn.tvaOverlays) {\r\n        for (const c of tkn.tvaOverlays) {\r\n          if (c.overlayConfig && c.overlayConfig.id === this.config.id) {\r\n            // Effect icon found, however if we're in global preview then we need to take into account\r\n            // a token/actor specific mapping which may override the global one\r\n            if (this.token) {\r\n              previewIcons.push({ token: tkn, icon: c });\r\n            } else if (!getFlagMappings(tkn).find((m) => m.id === this.config.id)) {\r\n              previewIcons.push({ token: tkn, icon: c });\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return previewIcons;\r\n  }\r\n\r\n  async _applyPreviews() {\r\n    const targets = this.getPreviewIcons();\r\n    for (const target of targets) {\r\n      const preview = evaluateOverlayExpressions(deepClone(this.previewConfig), target.token, {\r\n        overlayConfig: this.previewConfig,\r\n      });\r\n      target.icon.refresh(preview, {\r\n        preview: true,\r\n        previewTexture: await genTexture(target.token, preview),\r\n      });\r\n    }\r\n  }\r\n\r\n  async _removePreviews() {\r\n    const targets = this.getPreviewIcons();\r\n    for (const target of targets) {\r\n      target.icon.refresh();\r\n    }\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n    data.filters = Object.keys(PIXI.filters);\r\n    data.filters.push('OutlineOverlayFilter');\r\n    data.filters.sort();\r\n    data.tmfxActive = game.modules.get('tokenmagic')?.active;\r\n    if (data.tmfxActive) {\r\n      data.tmfxPresets = TokenMagic.getPresets().map((p) => p.name);\r\n      data.filters.unshift('Token Magic FX');\r\n    }\r\n    data.filters.unshift('NONE');\r\n    const settings = mergeObject(DEFAULT_OVERLAY_CONFIG, this.config, {\r\n      inplace: false,\r\n    });\r\n    data.ceActive = game.modules.get('dfreds-convenient-effects')?.active;\r\n    if (data.ceActive) {\r\n      data.ceEffects = game.dfreds.effects.all.map((ef) => ef.name);\r\n    }\r\n    data.macros = game.macros.map((m) => m.name);\r\n\r\n    if (settings.filter !== 'NONE') {\r\n      const filterOptions = genFilterOptionControls(settings.filter, settings.filterOptions);\r\n      if (filterOptions) {\r\n        settings.filterOptions = filterOptions;\r\n      } else {\r\n        settings.filterOptions = null;\r\n      }\r\n    } else {\r\n      settings.filterOptions = null;\r\n    }\r\n\r\n    data.users = game.users.map((u) => {\r\n      return { id: u.id, name: u.name, selected: settings.limitedUsers.includes(u.id) };\r\n    });\r\n\r\n    data.fonts = Object.keys(CONFIG.fontDefinitions);\r\n\r\n    const allMappings = getAllEffectMappings(this.token, true).filter((m) => m.id !== this.config.id);\r\n    const [_, groupedMappings] = sortMappingsToGroups(allMappings);\r\n\r\n    data.parents = groupedMappings;\r\n    if (!data.parentID) data.parentID = 'TOKEN';\r\n    if (!data.anchor) data.anchor = { x: 0.5, y: 0.5 };\r\n\r\n    // Cache Partials\r\n    for (const shapeName of Object.keys(OVERLAY_SHAPES)) {\r\n      await getTemplate(`modules/token-variants/templates/partials/shape${shapeName}.html`);\r\n    }\r\n    await getTemplate('modules/token-variants/templates/partials/repeating.html');\r\n    await getTemplate('modules/token-variants/templates/partials/interpolateColor.html');\r\n\r\n    data.allShapes = Object.keys(OVERLAY_SHAPES);\r\n    data.textAlignmentOptions = [\r\n      { value: 'left', label: 'Left' },\r\n      { value: 'center', label: 'Center' },\r\n      { value: 'right', label: 'Right' },\r\n      { value: 'justify', label: 'Justify' },\r\n    ];\r\n\r\n    // linkDimensions has been converted to linkDimensionsX and linkDimensionsY\r\n    // Make sure we're using the latest fields\r\n    // 20/07/2023\r\n    if (!('linkDimensionsX' in settings) && settings.linkDimensions) {\r\n      settings.linkDimensionsX = true;\r\n      settings.linkDimensionsY = true;\r\n    }\r\n\r\n    return mergeObject(data, settings);\r\n  }\r\n\r\n  _getHeaderButtons() {\r\n    const buttons = super._getHeaderButtons();\r\n    buttons.unshift({\r\n      label: 'Core Variables',\r\n      class: '.core-variables',\r\n      icon: 'fas fa-file-import fa-fw',\r\n      onclick: () => {\r\n        let content = `\r\n        <table>\r\n          <tr><th>Variable</th><th>Description</th></tr>\r\n          <tr><td>@hp</td><td>Actor Health</td></tr>\r\n          <tr><td>@hpMax</td><td>Actor Health (Max)</td></tr>\r\n          <tr><td>@gridSize</td><td>Grid Size (Pixels)</td></tr>\r\n          <tr><td>@label</td><td>Mapping's Label Field</td></tr>\r\n        </table>\r\n        `;\r\n\r\n        new Dialog({\r\n          title: `Core Variables`,\r\n          content,\r\n          buttons: {},\r\n        }).render(true);\r\n      },\r\n    });\r\n    return buttons;\r\n  }\r\n\r\n  async close(options = {}) {\r\n    super.close(options);\r\n    this._removePreviews();\r\n  }\r\n\r\n  _getSubmitData() {\r\n    let formData = super._getSubmitData();\r\n    formData = expandObject(formData);\r\n\r\n    if (!formData.repeating) delete formData.repeat;\r\n    if (!formData.text.repeating) delete formData.text.repeat;\r\n\r\n    if (formData.shapes) {\r\n      formData.shapes = Object.values(formData.shapes);\r\n      formData.shapes.forEach((shape) => {\r\n        if (!shape.repeating) delete shape.repeat;\r\n      });\r\n    }\r\n\r\n    if (formData.interactivity) {\r\n      formData.interactivity = Object.values(formData.interactivity)\r\n        .map((e) => {\r\n          e.macro = e.macro.trim();\r\n          e.script = e.script.trim();\r\n          if (e.tmfxPreset) e.tmfxPreset = e.tmfxPreset.trim();\r\n          if (e.ceEffect) e.ceEffect = e.ceEffect.trim();\r\n          return e;\r\n        })\r\n        .filter((e) => e.macro || e.script || e.ceEffect || e.tmfxPreset);\r\n    } else {\r\n      formData.interactivity = [];\r\n    }\r\n\r\n    if (formData.variables) {\r\n      formData.variables = Object.values(formData.variables);\r\n      formData.variables = formData.variables.filter((v) => v.name.trim() && v.value.trim());\r\n    }\r\n    if (formData.limitedUsers) {\r\n      if (getType(formData.limitedUsers) === 'string') formData.limitedUsers = [formData.limitedUsers];\r\n      formData.limitedUsers = formData.limitedUsers.filter((uid) => uid);\r\n    } else {\r\n      formData.limitedUsers = [];\r\n    }\r\n\r\n    formData.limitOnEffect = formData.limitOnEffect.trim();\r\n    formData.limitOnProperty = formData.limitOnProperty.trim();\r\n    if (formData.parentID === 'TOKEN') formData.parentID = '';\r\n\r\n    if (formData.filter === 'OutlineOverlayFilter' && 'filterOptions.outlineColor' in formData) {\r\n      formData['filterOptions.outlineColor'] = this._convertColor(formData['filterOptions.outlineColor']);\r\n    } else if (formData.filter === 'BevelFilter') {\r\n      if ('filterOptions.lightColor' in formData)\r\n        formData['filterOptions.lightColor'] = Number(Color.fromString(formData['filterOptions.lightColor']));\r\n      if ('filterOptions.shadowColor' in formData)\r\n        formData['filterOptions.shadowColor'] = Number(Color.fromString(formData['filterOptions.shadowColor']));\r\n    } else if (['DropShadowFilter', 'GlowFilter', 'OutlineFilter', 'FilterFire'].includes(formData.filter)) {\r\n      if ('filterOptions.color' in formData)\r\n        formData['filterOptions.color'] = Number(Color.fromString(formData['filterOptions.color']));\r\n    }\r\n\r\n    return formData;\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {\r\n    if (this.callback) this.callback(formData);\r\n  }\r\n}\r\n\r\nexport const FILTERS = {\r\n  OutlineOverlayFilter: {\r\n    defaultValues: {\r\n      outlineColor: [0, 0, 0, 1],\r\n      trueThickness: 1,\r\n      animate: false,\r\n    },\r\n    controls: [\r\n      {\r\n        type: 'color',\r\n        name: 'outlineColor',\r\n      },\r\n      {\r\n        type: 'range',\r\n        label: 'Thickness',\r\n        name: 'trueThickness',\r\n        min: 0,\r\n        max: 5,\r\n        step: 0.01,\r\n      },\r\n      {\r\n        type: 'boolean',\r\n        label: 'Oscillate',\r\n        name: 'animate',\r\n      },\r\n    ],\r\n    argType: 'args',\r\n  },\r\n  AlphaFilter: {\r\n    defaultValues: {\r\n      alpha: 1,\r\n    },\r\n    controls: [\r\n      {\r\n        type: 'range',\r\n        name: 'alpha',\r\n        min: 0,\r\n        max: 1,\r\n        step: 0.01,\r\n      },\r\n    ],\r\n    argType: 'args',\r\n  },\r\n  BlurFilter: {\r\n    defaultValues: {\r\n      strength: 8,\r\n      quality: 4,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'strength', min: 0, max: 20, step: 1 },\r\n      { type: 'range', name: 'quality', min: 0, max: 20, step: 1 },\r\n    ],\r\n    argType: 'args',\r\n  },\r\n  BlurFilterPass: {\r\n    defaultValues: {\r\n      horizontal: false,\r\n      strength: 8,\r\n      quality: 4,\r\n    },\r\n    controls: [\r\n      {\r\n        type: 'boolean',\r\n        name: 'horizontal',\r\n      },\r\n      { type: 'range', name: 'strength', min: 0, max: 20, step: 1 },\r\n      { type: 'range', name: 'quality', min: 0, max: 20, step: 1 },\r\n    ],\r\n    argType: 'args',\r\n  },\r\n  NoiseFilter: {\r\n    defaultValues: {\r\n      noise: 0.5,\r\n      seed: 4475160954091,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'noise', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'seed', min: 0, max: 100000, step: 1 },\r\n    ],\r\n    argType: 'args',\r\n  },\r\n  AdjustmentFilter: {\r\n    defaultValues: {\r\n      gamma: 1,\r\n      saturation: 1,\r\n      contrast: 1,\r\n      brightness: 1,\r\n      red: 1,\r\n      green: 1,\r\n      blue: 1,\r\n      alpha: 1,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'gamma', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'saturation', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'contrast', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'brightness', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'red', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'green', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'blue', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'alpha', min: 0, max: 1, step: 0.01 },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  AdvancedBloomFilter: {\r\n    defaultValues: {\r\n      threshold: 0.5,\r\n      bloomScale: 1,\r\n      brightness: 1,\r\n      blur: 8,\r\n      quality: 4,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'threshold', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'bloomScale', min: 0, max: 5, step: 0.01 },\r\n      { type: 'range', name: 'brightness', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'blur', min: 0, max: 20, step: 1 },\r\n      { type: 'range', name: 'quality', min: 0, max: 20, step: 1 },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  AsciiFilter: {\r\n    defaultValues: {\r\n      size: 8,\r\n    },\r\n    controls: [{ type: 'range', name: 'size', min: 0, max: 20, step: 0.01 }],\r\n    argType: 'args',\r\n  },\r\n  BevelFilter: {\r\n    defaultValues: {\r\n      rotation: 45,\r\n      thickness: 2,\r\n      lightColor: 0xffffff,\r\n      lightAlpha: 0.7,\r\n      shadowColor: 0x000000,\r\n      shadowAlpha: 0.7,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'rotation', min: 0, max: 360, step: 1 },\r\n      { type: 'range', name: 'thickness', min: 0, max: 20, step: 0.01 },\r\n      { type: 'color', name: 'lightColor' },\r\n      { type: 'range', name: 'lightAlpha', min: 0, max: 1, step: 0.01 },\r\n      { type: 'color', name: 'shadowColor' },\r\n      { type: 'range', name: 'shadowAlpha', min: 0, max: 1, step: 0.01 },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  BloomFilter: {\r\n    defaultValues: {\r\n      blur: 2,\r\n      quality: 4,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'blur', min: 0, max: 20, step: 1 },\r\n      { type: 'range', name: 'quality', min: 0, max: 20, step: 1 },\r\n    ],\r\n    argType: 'args',\r\n  },\r\n  BulgePinchFilter: {\r\n    defaultValues: {\r\n      radius: 100,\r\n      strength: 1,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'radius', min: 0, max: 500, step: 1 },\r\n      { type: 'range', name: 'strength', min: -1, max: 1, step: 0.01 },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  CRTFilter: {\r\n    defaultValues: {\r\n      curvature: 1,\r\n      lineWidth: 1,\r\n      lineContrast: 0.25,\r\n      verticalLine: false,\r\n      noise: 0.3,\r\n      noiseSize: 1,\r\n      seed: 0,\r\n      vignetting: 0.3,\r\n      vignettingAlpha: 1,\r\n      vignettingBlur: 0.3,\r\n      time: 0,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'curvature', min: 0, max: 20, step: 0.01 },\r\n      { type: 'range', name: 'lineWidth', min: 0, max: 20, step: 0.01 },\r\n      { type: 'range', name: 'lineContrast', min: 0, max: 5, step: 0.01 },\r\n      { type: 'boolean', name: 'verticalLine' },\r\n      { type: 'range', name: 'noise', min: 0, max: 2, step: 0.01 },\r\n      { type: 'range', name: 'noiseSize', min: 0, max: 20, step: 0.01 },\r\n      { type: 'range', name: 'seed', min: 0, max: 100000, step: 1 },\r\n      { type: 'range', name: 'vignetting', min: 0, max: 20, step: 0.01 },\r\n      { type: 'range', name: 'vignettingAlpha', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'vignettingBlur', min: 0, max: 5, step: 0.01 },\r\n      { type: 'range', name: 'time', min: 0, max: 10000, step: 1 },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  DotFilter: {\r\n    defaultValues: {\r\n      scale: 1,\r\n      angle: 5,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'scale', min: 0, max: 50, step: 1 },\r\n      { type: 'range', name: 'angle', min: 0, max: 360, step: 0.1 },\r\n    ],\r\n    argType: 'args',\r\n  },\r\n  DropShadowFilter: {\r\n    defaultValues: {\r\n      rotation: 45,\r\n      distance: 5,\r\n      color: 0x000000,\r\n      alpha: 0.5,\r\n      shadowOnly: false,\r\n      blur: 2,\r\n      quality: 3,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'rotation', min: 0, max: 360, step: 0.1 },\r\n      { type: 'range', name: 'distance', min: 0, max: 100, step: 0.1 },\r\n      { type: 'color', name: 'color' },\r\n      { type: 'range', name: 'alpha', min: 0, max: 1, step: 0.01 },\r\n      { type: 'boolean', name: 'shadowOnly' },\r\n      { type: 'range', name: 'blur', min: 0, max: 20, step: 0.1 },\r\n      { type: 'range', name: 'quality', min: 0, max: 20, step: 1 },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  EmbossFilter: {\r\n    defaultValues: {\r\n      strength: 5,\r\n    },\r\n    controls: [{ type: 'range', name: 'strength', min: 0, max: 20, step: 1 }],\r\n    argType: 'args',\r\n  },\r\n  GlitchFilter: {\r\n    defaultValues: {\r\n      slices: 5,\r\n      offset: 100,\r\n      direction: 0,\r\n      fillMode: 0,\r\n      seed: 0,\r\n      average: false,\r\n      minSize: 8,\r\n      sampleSize: 512,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'slices', min: 0, max: 50, step: 1 },\r\n      { type: 'range', name: 'distance', min: 0, max: 1000, step: 1 },\r\n      { type: 'range', name: 'direction', min: 0, max: 360, step: 0.1 },\r\n      {\r\n        type: 'select',\r\n        name: 'fillMode',\r\n        options: [\r\n          { value: 0, label: 'TRANSPARENT' },\r\n          { value: 1, label: 'ORIGINAL' },\r\n          { value: 2, label: 'LOOP' },\r\n          { value: 3, label: 'CLAMP' },\r\n          { value: 4, label: 'MIRROR' },\r\n        ],\r\n      },\r\n      { type: 'range', name: 'seed', min: 0, max: 10000, step: 1 },\r\n      { type: 'boolean', name: 'average' },\r\n      { type: 'range', name: 'minSize', min: 0, max: 500, step: 1 },\r\n      { type: 'range', name: 'sampleSize', min: 0, max: 1024, step: 1 },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  GlowFilter: {\r\n    defaultValues: {\r\n      distance: 10,\r\n      outerStrength: 4,\r\n      innerStrength: 0,\r\n      color: 0xffffff,\r\n      quality: 0.1,\r\n      knockout: false,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'distance', min: 1, max: 50, step: 1 },\r\n      { type: 'range', name: 'outerStrength', min: 0, max: 20, step: 1 },\r\n      { type: 'range', name: 'innerStrength', min: 0, max: 20, step: 1 },\r\n      { type: 'color', name: 'color' },\r\n      { type: 'range', name: 'quality', min: 0, max: 5, step: 0.1 },\r\n      { type: 'boolean', name: 'knockout' },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  GodrayFilter: {\r\n    defaultValues: {\r\n      angle: 30,\r\n      gain: 0.5,\r\n      lacunarity: 2.5,\r\n      parallel: true,\r\n      time: 0,\r\n      alpha: 1.0,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'angle', min: 0, max: 360, step: 0.1 },\r\n      { type: 'range', name: 'gain', min: 0, max: 5, step: 0.01 },\r\n      { type: 'range', name: 'lacunarity', min: 0, max: 5, step: 0.01 },\r\n      { type: 'boolean', name: 'parallel' },\r\n      { type: 'range', name: 'time', min: 0, max: 10000, step: 1 },\r\n      { type: 'range', name: 'alpha', min: 0, max: 1, step: 0.01 },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  KawaseBlurFilter: {\r\n    defaultValues: {\r\n      blur: 4,\r\n      quality: 3,\r\n      clamp: false,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'blur', min: 0, max: 20, step: 0.1 },\r\n      { type: 'range', name: 'quality', min: 0, max: 20, step: 1 },\r\n      { type: 'boolean', name: 'clamp' },\r\n    ],\r\n    argType: 'args',\r\n  },\r\n  OldFilmFilter: {\r\n    defaultValues: {\r\n      sepia: 0.3,\r\n      noise: 0.3,\r\n      noiseSize: 1.0,\r\n      scratch: 0.5,\r\n      scratchDensity: 0.3,\r\n      scratchWidth: 1.0,\r\n      vignetting: 0.3,\r\n      vignettingAlpha: 1.0,\r\n      vignettingBlur: 0.3,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'sepia', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'noise', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'noiseSize', min: 0, max: 5, step: 0.01 },\r\n      { type: 'range', name: 'scratch', min: 0, max: 5, step: 0.01 },\r\n      { type: 'range', name: 'scratchDensity', min: 0, max: 5, step: 0.01 },\r\n      { type: 'range', name: 'scratchWidth', min: 0, max: 20, step: 0.01 },\r\n      { type: 'range', name: 'vignetting', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'vignettingAlpha', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'vignettingBlur', min: 0, max: 5, step: 0.01 },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  OutlineFilter: {\r\n    defaultValues: {\r\n      thickness: 1,\r\n      color: 0x000000,\r\n      quality: 0.1,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'thickness', min: 0, max: 20, step: 0.1 },\r\n      { type: 'color', name: 'color' },\r\n      { type: 'range', name: 'quality', min: 0, max: 1, step: 0.01 },\r\n    ],\r\n    argType: 'args',\r\n  },\r\n  PixelateFilter: {\r\n    defaultValues: {\r\n      size: 1,\r\n    },\r\n    controls: [{ type: 'range', name: 'size', min: 1, max: 100, step: 1 }],\r\n    argType: 'args',\r\n  },\r\n  RGBSplitFilter: {\r\n    defaultValues: {\r\n      red: [-10, 0],\r\n      green: [0, 10],\r\n      blue: [0, 0],\r\n    },\r\n    controls: [\r\n      { type: 'point', name: 'red', min: 0, max: 50, step: 1 },\r\n      { type: 'point', name: 'green', min: 0, max: 50, step: 1 },\r\n      { type: 'point', name: 'blue', min: 0, max: 50, step: 1 },\r\n    ],\r\n    argType: 'args',\r\n  },\r\n  RadialBlurFilter: {\r\n    defaultValues: {\r\n      angle: 0,\r\n      center: [0, 0],\r\n      radius: -1,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'angle', min: 0, max: 360, step: 1 },\r\n      { type: 'point', name: 'center', min: 0, max: 1000, step: 1 },\r\n      { type: 'range', name: 'radius', min: -1, max: 1000, step: 1 },\r\n    ],\r\n    argType: 'args',\r\n  },\r\n  ReflectionFilter: {\r\n    defaultValues: {\r\n      mirror: true,\r\n      boundary: 0.5,\r\n      amplitude: [0, 20],\r\n      waveLength: [30, 100],\r\n      alpha: [1, 1],\r\n      time: 0,\r\n    },\r\n    controls: [\r\n      { type: 'boolean', name: 'mirror' },\r\n      { type: 'range', name: 'boundary', min: 0, max: 1, step: 0.01 },\r\n      { type: 'point', name: 'amplitude', min: 0, max: 100, step: 1 },\r\n      { type: 'point', name: 'waveLength', min: 0, max: 500, step: 1 },\r\n      { type: 'point', name: 'alpha', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'time', min: 0, max: 10000, step: 1 },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  DisplacementFilter: {\r\n    defaultValues: {\r\n      sprite: '',\r\n      textureScale: 1,\r\n      displacementScale: 1,\r\n    },\r\n    controls: [\r\n      { type: 'text', name: 'sprite' },\r\n      { type: 'range', name: 'textureScale', min: 0, max: 100, step: 0.1 },\r\n      { type: 'range', name: 'displacementScale', min: 0, max: 100, step: 0.1 },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  'Token Magic FX': {\r\n    defaultValues: {\r\n      params: [],\r\n    },\r\n    controls: [\r\n      { type: 'tmfxPreset', name: 'tmfxPreset' },\r\n      { type: 'json', name: 'params' },\r\n    ],\r\n  },\r\n};\r\n\r\nfunction genFilterOptionControls(filterName, filterOptions = {}) {\r\n  if (!(filterName in FILTERS)) return;\r\n\r\n  const options = mergeObject(FILTERS[filterName].defaultValues, filterOptions);\r\n  const values = getControlValues(filterName, options);\r\n\r\n  const controls = FILTERS[filterName].controls;\r\n  let controlsHTML = '<fieldset><legend>Options</legend>';\r\n  for (const control of controls) {\r\n    controlsHTML += genControl(control, values);\r\n  }\r\n  controlsHTML += '</fieldset>';\r\n\r\n  return controlsHTML;\r\n}\r\n\r\nfunction getControlValues(filterName, options) {\r\n  if (filterName === 'OutlineOverlayFilter') {\r\n    options.outlineColor = Color.fromRGB(options.outlineColor).toString();\r\n  } else if (filterName === 'BevelFilter') {\r\n    options.lightColor = Color.from(options.lightColor).toString();\r\n    options.shadowColor = Color.from(options.shadowColor).toString();\r\n  } else if (['DropShadowFilter', 'GlowFilter', 'OutlineFilter'].includes(filterName)) {\r\n    options.color = Color.from(options.color).toString();\r\n  }\r\n  return options;\r\n}\r\n\r\nfunction genControl(control, values) {\r\n  const val = values[control.name];\r\n  const name = control.name;\r\n  const label = control.label ?? name.charAt(0).toUpperCase() + name.slice(1);\r\n  const type = control.type;\r\n  if (type === 'color') {\r\n    return `\r\n<div class=\"form-group\">\r\n  <label>${label}</label>\r\n  <div class=\"form-fields\">\r\n      <input class=\"color\" type=\"text\" name=\"filterOptions.${name}\" value=\"${val}\">\r\n      <input type=\"color\" value=\"${val}\" data-edit=\"filterOptions.${name}\">\r\n  </div>\r\n</div>\r\n`;\r\n  } else if (type === 'range') {\r\n    return `\r\n<div class=\"form-group\">\r\n  <label>${label}</label>\r\n  <div class=\"form-fields\">\r\n      <input type=\"range\" name=\"filterOptions.${name}\" value=\"${val}\" min=\"${control.min}\" max=\"${control.max}\" step=\"${control.step}\">\r\n      <span class=\"range-value\">${val}</span>\r\n  </div>\r\n</div>\r\n`;\r\n  } else if (type === 'boolean') {\r\n    return `\r\n<div class=\"form-group\">\r\n  <label>${label}</label>\r\n  <div class=\"form-fields\">\r\n      <input type=\"checkbox\" name=\"filterOptions.${name}\" data-dtype=\"Boolean\" value=\"${val}\" ${val ? 'checked' : ''}>\r\n  </div>\r\n</div>\r\n    `;\r\n  } else if (type === 'select') {\r\n    let select = `\r\n    <div class=\"form-group\">\r\n    <label>${label}</label>\r\n    <div class=\"form-fields\">\r\n      <select name=\"${name}\">\r\n`;\r\n\r\n    for (const opt of control.options) {\r\n      select += `<option value=\"${opt.value}\" ${val === opt.value ? 'selected=\"selected\"' : ''}>${opt.label}</option>`;\r\n    }\r\n\r\n    select += `</select></div></div>`;\r\n\r\n    return select;\r\n  } else if (type === 'point') {\r\n    return `\r\n<div class=\"form-group\">\r\n  <label>${label}</label>\r\n  <div class=\"form-fields\">\r\n      <input type=\"range\" name=\"filterOptions.${name}\" value=\"${val[0]}\" min=\"${control.min}\" max=\"${control.max}\" step=\"${control.step}\">\r\n      <span class=\"range-value\">${val[0]}</span>\r\n  </div>\r\n  <div class=\"form-fields\">\r\n    <input type=\"range\" name=\"filterOptions.${name}\" value=\"${val[1]}\" min=\"${control.min}\" max=\"${control.max}\" step=\"${control.step}\">\r\n    <span class=\"range-value\">${val[1]}</span>\r\n  </div>\r\n</div>\r\n`;\r\n  } else if (type === 'json') {\r\n    let control = `\r\n<div class=\"form-group\">\r\n  <label>${label}</label>\r\n  <div class=\"form-fields\">\r\n      <textarea style=\"width: 450px; height: 200px;\" name=\"filterOptions.${name}\">${val}</textarea>\r\n  </div>`;\r\n    if (game.modules.get('multi-token-edit')?.api.showGenericForm) {\r\n      control += `\r\n  <div style=\"text-align: right; color: orangered;\">\r\n      <a> <i class=\"me-edit-json fas fa-edit\" title=\"Show Generic Form\"></i></a>\r\n  </div>`;\r\n    }\r\n    control += `</div>`;\r\n    return control;\r\n  } else if (type === 'text') {\r\n    return `\r\n<div class=\"form-group\">\r\n  <label>${label}</label>\r\n  <div class=\"form-fields\">\r\n      <input type=\"text\" name=\"filterOptions.${name}\" value=\"${val}\">\r\n  </div>\r\n</div>\r\n`;\r\n  } else if (type === 'tmfxPreset' && game.modules.get('tokenmagic')?.active) {\r\n    return `\r\n      <div class=\"form-group\">\r\n        <label>Preset <span class=\"units\">(TMFX)</span></label>\r\n        <div class=\"form-fields\">\r\n          <input list=\"tmfxPresets\" class=\"tmfxPreset\">\r\n          <button type=\"button\" class=\"presetImport\"><i class=\"fas fa-download\"></i></button>\r\n        </div>\r\n      `;\r\n  }\r\n  return '';\r\n}\r\n\r\nasync function promptParamChoice(params) {\r\n  return new Promise((resolve, reject) => {\r\n    const buttons = {};\r\n    for (let i = 0; i < params.length; i++) {\r\n      const label = params[i].filterType ?? params[i].filterId;\r\n      buttons[label] = {\r\n        label,\r\n        callback: () => {\r\n          resolve(i);\r\n        },\r\n      };\r\n    }\r\n\r\n    const dialog = new Dialog({\r\n      title: 'Select Filter To Edit',\r\n      content: '',\r\n      buttons,\r\n      close: () => resolve(-1),\r\n    });\r\n    dialog.render(true);\r\n  });\r\n}\r\n","export const DEFAULT_ACTIVE_EFFECT_CONFIG = {\r\n  id: '',\r\n  label: '',\r\n  expression: '',\r\n  codeExp: '',\r\n  imgName: '',\r\n  imgSrc: '',\r\n  priority: 50,\r\n  config: null,\r\n  overlay: false,\r\n  alwaysOn: false,\r\n  tokens: undefined,\r\n  disabled: false,\r\n  overlayConfig: null,\r\n  targetActors: null,\r\n  group: 'Default',\r\n};\r\n\r\nexport const DEFAULT_OVERLAY_CONFIG = {\r\n  img: '',\r\n  imgLinked: false,\r\n  alpha: 1,\r\n  scaleX: 1,\r\n  scaleY: 1,\r\n  offsetX: 0,\r\n  offsetY: 0,\r\n  angle: 0,\r\n  filter: 'NONE',\r\n  filterOptions: {},\r\n  inheritTint: false,\r\n  top: false,\r\n  bottom: false,\r\n  underlay: false,\r\n  linkRotation: true,\r\n  linkMirror: true,\r\n  linkOpacity: false,\r\n  linkScale: true,\r\n  linkDimensionX: false,\r\n  linkDimensionY: false,\r\n  linkStageScale: false,\r\n  mirror: false,\r\n  tint: null,\r\n  loop: true,\r\n  playOnce: false,\r\n  animation: {\r\n    rotate: false,\r\n    duration: 5000,\r\n    clockwise: true,\r\n    relative: false,\r\n  },\r\n  limitedUsers: [],\r\n  limitedToOwner: false,\r\n  limitOnProperty: '',\r\n  alwaysVisible: false,\r\n  text: {\r\n    text: '',\r\n    align: CONFIG.canvasTextStyle.align,\r\n    fontSize: CONFIG.canvasTextStyle.fontSize,\r\n    fontFamily: CONFIG.canvasTextStyle.fontFamily,\r\n    fill: CONFIG.canvasTextStyle.fill,\r\n    dropShadow: CONFIG.canvasTextStyle.dropShadow,\r\n    strokeThickness: CONFIG.canvasTextStyle.strokeThickness,\r\n    stroke: CONFIG.canvasTextStyle.stroke,\r\n    curve: { angle: 0, radius: 0, invert: false },\r\n    letterSpacing: CONFIG.canvasTextStyle.letterSpacing,\r\n    repeating: false,\r\n    wordWrap: false,\r\n    wordWrapWidth: 200,\r\n    breakWords: false,\r\n    maxHeight: 0,\r\n  },\r\n  parentID: '',\r\n  id: null,\r\n  anchor: { x: 0.5, y: 0.5 },\r\n  shapes: [],\r\n  variables: [],\r\n  interactivity: [],\r\n  ui: false,\r\n};\r\n\r\nexport const OVERLAY_SHAPES = {\r\n  Rectangle: {\r\n    type: 'rectangle',\r\n    x: 0,\r\n    y: 0,\r\n    width: 100,\r\n    height: 100,\r\n    radius: 0,\r\n    repeating: false,\r\n  },\r\n  Ellipse: {\r\n    type: 'ellipse',\r\n    x: 0,\r\n    y: 0,\r\n    width: 50,\r\n    height: 50,\r\n    repeating: false,\r\n  },\r\n  Polygon: {\r\n    type: 'polygon',\r\n    x: 0,\r\n    y: 0,\r\n    points: '0,1,0.95,0.31,0.59,-0.81,-0.59,-0.81,-0.95,0.31',\r\n    scale: 50,\r\n    repeating: false,\r\n  },\r\n  Torus: {\r\n    type: 'torus',\r\n    x: 0,\r\n    y: 0,\r\n    innerRadius: 50,\r\n    outerRadius: 100,\r\n    startAngle: 0,\r\n    endAngle: 180,\r\n    repeating: false,\r\n  },\r\n};\r\n\r\nexport const CORE_SHAPE = {\r\n  line: {\r\n    width: 1,\r\n    color: '#000000',\r\n    alpha: 1,\r\n  },\r\n  fill: { color: '#ffffff', color2: '', prc: '', alpha: 1 },\r\n};\r\n","import { FEATURE_CONTROL, TVA_CONFIG, getFlagMappings, updateSettings } from '../settings.js';\r\nimport {\r\n  applyCEEffect,\r\n  applyTMFXPreset,\r\n  determineAddedRemovedEffects,\r\n  executeMacro,\r\n  EXPRESSION_OPERATORS,\r\n  getAllActorTokens,\r\n  getFileName,\r\n  mergeMappings,\r\n  tv_executeScript,\r\n  updateTokenImage,\r\n} from '../utils.js';\r\nimport { broadcastOverlayRedraw, drawOverlays } from '../token/overlay.js';\r\nimport { registerHook, unregisterHook } from './hooks.js';\r\nimport { CORE_TEMPLATES } from '../mappingTemplates.js';\r\n\r\nconst EXPRESSION_MATCH_RE = /(\\\\\\()|(\\\\\\))|(\\|\\|)|(\\&\\&)|(\\\\\\!)/g;\r\nconst PF2E_ITEM_TYPES = ['condition', 'effect', 'weapon', 'equipment'];\r\nconst ITEM_TYPES = ['equipment', 'weapon'];\r\nconst feature_id = 'EffectMappings';\r\n\r\nexport function registerEffectMappingHooks() {\r\n  if (!FEATURE_CONTROL[feature_id]) {\r\n    [\r\n      'canvasReady',\r\n      'createActiveEffect',\r\n      'deleteActiveEffect',\r\n      'preUpdateActiveEffect',\r\n      'updateActiveEffect',\r\n      'createCombatant',\r\n      'deleteCombatant',\r\n      'preUpdateCombat',\r\n      'updateCombat',\r\n      'deleteCombat',\r\n      'preUpdateToken',\r\n      'preUpdateActor',\r\n      'updateActor',\r\n      'updateToken',\r\n      'createToken',\r\n      'preUpdateItem',\r\n      'updateItem',\r\n      'createItem',\r\n      'deleteItem',\r\n    ].forEach((name) => unregisterHook(feature_id, name));\r\n    return;\r\n  }\r\n\r\n  if (game.user.isGM) {\r\n    registerHook(feature_id, 'canvasReady', _refreshTokenMappings);\r\n    _refreshTokenMappings();\r\n  }\r\n\r\n  registerHook(feature_id, 'createActiveEffect', (activeEffect, options, userId) => {\r\n    if (!activeEffect.parent || activeEffect.disabled || game.userId !== userId) return;\r\n    const effectName = activeEffect.name ?? activeEffect.label;\r\n    _updateImageOnEffectChange(effectName, activeEffect.parent, true);\r\n  });\r\n  registerHook(feature_id, 'deleteActiveEffect', (activeEffect, options, userId) => {\r\n    if (!activeEffect.parent || activeEffect.disabled || game.userId !== userId) return;\r\n    const effectName = activeEffect.name ?? activeEffect.label;\r\n    _updateImageOnEffectChange(effectName, activeEffect.parent, false);\r\n  });\r\n  registerHook(feature_id, 'preUpdateActiveEffect', _preUpdateActiveEffect);\r\n  registerHook(feature_id, 'updateActiveEffect', _updateActiveEffect);\r\n  registerHook(feature_id, 'preUpdateToken', _preUpdateToken);\r\n  registerHook(feature_id, 'preUpdateActor', _preUpdateActor);\r\n  registerHook(feature_id, 'updateActor', _updateActor);\r\n  registerHook(feature_id, 'updateToken', _updateToken);\r\n  registerHook(feature_id, 'createToken', _createToken);\r\n  registerHook(feature_id, 'createCombatant', _createCombatant);\r\n  registerHook(feature_id, 'deleteCombatant', (combatant, options, userId) => {\r\n    if (game.userId !== userId) return;\r\n    _deleteCombatant(combatant);\r\n  });\r\n  registerHook(feature_id, 'preUpdateCombat', _preUpdateCombat);\r\n  registerHook(feature_id, 'updateCombat', _updateCombat);\r\n  registerHook(feature_id, 'deleteCombat', (combat, options, userId) => {\r\n    if (game.userId !== userId) return;\r\n    combat.combatants.forEach((combatant) => {\r\n      _deleteCombatant(combatant);\r\n    });\r\n  });\r\n\r\n  const applicable_item_types = game.system.id === 'pf2e' ? PF2E_ITEM_TYPES : ITEM_TYPES;\r\n  // Want to track condition/effect previous name so that the config can be reverted for it\r\n  registerHook(feature_id, 'preUpdateItem', (item, change, options, userId) => {\r\n    if (game.user.id === userId && applicable_item_types.includes(item.type)) {\r\n      options['token-variants-old-name'] = item.name;\r\n    }\r\n    _preUpdateAssign(item.parent, change, options);\r\n  });\r\n\r\n  registerHook(feature_id, 'createItem', (item, options, userId) => {\r\n    if (game.userId !== userId || !applicable_item_types.includes(item.type) || !item.parent) return;\r\n    _updateImageOnEffectChange(item.name, item.parent, true);\r\n  });\r\n\r\n  registerHook(feature_id, 'deleteItem', (item, options, userId) => {\r\n    if (game.userId !== userId || !applicable_item_types.includes(item.type) || !item.parent || item.disabled) return;\r\n    _updateImageOnEffectChange(item.name, item.parent, false);\r\n  });\r\n\r\n  // Status Effects can be applied \"stealthily\" on item equip/un-equip\r\n  registerHook(feature_id, 'updateItem', _updateItem);\r\n}\r\n\r\nasync function _refreshTokenMappings() {\r\n  for (const tkn of canvas.tokens.placeables) {\r\n    await updateWithEffectMapping(tkn);\r\n  }\r\n}\r\n\r\nfunction _createCombatant(combatant, options, userId) {\r\n  if (game.userId !== userId) return;\r\n  const token = combatant._token || canvas.tokens.get(combatant.tokenId);\r\n  if (!token || !token.actor) return;\r\n\r\n  updateWithEffectMapping(token, {\r\n    added: ['token-variants-combat'],\r\n  });\r\n}\r\n\r\nfunction _preUpdateActiveEffect(activeEffect, change, options, userId) {\r\n  if (!activeEffect.parent || game.userId !== userId) return;\r\n\r\n  if ('label' in change) {\r\n    options['token-variants-old-name'] = activeEffect.label;\r\n  }\r\n}\r\n\r\nfunction _updateActiveEffect(activeEffect, change, options, userId) {\r\n  if (!activeEffect.parent || game.userId !== userId) return;\r\n\r\n  const added = [];\r\n  const removed = [];\r\n\r\n  if ('disabled' in change) {\r\n    if (change.disabled) removed.push(activeEffect.label);\r\n    else added.push(activeEffect.label);\r\n  }\r\n  if ('label' in change) {\r\n    removed.push(options['token-variants-old-name']);\r\n    added.push(change.label);\r\n  }\r\n\r\n  if (added.length || removed.length) {\r\n    _updateImageOnMultiEffectChange(activeEffect.parent, added, removed);\r\n  }\r\n}\r\n\r\nfunction _preUpdateToken(token, change, options, userId) {\r\n  if (game.user.id !== userId || change.actorId) return;\r\n\r\n  const preUpdateEffects = getTokenEffects(token, true);\r\n  if (preUpdateEffects.length) {\r\n    setProperty(options, 'token-variants.preUpdateEffects', preUpdateEffects);\r\n  }\r\n\r\n  if (game.system.id === 'dnd5e' && token.actor?.isPolymorphed) {\r\n    setProperty(options, 'token-variants.wasPolymorphed', true);\r\n  }\r\n}\r\n\r\nasync function _updateToken(token, change, options, userId) {\r\n  if (game.user.id !== userId || change.actorId) return;\r\n\r\n  const addedEffects = [];\r\n  const removedEffects = [];\r\n  const preUpdateEffects = getProperty(options, 'token-variants.preUpdateEffects') || [];\r\n  const postUpdateEffects = getTokenEffects(token, true);\r\n  determineAddedRemovedEffects(addedEffects, removedEffects, postUpdateEffects, preUpdateEffects);\r\n\r\n  if (addedEffects.length || removedEffects.length || 'actorLink' in change) {\r\n    updateWithEffectMapping(token, { added: addedEffects, removed: removedEffects });\r\n  } else if (getProperty(options, 'token-variants.wasPolymorphed') && !token.actor?.isPolymorphed) {\r\n    updateWithEffectMapping(token);\r\n  }\r\n\r\n  if (game.userId === userId && 'hidden' in change) {\r\n    updateWithEffectMapping(token, {\r\n      added: change.hidden ? ['token-variants-visibility'] : [],\r\n      removed: !change.hidden ? ['token-variants-visibility'] : [],\r\n    });\r\n  }\r\n}\r\n\r\nfunction _preUpdateActor(actor, change, options, userId) {\r\n  if (game.user.id !== userId) return;\r\n  _preUpdateAssign(actor, change, options);\r\n}\r\n\r\nasync function _updateActor(actor, change, options, userId) {\r\n  if (game.user.id !== userId) return;\r\n\r\n  if ('flags' in change && 'token-variants' in change.flags) {\r\n    const tokenVariantFlags = change.flags['token-variants'];\r\n    if ('effectMappings' in tokenVariantFlags || '-=effectMappings' in tokenVariantFlags) {\r\n      const tokens = actor.token ? [actor.token] : getAllActorTokens(actor, true, !TVA_CONFIG.mappingsCurrentSceneOnly);\r\n      tokens.forEach((tkn) => updateWithEffectMapping(tkn));\r\n      for (const tkn of tokens) {\r\n        if (tkn.object && TVA_CONFIG.filterEffectIcons) {\r\n          await tkn.object.drawEffects();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  _preUpdateCheck(actor, options);\r\n}\r\n\r\nfunction _preUpdateAssign(actor, change, options) {\r\n  if (!actor) return;\r\n\r\n  // Determine which comparators are applicable so that we can compare after the\r\n  // actor update\r\n  const tokens = actor.token ? [actor.token] : getAllActorTokens(actor, true, !TVA_CONFIG.mappingsCurrentSceneOnly);\r\n  if (TVA_CONFIG.internalEffects.hpChange.enabled && tokens.length) {\r\n    applyHpChangeEffect(actor, change, tokens);\r\n  }\r\n  for (const tkn of tokens) {\r\n    const preUpdateEffects = getTokenEffects(tkn, true);\r\n\r\n    if (preUpdateEffects.length) {\r\n      setProperty(options, 'token-variants.' + tkn.id + '.preUpdateEffects', preUpdateEffects);\r\n    }\r\n  }\r\n}\r\n\r\nfunction _preUpdateCheck(actor, options, pAdded = [], pRemoved = []) {\r\n  if (!actor) return;\r\n  const tokens = actor.token ? [actor.token] : getAllActorTokens(actor, true, !TVA_CONFIG.mappingsCurrentSceneOnly);\r\n  for (const tkn of tokens) {\r\n    // Check if effects changed by comparing them against the ones calculated in preUpdate*\r\n    const added = [...pAdded];\r\n    const removed = [...pRemoved];\r\n    const postUpdateEffects = getTokenEffects(tkn, true);\r\n    const preUpdateEffects = getProperty(options, 'token-variants.' + tkn.id + '.preUpdateEffects') ?? [];\r\n\r\n    determineAddedRemovedEffects(added, removed, postUpdateEffects, preUpdateEffects);\r\n    if (added.length || removed.length) updateWithEffectMapping(tkn, { added, removed });\r\n  }\r\n}\r\n\r\nfunction _createToken(token, options, userId) {\r\n  if (userId && userId === game.user.id) updateWithEffectMapping(token);\r\n}\r\n\r\nfunction _preUpdateCombat(combat, round, options, userId) {\r\n  if (game.userId !== userId) return;\r\n  options['token-variants'] = {\r\n    combatantId: combat?.combatant?.token?.id,\r\n    nextCombatantId: combat?.nextCombatant?.token?.id,\r\n  };\r\n}\r\n\r\nfunction _updateCombat(combat, round, options, userId) {\r\n  if (game.userId !== userId) return;\r\n\r\n  const previousCombatantId = options['token-variants']?.combatantId;\r\n  const previousNextCombatantId = options['token-variants']?.nextCombatantId;\r\n\r\n  const currentCombatantId = combat?.combatant?.token?.id;\r\n  const currentNextCombatantId = combat?.nextCombatant?.token?.id;\r\n\r\n  const updateCombatant = function (id, added = [], removed = []) {\r\n    if (game.user.isGM) {\r\n      const token = canvas.tokens.get(id);\r\n      if (token) updateWithEffectMapping(token, { added, removed });\r\n    } else {\r\n      const message = {\r\n        handlerName: 'effectMappings',\r\n        args: { tokenId: id, sceneId: canvas.scene.id, added, removed },\r\n        type: 'UPDATE',\r\n      };\r\n      game.socket?.emit('module.token-variants', message);\r\n    }\r\n  };\r\n\r\n  if (previousCombatantId !== currentCombatantId) {\r\n    if (previousCombatantId) updateCombatant(previousCombatantId, [], ['combat-turn']);\r\n    if (currentCombatantId) updateCombatant(currentCombatantId, ['combat-turn'], []);\r\n  }\r\n  if (previousNextCombatantId !== currentNextCombatantId) {\r\n    if (previousNextCombatantId) updateCombatant(previousNextCombatantId, [], ['combat-turn-next']);\r\n    if (currentNextCombatantId) updateCombatant(currentNextCombatantId, ['combat-turn-next'], []);\r\n  }\r\n}\r\n\r\nfunction _updateItem(item, change, options, userId) {\r\n  const added = [];\r\n  const removed = [];\r\n\r\n  if (game.user.id === userId) {\r\n    // Handle condition/effect name change\r\n    if (options['token-variants-old-name'] !== item.name) {\r\n      added.push(item.name);\r\n      removed.push(options['token-variants-old-name']);\r\n    }\r\n\r\n    _preUpdateCheck(item.parent, options, added, removed);\r\n  }\r\n}\r\n\r\nlet EFFECT_M_QUEUES = {};\r\nlet EFFECT_M_TIMER;\r\n\r\nexport async function updateWithEffectMapping(token, { added = [], removed = [] } = {}) {\r\n  const callUpdateWithEffectMapping = function () {\r\n    for (const id of Object.keys(EFFECT_M_QUEUES)) {\r\n      const m = EFFECT_M_QUEUES[id];\r\n      _updateWithEffectMapping(m.token, m.opts.added, m.opts.removed);\r\n    }\r\n    EFFECT_M_QUEUES = {};\r\n  };\r\n\r\n  clearTimeout(EFFECT_M_TIMER);\r\n\r\n  if (token.id in EFFECT_M_QUEUES) {\r\n    const opts = EFFECT_M_QUEUES[token.id].opts;\r\n    added.forEach((a) => opts.added.add(a));\r\n    removed.forEach((a) => opts.removed.add(a));\r\n  } else {\r\n    EFFECT_M_QUEUES[token.id] = {\r\n      token,\r\n      opts: { added: new Set(added), removed: new Set(removed) },\r\n    };\r\n  }\r\n  EFFECT_M_TIMER = setTimeout(callUpdateWithEffectMapping, 100);\r\n}\r\n\r\nasync function _updateWithEffectMapping(token, added, removed) {\r\n  const placeable = token.object ?? token._object ?? token;\r\n  token = token.document ?? token;\r\n\r\n  const tokenImgName = token.getFlag('token-variants', 'name') || getFileName(token.texture.src);\r\n  let tokenDefaultImg = token.getFlag('token-variants', 'defaultImg');\r\n  const animate = !TVA_CONFIG.disableTokenUpdateAnimation;\r\n  const tokenUpdateObj = {};\r\n  const hadActiveHUD = token.object?.hasActiveHUD;\r\n  const toggleStatus = canvas.tokens.hud.object?.id === token.id ? canvas.tokens.hud._statusEffects : false;\r\n\r\n  let effects = getTokenEffects(token);\r\n\r\n  // If effect is included in `added` or `removed` we need to:\r\n  // 1. Insert it into `effects` if it's not there in case of 'added' and place it on top of the list\r\n  // 2. Remove it in case of 'removed'\r\n  for (const ef of added) {\r\n    const i = effects.findIndex((s) => s === ef);\r\n    if (i === -1) {\r\n      effects.push(ef);\r\n    } else if (i < effects.length - 1) {\r\n      effects.splice(i, 1);\r\n      effects.push(ef);\r\n    }\r\n  }\r\n  for (const ef of removed) {\r\n    const i = effects.findIndex((s) => s === ef);\r\n    if (i !== -1) {\r\n      effects.splice(i, 1);\r\n    }\r\n  }\r\n\r\n  const mappings = getAllEffectMappings(token);\r\n\r\n  // 3. Configurations may contain effect names in a form of a logical expressions\r\n  //    We need to evaluate them and insert them into effects/added/removed if needed\r\n  for (const mapping of mappings) {\r\n    evaluateMappingExpression(mapping, effects, token, added, removed);\r\n  }\r\n\r\n  // Accumulate all scripts that will need to be run after the update\r\n  const executeOnCallback = [];\r\n  const deferredUpdateScripts = [];\r\n  for (const ef of removed) {\r\n    const script = mappings.find((m) => m.id === ef)?.config?.tv_script;\r\n    if (script) {\r\n      if (script.onRemove) {\r\n        if (script.onRemove.includes('tvaUpdate')) deferredUpdateScripts.push(script.onRemove);\r\n        else executeOnCallback.push({ script: script.onRemove, token });\r\n      }\r\n      if (script.tmfxPreset) executeOnCallback.push({ tmfxPreset: script.tmfxPreset, token, action: 'remove' });\r\n      if (script.ceEffect?.name) executeOnCallback.push({ ceEffect: script.ceEffect, token, action: 'remove' });\r\n      if (script.macroOnApply) executeOnCallback.push({ macro: script.macroOnApply, token });\r\n    }\r\n  }\r\n  for (const ef of added) {\r\n    const script = mappings.find((m) => m.id === ef)?.config?.tv_script;\r\n    if (script) {\r\n      if (script.onApply) {\r\n        if (script.onApply.includes('tvaUpdate')) deferredUpdateScripts.push(script.onApply);\r\n        else executeOnCallback.push({ script: script.onApply, token });\r\n      }\r\n      if (script.tmfxPreset) executeOnCallback.push({ tmfxPreset: script.tmfxPreset, token, action: 'apply' });\r\n      if (script.ceEffect?.name) executeOnCallback.push({ ceEffect: script.ceEffect, token, action: 'apply' });\r\n      if (script.macroOnRemove) executeOnCallback.push({ macro: script.macroOnRemove, token });\r\n    }\r\n  }\r\n\r\n  // Next we're going to determine what configs need to be applied and in what order\r\n  // Filter effects that do not have a mapping and sort based on priority\r\n  effects = mappings.filter((m) => effects.includes(m.id)).sort((ef1, ef2) => ef1.priority - ef2.priority);\r\n\r\n  // Check if image update should be prevented based on module settings\r\n  let disableImageUpdate = false;\r\n  if (TVA_CONFIG.disableImageChangeOnPolymorphed && token.actor?.isPolymorphed) {\r\n    disableImageUpdate = true;\r\n  } else if (\r\n    TVA_CONFIG.disableImageUpdateOnNonPrototype &&\r\n    token.actor?.prototypeToken?.texture?.src !== token.texture.src\r\n  ) {\r\n    disableImageUpdate = true;\r\n    const tknImg = token.texture.src;\r\n    for (const m of mappings) {\r\n      if (m.imgSrc === tknImg) {\r\n        disableImageUpdate = false;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (disableImageUpdate) {\r\n    tokenDefaultImg = '';\r\n  }\r\n\r\n  let updateCall;\r\n\r\n  if (effects.length > 0) {\r\n    // Some effect mappings may not have images, find a mapping with one if it exists\r\n    const newImg = { imgSrc: '', imgName: '' };\r\n\r\n    if (!disableImageUpdate) {\r\n      for (let i = effects.length - 1; i >= 0; i--) {\r\n        if (effects[i].imgSrc) {\r\n          let iSrc = effects[i].imgSrc;\r\n          if (iSrc.includes('*') || (iSrc.includes('{') && iSrc.includes('}'))) {\r\n            // wildcard image, if this effect hasn't been newly applied we do not want to randomize the image again\r\n            if (!added.has(effects[i].overlayConfig?.effect)) {\r\n              newImg.imgSrc = token.texture.src;\r\n              newImg.imgName = getFileName(newImg.imgSrc);\r\n              break;\r\n            }\r\n          }\r\n          newImg.imgSrc = effects[i].imgSrc;\r\n          newImg.imgName = effects[i].imgName;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Collect custom configs to be applied to the token\r\n    let config;\r\n    if (TVA_CONFIG.stackStatusConfig) {\r\n      config = {};\r\n      for (const ef of effects) {\r\n        config = mergeObject(config, ef.config);\r\n      }\r\n    } else {\r\n      for (let i = effects.length - 1; i >= 0; i--) {\r\n        if (effects[i].config && Object.keys(effects[i].config).length !== 0) {\r\n          config = effects[i].config;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Use or update the default (original) token image\r\n    if (!newImg.imgSrc && tokenDefaultImg) {\r\n      delete tokenUpdateObj.flags?.['token-variants']?.defaultImg;\r\n      setProperty(tokenUpdateObj, 'flags.token-variants.-=defaultImg', null);\r\n      newImg.imgSrc = tokenDefaultImg.imgSrc;\r\n      newImg.imgName = tokenDefaultImg.imgName;\r\n    } else if (!tokenDefaultImg && newImg.imgSrc) {\r\n      setProperty(tokenUpdateObj, 'flags.token-variants.defaultImg', {\r\n        imgSrc: token.texture.src,\r\n        imgName: tokenImgName,\r\n      });\r\n    }\r\n\r\n    updateCall = () =>\r\n      updateTokenImage(newImg.imgSrc ?? null, {\r\n        token,\r\n        imgName: newImg.imgName ? newImg.imgName : tokenImgName,\r\n        tokenUpdate: tokenUpdateObj,\r\n        callback: _postTokenUpdateProcessing.bind(null, token, hadActiveHUD, toggleStatus, executeOnCallback),\r\n        config: config,\r\n        animate,\r\n      });\r\n  }\r\n\r\n  // If no mapping has been found and the default image (image prior to effect triggered update) is different from current one\r\n  // reset the token image back to default\r\n  if (effects.length === 0 && tokenDefaultImg) {\r\n    delete tokenUpdateObj.flags?.['token-variants']?.defaultImg;\r\n    setProperty(tokenUpdateObj, 'flags.token-variants.-=defaultImg', null);\r\n\r\n    updateCall = () =>\r\n      updateTokenImage(tokenDefaultImg.imgSrc, {\r\n        token,\r\n        imgName: tokenDefaultImg.imgName,\r\n        tokenUpdate: tokenUpdateObj,\r\n        callback: _postTokenUpdateProcessing.bind(null, token, hadActiveHUD, toggleStatus, executeOnCallback),\r\n        animate,\r\n      });\r\n    // If no default image exists but a custom effect is applied, we still want to perform an update to\r\n    // clear it\r\n  } else if (effects.length === 0 && token.getFlag('token-variants', 'usingCustomConfig')) {\r\n    updateCall = () =>\r\n      updateTokenImage(token.texture.src, {\r\n        token,\r\n        imgName: tokenImgName,\r\n        tokenUpdate: tokenUpdateObj,\r\n        callback: _postTokenUpdateProcessing.bind(null, token, hadActiveHUD, toggleStatus, executeOnCallback),\r\n        animate,\r\n      });\r\n  }\r\n\r\n  if (updateCall) {\r\n    if (deferredUpdateScripts.length) {\r\n      for (let i = 0; i < deferredUpdateScripts.length; i++) {\r\n        if (i === deferredUpdateScripts.length - 1) {\r\n          await tv_executeScript(deferredUpdateScripts[i], {\r\n            token,\r\n            tvaUpdate: () => {\r\n              updateCall();\r\n            },\r\n          });\r\n        } else {\r\n          await tv_executeScript(deferredUpdateScripts[i], {\r\n            token,\r\n            tvaUpdate: () => {},\r\n          });\r\n        }\r\n      }\r\n    } else {\r\n      updateCall();\r\n    }\r\n  } else {\r\n    if (executeOnCallback.length || deferredUpdateScripts.length) {\r\n      _postTokenUpdateProcessing(token, hadActiveHUD, toggleStatus, executeOnCallback);\r\n      _postTokenUpdateProcessing(token, hadActiveHUD, toggleStatus, deferredUpdateScripts);\r\n    }\r\n  }\r\n  broadcastOverlayRedraw(placeable);\r\n}\r\n\r\nasync function _postTokenUpdateProcessing(token, hadActiveHUD, toggleStatus, scripts) {\r\n  if (hadActiveHUD && token.object) {\r\n    canvas.tokens.hud.bind(token.object);\r\n    if (toggleStatus) canvas.tokens.hud._toggleStatusEffects(true);\r\n  }\r\n  for (const scr of scripts) {\r\n    if (scr.script) {\r\n      await tv_executeScript(scr.script, { token: scr.token });\r\n    } else if (scr.tmfxPreset) {\r\n      await applyTMFXPreset(scr.token, scr.tmfxPreset, scr.action);\r\n    } else if (scr.ceEffect) {\r\n      await applyCEEffect(scr.token, scr.ceEffect, scr.action);\r\n    } else if (scr.macro) {\r\n      await executeMacro(scr.macro, token);\r\n    }\r\n  }\r\n}\r\n\r\nexport function getAllEffectMappings(token = null, includeDisabled = false) {\r\n  let allMappings = getFlagMappings(token);\r\n  const unique = new Set();\r\n\r\n  // TODO: replace with a setting\r\n  allMappings.forEach((m) => unique.add(TVA_CONFIG.mergeGroup ? m.group : m.label));\r\n\r\n  // Sort out global mappings that do not apply to this actor\r\n  let applicableGlobal = TVA_CONFIG.globalMappings;\r\n  if (token?.actor?.type) {\r\n    const actorType = token.actor.type;\r\n    applicableGlobal = applicableGlobal.filter((m) => {\r\n      if (!m.targetActors || m.targetActors.includes(actorType)) {\r\n        return !unique.has(TVA_CONFIG.mergeGroup ? m.group : m.label);\r\n      }\r\n      return false;\r\n    });\r\n  }\r\n  allMappings = allMappings.concat(applicableGlobal);\r\n\r\n  if (!includeDisabled) allMappings = allMappings.filter((m) => !m.disabled);\r\n\r\n  return allMappings;\r\n}\r\n\r\nexport async function setOverlayVisibility({\r\n  userName = null,\r\n  userId = null,\r\n  label = null,\r\n  group = null,\r\n  token = null,\r\n  visible = true,\r\n} = {}) {\r\n  if (!label && !group) return;\r\n  if (userName) userId = game.users.find((u) => u.name === userName)?.id;\r\n  if (!userId) return;\r\n\r\n  let tokenMappings = getFlagMappings(token);\r\n  let globalMappings = TVA_CONFIG.globalMappings;\r\n\r\n  let updateToken = false;\r\n  let updateGlobal = false;\r\n\r\n  const updateMappings = function (mappings) {\r\n    mappings = mappings.filter((m) => m.overlay && (m.label === label || m.group === group));\r\n    let found = false;\r\n    if (mappings.length) found = true;\r\n\r\n    mappings.forEach((m) => {\r\n      const overlayConfig = m.overlayConfig;\r\n      if (visible) {\r\n        if (!overlayConfig.limitedUsers) overlayConfig.limitedUsers = [];\r\n        if (!overlayConfig.limitedUsers.find((u) => u === userId)) overlayConfig.limitedUsers.push(userId);\r\n      } else if (overlayConfig.limitedUsers) {\r\n        overlayConfig.limitedUsers = overlayConfig.limitedUsers.filter((u) => u !== userId);\r\n      }\r\n    });\r\n    return found;\r\n  };\r\n\r\n  updateToken = updateMappings(tokenMappings);\r\n  updateGlobal = updateMappings(globalMappings);\r\n\r\n  if (updateGlobal) await updateSettings({ globalMappings: globalMappings });\r\n  if (updateToken) {\r\n    const actor = game.actors.get(token.document.actorId);\r\n    if (actor) await actor.setFlag('token-variants', 'effectMappings', tokenMappings);\r\n  }\r\n  if (updateToken || updateGlobal) drawOverlays(token);\r\n}\r\n\r\nfunction _getTemplateMappings(templateName) {\r\n  return (\r\n    TVA_CONFIG.templateMappings.find((t) => t.name === templateName) ??\r\n    CORE_TEMPLATES.find((t) => t.name === templateName)\r\n  )?.mappings;\r\n}\r\n\r\nexport async function applyTemplate(token, templateName = null, mappings = null) {\r\n  if (templateName) mappings = _getTemplateMappings(templateName);\r\n  if (!token || !mappings) return;\r\n\r\n  const actor = game.actors.get(token.actor.id);\r\n  if (!actor) return;\r\n  const templateMappings = deepClone(mappings);\r\n  templateMappings.forEach((tm) => (tm.tokens = [token.id]));\r\n\r\n  const actMappings = mergeMappings(templateMappings, getFlagMappings(actor));\r\n  await actor.setFlag('token-variants', 'effectMappings', actMappings);\r\n  await updateWithEffectMapping(token);\r\n  drawOverlays(token);\r\n}\r\n\r\nexport async function removeTemplate(token, templateName = null, mappings = null) {\r\n  if (templateName) mappings = _getTemplateMappings(templateName);\r\n  if (!token || !mappings) return;\r\n\r\n  const actor = game.actors.get(token.actor.id);\r\n  if (!actor) return;\r\n\r\n  let actMappings = getFlagMappings(actor);\r\n  mappings.forEach((m) => {\r\n    let i = actMappings.findIndex((m2) => m2.id === m.id);\r\n    if (i !== -1) {\r\n      actMappings[i].tokens = actMappings[i].tokens.filter((t) => t !== token.id);\r\n      if (actMappings[i].tokens.length === 0) actMappings.splice(i, 1);\r\n    }\r\n  });\r\n\r\n  if (actMappings.length) await actor.setFlag('token-variants', 'effectMappings', actMappings);\r\n  else await actor.unsetFlag('token-variants', 'effectMappings');\r\n  await updateWithEffectMapping(token);\r\n  drawOverlays(token);\r\n}\r\n\r\nexport function toggleTemplate(token, templateName = null, mappings = null) {\r\n  if (templateName) mappings = _getTemplateMappings(templateName);\r\n  if (!token || !mappings) return;\r\n\r\n  const actor = game.actors.get(token.actor.id);\r\n  if (!actor) return;\r\n\r\n  const actMappings = getFlagMappings(actor);\r\n  if (actMappings.some((m) => mappings.some((m2) => m2.id === m.id && m.tokens?.includes(token.id)))) {\r\n    removeTemplate(token, null, mappings);\r\n  } else {\r\n    applyTemplate(token, null, mappings);\r\n  }\r\n}\r\n\r\nexport function toggleTemplateOnSelected(templateName = null, mappings = null) {\r\n  canvas.tokens.controlled.forEach((t) => toggleTemplate(t, templateName, mappings));\r\n}\r\n\r\nfunction getHPChangeEffect(token, effects) {\r\n  const internals = token.actor?.getFlag('token-variants', 'internalEffects') || {};\r\n  const delta = getProperty(\r\n    token,\r\n    `${isNewerVersion('11', game.version) ? 'actorData' : 'delta'}.flags.token-variants.internalEffects`\r\n  );\r\n  if (delta) mergeObject(internals, delta);\r\n  if (internals['hp--'] != null) effects.push('hp--');\r\n  if (internals['hp++'] != null) effects.push('hp++');\r\n}\r\n\r\nfunction applyHpChangeEffect(actor, change, tokens) {\r\n  let duration = Number(TVA_CONFIG.internalEffects.hpChange.duration);\r\n\r\n  const newHpValue = getProperty(change, `system.${TVA_CONFIG.systemHpPath}.value`);\r\n  if (newHpValue != null) {\r\n    const [currentHpVal, _] = getTokenHP(tokens[0]);\r\n    if (currentHpVal !== newHpValue) {\r\n      if (currentHpVal < newHpValue) {\r\n        setProperty(change, 'flags.token-variants.internalEffects.-=hp--', null);\r\n        setProperty(change, 'flags.token-variants.internalEffects.hp++', newHpValue - currentHpVal);\r\n        if (duration) {\r\n          setTimeout(() => {\r\n            actor.update({\r\n              'flags.token-variants.internalEffects.-=hp++': null,\r\n            });\r\n          }, duration * 1000);\r\n        }\r\n      } else {\r\n        setProperty(change, 'flags.token-variants.internalEffects.-=hp++', null);\r\n        setProperty(change, 'flags.token-variants.internalEffects.hp--', newHpValue - currentHpVal);\r\n        if (duration) {\r\n          setTimeout(() => {\r\n            actor.update({\r\n              'flags.token-variants.internalEffects.-=hp--': null,\r\n            });\r\n          }, duration * 1000);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function getTokenEffects(token, includeExpressions = false) {\r\n  const data = token.document ?? token;\r\n  let effects = [];\r\n\r\n  // TVA Effects\r\n  const tokenInCombat = game.combats.some((combat) => {\r\n    return combat.combatants.some((c) => c.tokenId === token.id);\r\n  });\r\n  if (tokenInCombat) {\r\n    effects.push('token-variants-combat');\r\n  }\r\n\r\n  if (game.combat?.started) {\r\n    if (game.combat?.combatant?.token?.id === token.id) {\r\n      effects.push('combat-turn');\r\n    } else if (game.combat?.nextCombatant?.token?.id === token.id) {\r\n      effects.push('combat-turn-next');\r\n    }\r\n  }\r\n  if (data.hidden) {\r\n    effects.push('token-variants-visibility');\r\n  }\r\n\r\n  if (TVA_CONFIG.internalEffects.hpChange.enabled) {\r\n    getHPChangeEffect(data, effects);\r\n  }\r\n\r\n  // Actor/Token effects\r\n  if (data.actorLink) {\r\n    getEffectsFromActor(token.actor, effects);\r\n  } else {\r\n    if (game.system.id === 'pf2e') {\r\n      (data.delta?.items || []).forEach((item) => {\r\n        if (_activePF2EItem(item)) {\r\n          effects.push(item.name);\r\n        }\r\n      });\r\n    } else {\r\n      (data.effects || []).filter((ef) => !ef.disabled && !ef.isSuppressed).forEach((ef) => effects.push(ef.label));\r\n      getEffectsFromActor(token.actor, effects);\r\n    }\r\n  }\r\n\r\n  // Expression/Mapping effects\r\n  evaluateComparatorEffects(token, effects);\r\n  evaluateStateEffects(token, effects);\r\n\r\n  // Include mappings marked as always applicable\r\n  // as well as the ones defined as logical expressions if needed\r\n  const mappings = getAllEffectMappings(token);\r\n\r\n  for (const m of mappings) {\r\n    if (m.tokens?.length && !m.tokens.includes(data.id)) continue;\r\n    if (m.alwaysOn) effects.unshift(m.id);\r\n    else if (includeExpressions) {\r\n      const evaluation = evaluateMappingExpression(m, effects, token);\r\n      if (evaluation) effects.unshift(m.id);\r\n    }\r\n  }\r\n\r\n  return effects;\r\n}\r\n\r\nexport function getEffectsFromActor(actor, effects = []) {\r\n  if (!actor) return effects;\r\n\r\n  if (game.system.id === 'pf2e') {\r\n    (actor.items || []).forEach((item, id) => {\r\n      if (_activePF2EItem(item)) effects.push(item.name);\r\n    });\r\n  } else {\r\n    (actor.effects || []).forEach((activeEffect, id) => {\r\n      if (!activeEffect.disabled && !activeEffect.isSuppressed) effects.push(activeEffect.name ?? activeEffect.label);\r\n    });\r\n    (actor.items || []).forEach((item) => {\r\n      if (ITEM_TYPES.includes(item.type) && item.system.equipped) effects.push(item.name ?? item.label);\r\n    });\r\n  }\r\n\r\n  return effects;\r\n}\r\n\r\nfunction _activePF2EItem(item) {\r\n  if (PF2E_ITEM_TYPES.includes(item.type)) {\r\n    if ('active' in item) {\r\n      return item.active;\r\n    } else if ('isEquipped' in item) {\r\n      return item.isEquipped;\r\n    } else {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nexport const VALID_EXPRESSION = new RegExp('([a-zA-Z\\\\-\\\\.\\\\+]+)([><=]+)(\".*\"|-?\\\\d+)(%{0,1})');\r\n\r\nexport function evaluateComparator(token, expression) {\r\n  const match = expression.match(VALID_EXPRESSION);\r\n  if (match) {\r\n    const property = match[1];\r\n\r\n    let currVal;\r\n    let maxVal;\r\n    if (property === 'hp') {\r\n      [currVal, maxVal] = getTokenHP(token);\r\n    } else if (property === 'hp++' || property === 'hp--') {\r\n      [currVal, maxVal] = getTokenHP(token);\r\n      currVal = getProperty(token, `actor.flags.token-variants.internalEffects.${property}`) ?? 0;\r\n    } else currVal = getProperty(token, property);\r\n    if (currVal == null) currVal = 0;\r\n\r\n    const sign = match[2];\r\n    let val = Number(match[3]);\r\n    if (isNaN(val)) {\r\n      val = match[3].substring(1, match[3].length - 1);\r\n      if (val === 'true') val = true;\r\n      if (val === 'false') val = false;\r\n      // Convert currVal to a truthy/falsy one if this is a bool check\r\n      if (val === true || val === false) {\r\n        if (isEmpty(currVal)) currVal = false;\r\n        else currVal = Boolean(currVal);\r\n      }\r\n    }\r\n    const isPercentage = Boolean(match[4]);\r\n\r\n    if (property === 'rotation') {\r\n      maxVal = 360;\r\n    } else if (maxVal == null) {\r\n      maxVal = 999999;\r\n    }\r\n    const toCompare = isPercentage ? (currVal / maxVal) * 100 : currVal;\r\n\r\n    let passed = false;\r\n    if (sign === '=') {\r\n      passed = toCompare == val;\r\n    } else if (sign === '>') {\r\n      passed = toCompare > val;\r\n    } else if (sign === '<') {\r\n      passed = toCompare < val;\r\n    } else if (sign === '>=') {\r\n      passed = toCompare >= val;\r\n    } else if (sign === '<=') {\r\n      passed = toCompare <= val;\r\n    } else if (sign === '<>') {\r\n      passed = toCompare < val || toCompare > val;\r\n    }\r\n    return passed;\r\n  }\r\n  return false;\r\n}\r\n\r\nexport function evaluateComparatorEffects(token, effects = []) {\r\n  token = token.document ?? token;\r\n\r\n  const mappings = getAllEffectMappings(token);\r\n\r\n  const matched = new Set();\r\n\r\n  for (const m of mappings) {\r\n    const expressions = m.expression\r\n      .split(EXPRESSION_MATCH_RE)\r\n      .filter(Boolean)\r\n      .map((exp) => exp.trim())\r\n      .filter(Boolean);\r\n    for (let i = 0; i < expressions.length; i++) {\r\n      if (evaluateComparator(token, expressions[i])) {\r\n        matched.add(expressions[i]);\r\n      }\r\n    }\r\n  }\r\n\r\n  // Remove duplicate expressions and insert into effects\r\n  matched.forEach((exp) => effects.unshift(exp));\r\n\r\n  return effects;\r\n}\r\n\r\nexport function evaluateStateEffects(token, effects) {\r\n  if (game.system.id === 'pf2e') {\r\n    const deathIcon = game.settings.get('pf2e', 'deathIcon');\r\n    if ((token.document ?? token).overlayEffect === deathIcon) effects.push('Dead');\r\n  }\r\n}\r\n\r\n/**\r\n * Replaces {1,a,5,b} type string in the expressions with (1|a|5|b)\r\n * @param {*} exp\r\n * @returns\r\n */\r\nfunction _findReplaceBracketWildcard(exp) {\r\n  let nExp = '';\r\n  let lIndex = 0;\r\n  while (lIndex >= 0) {\r\n    let i1 = exp.indexOf('\\\\\\\\\\\\{', lIndex);\r\n    if (i1 !== -1) {\r\n      let i2 = exp.indexOf('\\\\\\\\\\\\}', i1);\r\n      if (i2 !== -1) {\r\n        nExp += exp.substring(lIndex, i1);\r\n        nExp +=\r\n          '(' +\r\n          exp\r\n            .substring(i1 + 4, i2)\r\n            .split(',')\r\n            .join('|') +\r\n          ')';\r\n      }\r\n      lIndex = i2 + 4;\r\n    } else {\r\n      return nExp + exp.substring(lIndex, exp.length);\r\n    }\r\n  }\r\n  return nExp ?? exp;\r\n}\r\n\r\nfunction _testRegExEffect(effect, effects) {\r\n  let re = effect.replace(/[/\\-\\\\^$+?.()|[\\]{}]/g, '\\\\$&').replaceAll('\\\\\\\\*', '.*');\r\n  re = _findReplaceBracketWildcard(re);\r\n  re = new RegExp('^' + re + '$');\r\n  return effects.find((ef) => re.test(ef));\r\n}\r\n\r\nexport function evaluateMappingExpression(mapping, effects, token, added = new Set(), removed = new Set()) {\r\n  let arrExpression = mapping.expression\r\n    .split(EXPRESSION_MATCH_RE)\r\n    .filter(Boolean)\r\n    .map((s) => s.trim())\r\n    .filter(Boolean);\r\n\r\n  let temp = '';\r\n  let hasAdded = false;\r\n  let hasRemoved = false;\r\n  for (let exp of arrExpression) {\r\n    if (EXPRESSION_OPERATORS.includes(exp)) {\r\n      temp += exp.replace('\\\\', '');\r\n      continue;\r\n    }\r\n\r\n    if (/\\\\\\*|\\\\{.*\\\\}/g.test(exp)) {\r\n      let rExp = _testRegExEffect(exp, effects);\r\n      if (rExp) {\r\n        temp += 'true';\r\n      } else {\r\n        temp += 'false';\r\n      }\r\n\r\n      if (_testRegExEffect(exp, added)) hasAdded = true;\r\n      else if (_testRegExEffect(exp, removed)) hasRemoved = true;\r\n      continue;\r\n    } else if (effects.includes(exp)) {\r\n      temp += 'true';\r\n    } else {\r\n      temp += 'false';\r\n    }\r\n\r\n    if (!hasAdded && added.has(exp)) hasAdded = true;\r\n    if (!hasRemoved && removed.has(exp)) hasRemoved = true;\r\n  }\r\n\r\n  try {\r\n    let evaluation = eval(temp);\r\n\r\n    // Evaluate JS code\r\n    if (mapping.codeExp) {\r\n      try {\r\n        token = token.document ?? token;\r\n        if (!eval(mapping.codeExp)) evaluation = false;\r\n        else if (!mapping.expression) evaluation = true;\r\n      } catch (e) {\r\n        evaluation = false;\r\n      }\r\n    }\r\n\r\n    if (evaluation) {\r\n      if (hasAdded || hasRemoved) {\r\n        added.add(mapping.id);\r\n        effects.push(mapping.id);\r\n      } else effects.unshift(mapping.id);\r\n    } else if (hasRemoved || hasAdded) {\r\n      removed.add(mapping.id);\r\n    }\r\n    return evaluation;\r\n  } catch (e) {}\r\n  return false;\r\n}\r\n\r\nfunction _getTokenHPv11(token) {\r\n  let attributes;\r\n\r\n  if (token.actorLink) {\r\n    attributes = getProperty(token.actor?.system, TVA_CONFIG.systemHpPath);\r\n  } else {\r\n    attributes = mergeObject(\r\n      getProperty(token.actor?.system, TVA_CONFIG.systemHpPath) || {},\r\n      getProperty(token.delta?.system) || {},\r\n      {\r\n        inplace: false,\r\n      }\r\n    );\r\n  }\r\n\r\n  return [attributes?.value, attributes?.max];\r\n}\r\n\r\nexport function getTokenHP(token) {\r\n  if (!isNewerVersion('11', game.version)) return _getTokenHPv11(token);\r\n\r\n  let attributes;\r\n\r\n  if (token.actorLink) {\r\n    attributes = getProperty(token.actor.system, TVA_CONFIG.systemHpPath);\r\n  } else {\r\n    attributes = mergeObject(\r\n      getProperty(token.actor.system, TVA_CONFIG.systemHpPath) || {},\r\n      getProperty(token.actorData?.system) || {},\r\n      {\r\n        inplace: false,\r\n      }\r\n    );\r\n  }\r\n  return [attributes?.value, attributes?.max];\r\n}\r\n\r\nasync function _updateImageOnEffectChange(effectName, actor, added = true) {\r\n  const tokens = actor.token ? [actor.token] : getAllActorTokens(actor, true, !TVA_CONFIG.mappingsCurrentSceneOnly);\r\n  for (const token of tokens) {\r\n    await updateWithEffectMapping(token, {\r\n      added: added ? [effectName] : [],\r\n      removed: !added ? [effectName] : [],\r\n    });\r\n  }\r\n}\r\n\r\nasync function _updateImageOnMultiEffectChange(actor, added = [], removed = []) {\r\n  if (!actor) return;\r\n  const tokens = actor.token ? [actor.token] : getAllActorTokens(actor, true, !TVA_CONFIG.mappingsCurrentSceneOnly);\r\n  for (const token of tokens) {\r\n    await updateWithEffectMapping(token, {\r\n      added: added,\r\n      removed: removed,\r\n    });\r\n  }\r\n}\r\n\r\nasync function _deleteCombatant(combatant) {\r\n  const token = combatant._token || canvas.tokens.get(combatant.tokenId);\r\n  if (!token || !token.actor) return;\r\n  await updateWithEffectMapping(token, {\r\n    removed: ['token-variants-combat'],\r\n  });\r\n}\r\n","import { BASE_IMAGE_CATEGORIES, userRequiresImageCache, waitForTokenTexture } from './utils.js';\r\nimport { ForgeSearchPaths } from '../applications/forgeSearchPaths.js';\r\nimport TokenHUDClientSettings from '../applications/tokenHUDClientSettings.js';\r\nimport CompendiumMapConfig from '../applications/compendiumMap.js';\r\nimport ImportExport from '../applications/importExport.js';\r\nimport ConfigureSettings from '../applications/configureSettings.js';\r\nimport { cacheImages, saveCache } from './search.js';\r\nimport { registerAllHooks } from './hooks/hooks.js';\r\nimport { registerAllWrappers } from './wrappers/wrappers.js';\r\n\r\nexport const TVA_CONFIG = {\r\n  debug: false,\r\n  disableNotifs: false,\r\n  searchPaths: [\r\n    {\r\n      text: 'modules/caeora-maps-tokens-assets/assets/tokens',\r\n      cache: true,\r\n      source: typeof ForgeAPI === 'undefined' ? 'data' : 'forge-bazaar',\r\n      types: ['Portrait', 'Token', 'PortraitAndToken'],\r\n    },\r\n  ],\r\n  forgeSearchPaths: {},\r\n  worldHud: {\r\n    displayOnlySharedImages: false,\r\n    disableIfTHWEnabled: false,\r\n    includeKeywords: false,\r\n    updateActorImage: false,\r\n    useNameSimilarity: false,\r\n    includeWildcard: true,\r\n    showFullPath: false,\r\n    animate: true,\r\n  },\r\n  hud: {\r\n    enableSideMenu: true,\r\n    displayAsImage: true,\r\n    imageOpacity: 50,\r\n  },\r\n  keywordSearch: true,\r\n  excludedKeywords: 'and,for',\r\n  runSearchOnPath: false,\r\n  searchFilters: {},\r\n  algorithm: {\r\n    exact: false,\r\n    fuzzy: true,\r\n    fuzzyLimit: 100,\r\n    fuzzyThreshold: 0.3,\r\n    fuzzyArtSelectPercentSlider: true,\r\n  },\r\n  tokenConfigs: [],\r\n  randomizer: {\r\n    actorCreate: false,\r\n    tokenCreate: false,\r\n    tokenCopyPaste: false,\r\n    tokenName: true,\r\n    keywords: false,\r\n    shared: false,\r\n    wildcard: false,\r\n    representedActorDisable: false,\r\n    linkedActorDisable: true,\r\n    popupOnDisable: false,\r\n    diffImages: false,\r\n    syncImages: false,\r\n  },\r\n  popup: {\r\n    disableAutoPopupOnActorCreate: true,\r\n    disableAutoPopupOnTokenCreate: true,\r\n    disableAutoPopupOnTokenCopyPaste: true,\r\n    twoPopups: false,\r\n    twoPopupsNoDialog: false,\r\n  },\r\n  imgurClientId: '',\r\n  stackStatusConfig: true,\r\n  mergeGroup: false,\r\n  staticCache: false,\r\n  staticCacheFile: 'modules/token-variants/token-variants-cache.json',\r\n  tilesEnabled: true,\r\n  compendiumMapper: {\r\n    missingOnly: false,\r\n    diffImages: false,\r\n    showImages: true,\r\n    cache: false,\r\n    autoDisplayArtSelect: true,\r\n    syncImages: false,\r\n    overrideCategory: false,\r\n    category: 'Token',\r\n    missingImages: [{ document: 'all', image: CONST.DEFAULT_TOKEN }],\r\n    searchOptions: {},\r\n  },\r\n  permissions: {\r\n    popups: {\r\n      1: false,\r\n      2: false,\r\n      3: true,\r\n      4: true,\r\n    },\r\n    portrait_right_click: {\r\n      1: false,\r\n      2: false,\r\n      3: true,\r\n      4: true,\r\n    },\r\n    image_path_button: {\r\n      1: false,\r\n      2: false,\r\n      3: true,\r\n      4: true,\r\n    },\r\n    hud: {\r\n      1: true,\r\n      2: true,\r\n      3: true,\r\n      4: true,\r\n    },\r\n    hudFullAccess: {\r\n      1: false,\r\n      2: false,\r\n      3: true,\r\n      4: true,\r\n    },\r\n    statusConfig: {\r\n      1: false,\r\n      2: false,\r\n      3: true,\r\n      4: true,\r\n    },\r\n  },\r\n  globalMappings: [],\r\n  templateMappings: [],\r\n  customImageCategories: [],\r\n  displayEffectIconsOnHover: false,\r\n  disableEffectIcons: false,\r\n  filterEffectIcons: false,\r\n  filterCustomEffectIcons: true,\r\n  filterIconList: [],\r\n  updateTokenProto: false,\r\n  imgNameContainsDimensions: false,\r\n  imgNameContainsFADimensions: false,\r\n  playVideoOnHover: true,\r\n  pauseVideoOnHoverOut: false,\r\n  disableImageChangeOnPolymorphed: false,\r\n  disableImageUpdateOnNonPrototype: false,\r\n  disableTokenUpdateAnimation: false,\r\n  mappingsCurrentSceneOnly: false,\r\n  invisibleImage: '',\r\n  systemHpPath: '',\r\n  internalEffects: {\r\n    hpChange: { enabled: false, duration: null },\r\n  },\r\n  hideElevationTooltip: false,\r\n  hideTokenBorder: false,\r\n};\r\n\r\nexport const FEATURE_CONTROL = {\r\n  EffectMappings: true,\r\n  EffectIcons: true,\r\n  Overlays: true,\r\n  UserMappings: true,\r\n  Wildcards: true,\r\n  PopUpAndRandomize: true,\r\n  HUD: true,\r\n  HideElement: true,\r\n};\r\n\r\nexport function registerSettings() {\r\n  game.settings.register('token-variants', 'featureControl', {\r\n    scope: 'world',\r\n    config: false,\r\n    type: Object,\r\n    default: FEATURE_CONTROL,\r\n    onChange: async (val) => {\r\n      mergeObject(FEATURE_CONTROL, val);\r\n      registerAllHooks();\r\n      registerAllWrappers();\r\n    },\r\n  });\r\n  mergeObject(FEATURE_CONTROL, game.settings.get('token-variants', 'featureControl'));\r\n\r\n  game.settings.registerMenu('token-variants', 'settings', {\r\n    name: 'Configure Settings',\r\n    hint: 'Configure Token Variant Art settings',\r\n    label: 'Settings',\r\n    scope: 'world',\r\n    icon: 'fas fa-cog',\r\n    type: ConfigureSettings,\r\n    restricted: true,\r\n  });\r\n\r\n  const systemHpPaths = {\r\n    'cyberpunk-red-core': 'derivedStats.hp',\r\n    lfg: 'health',\r\n    worldbuilding: 'health',\r\n    twodsix: 'hits',\r\n  };\r\n  TVA_CONFIG.systemHpPath = systemHpPaths[game.system.id] ?? 'attributes.hp';\r\n\r\n  game.settings.register('token-variants', 'effectMappingToggleGroups', {\r\n    scope: 'world',\r\n    config: false,\r\n    type: Object,\r\n    default: { Default: true },\r\n  });\r\n\r\n  game.settings.register('token-variants', 'settings', {\r\n    scope: 'world',\r\n    config: false,\r\n    type: Object,\r\n    default: TVA_CONFIG,\r\n    onChange: async (val) => {\r\n      // Generate a diff, it will be required when doing post-processing of the modified settings\r\n      const diff = _arrayAwareDiffObject(TVA_CONFIG, val);\r\n\r\n      // Check image re-cache required due to permission changes\r\n      let requiresImageCache = false;\r\n      if ('permissions' in diff) {\r\n        if (\r\n          !userRequiresImageCache(TVA_CONFIG.permissions) &&\r\n          userRequiresImageCache(val.permissions)\r\n        )\r\n          requiresImageCache = true;\r\n      }\r\n\r\n      // Update live settings\r\n      mergeObject(TVA_CONFIG, val);\r\n\r\n      if (\r\n        TVA_CONFIG.filterEffectIcons &&\r\n        ('filterCustomEffectIcons' in diff || 'filterIconList' in diff)\r\n      ) {\r\n        for (const tkn of canvas.tokens.placeables) {\r\n          waitForTokenTexture(tkn, (token) => {\r\n            token.drawEffects();\r\n          });\r\n        }\r\n      }\r\n\r\n      // Check image re-cache required due to search path changes\r\n      if ('searchPaths' in diff || 'forgeSearchPaths' in diff) {\r\n        if (userRequiresImageCache(TVA_CONFIG.permissions)) requiresImageCache = true;\r\n      }\r\n\r\n      // Cache/re-cache images if necessary\r\n      if (requiresImageCache) {\r\n        await cacheImages();\r\n      }\r\n\r\n      if (diff.staticCache) {\r\n        const cacheFile = diff.staticCacheFile ? diff.staticCacheFile : TVA_CONFIG.staticCacheFile;\r\n        saveCache(cacheFile);\r\n      }\r\n\r\n      TVA_CONFIG.hud = game.settings.get('token-variants', 'hudSettings');\r\n\r\n      registerAllHooks();\r\n      registerAllWrappers();\r\n\r\n      if ('displayEffectIconsOnHover' in diff) {\r\n        for (const tkn of canvas.tokens.placeables) {\r\n          if (tkn.effects) tkn.effects.visible = !diff.displayEffectIconsOnHover;\r\n        }\r\n      }\r\n\r\n      if ('hideElevationTooltip' in diff) {\r\n        for (const tkn of canvas.tokens.placeables) {\r\n          if (tkn.tooltip) tkn.tooltip.text = tkn._getTooltipText();\r\n        }\r\n      }\r\n\r\n      if ('hideTokenBorder' in diff) {\r\n        for (const tkn of canvas.tokens.placeables) {\r\n          if (tkn.border) tkn.border.visible = !diff.hideTokenBorder;\r\n        }\r\n      }\r\n\r\n      if ('filterEffectIcons' in diff || 'disableEffectIcons' in diff) {\r\n        for (const tkn of canvas.tokens.placeables) {\r\n          tkn.drawEffects();\r\n        }\r\n      }\r\n    },\r\n  });\r\n\r\n  game.settings.register('token-variants', 'debug', {\r\n    scope: 'world',\r\n    config: false,\r\n    type: Boolean,\r\n    default: TVA_CONFIG.debug,\r\n    onChange: (val) => (TVA_CONFIG.debug = val),\r\n  });\r\n\r\n  if (typeof ForgeAPI !== 'undefined') {\r\n    game.settings.registerMenu('token-variants', 'forgeSearchPaths', {\r\n      name: game.i18n.localize('token-variants.settings.forge-search-paths.Name'),\r\n      hint: game.i18n.localize('token-variants.settings.forge-search-paths.Hint'),\r\n      icon: 'fas fa-search',\r\n      type: ForgeSearchPaths,\r\n      scope: 'client',\r\n      restricted: false,\r\n    });\r\n  }\r\n\r\n  game.settings.register('token-variants', 'tokenConfigs', {\r\n    scope: 'world',\r\n    config: false,\r\n    type: Array,\r\n    default: TVA_CONFIG.tokenConfigs,\r\n    onChange: (val) => (TVA_CONFIG.tokenConfigs = val),\r\n  });\r\n\r\n  game.settings.registerMenu('token-variants', 'tokenHUDSettings', {\r\n    name: game.i18n.localize('token-variants.settings.token-hud.Name'),\r\n    hint: game.i18n.localize('token-variants.settings.token-hud.Hint'),\r\n    scope: 'client',\r\n    icon: 'fas fa-images',\r\n    type: TokenHUDClientSettings,\r\n    restricted: false,\r\n  });\r\n\r\n  game.settings.registerMenu('token-variants', 'compendiumMapper', {\r\n    name: game.i18n.localize('token-variants.settings.compendium-mapper.Name'),\r\n    hint: game.i18n.localize('token-variants.settings.compendium-mapper.Hint'),\r\n    scope: 'world',\r\n    icon: 'fas fa-cogs',\r\n    type: CompendiumMapConfig,\r\n    restricted: true,\r\n  });\r\n\r\n  game.settings.register('token-variants', 'compendiumMapper', {\r\n    scope: 'world',\r\n    config: false,\r\n    type: Object,\r\n    default: TVA_CONFIG.compendiumMapper,\r\n    onChange: (val) => (TVA_CONFIG.compendiumMapper = val),\r\n  });\r\n\r\n  game.settings.register('token-variants', 'hudSettings', {\r\n    scope: 'client',\r\n    config: false,\r\n    type: Object,\r\n    default: TVA_CONFIG.hud,\r\n    onChange: (val) => (TVA_CONFIG.hud = val),\r\n  });\r\n\r\n  game.settings.registerMenu('token-variants', 'importExport', {\r\n    name: `Import/Export`,\r\n    hint: game.i18n.localize('token-variants.settings.import-export.Hint'),\r\n    scope: 'world',\r\n    icon: 'fas fa-toolbox',\r\n    type: ImportExport,\r\n    restricted: true,\r\n  });\r\n\r\n  // Read settings\r\n  const settings = game.settings.get('token-variants', 'settings');\r\n  mergeObject(TVA_CONFIG, settings);\r\n\r\n  if (isEmpty(TVA_CONFIG.searchFilters)) {\r\n    BASE_IMAGE_CATEGORIES.forEach((cat) => {\r\n      TVA_CONFIG.searchFilters[cat] = {\r\n        include: '',\r\n        exclude: '',\r\n        regex: '',\r\n      };\r\n    });\r\n  }\r\n\r\n  for (let uid in TVA_CONFIG.forgeSearchPaths) {\r\n    TVA_CONFIG.forgeSearchPaths[uid].paths = TVA_CONFIG.forgeSearchPaths[uid].paths.map((p) => {\r\n      if (!p.source) {\r\n        p.source = 'forgevtt';\r\n      }\r\n      if (!p.types) {\r\n        if (p.tiles) p.types = ['Tile'];\r\n        else p.types = ['Portrait', 'Token', 'PortraitAndToken'];\r\n      }\r\n      return p;\r\n    });\r\n  }\r\n\r\n  // 20/07/2023 Convert globalMappings to a new format\r\n  if (getType(settings.globalMappings) === 'Object') {\r\n    Hooks.once('ready', () => {\r\n      TVA_CONFIG.globalMappings = migrateMappings(settings.globalMappings);\r\n      setTimeout(() => updateSettings({ globalMappings: TVA_CONFIG.globalMappings }), 10000);\r\n    });\r\n  }\r\n\r\n  // Read client settings\r\n  TVA_CONFIG.hud = game.settings.get('token-variants', 'hudSettings');\r\n}\r\n\r\nexport function migrateMappings(mappings, globalMappings = []) {\r\n  if (!mappings) return [];\r\n  if (getType(mappings) === 'Object') {\r\n    let nMappings = [];\r\n    for (const [effect, mapping] of Object.entries(mappings)) {\r\n      if (!mapping.label) mapping.label = effect.replaceAll('¶', '.');\r\n      if (!mapping.expression) mapping.expression = effect.replaceAll('¶', '.');\r\n      if (!mapping.id) mapping.id = randomID(8);\r\n      delete mapping.effect;\r\n      if (mapping.overlayConfig) mapping.overlayConfig.id = mapping.id;\r\n      delete mapping.overlayConfig?.effect;\r\n      nMappings.push(mapping);\r\n    }\r\n    // Convert parents to parentIDs\r\n    let combMappings = nMappings.concat(globalMappings);\r\n    for (const mapping of nMappings) {\r\n      if (mapping.overlayConfig?.parent) {\r\n        if (mapping.overlayConfig.parent === 'Token (Placeable)') {\r\n          mapping.overlayConfig.parentID = 'TOKEN';\r\n        } else {\r\n          const parent = combMappings.find((m) => m.label === mapping.overlayConfig.parent);\r\n          if (parent) mapping.overlayConfig.parentID = parent.id;\r\n          else mapping.overlayConfig.parentID = '';\r\n        }\r\n        delete mapping.overlayConfig.parent;\r\n      }\r\n    }\r\n    return nMappings;\r\n  }\r\n  return mappings;\r\n}\r\n\r\nexport function getFlagMappings(object) {\r\n  if (!object) return [];\r\n  let doc = object.document ?? object;\r\n  const actorId = doc.actor?.id;\r\n  if (actorId) {\r\n    doc = game.actors.get(actorId);\r\n    if (!doc) return [];\r\n  }\r\n\r\n  // 23/07/2023\r\n  let mappings = doc.getFlag('token-variants', 'effectMappings') ?? [];\r\n  if (getType(mappings) === 'Object') {\r\n    mappings = migrateMappings(mappings, TVA_CONFIG.globalMappings);\r\n    doc.setFlag('token-variants', 'effectMappings', mappings);\r\n  }\r\n  return mappings;\r\n}\r\n\r\nexport function exportSettingsToJSON() {\r\n  const settings = deepClone(TVA_CONFIG);\r\n  const filename = `token-variants-settings.json`;\r\n  saveDataToFile(JSON.stringify(settings, null, 2), 'text/json', filename);\r\n}\r\n\r\nexport async function importSettingsFromJSON(json) {\r\n  if (typeof json === 'string') json = JSON.parse(json);\r\n\r\n  if (json.forgeSearchPaths)\r\n    for (let uid in json.forgeSearchPaths) {\r\n      json.forgeSearchPaths[uid].paths = json.forgeSearchPaths[uid].paths.map((p) => {\r\n        if (!p.source) {\r\n          p.source = 'forgevtt';\r\n        }\r\n        if (!p.types) {\r\n          if (p.tiles) p.types = ['Tile'];\r\n          else p.types = ['Portrait', 'Token', 'PortraitAndToken'];\r\n        }\r\n        return p;\r\n      });\r\n    }\r\n\r\n  // 09/07/2022 Convert filters to new format if old one is still in use\r\n  if (json.searchFilters && json.searchFilters.portraitFilterInclude != null) {\r\n    const filters = json.searchFilters;\r\n    json.searchFilters = {\r\n      Portrait: {\r\n        include: filters.portraitFilterInclude ?? '',\r\n        exclude: filters.portraitFilterExclude ?? '',\r\n        regex: filters.portraitFilterRegex ?? '',\r\n      },\r\n      Token: {\r\n        include: filters.tokenFilterInclude ?? '',\r\n        exclude: filters.tokenFilterExclude ?? '',\r\n        regex: filters.tokenFilterRegex ?? '',\r\n      },\r\n      PortraitAndToken: {\r\n        include: filters.generalFilterInclude ?? '',\r\n        exclude: filters.generalFilterExclude ?? '',\r\n        regex: filters.generalFilterRegex ?? '',\r\n      },\r\n    };\r\n    if (json.compendiumMapper) delete json.compendiumMapper.searchFilters;\r\n  }\r\n\r\n  // Global Mappings need special merge\r\n  if (json.globalMappings) {\r\n    const nMappings = migrateMappings(json.globalMappings);\r\n    for (const m of nMappings) {\r\n      const i = TVA_CONFIG.globalMappings.findIndex((mapping) => m.label === mapping.label);\r\n      if (i === -1) TVA_CONFIG.globalMappings.push(m);\r\n      else TVA_CONFIG.globalMappings[i] = m;\r\n    }\r\n    json.globalMappings = TVA_CONFIG.globalMappings;\r\n  }\r\n\r\n  updateSettings(json);\r\n}\r\n\r\nfunction _refreshFilters(filters, customCategories, updateTVAConfig = false) {\r\n  const categories = BASE_IMAGE_CATEGORIES.concat(\r\n    customCategories ?? TVA_CONFIG.customImageCategories\r\n  );\r\n  for (const filter in filters) {\r\n    if (!categories.includes(filter)) {\r\n      delete filters[filter];\r\n      if (updateTVAConfig) delete TVA_CONFIG.searchFilters[filter];\r\n    }\r\n  }\r\n  for (const category of customCategories) {\r\n    if (filters[category] == null) {\r\n      filters[category] = {\r\n        include: '',\r\n        exclude: '',\r\n        regex: '',\r\n      };\r\n    }\r\n  }\r\n}\r\n\r\nexport async function updateSettings(newSettings) {\r\n  const settings = mergeObject(deepClone(TVA_CONFIG), newSettings, { insertKeys: false });\r\n  // Custom image categories might have changed, meaning we may have filters that are no longer relevant\r\n  // or need to be added\r\n  if ('customImageCategories' in newSettings) {\r\n    _refreshFilters(settings.searchFilters, newSettings.customImageCategories, true);\r\n    if (settings.compendiumMapper?.searchOptions?.searchFilters != null) {\r\n      _refreshFilters(\r\n        settings.compendiumMapper.searchOptions.searchFilters,\r\n        newSettings.customImageCategories\r\n      );\r\n      TVA_CONFIG.compendiumMapper.searchOptions.searchFilters =\r\n        settings.compendiumMapper.searchOptions.searchFilters;\r\n    }\r\n  }\r\n  await game.settings.set('token-variants', 'settings', settings);\r\n}\r\n\r\nexport function _arrayAwareDiffObject(original, other, { inner = false } = {}) {\r\n  function _difference(v0, v1) {\r\n    let t0 = getType(v0);\r\n    let t1 = getType(v1);\r\n    if (t0 !== t1) return [true, v1];\r\n    if (t0 === 'Array') return [!_arrayEquality(v0, v1), v1];\r\n    if (t0 === 'Object') {\r\n      if (isEmpty(v0) !== isEmpty(v1)) return [true, v1];\r\n      let d = _arrayAwareDiffObject(v0, v1, { inner });\r\n      return [!isEmpty(d), d];\r\n    }\r\n    return [v0 !== v1, v1];\r\n  }\r\n\r\n  // Recursively call the _difference function\r\n  return Object.keys(other).reduce((obj, key) => {\r\n    if (inner && !(key in original)) return obj;\r\n    let [isDifferent, difference] = _difference(original[key], other[key]);\r\n    if (isDifferent) obj[key] = difference;\r\n    return obj;\r\n  }, {});\r\n}\r\n\r\nfunction _arrayEquality(a1, a2) {\r\n  if (!(a2 instanceof Array) || a2.length !== a1.length) return false;\r\n  return a1.every((v, i) => {\r\n    if (getType(v) === 'Object') return Object.keys(_arrayAwareDiffObject(v, a2[i])).length === 0;\r\n    return a2[i] === v;\r\n  });\r\n}\r\n\r\nexport function getSearchOptions() {\r\n  return {\r\n    keywordSearch: TVA_CONFIG.keywordSearch,\r\n    excludedKeywords: TVA_CONFIG.excludedKeywords,\r\n    runSearchOnPath: TVA_CONFIG.runSearchOnPath,\r\n    algorithm: TVA_CONFIG.algorithm,\r\n    searchFilters: TVA_CONFIG.searchFilters,\r\n  };\r\n}\r\n","import { TVA_CONFIG, updateSettings, _arrayAwareDiffObject } from './settings.js';\r\nimport { showArtSelect } from '../token-variants.mjs';\r\nimport EffectMappingForm from '../applications/effectMappingForm.js';\r\nimport CompendiumMapConfig from '../applications/compendiumMap.js';\r\nimport { toggleTemplateDialog } from '../applications/dialogs.js';\r\n\r\nconst simplifyRegex = new RegExp(/[^A-Za-z0-9/\\\\]/g);\r\n\r\nexport const SUPPORTED_COMP_ATTRIBUTES = ['rotation', 'elevation'];\r\nexport const EXPRESSION_OPERATORS = ['\\\\(', '\\\\)', '&&', '||', '\\\\!'];\r\n\r\n// Types of searches\r\nexport const SEARCH_TYPE = {\r\n  PORTRAIT: 'Portrait',\r\n  TOKEN: 'Token',\r\n  PORTRAIT_AND_TOKEN: 'PortraitAndToken',\r\n  TILE: 'Tile',\r\n  ITEM: 'Item',\r\n  JOURNAL: 'JournalEntry',\r\n  MACRO: 'Macro',\r\n};\r\n\r\nexport const BASE_IMAGE_CATEGORIES = [\r\n  'Portrait',\r\n  'Token',\r\n  'PortraitAndToken',\r\n  'Tile',\r\n  'Item',\r\n  'JournalEntry',\r\n  'Macro',\r\n  'RollTable',\r\n];\r\n\r\nexport const PRESSED_KEYS = {\r\n  popupOverride: false,\r\n  config: false,\r\n};\r\n\r\nconst BATCH_UPDATES = {\r\n  TOKEN: [],\r\n  TOKEN_CALLBACKS: [],\r\n  TOKEN_CONTEXT: { animate: true },\r\n  ACTOR: [],\r\n  ACTOR_CONTEXT: null,\r\n};\r\n\r\nexport function startBatchUpdater() {\r\n  canvas.app.ticker.add(() => {\r\n    if (BATCH_UPDATES.TOKEN.length) {\r\n      canvas.scene.updateEmbeddedDocuments('Token', BATCH_UPDATES.TOKEN, BATCH_UPDATES.TOKEN_CONTEXT).then(() => {\r\n        for (const cb of BATCH_UPDATES.TOKEN_CALLBACKS) {\r\n          cb();\r\n        }\r\n        BATCH_UPDATES.TOKEN_CALLBACKS = [];\r\n      });\r\n      BATCH_UPDATES.TOKEN = [];\r\n    }\r\n    if (BATCH_UPDATES.ACTOR.length !== 0) {\r\n      if (BATCH_UPDATES.ACTOR_CONTEXT) Actor.updateDocuments(BATCH_UPDATES.ACTOR, BATCH_UPDATES.ACTOR_CONTEXT);\r\n      else Actor.updateDocuments(BATCH_UPDATES.ACTOR);\r\n      BATCH_UPDATES.ACTOR = [];\r\n      BATCH_UPDATES.ACTOR_CONTEXT = null;\r\n    }\r\n  });\r\n}\r\n\r\nexport function queueTokenUpdate(id, update, callback = null, animate = true) {\r\n  update._id = id;\r\n  BATCH_UPDATES.TOKEN.push(update);\r\n  BATCH_UPDATES.TOKEN_CONTEXT = { animate };\r\n  if (callback) BATCH_UPDATES.TOKEN_CALLBACKS.push(callback);\r\n}\r\n\r\nexport function queueActorUpdate(id, update, context = null) {\r\n  update._id = id;\r\n  BATCH_UPDATES.ACTOR.push(update);\r\n  BATCH_UPDATES.ACTOR_CONTEXT = context;\r\n}\r\n\r\n/**\r\n * Updates Token and/or Proto Token  with the new image and custom configuration if one exists.\r\n * @param {string} imgSrc Image source path/url\r\n * @param {object} [options={}] Update options\r\n * @param {Token[]} [options.token] Token to be updated with the new image\r\n * @param {Actor} [options.actor] Actor with Proto Token to be updated with the new image\r\n * @param {string} [options.imgName] Image name if it differs from the file name. Relevant for rolltable sourced images.\r\n * @param {object} [options.tokenUpdate] Token update to be merged and performed at the same time as image update\r\n * @param {object} [options.actorUpdate] Actor update to be merged and performed at the same time as image update\r\n * @param {string} [options.pack] Compendium pack of the Actor being updated\r\n * @param {func} [options.callback] Callback to be executed when a batch update has been performed\r\n * @param {object} [options.config] Token Configuration settings to be applied to the token\r\n */\r\nexport async function updateTokenImage(\r\n  imgSrc,\r\n  {\r\n    token = null,\r\n    actor = null,\r\n    imgName = null,\r\n    tokenUpdate = {},\r\n    actorUpdate = {},\r\n    pack = '',\r\n    callback = null,\r\n    config = undefined,\r\n    animate = true,\r\n    update = null,\r\n    applyDefaultConfig = true,\r\n  } = {}\r\n) {\r\n  if (!(token || actor)) {\r\n    console.warn(game.i18n.localize('token-variants.notifications.warn.update-image-no-token-actor'));\r\n    return;\r\n  }\r\n\r\n  token = token?.document ?? token;\r\n\r\n  // Check if it's a wildcard image\r\n  if ((imgSrc && imgSrc.includes('*')) || (imgSrc.includes('{') && imgSrc.includes('}'))) {\r\n    const images = await wildcardImageSearch(imgSrc);\r\n    if (images.length) {\r\n      imgSrc = images[Math.floor(Math.random() * images.length)];\r\n    }\r\n  }\r\n\r\n  if (!actor && token.actor) {\r\n    actor = game.actors.get(token.actor.id);\r\n  }\r\n\r\n  const getDefaultConfig = (token, actor) => {\r\n    let configEntries = [];\r\n    if (token) configEntries = token.getFlag('token-variants', 'defaultConfig') || [];\r\n    else if (actor) {\r\n      const tokenData = actor.prototypeToken;\r\n      if ('token-variants' in tokenData.flags && 'defaultConfig' in tokenData['token-variants'])\r\n        configEntries = tokenData['token-variants']['defaultConfig'];\r\n    }\r\n    return expandObject(Object.fromEntries(configEntries));\r\n  };\r\n\r\n  const constructDefaultConfig = (origData, customConfig) => {\r\n    const flatOrigData = flattenObject(origData);\r\n    TokenDataAdapter.dataToForm(flatOrigData);\r\n    const flatCustomConfig = flattenObject(customConfig);\r\n    let filtered = filterObject(flatOrigData, flatCustomConfig);\r\n\r\n    // Flags need special treatment as once set they are not removed via absence of them in the update\r\n    for (let [k, v] of Object.entries(flatCustomConfig)) {\r\n      if (k.startsWith('flags.')) {\r\n        if (!(k in flatOrigData)) {\r\n          let splitK = k.split('.');\r\n          splitK[splitK.length - 1] = '-=' + splitK[splitK.length - 1];\r\n          filtered[splitK.join('.')] = null;\r\n        }\r\n      }\r\n    }\r\n\r\n    return Object.entries(filtered);\r\n  };\r\n\r\n  let tokenUpdateObj = tokenUpdate;\r\n  if (imgSrc) {\r\n    setProperty(tokenUpdateObj, 'texture.src', imgSrc);\r\n    if (imgName && getFileName(imgSrc) === imgName) setProperty(tokenUpdateObj, 'flags.token-variants.-=name', null);\r\n    else setProperty(tokenUpdateObj, 'flags.token-variants.name', imgName);\r\n  }\r\n\r\n  const tokenCustomConfig = mergeObject(\r\n    getTokenConfigForUpdate(imgSrc || token?.texture.src, imgName, token),\r\n    config ?? {}\r\n  );\r\n  const usingCustomConfig = token?.getFlag('token-variants', 'usingCustomConfig');\r\n  const defaultConfig = getDefaultConfig(token);\r\n  if (!isEmpty(tokenCustomConfig) || usingCustomConfig) {\r\n    tokenUpdateObj = modMergeObject(tokenUpdateObj, defaultConfig);\r\n  }\r\n\r\n  if (!isEmpty(tokenCustomConfig)) {\r\n    if (token) {\r\n      setProperty(tokenUpdateObj, 'flags.token-variants.usingCustomConfig', true);\r\n      let doc = token.document ?? token;\r\n      const tokenData = doc.toObject ? doc.toObject() : deepClone(doc);\r\n\r\n      const defConf = constructDefaultConfig(mergeObject(tokenData, defaultConfig), tokenCustomConfig);\r\n      setProperty(tokenUpdateObj, 'flags.token-variants.defaultConfig', defConf);\r\n    } else if (actor && !token) {\r\n      setProperty(tokenUpdateObj, 'flags.token-variants.usingCustomConfig', true);\r\n      const tokenData = actor.prototypeToken instanceof Object ? actor.prototypeToken : actor.prototypeToken.toObject();\r\n      const defConf = constructDefaultConfig(tokenData, tokenCustomConfig);\r\n      setProperty(tokenUpdateObj, 'flags.token-variants.defaultConfig', defConf);\r\n    }\r\n\r\n    // Fix, an empty flag may be passed which would overwrite any current flags in the updateObj\r\n    // Remove it before doing the merge\r\n    if (!tokenCustomConfig.flags) {\r\n      delete tokenCustomConfig.flags;\r\n    }\r\n\r\n    tokenUpdateObj = modMergeObject(tokenUpdateObj, tokenCustomConfig);\r\n  } else if (usingCustomConfig) {\r\n    setProperty(tokenUpdateObj, 'flags.token-variants.-=usingCustomConfig', null);\r\n    delete tokenUpdateObj?.flags?.['token-variants']?.defaultConfig;\r\n    setProperty(tokenUpdateObj, 'flags.token-variants.-=defaultConfig', null);\r\n  }\r\n\r\n  if (!applyDefaultConfig) {\r\n    setProperty(tokenUpdateObj, 'flags.token-variants.-=usingCustomConfig', null);\r\n    delete tokenUpdateObj?.flags?.['token-variants']?.defaultConfig;\r\n    setProperty(tokenUpdateObj, 'flags.token-variants.-=defaultConfig', null);\r\n  }\r\n\r\n  if (!isEmpty(tokenUpdateObj)) {\r\n    if (actor && !token) {\r\n      TokenDataAdapter.formToData(actor.prototypeToken, tokenUpdateObj);\r\n      actorUpdate.token = tokenUpdateObj;\r\n      if (pack) {\r\n        queueActorUpdate(actor.id, actorUpdate, { pack: pack });\r\n      } else {\r\n        await (actor.document ?? actor).update(actorUpdate);\r\n      }\r\n    }\r\n\r\n    if (token) {\r\n      TokenDataAdapter.formToData(token, tokenUpdateObj);\r\n      if (TVA_CONFIG.updateTokenProto && token.actor) {\r\n        if (update) {\r\n          mergeObject(update, { token: tokenUpdateObj });\r\n        } else {\r\n          // Timeout to prevent race conditions with other modules namely MidiQOL\r\n          // this is a low priority update so it should be Ok to do\r\n          if (token.actorLink) {\r\n            setTimeout(() => queueActorUpdate(token.actor.id, { token: tokenUpdateObj }), 500);\r\n          } else {\r\n            setTimeout(() => token.actor.update({ token: tokenUpdateObj }), 500);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (update) {\r\n        mergeObject(update, tokenUpdateObj);\r\n      } else {\r\n        if (token.object) queueTokenUpdate(token.id, tokenUpdateObj, callback, animate);\r\n        else {\r\n          await token.update(tokenUpdateObj, { animate });\r\n          callback();\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Assign new artwork to the actor\r\n */\r\nexport async function updateActorImage(actor, imgSrc, directUpdate = true, pack = '') {\r\n  if (!actor) return;\r\n  if (directUpdate) {\r\n    await (actor.document ?? actor).update({\r\n      img: imgSrc,\r\n    });\r\n  } else {\r\n    queueActorUpdate(\r\n      actor.id,\r\n      {\r\n        img: imgSrc,\r\n      },\r\n      pack ? { pack: pack } : null\r\n    );\r\n  }\r\n}\r\n\r\nasync function showTileArtSelect() {\r\n  for (const tile of canvas.tiles.controlled) {\r\n    const tileName = tile.document.getFlag('token-variants', 'tileName') || tile.id;\r\n    showArtSelect(tileName, {\r\n      callback: async function (imgSrc, name) {\r\n        tile.document.update({ img: imgSrc });\r\n      },\r\n      searchType: SEARCH_TYPE.TILE,\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Checks if a key is pressed taking into account current game version.\r\n * @param {string} key v/Ctrl/Shift/Alt\r\n * @returns\r\n */\r\nexport function keyPressed(key) {\r\n  if (key === 'v') return game.keyboard.downKeys.has('KeyV');\r\n  return PRESSED_KEYS[key];\r\n}\r\n\r\nexport function registerKeybinds() {\r\n  game.keybindings.register('token-variants', 'popupOverride', {\r\n    name: 'Popup Override',\r\n    hint: 'When held will trigger popups even when they are disabled.',\r\n    editable: [\r\n      {\r\n        key: 'ShiftLeft',\r\n      },\r\n    ],\r\n    onDown: () => {\r\n      PRESSED_KEYS.popupOverride = true;\r\n    },\r\n    onUp: () => {\r\n      PRESSED_KEYS.popupOverride = false;\r\n    },\r\n    restricted: false,\r\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\r\n  });\r\n  game.keybindings.register('token-variants', 'config', {\r\n    name: 'Config',\r\n    hint: 'When held during a mouse Left-Click of an Image or an Active Affect will display a configuration window.',\r\n    editable: [\r\n      {\r\n        key: 'ShiftLeft',\r\n      },\r\n    ],\r\n    onDown: () => {\r\n      PRESSED_KEYS.config = true;\r\n    },\r\n    onUp: () => {\r\n      PRESSED_KEYS.config = false;\r\n    },\r\n    restricted: false,\r\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\r\n  });\r\n  game.keybindings.register('token-variants', 'showArtSelectPortrait', {\r\n    name: 'Show Art Select: Portrait',\r\n    hint: 'Brings up an Art Select pop-up to change the portrait images of the selected tokens.',\r\n    editable: [\r\n      {\r\n        key: 'Digit1',\r\n        modifiers: ['Shift'],\r\n      },\r\n    ],\r\n    onDown: () => {\r\n      for (const token of canvas.tokens.controlled) {\r\n        const actor = token.actor;\r\n        if (!actor) continue;\r\n        showArtSelect(actor.name, {\r\n          callback: async function (imgSrc, name) {\r\n            await updateActorImage(actor, imgSrc);\r\n          },\r\n          searchType: SEARCH_TYPE.PORTRAIT,\r\n          object: actor,\r\n        });\r\n      }\r\n      if (TVA_CONFIG.tilesEnabled && canvas.tokens.controlled.length === 0) showTileArtSelect();\r\n    },\r\n    restricted: true,\r\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\r\n  });\r\n  game.keybindings.register('token-variants', 'showArtSelectToken', {\r\n    name: 'Show Art Select: Token',\r\n    hint: 'Brings up an Art Select pop-up to change the token images of the selected tokens.',\r\n    editable: [\r\n      {\r\n        key: 'Digit2',\r\n        modifiers: ['Shift'],\r\n      },\r\n    ],\r\n    onDown: () => {\r\n      for (const token of canvas.tokens.controlled) {\r\n        showArtSelect(token.name, {\r\n          callback: async function (imgSrc, imgName) {\r\n            updateTokenImage(imgSrc, {\r\n              actor: token.actor,\r\n              imgName: imgName,\r\n              token: token,\r\n            });\r\n          },\r\n          searchType: SEARCH_TYPE.TOKEN,\r\n          object: token,\r\n        });\r\n      }\r\n      if (TVA_CONFIG.tilesEnabled && canvas.tokens.controlled.length === 0) showTileArtSelect();\r\n    },\r\n    restricted: true,\r\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\r\n  });\r\n  game.keybindings.register('token-variants', 'showArtSelectGeneral', {\r\n    name: 'Show Art Select: Portrait+Token',\r\n    hint: 'Brings up an Art Select pop-up to change both Portrait and Token images of the selected tokens.',\r\n    editable: [\r\n      {\r\n        key: 'Digit3',\r\n        modifiers: ['Shift'],\r\n      },\r\n    ],\r\n    onDown: () => {\r\n      for (const token of canvas.tokens.controlled) {\r\n        const actor = token.actor;\r\n        showArtSelect(token.name, {\r\n          callback: async function (imgSrc, imgName) {\r\n            if (actor) await updateActorImage(actor, imgSrc);\r\n            updateTokenImage(imgSrc, {\r\n              actor: token.actor,\r\n              imgName: imgName,\r\n              token: token,\r\n            });\r\n          },\r\n          searchType: SEARCH_TYPE.PORTRAIT_AND_TOKEN,\r\n          object: token,\r\n        });\r\n      }\r\n      if (TVA_CONFIG.tilesEnabled && canvas.tokens.controlled.length === 0) showTileArtSelect();\r\n    },\r\n    restricted: true,\r\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\r\n  });\r\n  game.keybindings.register('token-variants', 'openGlobalMappings', {\r\n    name: 'Open Global Effect Configurations',\r\n    hint: 'Brings up the settings window for Global Effect Configurations',\r\n    editable: [\r\n      {\r\n        key: 'KeyG',\r\n        modifiers: ['Shift'],\r\n      },\r\n    ],\r\n    onDown: () => {\r\n      const setting = game.settings.get('core', DefaultTokenConfig.SETTING);\r\n      const data = new foundry.data.PrototypeToken(setting);\r\n      const token = new TokenDocument(data, { actor: null });\r\n      new EffectMappingForm(token, { globalMappings: true }).render(true);\r\n    },\r\n    restricted: true,\r\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\r\n  });\r\n\r\n  game.keybindings.register('token-variants', 'compendiumMapper', {\r\n    name: 'Compendium Mapper',\r\n    hint: 'Opens Compendium Mapper',\r\n    editable: [\r\n      {\r\n        key: 'KeyM',\r\n        modifiers: ['Shift'],\r\n      },\r\n    ],\r\n    onDown: () => {\r\n      new CompendiumMapConfig().render(true);\r\n    },\r\n    restricted: true,\r\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\r\n  });\r\n\r\n  game.keybindings.register('token-variants', 'toggleTemplate', {\r\n    name: 'Toggle Template Dialog',\r\n    hint: 'Brings up a dialog from which you can toggle templates on currently selected tokens.',\r\n    editable: [],\r\n    onDown: toggleTemplateDialog,\r\n    restricted: true,\r\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\r\n  });\r\n}\r\n\r\n/**\r\n * Retrieves a custom token configuration if one exists for the given image\r\n */\r\nexport function getTokenConfig(imgSrc, imgName) {\r\n  if (!imgName) imgName = getFileName(imgSrc);\r\n  const tokenConfigs = (TVA_CONFIG.tokenConfigs || []).flat();\r\n  return tokenConfigs.find((config) => config.tvImgSrc == imgSrc && config.tvImgName == imgName) ?? {};\r\n}\r\n\r\n/**\r\n * Retrieves a custom token configuration if one exists for the given image and removes control keys\r\n * returning a clean config that can be used in token update.\r\n */\r\nexport function getTokenConfigForUpdate(imgSrc, imgName, token) {\r\n  if (!imgSrc) return {};\r\n\r\n  let tokenConfig = {};\r\n  for (const path of TVA_CONFIG.searchPaths) {\r\n    if (path.config && imgSrc.startsWith(path.text)) {\r\n      mergeObject(tokenConfig, path.config);\r\n    }\r\n  }\r\n\r\n  let imgConfig = getTokenConfig(imgSrc, imgName ?? getFileName(imgSrc));\r\n  if (!isEmpty(imgConfig)) {\r\n    imgConfig = deepClone(imgConfig);\r\n    delete imgConfig.tvImgSrc;\r\n    delete imgConfig.tvImgName;\r\n    if (token) TokenDataAdapter.formToData(token, imgConfig);\r\n\r\n    for (var key in imgConfig) {\r\n      if (!key.startsWith('tvTab_')) {\r\n        tokenConfig[key] = imgConfig[key];\r\n      }\r\n    }\r\n  }\r\n\r\n  if (TVA_CONFIG.imgNameContainsDimensions || TVA_CONFIG.imgNameContainsFADimensions) {\r\n    extractDimensionsFromImgName(imgSrc, tokenConfig);\r\n  }\r\n\r\n  return tokenConfig;\r\n}\r\n\r\n/**\r\n * Adds or removes a custom token configuration\r\n */\r\nexport function setTokenConfig(imgSrc, imgName, tokenConfig) {\r\n  const tokenConfigs = (TVA_CONFIG.tokenConfigs || []).flat();\r\n  const tcIndex = tokenConfigs.findIndex((config) => config.tvImgSrc == imgSrc && config.tvImgName == imgName);\r\n\r\n  let deleteConfig = !tokenConfig || Object.keys(tokenConfig).length === 0;\r\n  if (!deleteConfig) {\r\n    tokenConfig['tvImgSrc'] = imgSrc;\r\n    tokenConfig['tvImgName'] = imgName;\r\n  }\r\n\r\n  if (tcIndex != -1 && !deleteConfig) {\r\n    tokenConfigs[tcIndex] = tokenConfig;\r\n  } else if (tcIndex != -1 && deleteConfig) {\r\n    tokenConfigs.splice(tcIndex, 1);\r\n  } else if (!deleteConfig) {\r\n    tokenConfigs.push(tokenConfig);\r\n  }\r\n  updateSettings({ tokenConfigs: tokenConfigs });\r\n  return !deleteConfig;\r\n}\r\n\r\n/**\r\n * Extracts the file name from the given path.\r\n */\r\nexport function getFileName(path) {\r\n  if (!path) return '';\r\n  return decodeURISafely(path).split('\\\\').pop().split('/').pop().split('.').slice(0, -1).join('.');\r\n}\r\n\r\n/**\r\n * Extracts the file name including the extension from the given path.\r\n */\r\nexport function getFileNameWithExt(path) {\r\n  if (!path) return '';\r\n  return decodeURISafely(path).split('\\\\').pop().split('/').pop();\r\n}\r\n\r\n/**\r\n * Extract the directory path excluding the file name.\r\n */\r\nexport function getFilePath(path) {\r\n  return decodeURISafely(path).match(/(.*)[\\/\\\\]/)[1] || '';\r\n}\r\n\r\n/**\r\n * Simplify name.\r\n */\r\nexport function simplifyName(name) {\r\n  return name.replace(simplifyRegex, '').toLowerCase();\r\n}\r\n\r\nexport function simplifyPath(path) {\r\n  return decodeURIComponentSafely(path).replace(simplifyRegex, '').toLowerCase();\r\n}\r\n\r\n/**\r\n * Parses the 'excludedKeyword' setting (a comma separated string) into a Set\r\n */\r\nexport function parseKeywords(keywords) {\r\n  return keywords\r\n    .split(/\\W/)\r\n    .map((word) => simplifyName(word))\r\n    .filter((word) => word != '');\r\n}\r\n\r\n/**\r\n * Returns true of provided path points to an image\r\n */\r\nexport function isImage(path) {\r\n  var extension = path.split('.');\r\n  extension = extension[extension.length - 1].toLowerCase();\r\n  return ['jpg', 'jpeg', 'png', 'svg', 'webp', 'gif'].includes(extension);\r\n}\r\n\r\n/**\r\n * Returns true of provided path points to a video\r\n */\r\nexport function isVideo(path) {\r\n  var extension = path.split('.');\r\n  extension = extension[extension.length - 1].toLowerCase();\r\n  return ['mp4', 'ogg', 'webm', 'm4v'].includes(extension);\r\n}\r\n\r\n/**\r\n * Send a recursive HTTP asset browse request to ForgeVTT\r\n * @param {string} path Asset Library path\r\n * @param {string} apiKey Key with read access to the Asset Library\r\n * @returns\r\n */\r\nexport async function callForgeVTT(path, apiKey) {\r\n  return new Promise(async (resolve, reject) => {\r\n    if (typeof ForgeVTT === 'undefined' || !ForgeVTT.usingTheForge) return resolve({});\r\n\r\n    const url = `${ForgeVTT.FORGE_URL}/api/assets/browse`;\r\n    const xhr = new XMLHttpRequest();\r\n    xhr.withCredentials = true;\r\n    xhr.open('POST', url);\r\n    xhr.setRequestHeader('Access-Key', apiKey);\r\n    xhr.setRequestHeader('X-XSRF-TOKEN', await ForgeAPI.getXSRFToken());\r\n    xhr.responseType = 'json';\r\n\r\n    xhr.onreadystatechange = () => {\r\n      if (xhr.readyState !== 4) return;\r\n      resolve(xhr.response);\r\n    };\r\n    xhr.onerror = (err) => {\r\n      resolve({ code: 500, error: err.message });\r\n    };\r\n    let formData = {\r\n      path: path,\r\n      options: {\r\n        recursive: true,\r\n      },\r\n    };\r\n    formData = JSON.stringify(formData);\r\n    xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8');\r\n    xhr.send(formData);\r\n  });\r\n}\r\n\r\n/**\r\n * Retrieves filters based on the type of search.\r\n * @param {SEARCH_TYPE} searchType\r\n */\r\nexport function getFilters(searchType, filters) {\r\n  // Select filters based on type of search\r\n  filters = filters ? filters : TVA_CONFIG.searchFilters;\r\n\r\n  if (filters[searchType]) {\r\n    filters = filters[searchType];\r\n  } else {\r\n    filters = {\r\n      include: '',\r\n      exclude: '',\r\n      regex: '',\r\n    };\r\n  }\r\n\r\n  if (filters.regex) filters.regex = new RegExp(filters.regex);\r\n  return filters;\r\n}\r\n\r\nexport function userRequiresImageCache(perm) {\r\n  const permissions = perm ? perm : TVA_CONFIG.permissions;\r\n  const role = game.user.role;\r\n  return (\r\n    permissions.popups[role] ||\r\n    permissions.portrait_right_click[role] ||\r\n    permissions.image_path_button[role] ||\r\n    permissions.hudFullAccess[role]\r\n  );\r\n}\r\n\r\nexport async function waitForTokenTexture(token, callback, checks = 40) {\r\n  // v10/v9 compatibility\r\n\r\n  if (!token.mesh || !token.mesh.texture) {\r\n    checks--;\r\n    if (checks > 1)\r\n      new Promise((resolve) => setTimeout(resolve, 1)).then(() => waitForTokenTexture(token, callback, checks));\r\n    return;\r\n  }\r\n\r\n  callback(token);\r\n}\r\n\r\nexport function flattenSearchResults(results) {\r\n  let flattened = [];\r\n  if (!results) return flattened;\r\n  results.forEach((images) => {\r\n    flattened = flattened.concat(images);\r\n  });\r\n  return flattened;\r\n}\r\n\r\n// Slightly modified version of mergeObject; added an option to ignore -= keys\r\nexport function modMergeObject(\r\n  original,\r\n  other = {},\r\n  {\r\n    insertKeys = true,\r\n    insertValues = true,\r\n    overwrite = true,\r\n    recursive = true,\r\n    inplace = true,\r\n    enforceTypes = false,\r\n  } = {},\r\n  _d = 0\r\n) {\r\n  other = other || {};\r\n  if (!(original instanceof Object) || !(other instanceof Object)) {\r\n    throw new Error('One of original or other are not Objects!');\r\n  }\r\n  const options = {\r\n    insertKeys,\r\n    insertValues,\r\n    overwrite,\r\n    recursive,\r\n    inplace,\r\n    enforceTypes,\r\n  };\r\n\r\n  // Special handling at depth 0\r\n  if (_d === 0) {\r\n    if (!inplace) original = deepClone(original);\r\n    if (Object.keys(original).some((k) => /\\./.test(k))) original = expandObject(original);\r\n    if (Object.keys(other).some((k) => /\\./.test(k))) other = expandObject(other);\r\n  }\r\n\r\n  // Iterate over the other object\r\n  for (let k of Object.keys(other)) {\r\n    const v = other[k];\r\n    if (original.hasOwnProperty('-=' + k)) {\r\n      original[k] = original['-=' + k];\r\n      delete original['-=' + k];\r\n    }\r\n    if (original.hasOwnProperty(k)) _modMergeUpdate(original, k, v, options, _d + 1);\r\n    else _modMergeInsert(original, k, v, options, _d + 1);\r\n  }\r\n  return original;\r\n}\r\n\r\n/**\r\n * A helper function for merging objects when the target key does not exist in the original\r\n * @private\r\n */\r\nfunction _modMergeInsert(original, k, v, { insertKeys, insertValues } = {}, _d) {\r\n  // Recursively create simple objects\r\n  if (v?.constructor === Object) {\r\n    original[k] = modMergeObject({}, v, {\r\n      insertKeys: true,\r\n      inplace: true,\r\n    });\r\n    return;\r\n  }\r\n\r\n  // Delete a key\r\n  // if (k.startsWith('-=')) {\r\n  //   delete original[k.slice(2)];\r\n  //   return;\r\n  // }\r\n\r\n  // Insert a key\r\n  const canInsert = (_d <= 1 && insertKeys) || (_d > 1 && insertValues);\r\n  if (canInsert) original[k] = v;\r\n}\r\n\r\n/**\r\n * A helper function for merging objects when the target key exists in the original\r\n * @private\r\n */\r\nfunction _modMergeUpdate(original, k, v, { insertKeys, insertValues, enforceTypes, overwrite, recursive } = {}, _d) {\r\n  const x = original[k];\r\n  const tv = getType(v);\r\n  const tx = getType(x);\r\n\r\n  // Recursively merge an inner object\r\n  if (tv === 'Object' && tx === 'Object' && recursive) {\r\n    return modMergeObject(\r\n      x,\r\n      v,\r\n      {\r\n        insertKeys: insertKeys,\r\n        insertValues: insertValues,\r\n        overwrite: overwrite,\r\n        inplace: true,\r\n        enforceTypes: enforceTypes,\r\n      },\r\n      _d\r\n    );\r\n  }\r\n\r\n  // Overwrite an existing value\r\n  if (overwrite) {\r\n    if (tx !== 'undefined' && tv !== tx && enforceTypes) {\r\n      throw new Error(`Mismatched data types encountered during object merge.`);\r\n    }\r\n    original[k] = v;\r\n  }\r\n}\r\n\r\nexport async function tv_executeScript(script, { actor, token, tvaUpdate } = {}) {\r\n  // Add variables to the evaluation scope\r\n  const speaker = ChatMessage.getSpeaker();\r\n  const character = game.user.character;\r\n\r\n  token = token?.object || token || (canvas.ready ? canvas.tokens.get(speaker.token) : null);\r\n  actor = actor || token?.actor || game.actors.get(speaker.actor);\r\n\r\n  // Attempt script execution\r\n  const AsyncFunction = async function () {}.constructor;\r\n  try {\r\n    const fn = AsyncFunction('speaker', 'actor', 'token', 'character', 'tvaUpdate', `${script}`);\r\n    await fn.call(null, speaker, actor, token, character, tvaUpdate);\r\n  } catch (err) {\r\n    ui.notifications.error(`There was an error in your script syntax. See the console (F12) for details`);\r\n    console.error(err);\r\n  }\r\n}\r\n\r\nexport async function executeMacro(macroName, token) {\r\n  token = token?.object || token;\r\n  game.macros.find((m) => m.name === macroName)?.execute({ token });\r\n}\r\n\r\nexport async function applyTMFXPreset(token, presetName, action = 'apply') {\r\n  token = token.object ?? token;\r\n  if (game.modules.get('tokenmagic')?.active && token.document) {\r\n    const preset = TokenMagic.getPreset(presetName);\r\n    if (preset) {\r\n      if (action === 'apply') {\r\n        await TokenMagic.addUpdateFilters(token, preset);\r\n      } else if (action === 'remove') {\r\n        await TokenMagic.deleteFilters(token, presetName);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport async function toggleTMFXPreset(token, presetName) {\r\n  token = token.object ?? token;\r\n  if (game.modules.get('tokenmagic')?.active && token.document) {\r\n    if (TokenMagic.hasFilterId(token, presetName)) {\r\n      applyTMFXPreset(token, presetName, 'remove');\r\n    } else {\r\n      applyTMFXPreset(token, presetName, 'apply');\r\n    }\r\n  }\r\n}\r\n\r\nexport async function applyCEEffect(tokenDoc, ceEffect, action = 'apply') {\r\n  if (game.modules.get('dfreds-convenient-effects')?.active) {\r\n    if (!ceEffect.apply && !ceEffect.remove) return;\r\n    else if (!ceEffect.apply || !ceEffect.remove) {\r\n      if (action === 'apply') {\r\n        if (ceEffect.remove) action = 'remove';\r\n      } else return;\r\n    }\r\n\r\n    let uuid = tokenDoc.actor?.uuid;\r\n    if (uuid) {\r\n      if (action === 'apply') {\r\n        await game.dfreds.effectInterface.addEffect({\r\n          effectName: ceEffect.name,\r\n          uuid,\r\n          origin: 'token-variants',\r\n          overlay: false,\r\n        });\r\n      } else {\r\n        await game.dfreds.effectInterface.removeEffect({ effectName: ceEffect.name, uuid });\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport async function toggleCEEffect(token, effectName) {\r\n  if (game.modules.get('dfreds-convenient-effects')?.active) {\r\n    let uuid = (token.document ?? token).actor?.uuid;\r\n    await game.dfreds.effectInterface.toggleEffect(effectName, {\r\n      uuids: [uuid],\r\n      overlay: false,\r\n    });\r\n  }\r\n}\r\n\r\nexport class TokenDataAdapter {\r\n  static dataToForm(data) {\r\n    if ('texture.scaleX' in data) {\r\n      data.scale = Math.abs(data['texture.scaleX']);\r\n      data.mirrorX = data['texture.scaleX'] < 0;\r\n    }\r\n    if ('texture.scaleY' in data) {\r\n      data.scale = Math.abs(data['texture.scaleY']);\r\n      data.mirrorY = data['texture.scaleY'] < 0;\r\n    }\r\n  }\r\n\r\n  static formToData(token, formData) {\r\n    // Scale/mirroring\r\n    if ('scale' in formData || 'mirrorX' in formData || 'mirrorY' in formData) {\r\n      const doc = token.document ? token.document : token;\r\n      if (!('scale' in formData)) formData.scale = Math.abs(doc.texture.scaleX);\r\n      if (!('mirrorX' in formData)) formData.mirrorX = doc.texture.scaleX < 0;\r\n      if (!('mirrorY' in formData)) formData.mirrorY = doc.texture.scaleY < 0;\r\n      setProperty(formData, 'texture.scaleX', formData.scale * (formData.mirrorX ? -1 : 1));\r\n      setProperty(formData, 'texture.scaleY', formData.scale * (formData.mirrorY ? -1 : 1));\r\n      ['scale', 'mirrorX', 'mirrorY'].forEach((k) => delete formData[k]);\r\n    }\r\n  }\r\n}\r\n\r\nexport function determineAddedRemovedEffects(addedEffects, removedEffects, newEffects, oldEffects) {\r\n  for (const ef of newEffects) {\r\n    if (!oldEffects.includes(ef)) {\r\n      addedEffects.push(ef);\r\n    }\r\n  }\r\n  for (const ef of oldEffects) {\r\n    if (!newEffects.includes(ef)) {\r\n      removedEffects.push(ef);\r\n    }\r\n  }\r\n}\r\n\r\nexport async function wildcardImageSearch(imgSrc) {\r\n  let source = 'data';\r\n  const browseOptions = { wildcard: true };\r\n\r\n  // Support non-user sources\r\n  if (/\\.s3\\./.test(imgSrc)) {\r\n    source = 's3';\r\n    const { bucket, keyPrefix } = FilePicker.parseS3URL(imgSrc);\r\n    if (bucket) {\r\n      browseOptions.bucket = bucket;\r\n      imgSrc = keyPrefix;\r\n    }\r\n  } else if (imgSrc.startsWith('icons/')) source = 'public';\r\n\r\n  // Retrieve wildcard content\r\n  try {\r\n    const content = await FilePicker.browse(source, imgSrc, browseOptions);\r\n    return content.files;\r\n  } catch (err) {}\r\n  return [];\r\n}\r\n\r\n/**\r\n * Returns a random name generated using Name Forge module\r\n * @param {*} randomizerSettings\r\n * @returns\r\n */\r\nexport async function nameForgeRandomize(randomizerSettings) {\r\n  const nameForgeSettings = randomizerSettings.nameForge;\r\n  if (nameForgeSettings?.randomize && nameForgeSettings?.models) {\r\n    const nameForge = game.modules.get('nameforge');\r\n    if (nameForge?.active) {\r\n      const randomNames = [];\r\n      for (const modelKey of nameForgeSettings.models) {\r\n        const modelProp = getProperty(nameForge.models, modelKey);\r\n        if (modelProp) {\r\n          const model = await nameForge.api.createModel(modelProp);\r\n          if (model) {\r\n            randomNames.push(nameForge.api.generateName(model)[0]);\r\n          }\r\n        }\r\n      }\r\n      return randomNames[Math.floor(Math.random() * randomNames.length)];\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Upload Token and associated overlays as a single image\r\n */\r\nexport async function uploadTokenImage(token, options) {\r\n  let renderTexture = captureToken(token, options);\r\n  if (renderTexture) {\r\n    const b64 = canvas.app.renderer.extract.base64(renderTexture, 'image/webp', 1);\r\n    let res = await fetch(b64);\r\n    let blob = await res.blob();\r\n    const filename = options.name + `.webp`;\r\n    let file = new File([blob], filename, { type: 'image/webp' });\r\n    await FilePicker.upload('data', options.path, file, {});\r\n  }\r\n}\r\n\r\n/**\r\n * Modified version of 'dev7355608' captureCanvas function. Captures combined Token and Overlay image\r\n */\r\nfunction captureToken(token, { scale = 3, width = null, height = null } = {}) {\r\n  if (!canvas.ready || !token) {\r\n    return;\r\n  }\r\n\r\n  width = width ?? token.texture.width;\r\n  height = height ?? token.texture.height;\r\n\r\n  scale = scale * Math.min(width / token.texture.width, height / token.texture.height);\r\n\r\n  const renderer = canvas.app.renderer;\r\n  const viewPosition = { ...canvas.scene._viewPosition };\r\n\r\n  renderer.resize(width ?? renderer.screen.width, height ?? renderer.screen.height);\r\n\r\n  width = canvas.screenDimensions[0] = renderer.screen.width;\r\n  height = canvas.screenDimensions[1] = renderer.screen.height;\r\n\r\n  canvas.stage.position.set(width / 2, height / 2);\r\n\r\n  canvas.pan({\r\n    x: token.center.x,\r\n    y: token.center.y,\r\n    scale,\r\n  });\r\n\r\n  const renderTexture = PIXI.RenderTexture.create({\r\n    width,\r\n    height,\r\n    resolution: token.texture.resolution,\r\n  });\r\n\r\n  const cacheParent = canvas.stage.enableTempParent();\r\n\r\n  canvas.stage.updateTransform();\r\n  canvas.stage.disableTempParent(cacheParent);\r\n\r\n  let spritesToRender = [token.mesh];\r\n  if (token.tvaOverlays) spritesToRender = spritesToRender.concat(token.tvaOverlays);\r\n  spritesToRender.sort((sprite) => sprite.sort);\r\n\r\n  for (const sprite of spritesToRender) {\r\n    renderer.render(sprite, { renderTexture, skipUpdateTransform: true, clear: false });\r\n  }\r\n\r\n  canvas._onResize();\r\n  canvas.pan(viewPosition);\r\n\r\n  return renderTexture;\r\n}\r\n\r\nexport function getAllActorTokens(actor, linked = false, document = false) {\r\n  if (actor.isToken) {\r\n    if (document) return [actor.token];\r\n    else if (actor.token.object) return [actor.token.object];\r\n    else return [];\r\n  }\r\n\r\n  const tokens = [];\r\n  game.scenes.forEach((scene) =>\r\n    scene.tokens.forEach((token) => {\r\n      if (token.actorId === actor.id) {\r\n        if (linked && token.actorLink) tokens.push(token);\r\n        else if (!linked) tokens.push(token);\r\n      }\r\n    })\r\n  );\r\n  if (document) return tokens;\r\n  else return tokens.map((token) => token.object).filter((token) => token);\r\n}\r\n\r\nexport function extractDimensionsFromImgName(img, dimensions = {}) {\r\n  const name = getFileName(img);\r\n\r\n  let scale;\r\n  if (TVA_CONFIG.imgNameContainsDimensions) {\r\n    const height = name.match(/_height(.*)_/)?.[1];\r\n    if (height) dimensions.height = parseFloat(height);\r\n    const width = name.match(/_width(.*)_/)?.[1];\r\n    if (width) dimensions.width = parseFloat(width);\r\n    scale = name.match(/_scale(.*)_/)?.[1];\r\n    if (scale) scale = Math.max(parseFloat(scale), 0.2);\r\n  }\r\n  if (TVA_CONFIG.imgNameContainsFADimensions) {\r\n    scale = name.match(/_Scale(\\d+)_/)?.[1];\r\n    if (scale) {\r\n      scale = Math.max(parseInt(scale) / 100, 0.2);\r\n    }\r\n  }\r\n  if (scale) {\r\n    dimensions['texture.scaleX'] = scale;\r\n    dimensions['texture.scaleY'] = scale;\r\n  }\r\n  return dimensions;\r\n}\r\n\r\nexport function string2Hex(hexString) {\r\n  return PIXI.utils.string2hex(hexString);\r\n}\r\n\r\nexport function decodeURISafely(uri) {\r\n  try {\r\n    return decodeURI(uri);\r\n  } catch (e) {\r\n    console.warn('URI Component not decodable: ' + uri);\r\n    return uri;\r\n  }\r\n}\r\n\r\nexport function decodeURIComponentSafely(uri) {\r\n  try {\r\n    return decodeURIComponent(uri);\r\n  } catch (e) {\r\n    console.warn('URI Component not decodable: ' + uri);\r\n    return uri;\r\n  }\r\n}\r\n\r\nexport function mergeMappings(from, to) {\r\n  const changedIDs = {};\r\n\r\n  for (const m of from) {\r\n    const i = to.findIndex((mapping) => mapping.label === m.label && mapping.group === m.group);\r\n    if (i === -1) to.push(m);\r\n    else {\r\n      changedIDs[to.id] = m.id;\r\n      if (to[i].tokens?.length) {\r\n        if (!m.tokens) m.tokens = [];\r\n        to[i].tokens.forEach((id) => {\r\n          if (!m.tokens.includes(id)) m.tokens.push(id);\r\n        });\r\n      }\r\n      to[i] = m;\r\n    }\r\n  }\r\n\r\n  // If parent's id has been changed we need to update all the children\r\n  to.forEach((m) => {\r\n    let pID = m.overlayConfig?.parentID;\r\n    if (pID && pID in changedIDs) {\r\n      m.overlayConfig.parentID = changedIDs[pID];\r\n    }\r\n  });\r\n\r\n  return to;\r\n}\r\n","import { registerSettings, TVA_CONFIG, exportSettingsToJSON, updateSettings } from './scripts/settings.js';\r\nimport { ArtSelect, addToArtSelectQueue } from './applications/artSelect.js';\r\nimport {\r\n  SEARCH_TYPE,\r\n  registerKeybinds,\r\n  updateTokenImage,\r\n  startBatchUpdater,\r\n  userRequiresImageCache,\r\n  waitForTokenTexture,\r\n} from './scripts/utils.js';\r\nimport { FONT_LOADING, drawOverlays } from './scripts/token/overlay.js';\r\nimport {\r\n  getTokenEffects,\r\n  setOverlayVisibility,\r\n  toggleTemplate,\r\n  toggleTemplateOnSelected,\r\n  updateWithEffectMapping,\r\n} from './scripts/hooks/effectMappingHooks.js';\r\nimport { cacheImages, doImageSearch, doRandomSearch, isCaching } from './scripts/search.js';\r\nimport { REGISTERED_HOOKS, registerAllHooks, registerHook } from './scripts/hooks/hooks.js';\r\nimport { REGISTERED_WRAPPERS, registerAllWrappers } from './scripts/wrappers/wrappers.js';\r\nimport {\r\n  assignUserSpecificImage,\r\n  assignUserSpecificImageToSelected,\r\n  unassignUserSpecificImage,\r\n  unassignUserSpecificImageFromSelected,\r\n} from './scripts/wrappers/userMappingWrappers.js';\r\nimport { toggleTemplateDialog } from './applications/dialogs.js';\r\n\r\n// Tracks if module has been initialized\r\nlet MODULE_INITIALIZED = false;\r\nexport function isInitialized() {\r\n  return MODULE_INITIALIZED;\r\n}\r\nlet onInit = [];\r\n\r\n/**\r\n * Initialize the Token Variants module on Foundry VTT init\r\n */\r\nasync function initialize() {\r\n  // Initialization should only be performed once\r\n  if (MODULE_INITIALIZED) {\r\n    return;\r\n  }\r\n\r\n  // Font Awesome need to be loaded manually on FireFox\r\n  FONT_LOADING.loading = FontConfig.loadFont('fontAwesome', {\r\n    editor: false,\r\n    fonts: [{ urls: ['fonts/fontawesome/webfonts/fa-solid-900.ttf'] }],\r\n  });\r\n\r\n  // Want this to be executed once the module has initialized\r\n  onInit.push(() => {\r\n    // Need to wait for icons do be drawn first however I could not find a way\r\n    // to wait until that has occurred. Instead we'll just wait for some static\r\n    // amount of time.\r\n    new Promise((resolve) => setTimeout(resolve, 500)).then(() => {\r\n      for (const tkn of canvas.tokens.placeables) {\r\n        drawOverlays(tkn); // Draw Overlays\r\n\r\n        // Disable effect icons\r\n        if (TVA_CONFIG.disableEffectIcons) {\r\n          waitForTokenTexture(tkn, (token) => {\r\n            token.effects.removeChildren().forEach((c) => c.destroy());\r\n            token.effects.bg = token.effects.addChild(new PIXI.Graphics());\r\n            token.effects.overlay = null;\r\n          });\r\n        } else if (TVA_CONFIG.filterEffectIcons) {\r\n          waitForTokenTexture(tkn, (token) => {\r\n            token.drawEffects();\r\n          });\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  if (userRequiresImageCache()) cacheImages();\r\n\r\n  // Register ALL Hooks\r\n  registerAllHooks();\r\n\r\n  // Startup ticker that will periodically call 'updateEmbeddedDocuments' with all the accrued updates since the last tick\r\n  startBatchUpdater();\r\n\r\n  registerHook('Search', 'renderArtSelect', () => {\r\n    ArtSelect.executing = false;\r\n  });\r\n\r\n  // Handle broadcasts\r\n  game.socket?.on(`module.token-variants`, (message) => {\r\n    if (message.handlerName === 'forgeSearchPaths' && message.type === 'UPDATE') {\r\n      // Workaround for forgeSearchPaths setting to be updated by non-GM clients\r\n      if (!game.user.isGM) return;\r\n      const isResponsibleGM = !game.users\r\n        .filter((user) => user.isGM && (user.active || user.isActive))\r\n        .some((other) => other.id < game.user.id);\r\n      if (!isResponsibleGM) return;\r\n      updateSettings({ forgeSearchPaths: message.args });\r\n    } else if (message.handlerName === 'drawOverlays' && message.type === 'UPDATE') {\r\n      if (message.args.all) {\r\n        if (canvas.scene.id !== message.args.sceneId) {\r\n          for (const tkn of canvas.tokens.placeables) {\r\n            drawOverlays(tkn);\r\n          }\r\n        }\r\n      } else if (message.args.actorId) {\r\n        const actor = game.actors.get(message.args.actorId);\r\n        if (actor) actor.getActiveTokens(true)?.forEach((tkn) => drawOverlays(tkn));\r\n      } else if (message.args.tokenId) {\r\n        const tkn = canvas.tokens.get(message.args.tokenId);\r\n        if (tkn) drawOverlays(tkn);\r\n      }\r\n    } else if (message.handlerName === 'effectMappings') {\r\n      if (!game.user.isGM) return;\r\n      const isResponsibleGM = !game.users\r\n        .filter((user) => user.isGM && (user.active || user.isActive))\r\n        .some((other) => other.id < game.user.id);\r\n      if (!isResponsibleGM) return;\r\n      const args = message.args;\r\n      const token = game.scenes.get(args.sceneId)?.tokens.get(args.tokenId);\r\n      if (token) updateWithEffectMapping(token, { added: args.added, removed: args.removed });\r\n    }\r\n  });\r\n\r\n  MODULE_INITIALIZED = true;\r\n  for (const cb of onInit) {\r\n    cb();\r\n  }\r\n  onInit = [];\r\n}\r\n\r\n/**\r\n * Performs searches and displays the Art Select pop-up with the results\r\n * @param {string} search The text to be used as the search criteria\r\n * @param {object} [options={}] Options which customize the search\r\n * @param {Function[]} [options.callback] Function to be called with the user selected image path\r\n * @param {SEARCH_TYPE|string} [options.searchType] Controls filters applied to the search results\r\n * @param {Token|Actor} [options.object] Token/Actor used when displaying Custom Token Config prompt\r\n * @param {boolean} [options.force] If true will always override the current Art Select window if one exists instead of adding it to the queue\r\n * @param {object} [options.searchOptions] Override search and filter settings\r\n */\r\nexport async function showArtSelect(\r\n  search,\r\n  {\r\n    callback = null,\r\n    searchType = SEARCH_TYPE.PORTRAIT_AND_TOKEN,\r\n    object = null,\r\n    force = false,\r\n    preventClose = false,\r\n    image1 = '',\r\n    image2 = '',\r\n    displayMode = ArtSelect.IMAGE_DISPLAY.NONE,\r\n    multipleSelection = false,\r\n    searchOptions = {},\r\n    allImages = null,\r\n  } = {}\r\n) {\r\n  if (isCaching()) return;\r\n\r\n  const artSelects = Object.values(ui.windows).filter((app) => app instanceof ArtSelect);\r\n  if (ArtSelect.executing || (!force && artSelects.length !== 0)) {\r\n    addToArtSelectQueue(search, {\r\n      callback,\r\n      searchType,\r\n      object,\r\n      preventClose,\r\n      searchOptions,\r\n      allImages,\r\n    });\r\n    return;\r\n  }\r\n\r\n  ArtSelect.executing = true;\r\n  if (!allImages)\r\n    allImages = await doImageSearch(search, {\r\n      searchType: searchType,\r\n      searchOptions: searchOptions,\r\n    });\r\n\r\n  new ArtSelect(search, {\r\n    allImages: allImages,\r\n    searchType: searchType,\r\n    callback: callback,\r\n    object: object,\r\n    preventClose: preventClose,\r\n    image1: image1,\r\n    image2: image2,\r\n    displayMode: displayMode,\r\n    multipleSelection: multipleSelection,\r\n    searchOptions: searchOptions,\r\n  }).render(true);\r\n}\r\n\r\n// Initialize module\r\nregisterHook('main', 'ready', initialize, { once: true });\r\n\r\n// Register API and Keybinds\r\nregisterHook('main', 'init', function () {\r\n  registerSettings();\r\n  registerAllWrappers();\r\n\r\n  registerKeybinds();\r\n\r\n  const api = {\r\n    cacheImages,\r\n    doImageSearch,\r\n    doRandomSearch,\r\n    getTokenEffects,\r\n    showArtSelect,\r\n    updateTokenImage,\r\n    exportSettingsToJSON,\r\n    assignUserSpecificImage,\r\n    assignUserSpecificImageToSelected,\r\n    unassignUserSpecificImage,\r\n    unassignUserSpecificImageFromSelected,\r\n    setOverlayVisibility,\r\n    toggleTemplateDialog,\r\n    toggleTemplate,\r\n    toggleTemplateOnSelected,\r\n    TVA_CONFIG,\r\n  };\r\n\r\n  Object.defineProperty(api, 'hooks', {\r\n    get() {\r\n      return deepClone(REGISTERED_HOOKS);\r\n    },\r\n    configurable: true,\r\n  });\r\n\r\n  Object.defineProperty(api, 'wrappers', {\r\n    get() {\r\n      return deepClone(REGISTERED_WRAPPERS);\r\n    },\r\n    configurable: true,\r\n  });\r\n\r\n  game.modules.get('token-variants').api = api;\r\n});\r\n","import TokenCustomConfig from './tokenCustomConfig.js';\r\nimport { isVideo, isImage, keyPressed, SEARCH_TYPE, BASE_IMAGE_CATEGORIES, getFileName } from '../scripts/utils.js';\r\nimport { showArtSelect } from '../token-variants.mjs';\r\nimport { TVA_CONFIG, getSearchOptions } from '../scripts/settings.js';\r\n\r\nexport function addToArtSelectQueue(search, options) {\r\n  ArtSelect.queue.push({\r\n    search: search,\r\n    options: options,\r\n  });\r\n  $('button#token-variant-art-clear-queue').html(`Clear Queue (${ArtSelect.queue.length})`).show();\r\n}\r\n\r\nexport function addToQueue(search, options) {\r\n  ArtSelect.queue.push({\r\n    search: search,\r\n    options: options,\r\n  });\r\n}\r\n\r\nexport function renderFromQueue(force = false) {\r\n  if (!force) {\r\n    const artSelects = Object.values(ui.windows).filter((app) => app instanceof ArtSelect);\r\n    if (artSelects.length !== 0) {\r\n      if (ArtSelect.queue.length !== 0)\r\n        $('button#token-variant-art-clear-queue').html(`Clear Queue (${ArtSelect.queue.length})`).show();\r\n      return;\r\n    }\r\n  }\r\n\r\n  let callData = ArtSelect.queue.shift();\r\n  if (callData?.options.execute) {\r\n    callData.options.execute();\r\n    callData = ArtSelect.queue.shift();\r\n  }\r\n  if (callData) {\r\n    showArtSelect(callData.search, callData.options);\r\n  }\r\n}\r\n\r\nfunction delay(fn, ms) {\r\n  let timer = 0;\r\n  return function (...args) {\r\n    clearTimeout(timer);\r\n    timer = setTimeout(fn.bind(this, ...args), ms || 0);\r\n  };\r\n}\r\n\r\nexport class ArtSelect extends FormApplication {\r\n  static queue = [];\r\n\r\n  static instance = null;\r\n\r\n  // showArtSelect(...) can take a while to fully execute and it is possible for it to be called\r\n  // multiple times in very quick succession especially if copy pasting tokens or importing actors.\r\n  // This variable set early in the function execution is used to queue additional requests rather\r\n  // than continue execution\r\n  static executing = false;\r\n\r\n  static IMAGE_DISPLAY = {\r\n    NONE: 0,\r\n    PORTRAIT: 1,\r\n    TOKEN: 2,\r\n    PORTRAIT_TOKEN: 3,\r\n    IMAGE: 4,\r\n  };\r\n\r\n  constructor(\r\n    search,\r\n    {\r\n      preventClose = false,\r\n      object = null,\r\n      callback = null,\r\n      searchType = null,\r\n      allImages = null,\r\n      image1 = '',\r\n      image2 = '',\r\n      displayMode = ArtSelect.IMAGE_DISPLAY.NONE,\r\n      multipleSelection = false,\r\n      searchOptions = {},\r\n    } = {}\r\n  ) {\r\n    let title = game.i18n.localize('token-variants.windows.art-select.select-variant');\r\n    if (searchType === SEARCH_TYPE.TOKEN)\r\n      title = game.i18n.localize('token-variants.windows.art-select.select-token-art');\r\n    else if (searchType === SEARCH_TYPE.PORTRAIT)\r\n      title = game.i18n.localize('token-variants.windows.art-select.select-portrait-art');\r\n\r\n    super(\r\n      {},\r\n      {\r\n        closeOnSubmit: false,\r\n        width: ArtSelect.WIDTH || 500,\r\n        height: ArtSelect.HEIGHT || 500,\r\n        left: ArtSelect.LEFT,\r\n        top: ArtSelect.TOP,\r\n        title: title,\r\n      }\r\n    );\r\n    this.search = search;\r\n    this.allImages = allImages;\r\n    this.callback = callback;\r\n    this.doc = object;\r\n    this.preventClose = preventClose;\r\n    this.image1 = image1;\r\n    this.image2 = image2;\r\n    this.displayMode = displayMode;\r\n    this.multipleSelection = multipleSelection;\r\n    this.searchType = searchType;\r\n    this.searchOptions = mergeObject(searchOptions, getSearchOptions(), {\r\n      overwrite: false,\r\n    });\r\n    ArtSelect.instance = this;\r\n\r\n    const constructorName = `ArtSelect`;\r\n    Object.defineProperty(ArtSelect.prototype.constructor, 'name', { value: constructorName });\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-art-select',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/artSelect.html',\r\n      resizable: true,\r\n      minimizable: false,\r\n    });\r\n  }\r\n\r\n  _getHeaderButtons() {\r\n    const buttons = super._getHeaderButtons();\r\n    buttons.unshift({\r\n      label: 'FilePicker',\r\n      class: 'file-picker',\r\n      icon: 'fas fa-file-import fa-fw',\r\n      onclick: () => {\r\n        new FilePicker({\r\n          type: 'imagevideo',\r\n          callback: (path) => {\r\n            if (!this.preventClose) {\r\n              this.close();\r\n            }\r\n            if (this.callback) {\r\n              this.callback(path, getFileName(path));\r\n            }\r\n          },\r\n        }).render();\r\n      },\r\n    });\r\n    buttons.unshift({\r\n      label: 'Image Category',\r\n      class: 'type',\r\n      icon: 'fas fa-swatchbook',\r\n      onclick: () => {\r\n        if (ArtSelect.instance) ArtSelect.instance._typeSelect();\r\n      },\r\n    });\r\n    return buttons;\r\n  }\r\n\r\n  _typeSelect() {\r\n    const categories = BASE_IMAGE_CATEGORIES.concat(TVA_CONFIG.customImageCategories);\r\n\r\n    const buttons = {};\r\n    for (const c of categories) {\r\n      let label = c;\r\n      if (c === this.searchType) {\r\n        label = '<b>>>> ' + label + ' <<<</b>';\r\n      }\r\n      buttons[c] = {\r\n        label: label,\r\n        callback: () => {\r\n          if (this.searchType !== c) {\r\n            this.searchType = c;\r\n            this._performSearch(this.search, true);\r\n          }\r\n        },\r\n      };\r\n    }\r\n\r\n    new Dialog({\r\n      title: `Select Image Category and Filter`,\r\n      content: `<style>.dialog .dialog-button {flex: 0 0 auto;}</style>`,\r\n      buttons: buttons,\r\n    }).render(true);\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n    if (this.doc instanceof Item) {\r\n      data.item = true;\r\n      data.description = this.doc.system?.description?.value ?? '';\r\n    }\r\n    const searchOptions = this.searchOptions;\r\n    const algorithm = searchOptions.algorithm;\r\n\r\n    //\r\n    // Create buttons\r\n    //\r\n    const tokenConfigs = (TVA_CONFIG.tokenConfigs || []).flat();\r\n    const fuzzySearch = algorithm.fuzzy;\r\n\r\n    let allButtons = new Map();\r\n    let artFound = false;\r\n\r\n    const genLabel = function (str, indices, start = '<mark>', end = '</mark>', fillChar = null) {\r\n      if (!indices) return str;\r\n      let fillStr = fillChar ? fillChar.repeat(str.length) : str;\r\n      let label = '';\r\n      let lastIndex = 0;\r\n      for (const index of indices) {\r\n        label += fillStr.slice(lastIndex, index[0]);\r\n        label += start + str.slice(index[0], index[1] + 1) + end;\r\n        lastIndex = index[1] + 1;\r\n      }\r\n      label += fillStr.slice(lastIndex, fillStr.length);\r\n\r\n      return label;\r\n    };\r\n\r\n    const genTitle = function (obj) {\r\n      if (!fuzzySearch) return obj.path;\r\n\r\n      let percent = Math.ceil((1 - obj.score) * 100) + '%';\r\n      if (searchOptions.runSearchOnPath) {\r\n        return percent + '\\n' + genLabel(obj.path, obj.indices, '', '', '-') + '\\n' + obj.path;\r\n      }\r\n      return percent;\r\n    };\r\n\r\n    this.allImages.forEach((images, search) => {\r\n      const buttons = [];\r\n      images.forEach((imageObj) => {\r\n        artFound = true;\r\n        const vid = isVideo(imageObj.path);\r\n        const img = isImage(imageObj.path);\r\n        buttons.push({\r\n          path: imageObj.path,\r\n          img: img,\r\n          vid: vid,\r\n          type: vid || img,\r\n          name: imageObj.name,\r\n          label:\r\n            fuzzySearch && !searchOptions.runSearchOnPath ? genLabel(imageObj.name, imageObj.indices) : imageObj.name,\r\n          title: genTitle(imageObj),\r\n          hasConfig:\r\n            this.searchType === SEARCH_TYPE.TOKEN || this.searchType === SEARCH_TYPE.PORTRAIT_AND_TOKEN\r\n              ? Boolean(\r\n                  tokenConfigs.find((config) => config.tvImgSrc == imageObj.path && config.tvImgName == imageObj.name)\r\n                )\r\n              : false,\r\n        });\r\n      });\r\n      allButtons.set(search, buttons);\r\n    });\r\n\r\n    if (artFound) data.allImages = allButtons;\r\n\r\n    data.search = this.search;\r\n    data.queue = ArtSelect.queue.length;\r\n    data.image1 = this.image1;\r\n    data.image2 = this.image2;\r\n    data.displayMode = this.displayMode;\r\n    data.multipleSelection = this.multipleSelection;\r\n    data.displaySlider = algorithm.fuzzy && algorithm.fuzzyArtSelectPercentSlider;\r\n    data.fuzzyThreshold = algorithm.fuzzyThreshold;\r\n    if (data.displaySlider) {\r\n      data.fuzzyThreshold = 100 - data.fuzzyThreshold * 100;\r\n      data.fuzzyThreshold = data.fuzzyThreshold.toFixed(0);\r\n    }\r\n    data.autoplay = !TVA_CONFIG.playVideoOnHover;\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n    const callback = this.callback;\r\n    const close = () => this.close();\r\n    const object = this.doc;\r\n    const preventClose = this.preventClose;\r\n    const multipleSelection = this.multipleSelection;\r\n\r\n    const boxes = html.find(`.token-variants-grid-box`);\r\n    boxes.hover(\r\n      function () {\r\n        if (TVA_CONFIG.playVideoOnHover) {\r\n          const vid = $(this).siblings('video');\r\n          if (vid.length) {\r\n            vid[0].play();\r\n            $(this).siblings('.fa-play').hide();\r\n          }\r\n        }\r\n      },\r\n      function () {\r\n        if (TVA_CONFIG.pauseVideoOnHoverOut) {\r\n          const vid = $(this).siblings('video');\r\n          if (vid.length) {\r\n            vid[0].pause();\r\n            vid[0].currentTime = 0;\r\n            $(this).siblings('.fa-play').show();\r\n          }\r\n        }\r\n      }\r\n    );\r\n    boxes.map((box) => {\r\n      boxes[box].addEventListener('click', async function (event) {\r\n        if (keyPressed('config')) {\r\n          if (object)\r\n            new TokenCustomConfig(object, {}, event.target.dataset.name, event.target.dataset.filename).render(true);\r\n        } else {\r\n          if (!preventClose) {\r\n            close();\r\n          }\r\n          if (callback) {\r\n            callback(event.target.dataset.name, event.target.dataset.filename);\r\n          }\r\n        }\r\n      });\r\n      if (multipleSelection) {\r\n        boxes[box].addEventListener('contextmenu', async function (event) {\r\n          $(event.target).toggleClass('selected');\r\n        });\r\n      }\r\n    });\r\n\r\n    let searchInput = html.find('#custom-art-search');\r\n    searchInput.focus();\r\n    searchInput[0].selectionStart = searchInput[0].selectionEnd = 10000;\r\n\r\n    searchInput.on(\r\n      'input',\r\n      delay((event) => {\r\n        this._performSearch(event.target.value);\r\n      }, 350)\r\n    );\r\n\r\n    html.find(`button#token-variant-art-clear-queue`).on('click', (event) => {\r\n      ArtSelect.queue = ArtSelect.queue.filter((callData) => callData.options.execute);\r\n      $(event.target).hide();\r\n    });\r\n\r\n    $(html)\r\n      .find('[name=\"fuzzyThreshold\"]')\r\n      .change((e) => {\r\n        $(e.target)\r\n          .siblings('.token-variants-range-value')\r\n          .html(`${parseFloat(e.target.value).toFixed(0)}%`);\r\n        this.searchOptions.algorithm.fuzzyThreshold = (100 - e.target.value) / 100;\r\n      })\r\n      .change(\r\n        delay((event) => {\r\n          this._performSearch(this.search, true);\r\n        }, 350)\r\n      );\r\n\r\n    if (multipleSelection) {\r\n      html.find(`button#token-variant-art-return-selected`).on('click', () => {\r\n        if (callback) {\r\n          const images = [];\r\n          html\r\n            .find(`.token-variants-grid-box.selected`)\r\n            .siblings('.token-variants-grid-image')\r\n            .each(function () {\r\n              images.push(this.getAttribute('src'));\r\n            });\r\n          callback(images);\r\n        }\r\n        close();\r\n      });\r\n      html.find(`button#token-variant-art-return-all`).on('click', () => {\r\n        if (callback) {\r\n          const images = [];\r\n          html.find(`.token-variants-grid-image`).each(function () {\r\n            images.push(this.getAttribute('src'));\r\n          });\r\n          callback(images);\r\n        }\r\n        close();\r\n      });\r\n    }\r\n  }\r\n\r\n  _performSearch(search, force = false) {\r\n    if (!force && this.search.trim() === search.trim()) return;\r\n    showArtSelect(search, {\r\n      callback: this.callback,\r\n      searchType: this.searchType,\r\n      object: this.doc,\r\n      force: true,\r\n      image1: this.image1,\r\n      image2: this.image2,\r\n      displayMode: this.displayMode,\r\n      multipleSelection: this.multipleSelection,\r\n      searchOptions: this.searchOptions,\r\n      preventClose: this.preventClose,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {\r\n    if (formData && formData.search != this.search) {\r\n      this._performSearch(formData.search);\r\n    } else {\r\n      this.close();\r\n    }\r\n  }\r\n\r\n  setPosition(options = {}) {\r\n    if (options.width) ArtSelect.WIDTH = options.width;\r\n    if (options.height) ArtSelect.HEIGHT = options.height;\r\n    if (options.top) ArtSelect.TOP = options.top;\r\n    if (options.left) ArtSelect.LEFT = options.left;\r\n    super.setPosition(options);\r\n  }\r\n\r\n  async close(options = {}) {\r\n    let callData = ArtSelect.queue.shift();\r\n    if (callData?.options.execute) {\r\n      callData.options.execute();\r\n      callData = ArtSelect.queue.shift();\r\n    }\r\n    if (callData) {\r\n      callData.options.force = true;\r\n      showArtSelect(callData.search, callData.options);\r\n    } else {\r\n      // For some reason there might be app instances that have not closed themselves by this point\r\n      // If there are, close them now\r\n      const artSelects = Object.values(ui.windows)\r\n        .filter((app) => app instanceof ArtSelect)\r\n        .filter((app) => app.appId !== this.appId);\r\n      for (const app of artSelects) {\r\n        app.close();\r\n      }\r\n\r\n      return super.close(options);\r\n    }\r\n  }\r\n}\r\n\r\nexport function insertArtSelectButton(html, target, { search = '', searchType = SEARCH_TYPE.TOKEN } = {}) {\r\n  const button = $(`<button \r\n      class=\"token-variants-image-select-button\" \r\n      type=\"button\"\r\n      data-type=\"imagevideo\"\r\n      data-target=\"${target}\"\r\n      title=\"${game.i18n.localize('token-variants.windows.art-select.select-variant')}\">\r\n        <i class=\"fas fa-images\"></i>\r\n      </button>`);\r\n  button.on('click', () => {\r\n    showArtSelect(search, {\r\n      callback: (imgSrc, name) => {\r\n        button.siblings(`[name=\"${target}\"]`).val(imgSrc);\r\n      },\r\n      searchType,\r\n    });\r\n  });\r\n  const input = html.find(`[name=\"${target}\"]`);\r\n  input.after(button);\r\n  return Boolean(input.length);\r\n}\r\n","import { getTokenConfig, setTokenConfig } from '../scripts/utils.js';\r\n\r\nexport default class TokenCustomConfig extends TokenConfig {\r\n  constructor(object, options, imgSrc, imgName, callback, config) {\r\n    let token;\r\n    if (object instanceof Actor) {\r\n      token = new TokenDocument(object.token, {\r\n        actor: object,\r\n      });\r\n    } else {\r\n      token = new TokenDocument(object.document, {\r\n        actor: game.actors.get(object.actorId),\r\n      });\r\n    }\r\n    super(token, options);\r\n    this.imgSrc = imgSrc;\r\n    this.imgName = imgName;\r\n    this.callback = callback;\r\n    this.config = config;\r\n    if (this.config) {\r\n      this.flags = this.config.flags;\r\n      this.tv_script = this.config.tv_script;\r\n    }\r\n  }\r\n\r\n  _getSubmitData(updateData = {}) {\r\n    if (!this.form) throw new Error('The FormApplication subclass has no registered form element');\r\n    const fd = new FormDataExtended(this.form, { editors: this.editors });\r\n    let data = fd.object;\r\n    if (updateData) data = foundry.utils.flattenObject(foundry.utils.mergeObject(data, updateData));\r\n\r\n    // Clear detection modes array\r\n    if (!('detectionModes.0.id' in data)) data.detectionModes = [];\r\n\r\n    // Treat \"None\" as null for bar attributes\r\n    data['bar1.attribute'] ||= null;\r\n    data['bar2.attribute'] ||= null;\r\n    return data;\r\n  }\r\n\r\n  async _updateObject(event, formData) {\r\n    const filtered = {};\r\n\r\n    const form = $(event.target).closest('form');\r\n\r\n    form.find('.form-group').each(function (_) {\r\n      const tva_checkbox = $(this).find('.tva-config-checkbox > input');\r\n      if (tva_checkbox.length && tva_checkbox.is(':checked')) {\r\n        $(this)\r\n          .find('[name]')\r\n          .each(function (_) {\r\n            const name = $(this).attr('name');\r\n            filtered[name] = formData[name];\r\n          });\r\n      }\r\n    });\r\n\r\n    if (this.tv_script) {\r\n      filtered.tv_script = this.tv_script;\r\n    }\r\n\r\n    if (this.config) {\r\n      let config = expandObject(filtered);\r\n      config.flags = config.flags ? mergeObject(this.flags || {}, config.flags) : this.flags;\r\n      if (this.callback) this.callback(config);\r\n    } else {\r\n      const saved = setTokenConfig(this.imgSrc, this.imgName, filtered);\r\n      if (this.callback) this.callback(saved);\r\n    }\r\n  }\r\n\r\n  applyCustomConfig() {\r\n    const tokenConfig = flattenObject(this.config || getTokenConfig(this.imgSrc, this.imgName));\r\n    const form = $(this.form);\r\n    for (const key of Object.keys(tokenConfig)) {\r\n      const el = form.find(`[name=\"${key}\"]`);\r\n      if (el.is(':checkbox')) {\r\n        el.prop('checked', tokenConfig[key]);\r\n      } else {\r\n        el.val(tokenConfig[key]);\r\n      }\r\n      el.trigger('change');\r\n    }\r\n  }\r\n\r\n  // *************\r\n  // consider moving html injection to:\r\n  // _replaceHTML | _injectHTML\r\n\r\n  async activateListeners(html) {\r\n    await super.activateListeners(html);\r\n\r\n    // Disable image path controls\r\n    $(html).find('.token-variants-image-select-button').prop('disabled', true);\r\n    $(html).find('.file-picker').prop('disabled', true);\r\n    $(html).find('.image').prop('disabled', true);\r\n\r\n    // Remove 'Assign Token' button\r\n    $(html).find('.assign-token').remove();\r\n\r\n    // Add checkboxes to control inclusion of specific tabs in the custom config\r\n    const tokenConfig = this.config || getTokenConfig(this.imgSrc, this.imgName);\r\n    this.tv_script = tokenConfig.tv_script;\r\n\r\n    $(html).on('change', '.tva-config-checkbox', this._onCheckboxChange);\r\n\r\n    const processFormGroup = function (formGroup) {\r\n      // Checkbox is not added for the Image Path group\r\n      if (!$(formGroup).find('[name=\"img\"]').length) {\r\n        let savedField = false;\r\n        if (tokenConfig) {\r\n          const flatConfig = flattenObject(tokenConfig);\r\n          $(formGroup)\r\n            .find('[name]')\r\n            .each(function (_) {\r\n              const name = $(this).attr('name');\r\n              if (name in flatConfig) {\r\n                savedField = true;\r\n              }\r\n            });\r\n        }\r\n\r\n        const checkbox = $(\r\n          `<div class=\"tva-config-checkbox\"><input type=\"checkbox\" data-dtype=\"Boolean\" ${\r\n            savedField ? 'checked=\"\"' : ''\r\n          }></div>`\r\n        );\r\n        if ($(formGroup).find('p.hint').length) {\r\n          $(formGroup).find('p.hint').before(checkbox);\r\n        } else {\r\n          $(formGroup).append(checkbox);\r\n        }\r\n        checkbox.find('input').trigger('change');\r\n      }\r\n    };\r\n    // Add checkboxes to each form-group to control highlighting and which fields will are to be saved\r\n    $(html)\r\n      .find('.form-group')\r\n      .each(function (index) {\r\n        processFormGroup(this);\r\n      });\r\n\r\n    // Add 'update' and 'remove' config buttons\r\n    $(html).find('.sheet-footer > button').remove();\r\n    $(html)\r\n      .find('.sheet-footer')\r\n      .append('<button type=\"submit\" value=\"1\"><i class=\"far fa-save\"></i> Save Config</button>');\r\n    if (tokenConfig) {\r\n      $(html)\r\n        .find('.sheet-footer')\r\n        .append('<button type=\"button\" class=\"remove-config\"><i class=\"fas fa-trash\"></i> Remove Config</button>');\r\n      html.find('.remove-config').click(this._onRemoveConfig.bind(this));\r\n    }\r\n\r\n    // Pre-select image or appearance tab\r\n    $(html).find('.tabs > .item[data-tab=\"image\"] > i').trigger('click');\r\n    $(html).find('.tabs > .item[data-tab=\"appearance\"] > i').trigger('click');\r\n\r\n    document.activeElement.blur(); // Hack fix for key UP/DOWN effects not registering after config has been opened\r\n\r\n    // TokenConfig might be changed by some modules after activateListeners is processed\r\n    // Look out for these updates and add checkboxes for any newly added form-groups\r\n    const mutate = (mutations) => {\r\n      mutations.forEach((mutation) => {\r\n        mutation.addedNodes.forEach((node) => {\r\n          if (node.nodeName === 'DIV' && node.className === 'form-group') {\r\n            processFormGroup(node);\r\n            this.applyCustomConfig();\r\n          }\r\n        });\r\n      });\r\n    };\r\n\r\n    const observer = new MutationObserver(mutate);\r\n    observer.observe(html[0], {\r\n      characterData: false,\r\n      attributes: false,\r\n      childList: true,\r\n      subtree: true,\r\n    });\r\n\r\n    // On any field being changed we want to automatically select the form-group to be included in the update\r\n    $(html).on('change', 'input, select', onInputChange);\r\n    $(html).on('click', 'button', onInputChange);\r\n\r\n    this.applyCustomConfig();\r\n  }\r\n\r\n  async _onCheckboxChange(event) {\r\n    const checkbox = $(event.target);\r\n    checkbox.closest('.form-group').css({\r\n      'outline-color': checkbox.is(':checked') ? 'green' : '#ffcc6e',\r\n      'outline-width': '2px',\r\n      'outline-style': 'dotted',\r\n      'margin-bottom': '5px',\r\n    });\r\n    checkbox.closest('.tva-config-checkbox').css({\r\n      'outline-color': checkbox.is(':checked') ? 'green' : '#ffcc6e',\r\n      'outline-width': '2px',\r\n      'outline-style': 'solid',\r\n    });\r\n  }\r\n\r\n  async _onRemoveConfig(event) {\r\n    if (this.config) {\r\n      if (this.callback) this.callback({});\r\n    } else {\r\n      const saved = setTokenConfig(this.imgSrc, this.imgName, null);\r\n      if (this.callback) this.callback(saved);\r\n    }\r\n    this.close();\r\n  }\r\n\r\n  get id() {\r\n    return `token-custom-config-${this.object.id}`;\r\n  }\r\n\r\n  _getHeaderButtons() {\r\n    const buttons = super._getHeaderButtons();\r\n    return buttons;\r\n  }\r\n}\r\n\r\n// Toggle checkbox if input has been detected inside it's form-group\r\nasync function onInputChange(event) {\r\n  if (event.target.parentNode.className === 'tva-config-checkbox') return;\r\n  $(event.target).closest('.form-group').find('.tva-config-checkbox input').prop('checked', true);\r\n}\r\n","import { TVA_CONFIG } from '../settings.js';\r\nimport { TVAOverlay } from '../sprite/TVAOverlay.js';\r\nimport { string2Hex, waitForTokenTexture } from '../utils.js';\r\nimport { getAllEffectMappings, getTokenEffects, getTokenHP } from '../hooks/effectMappingHooks.js';\r\n\r\nexport const FONT_LOADING = {};\r\n\r\nexport async function drawOverlays(token) {\r\n  if (token.tva_drawing_overlays) return;\r\n  token.tva_drawing_overlays = true;\r\n\r\n  const mappings = getAllEffectMappings(token);\r\n  const effects = getTokenEffects(token, true);\r\n  let processedMappings = mappings\r\n    .filter((m) => m.overlay && effects.includes(m.id))\r\n    .sort(\r\n      (m1, m2) =>\r\n        (m1.priority - m1.overlayConfig?.parentID ? 0 : 999) - (m2.priority - m2.overlayConfig?.parentID ? 0 : 999)\r\n    );\r\n\r\n  // See if the whole stack or just top of the stack should be used according to settings\r\n  if (processedMappings.length) {\r\n    processedMappings = TVA_CONFIG.stackStatusConfig\r\n      ? processedMappings\r\n      : [processedMappings[processedMappings.length - 1]];\r\n  }\r\n\r\n  // Process strings as expressions\r\n  const overlays = processedMappings.map((m) => evaluateOverlayExpressions(deepClone(m.overlayConfig), token, m));\r\n\r\n  if (overlays.length) {\r\n    waitForTokenTexture(token, async (token) => {\r\n      if (!token.tvaOverlays) token.tvaOverlays = [];\r\n      // Temporarily mark every overlay for removal.\r\n      // We'll only keep overlays that are still applicable to the token\r\n      _markAllOverlaysForRemoval(token);\r\n\r\n      // To keep track of the overlay order\r\n      let overlaySort = 0;\r\n      let underlaySort = 0;\r\n      for (const ov of overlays) {\r\n        let sprite = _findTVAOverlay(ov.id, token);\r\n        if (sprite) {\r\n          const diff = diffObject(sprite.overlayConfig, ov);\r\n\r\n          // Check if we need to create a new texture or simply refresh the overlay\r\n          if (!isEmpty(diff)) {\r\n            if (ov.img?.includes('*') || (ov.img?.includes('{') && ov.img?.includes('}'))) {\r\n              sprite.refresh(ov);\r\n            } else if (diff.img || diff.text || diff.shapes || diff.repeat) {\r\n              sprite.setTexture(await genTexture(token, ov), { configuration: ov });\r\n            } else if (diff.parentID) {\r\n              sprite.parent?.removeChild(sprite)?.destroy();\r\n              sprite = null;\r\n            } else {\r\n              sprite.refresh(ov);\r\n            }\r\n          } else if (diff.text?.text || diff.shapes) {\r\n            sprite.setTexture(await genTexture(token, ov), { configuration: ov });\r\n          }\r\n\r\n          if ('ui' in diff) {\r\n            sprite.parent.removeChild(sprite);\r\n            const layer = ov.ui ? canvas.tokens : canvas.primary;\r\n            sprite = layer.addChild(sprite);\r\n          }\r\n        }\r\n        if (!sprite) {\r\n          if (ov.parentID) {\r\n            const parent = _findTVAOverlay(ov.parentID, token);\r\n            if (parent && !parent.tvaRemove)\r\n              sprite = parent.addChildAuto(new TVAOverlay(await genTexture(token, ov), token, ov));\r\n          } else {\r\n            const layer = ov.ui ? canvas.tokens : canvas.primary;\r\n            sprite = layer.addChild(new TVAOverlay(await genTexture(token, ov), token, ov));\r\n          }\r\n          if (sprite) token.tvaOverlays.push(sprite);\r\n        }\r\n\r\n        // If the sprite has a parent confirm that the parent has not been removed\r\n        if (sprite?.overlayConfig.parentID) {\r\n          const parent = _findTVAOverlay(sprite.overlayConfig.parentID, token);\r\n          if (!parent || parent.tvaRemove) sprite = null;\r\n        }\r\n\r\n        if (sprite) {\r\n          sprite.tvaRemove = false; // Sprite in use, do not remove\r\n\r\n          // Assign order to the overlay\r\n          if (sprite.overlayConfig.underlay) {\r\n            underlaySort -= 0.01;\r\n            sprite.overlaySort = underlaySort;\r\n          } else {\r\n            overlaySort += 0.01;\r\n            sprite.overlaySort = overlaySort;\r\n          }\r\n        }\r\n      }\r\n\r\n      removeMarkedOverlays(token);\r\n      token.tva_drawing_overlays = false;\r\n    });\r\n  } else {\r\n    _removeAllOverlays(token);\r\n    token.tva_drawing_overlays = false;\r\n  }\r\n}\r\n\r\n// function _getLayer(ov) {\r\n//   const layer = ov.ui ? canvas.tokens : canvas.primary;\r\n//   if (!layer.tvaOverlay) layer.tvaOverlays = layer.addChild(new PIXI.Container());\r\n//   return layer.tvaOverlays;\r\n// }\r\n\r\nexport async function genTexture(token, conf) {\r\n  const img = conf.imgLinked ? token.document.texture.src : conf.img?.trim();\r\n  if (img) {\r\n    return await generateImage(token, conf, img);\r\n  } else if (conf.text?.text != null) {\r\n    return await generateTextTexture(token, conf);\r\n  } else if (conf.shapes?.length) {\r\n    return await generateShapeTexture(token, conf.shapes);\r\n  } else if (conf.html?.template) {\r\n    return { html: true, texture: await loadTexture('modules\\\\token-variants\\\\img\\\\html_bg.webp') };\r\n  } else {\r\n    return {\r\n      texture: await loadTexture('modules/token-variants/img/token-images.svg'),\r\n    };\r\n  }\r\n}\r\n\r\nasync function generateImage(token, conf, img) {\r\n  if (img.includes('*') || (img.includes('{') && img.includes('}'))) {\r\n    const images = await wildcardImageSearch(img);\r\n    if (images.length) {\r\n      if (images.length) {\r\n        img = images[Math.floor(Math.random() * images.length)];\r\n      }\r\n    }\r\n  }\r\n\r\n  let texture = await loadTexture(img, {\r\n    fallback: 'modules/token-variants/img/token-images.svg',\r\n  });\r\n\r\n  // Repeat image if needed\r\n  // Repeating the shape if necessary\r\n  if (conf.repeating && conf.repeat) {\r\n    const repeat = conf.repeat;\r\n    let numRepeats;\r\n    if (repeat.isPercentage) {\r\n      numRepeats = Math.ceil(repeat.value / repeat.maxValue / (repeat.increment / 100));\r\n    } else {\r\n      numRepeats = Math.ceil(repeat.value / repeat.increment);\r\n    }\r\n    let n = 0;\r\n    let rows = 0;\r\n    const maxRows = repeat.maxRows ?? Infinity;\r\n    let xOffset = 0;\r\n    let yOffset = 0;\r\n    const paddingX = repeat.paddingX ?? 0;\r\n    const paddingY = repeat.paddingY ?? 0;\r\n    let container = new PIXI.Container();\r\n    while (numRepeats > 0) {\r\n      let img = new PIXI.Sprite(texture);\r\n      img.x = xOffset;\r\n      img.y = yOffset;\r\n      container.addChild(img);\r\n      xOffset += texture.width + paddingX;\r\n      numRepeats--;\r\n      n++;\r\n      if (numRepeats != 0 && n >= repeat.perRow) {\r\n        rows += 1;\r\n        if (rows >= maxRows) break;\r\n        yOffset += texture.height + paddingY;\r\n        xOffset = 0;\r\n        n = 0;\r\n      }\r\n    }\r\n\r\n    texture = _renderContainer(container, texture.resolution);\r\n  }\r\n\r\n  return { texture };\r\n}\r\n\r\nfunction _renderContainer(container, resolution, { width = null, height = null } = {}) {\r\n  const bounds = container.getLocalBounds();\r\n  const matrix = new PIXI.Matrix();\r\n  matrix.tx = -bounds.x;\r\n  matrix.ty = -bounds.y;\r\n\r\n  const renderTexture = PIXI.RenderTexture.create({\r\n    width: width ?? bounds.width,\r\n    height: height ?? bounds.height,\r\n    resolution: resolution,\r\n  });\r\n\r\n  if (isNewerVersion('11', game.version)) {\r\n    canvas.app.renderer.render(container, renderTexture, true, matrix, false);\r\n  } else {\r\n    canvas.app.renderer.render(container, {\r\n      renderTexture,\r\n      clear: true,\r\n      transform: matrix,\r\n      skipUpdateTransform: false,\r\n    });\r\n  }\r\n  renderTexture.destroyable = true;\r\n  return renderTexture;\r\n}\r\n\r\n// Return width and height of the drawn shape\r\nfunction _drawShape(graphics, shape, xOffset = 0, yOffset = 0) {\r\n  if (shape.type === 'rectangle') {\r\n    graphics.drawRoundedRect(shape.x + xOffset, shape.y + yOffset, shape.width, shape.height, shape.radius);\r\n    return [shape.width, shape.height];\r\n  } else if (shape.type === 'ellipse') {\r\n    graphics.drawEllipse(shape.x + xOffset + shape.width, shape.y + yOffset + shape.height, shape.width, shape.height);\r\n    return [shape.width * 2, shape.height * 2];\r\n  } else if (shape.type === 'polygon') {\r\n    graphics.drawPolygon(\r\n      shape.points.split(',').map((p, i) => Number(p) * shape.scale + (i % 2 === 0 ? shape.x : shape.y))\r\n    );\r\n  } else if (shape.type === 'torus') {\r\n    drawTorus(\r\n      graphics,\r\n      shape.x + xOffset + shape.outerRadius,\r\n      shape.y + yOffset + shape.outerRadius,\r\n      shape.innerRadius,\r\n      shape.outerRadius,\r\n      Math.toRadians(shape.startAngle),\r\n      shape.endAngle >= 360 ? Math.PI * 2 : Math.toRadians(shape.endAngle)\r\n    );\r\n    return [shape.outerRadius * 2, shape.outerRadius * 2];\r\n  }\r\n}\r\n\r\nexport async function generateShapeTexture(token, shapes) {\r\n  let graphics = new PIXI.Graphics();\r\n\r\n  for (const obj of shapes) {\r\n    graphics.beginFill(interpolateColor(obj.fill.color, obj.fill.interpolateColor), obj.fill.alpha);\r\n    graphics.lineStyle(obj.line.width, string2Hex(obj.line.color), obj.line.alpha);\r\n\r\n    const shape = obj.shape;\r\n\r\n    // Repeating the shape if necessary\r\n    if (obj.repeating && obj.repeat) {\r\n      const repeat = obj.repeat;\r\n      let numRepeats;\r\n      if (repeat.isPercentage) {\r\n        numRepeats = Math.ceil(repeat.value / repeat.maxValue / (repeat.increment / 100));\r\n      } else {\r\n        numRepeats = Math.ceil(repeat.value / repeat.increment);\r\n      }\r\n      let n = 0;\r\n      let rows = 0;\r\n      const maxRows = repeat.maxRows ?? Infinity;\r\n      let xOffset = 0;\r\n      let yOffset = 0;\r\n      const paddingX = repeat.paddingX ?? 0;\r\n      const paddingY = repeat.paddingY ?? 0;\r\n      while (numRepeats > 0) {\r\n        const [width, height] = _drawShape(graphics, shape, xOffset, yOffset);\r\n        xOffset += width + paddingX;\r\n        numRepeats--;\r\n        n++;\r\n        if (numRepeats != 0 && n >= repeat.perRow) {\r\n          rows += 1;\r\n          if (rows >= maxRows) break;\r\n          yOffset += height + paddingY;\r\n          xOffset = 0;\r\n          n = 0;\r\n        }\r\n      }\r\n    } else {\r\n      _drawShape(graphics, shape);\r\n    }\r\n  }\r\n\r\n  // Store original graphics dimensions as these may change when children are added\r\n  graphics.shapesWidth = Number(graphics.width);\r\n  graphics.shapesHeight = Number(graphics.height);\r\n\r\n  return { texture: PIXI.Texture.EMPTY, shapes: graphics };\r\n}\r\n\r\nfunction drawTorus(graphics, x, y, innerRadius, outerRadius, startArc = 0, endArc = Math.PI * 2) {\r\n  if (Math.abs(endArc - startArc) >= Math.PI * 2) {\r\n    return graphics.drawCircle(x, y, outerRadius).beginHole().drawCircle(x, y, innerRadius).endHole();\r\n  }\r\n\r\n  graphics.finishPoly();\r\n  graphics.arc(x, y, innerRadius, endArc, startArc, true).arc(x, y, outerRadius, startArc, endArc, false).finishPoly();\r\n}\r\n\r\nexport function interpolateColor(minColor, interpolate, rString = false) {\r\n  if (!interpolate || !interpolate.color2 || !interpolate.prc) return rString ? minColor : string2Hex(minColor);\r\n\r\n  if (!PIXI.Color) return _interpolateV10(minColor, interpolate, rString);\r\n\r\n  const percentage = interpolate.prc;\r\n  minColor = new PIXI.Color(minColor);\r\n  const maxColor = new PIXI.Color(interpolate.color2);\r\n\r\n  let minHsv = rgb2hsv(minColor.red, minColor.green, minColor.blue);\r\n  let maxHsv = rgb2hsv(maxColor.red, maxColor.green, maxColor.blue);\r\n\r\n  let deltaHue = maxHsv[0] - minHsv[0];\r\n  let deltaAngle = deltaHue + (Math.abs(deltaHue) > 180 ? (deltaHue < 0 ? 360 : -360) : 0);\r\n\r\n  let targetHue = minHsv[0] + deltaAngle * percentage;\r\n  let targetSaturation = (1 - percentage) * minHsv[1] + percentage * maxHsv[1];\r\n  let targetValue = (1 - percentage) * minHsv[2] + percentage * maxHsv[2];\r\n\r\n  let result = new PIXI.Color({ h: targetHue, s: targetSaturation * 100, v: targetValue * 100 });\r\n  return rString ? result.toHex() : result.toNumber();\r\n}\r\n\r\nfunction _interpolateV10(minColor, interpolate, rString = false) {\r\n  const percentage = interpolate.prc;\r\n  minColor = PIXI.utils.hex2rgb(string2Hex(minColor));\r\n  const maxColor = PIXI.utils.hex2rgb(string2Hex(interpolate.color2));\r\n\r\n  let minHsv = rgb2hsv(minColor[0], minColor[1], minColor[2]);\r\n  let maxHsv = rgb2hsv(maxColor[0], maxColor[1], maxColor[2]);\r\n\r\n  let deltaHue = maxHsv[0] - minHsv[0];\r\n  let deltaAngle = deltaHue + (Math.abs(deltaHue) > 180 ? (deltaHue < 0 ? 360 : -360) : 0);\r\n\r\n  let targetHue = minHsv[0] + deltaAngle * percentage;\r\n  let targetSaturation = (1 - percentage) * minHsv[1] + percentage * maxHsv[1];\r\n  let targetValue = (1 - percentage) * minHsv[2] + percentage * maxHsv[2];\r\n\r\n  let result = Color.fromHSV([targetHue / 360, targetSaturation, targetValue]);\r\n  return rString ? result.toString() : Number(result);\r\n}\r\n\r\n/**\r\n * Converts a color from RGB to HSV space.\r\n * Source: https://stackoverflow.com/questions/8022885/rgb-to-hsv-color-in-javascript/54070620#54070620\r\n */\r\nfunction rgb2hsv(r, g, b) {\r\n  let v = Math.max(r, g, b),\r\n    c = v - Math.min(r, g, b);\r\n  let h = c && (v == r ? (g - b) / c : v == g ? 2 + (b - r) / c : 4 + (r - g) / c);\r\n  return [60 * (h < 0 ? h + 6 : h), v && c / v, v];\r\n}\r\n\r\nconst CORE_VARIABLES = {\r\n  '@hp': (token) => getTokenHP(token)?.[0],\r\n  '@hpMax': (token) => getTokenHP(token)?.[1],\r\n  '@gridSize': () => canvas.grid?.size,\r\n  '@label': (_, conf) => conf.label,\r\n};\r\n\r\nfunction _evaluateString(str, token, conf) {\r\n  let variables = conf.overlayConfig?.variables;\r\n  const re2 = new RegExp('@\\\\w+', 'gi');\r\n  str = str.replace(re2, function replace(match) {\r\n    let name = match.substr(1, match.length);\r\n    let v = variables?.find((v) => v.name === name);\r\n    if (v) return v.value;\r\n    else if (match in CORE_VARIABLES) return CORE_VARIABLES[match](token, conf);\r\n    return match;\r\n  });\r\n\r\n  const re = new RegExp('{{.*?}}', 'gi');\r\n  str = str\r\n    .replace(re, function replace(match) {\r\n      const property = match.substring(2, match.length - 2);\r\n      if (conf && property === 'effect') {\r\n        return conf.expression;\r\n      }\r\n      if (token && property === 'hp') return getTokenHP(token)?.[0];\r\n      else if (token && property === 'hpMax') return getTokenHP(token)?.[1];\r\n      const val = getProperty(token.document ?? token, property);\r\n      return val === undefined ? match : val;\r\n    })\r\n    .replace('\\\\n', '\\n');\r\n\r\n  return str;\r\n}\r\n\r\nfunction _executeString(evalString, token) {\r\n  try {\r\n    const actor = token.actor; // So that actor is easily accessible within eval() scope\r\n    const result = eval(evalString);\r\n    if (getType(result) === 'Object') evalString;\r\n    return result;\r\n  } catch (e) {}\r\n  return evalString;\r\n}\r\n\r\nexport function evaluateOverlayExpressions(obj, token, conf) {\r\n  for (const [k, v] of Object.entries(obj)) {\r\n    if (\r\n      !['label', 'interactivity', 'variables', 'id', 'parentID', 'limitedUsers', 'filter', 'limitOnProperty'].includes(\r\n        k\r\n      )\r\n    ) {\r\n      obj[k] = _evaluateObjExpressions(v, token, conf);\r\n    }\r\n  }\r\n  return obj;\r\n}\r\n\r\n// Evaluate provided object values substituting in {{path.to.property}} with token properties, and performing eval() on strings\r\nfunction _evaluateObjExpressions(obj, token, conf) {\r\n  const t = getType(obj);\r\n  if (t === 'string') {\r\n    const str = _evaluateString(obj, token, conf);\r\n    return _executeString(str, token);\r\n  } else if (t === 'Array') {\r\n    for (let i = 0; i < obj.length; i++) {\r\n      obj[i] = _evaluateObjExpressions(obj[i], token, conf);\r\n    }\r\n  } else if (t === 'Object') {\r\n    for (const [k, v] of Object.entries(obj)) {\r\n      // Exception for text overlay\r\n      if (k === 'text' && getType(v) === 'string' && v) {\r\n        const evalString = _evaluateString(v, token, conf);\r\n        const result = _executeString(evalString, token);\r\n        if (getType(result) !== 'string') obj[k] = evalString;\r\n        else obj[k] = result;\r\n      } else obj[k] = _evaluateObjExpressions(v, token, conf);\r\n    }\r\n  }\r\n  return obj;\r\n}\r\n\r\nexport async function generateTextTexture(token, conf) {\r\n  await FONT_LOADING.loading;\r\n  let label = conf.text.text;\r\n\r\n  // Repeating the string if necessary\r\n  if (conf.text.repeating && conf.text.repeat) {\r\n    let tmp = '';\r\n    const repeat = conf.text.repeat;\r\n    let numRepeats;\r\n    if (repeat.isPercentage) {\r\n      numRepeats = Math.ceil(repeat.value / repeat.maxValue / (repeat.increment / 100));\r\n    } else {\r\n      numRepeats = Math.ceil(repeat.value / repeat.increment);\r\n    }\r\n    let n = 0;\r\n    let rows = 0;\r\n    let maxRows = repeat.maxRows ?? Infinity;\r\n    while (numRepeats > 0) {\r\n      tmp += label;\r\n      numRepeats--;\r\n      n++;\r\n      if (numRepeats != 0 && n >= repeat.perRow) {\r\n        rows += 1;\r\n        if (rows >= maxRows) break;\r\n        tmp += '\\n';\r\n        n = 0;\r\n      }\r\n    }\r\n    label = tmp;\r\n  }\r\n\r\n  let style = PreciseText.getTextStyle({\r\n    ...conf.text,\r\n    fontFamily: [conf.text.fontFamily, 'fontAwesome'].join(','),\r\n    fill: interpolateColor(conf.text.fill, conf.text.interpolateColor, true),\r\n  });\r\n  const text = new PreciseText(label, style);\r\n  text.updateText(false);\r\n\r\n  const texture = text.texture;\r\n  const height = conf.text.maxHeight ? Math.min(texture.height, conf.text.maxHeight) : null;\r\n  const curve = conf.text.curve;\r\n\r\n  if (!height && !curve?.radius && !curve?.angle) {\r\n    texture.textLabel = label;\r\n    return { texture };\r\n  }\r\n\r\n  const container = new PIXI.Container();\r\n\r\n  if (curve?.radius || curve?.angle) {\r\n    // Curve the text\r\n    const letterSpacing = conf.text.letterSpacing ?? 0;\r\n    const radius = curve.angle ? (texture.width + letterSpacing) / (Math.PI * 2) / (curve.angle / 360) : curve.radius;\r\n    const maxRopePoints = 100;\r\n    const step = Math.PI / maxRopePoints;\r\n\r\n    let ropePoints = maxRopePoints - Math.round((texture.width / (radius * Math.PI)) * maxRopePoints);\r\n    ropePoints /= 2;\r\n\r\n    const points = [];\r\n    for (let i = maxRopePoints - ropePoints; i > ropePoints; i--) {\r\n      const x = radius * Math.cos(step * i);\r\n      const y = radius * Math.sin(step * i);\r\n      points.push(new PIXI.Point(x, curve.invert ? y : -y));\r\n    }\r\n    const rope = new PIXI.SimpleRope(texture, points);\r\n    container.addChild(rope);\r\n  } else {\r\n    container.addChild(new PIXI.Sprite(texture));\r\n  }\r\n\r\n  const renderTexture = _renderContainer(container, 2, { height });\r\n  text.destroy();\r\n\r\n  renderTexture.textLabel = label;\r\n  return { texture: renderTexture };\r\n}\r\n\r\nfunction _markAllOverlaysForRemoval(token) {\r\n  for (const child of token.tvaOverlays) {\r\n    if (child instanceof TVAOverlay) {\r\n      child.tvaRemove = true;\r\n    }\r\n  }\r\n}\r\n\r\nexport function removeMarkedOverlays(token) {\r\n  const sprites = [];\r\n  for (const child of token.tvaOverlays) {\r\n    if (child.tvaRemove) {\r\n      child.parent?.removeChild(child)?.destroy();\r\n    } else {\r\n      sprites.push(child);\r\n    }\r\n  }\r\n  token.tvaOverlays = sprites;\r\n}\r\n\r\nfunction _findTVAOverlay(id, token) {\r\n  for (const child of token.tvaOverlays) {\r\n    if (child.overlayConfig?.id === id) {\r\n      return child;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction _removeAllOverlays(token) {\r\n  if (token.tvaOverlays)\r\n    for (const child of token.tvaOverlays) {\r\n      child.parent?.removeChild(child)?.destroy();\r\n    }\r\n  token.tvaOverlays = null;\r\n}\r\n\r\nexport function broadcastOverlayRedraw(token) {\r\n  // Need to broadcast to other users to re-draw the overlay\r\n  if (token) drawOverlays(token);\r\n  const actorId = token.document?.actorLink ? token.actor?.id : null;\r\n  const message = {\r\n    handlerName: 'drawOverlays',\r\n    args: { tokenId: token.id, actorId },\r\n    type: 'UPDATE',\r\n  };\r\n  game.socket?.emit('module.token-variants', message);\r\n}\r\n","import { FILTERS } from '../../applications/overlayConfig.js';\r\nimport { evaluateComparator, getTokenEffects } from '../hooks/effectMappingHooks.js';\r\nimport { registerOverlayRefreshHook, unregisterOverlayRefreshHooks } from '../hooks/overlayHooks.js';\r\nimport { DEFAULT_OVERLAY_CONFIG } from '../models.js';\r\nimport { interpolateColor, removeMarkedOverlays } from '../token/overlay.js';\r\nimport { executeMacro, toggleCEEffect, toggleTMFXPreset, tv_executeScript } from '../utils.js';\r\nimport { HTMLOverlay } from './HTMLOverlay.js';\r\n\r\nexport class TVAOverlay extends TokenMesh {\r\n  constructor(pTexture, token, config) {\r\n    super(token);\r\n    if (pTexture.shapes) pTexture.shapes = this.addChild(pTexture.shapes);\r\n\r\n    this.pseudoTexture = pTexture;\r\n    this.texture = pTexture.texture;\r\n    //this.setTexture(pTexture, { refresh: false });\r\n\r\n    this.ready = false;\r\n    this.overlaySort = 0;\r\n\r\n    this.overlayConfig = mergeObject(DEFAULT_OVERLAY_CONFIG, config, { inplace: false });\r\n    if (pTexture.html) this.addHTMLOverlay();\r\n\r\n    // linkDimensions has been converted to linkDimensionsX and linkDimensionsY\r\n    // Make sure we're using the latest fields\r\n    // 20/07/2023\r\n    if (!('linkDimensionsX' in this.overlayConfig) && this.overlayConfig.linkDimensions) {\r\n      this.overlayConfig.linkDimensionsX = true;\r\n      this.overlayConfig.linkDimensionsY = true;\r\n    }\r\n\r\n    this._registerHooks(this.overlayConfig);\r\n    this._tvaPlay().then(() => this.refresh());\r\n\r\n    // Workaround needed for v11 visible property\r\n    Object.defineProperty(this, 'visible', {\r\n      get: this._customVisible,\r\n      set: function () {},\r\n      configurable: true,\r\n    });\r\n\r\n    this.eventMode = 'passive';\r\n    this.enableInteractivity(this.overlayConfig);\r\n  }\r\n\r\n  enableInteractivity() {\r\n    if (this.mouseInteractionManager && !this.overlayConfig.interactivity?.length) {\r\n      this.removeAllListeners();\r\n      this.mouseInteractionManager = null;\r\n      this.cursor = null;\r\n      this.eventMode = 'passive';\r\n      return;\r\n    } else if (this.mouseInteractionManager || !this.overlayConfig.interactivity?.length) return;\r\n\r\n    if (!this.overlayConfig.ui) {\r\n      if (canvas.primary.eventMode === 'passive') {\r\n        canvas.primary.eventMode = 'passive';\r\n      }\r\n    }\r\n\r\n    this.eventMode = 'static';\r\n    this.cursor = 'pointer';\r\n    const token = this.object;\r\n    const sprite = this;\r\n\r\n    const runInteraction = function (event, listener) {\r\n      sprite.overlayConfig.interactivity.forEach((i) => {\r\n        if (i.listener === listener) {\r\n          event.preventDefault();\r\n          event.stopPropagation();\r\n          if (i.script) tv_executeScript(i.script, { token });\r\n          if (i.macro) executeMacro(i.macro, token);\r\n          if (i.ceEffect) toggleCEEffect(token, i.ceEffect);\r\n          if (i.tmfxPreset) toggleTMFXPreset(token, i.tmfxPreset);\r\n        }\r\n      });\r\n    };\r\n\r\n    const permissions = {\r\n      hoverIn: () => true,\r\n      hoverOut: () => true,\r\n      clickLeft: () => true,\r\n      clickLeft2: () => true,\r\n      clickRight: () => true,\r\n      clickRight2: () => true,\r\n      dragStart: () => false,\r\n    };\r\n\r\n    const callbacks = {\r\n      hoverIn: (event) => runInteraction(event, 'hoverIn'),\r\n      hoverOut: (event) => runInteraction(event, 'hoverOut'),\r\n      clickLeft: (event) => runInteraction(event, 'clickLeft'),\r\n      clickLeft2: (event) => runInteraction(event, 'clickLeft2'),\r\n      clickRight: (event) => runInteraction(event, 'clickRight'),\r\n      clickRight2: (event) => runInteraction(event, 'clickRight2'),\r\n      dragLeftStart: null,\r\n      dragLeftMove: null,\r\n      dragLeftDrop: null,\r\n      dragLeftCancel: null,\r\n      dragRightStart: null,\r\n      dragRightMove: null,\r\n      dragRightDrop: null,\r\n      dragRightCancel: null,\r\n      longPress: null,\r\n    };\r\n\r\n    const options = { target: null };\r\n\r\n    // Create the interaction manager\r\n    const mgr = new MouseInteractionManager(this, canvas.stage, permissions, callbacks, options);\r\n    this.mouseInteractionManager = mgr.activate();\r\n  }\r\n\r\n  _customVisible() {\r\n    const ov = this.overlayConfig;\r\n    if (!this.ready || !(this.object.visible || ov.alwaysVisible)) return false;\r\n\r\n    if (ov.limitedToOwner && !this.object.owner) return false;\r\n    if (ov.limitedUsers?.length && !ov.limitedUsers.includes(game.user.id)) return false;\r\n\r\n    if (ov.limitOnEffect || ov.limitOnProperty) {\r\n      const speaker = ChatMessage.getSpeaker();\r\n      let token = canvas.ready ? canvas.tokens.get(speaker.token) : null;\r\n      if (!token) return false;\r\n      if (ov.limitOnEffect) {\r\n        if (!getTokenEffects(token).includes(ov.limitOnEffect)) return false;\r\n      }\r\n      if (ov.limitOnProperty) {\r\n        if (!evaluateComparator(token.document, ov.limitOnProperty)) return false;\r\n      }\r\n    }\r\n\r\n    if (ov.limitOnHover || ov.limitOnControl || ov.limitOnHighlight || ov.limitOnHUD) {\r\n      if (ov.limitOnHover && canvas.controls.ruler._state === Ruler.STATES.INACTIVE && this.object.hover) return true;\r\n      if (ov.limitOnControl && this.object.controlled) return true;\r\n      if (ov.limitOnHighlight && (canvas.tokens.highlightObjects ?? canvas.tokens._highlight)) return true;\r\n      if (ov.limitOnHUD && this.object.hasActiveHUD) return true;\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  // Overlays have the same sort order as the parent\r\n  get sort() {\r\n    return this.object.document.sort || 0;\r\n  }\r\n\r\n  get _lastSortedIndex() {\r\n    return (this.object.mesh._lastSortedIndex || 0) + this.overlaySort;\r\n  }\r\n\r\n  get elevation() {\r\n    let elevation = this.object.mesh?.data.elevation;\r\n    if (this.overlayConfig.top) elevation += 9999;\r\n    else if (this.overlayConfig.bottom) elevation -= 9999;\r\n    return elevation;\r\n  }\r\n\r\n  set _lastSortedIndex(val) {}\r\n\r\n  async _tvaPlay() {\r\n    // Ensure playback state for video\r\n    const source = foundry.utils.getProperty(this.texture, 'baseTexture.resource.source');\r\n    if (source && source.tagName === 'VIDEO') {\r\n      // Detach video from others\r\n      const s = source.cloneNode();\r\n\r\n      if (this.overlayConfig.playOnce) {\r\n        s.onended = () => {\r\n          this.alpha = 0;\r\n          this.tvaVideoEnded = true;\r\n        };\r\n      }\r\n\r\n      await new Promise((resolve) => (s.oncanplay = resolve));\r\n      this.texture = PIXI.Texture.from(s, { resourceOptions: { autoPlay: false } });\r\n\r\n      const options = {\r\n        loop: this.overlayConfig.loop && !this.overlayConfig.playOnce,\r\n        volume: 0,\r\n        offset: 0,\r\n        playing: true,\r\n      };\r\n      game.video.play(s, options);\r\n    }\r\n  }\r\n\r\n  addChildAuto(...children) {\r\n    if (this.pseudoTexture?.shapes) {\r\n      return this.pseudoTexture.shapes.addChild(...children);\r\n    } else {\r\n      return this.addChild(...children);\r\n    }\r\n  }\r\n\r\n  setTexture(pTexture, { preview = false, refresh = true, configuration = null } = {}) {\r\n    // Text preview handling\r\n    if (preview) {\r\n      this._swapChildren(pTexture);\r\n      if (this.originalTexture) this._destroyTexture();\r\n      else {\r\n        this.originalTexture = this.pseudoTexture;\r\n        if (this.originalTexture.shapes) this.removeChild(this.originalTexture.shapes);\r\n      }\r\n      this.pseudoTexture = pTexture;\r\n      this.texture = pTexture.texture;\r\n      if (pTexture.shapes) pTexture.shapes = this.addChild(pTexture.shapes);\r\n    } else if (this.originalTexture) {\r\n      this._swapChildren(this.originalTexture);\r\n      this._destroyTexture();\r\n      this.pseudoTexture = this.originalTexture;\r\n      this.texture = this.originalTexture.texture;\r\n      if (this.originalTexture.shapes) this.pseudoTexture.shapes = this.addChild(this.originalTexture.shapes);\r\n      delete this.originalTexture;\r\n    } else {\r\n      this._swapChildren(pTexture);\r\n      this._destroyTexture();\r\n      this.pseudoTexture = pTexture;\r\n      this.texture = pTexture.texture;\r\n      if (pTexture.shapes) this.pseudoTexture.shapes = this.addChild(pTexture.shapes);\r\n    }\r\n\r\n    if (refresh) this.refresh(configuration, { fullRefresh: !preview });\r\n  }\r\n\r\n  refresh(configuration, { preview = false, fullRefresh = true, previewTexture = null } = {}) {\r\n    if (!this.overlayConfig || !this.texture) return;\r\n\r\n    // Text preview handling\r\n    if (previewTexture || this.originalTexture) {\r\n      this.setTexture(previewTexture, { preview: Boolean(previewTexture), refresh: false });\r\n    }\r\n\r\n    // Register/Unregister hooks that should refresh this overlay\r\n    if (configuration) {\r\n      this._registerHooks(configuration);\r\n    }\r\n\r\n    const config = mergeObject(this.overlayConfig, configuration ?? {}, { inplace: !preview });\r\n\r\n    this.enableInteractivity(config);\r\n\r\n    if (fullRefresh) {\r\n      const source = foundry.utils.getProperty(this.texture, 'baseTexture.resource.source');\r\n      if (source && source.tagName === 'VIDEO') {\r\n        if (!source.loop && config.loop) {\r\n          game.video.play(source);\r\n        } else if (source.loop && !config.loop) {\r\n          game.video.stop(source);\r\n        }\r\n        source.loop = config.loop;\r\n      }\r\n    }\r\n\r\n    const shapes = this.pseudoTexture.shapes;\r\n\r\n    // Scale the image using the same logic as the token\r\n    const dimensions = shapes ?? this.texture;\r\n    if (config.linkScale && !config.parentID) {\r\n      const scale = this.scale;\r\n      const aspect = dimensions.width / dimensions.height;\r\n      if (aspect >= 1) {\r\n        scale.x = (this.object.w * this.object.document.texture.scaleX) / dimensions.width;\r\n        scale.y = Number(scale.x);\r\n      } else {\r\n        scale.y = (this.object.h * this.object.document.texture.scaleY) / dimensions.height;\r\n        scale.x = Number(scale.y);\r\n      }\r\n    } else if (config.linkStageScale) {\r\n      this.scale.x = 1 / canvas.stage.scale.x;\r\n      this.scale.y = 1 / canvas.stage.scale.y;\r\n    } else if (config.linkDimensionsX || config.linkDimensionsY) {\r\n      if (config.linkDimensionsX) {\r\n        this.scale.x = this.object.document.width;\r\n      }\r\n      if (config.linkDimensionsY) {\r\n        this.scale.y = this.object.document.height;\r\n      }\r\n    } else {\r\n      this.scale.x = config.width ? config.width / dimensions.width : 1;\r\n      this.scale.y = config.height ? config.height / dimensions.height : 1;\r\n    }\r\n\r\n    // Adjust scale according to config\r\n    this.scale.x = this.scale.x * config.scaleX;\r\n    this.scale.y = this.scale.y * config.scaleY;\r\n\r\n    // Check if mirroring should be inherited from the token and if so apply it\r\n    if (config.linkMirror && !config.parentID) {\r\n      this.scale.x = Math.abs(this.scale.x) * (this.object.document.texture.scaleX < 0 ? -1 : 1);\r\n      this.scale.y = Math.abs(this.scale.y) * (this.object.document.texture.scaleY < 0 ? -1 : 1);\r\n    }\r\n\r\n    if (this.anchor) {\r\n      if (!config.anchor) this.anchor.set(0.5, 0.5);\r\n      else this.anchor.set(config.anchor.x, config.anchor.y);\r\n    }\r\n\r\n    let xOff = 0;\r\n    let yOff = 0;\r\n    if (shapes) {\r\n      shapes.position.x = -this.anchor.x * shapes.width;\r\n      shapes.position.y = -this.anchor.y * shapes.height;\r\n      if (config.animation.relative) {\r\n        this.pivot.set(0, 0);\r\n        shapes.pivot.set((0.5 - this.anchor.x) * shapes.width, (0.5 - this.anchor.y) * shapes.height);\r\n        xOff = shapes.pivot.x * this.scale.x;\r\n        yOff = shapes.pivot.y * this.scale.y;\r\n      }\r\n    } else if (config.animation.relative) {\r\n      xOff = (0.5 - this.anchor.x) * this.width;\r\n      yOff = (0.5 - this.anchor.y) * this.height;\r\n      this.pivot.set((0.5 - this.anchor.x) * this.texture.width, (0.5 - this.anchor.y) * this.texture.height);\r\n    }\r\n\r\n    // Position\r\n    const pOffsetX = config.pOffsetX || 0;\r\n    const pOffsetY = config.pOffsetY || 0;\r\n    if (config.parentID) {\r\n      const anchor = this.parent.anchor ?? { x: 0, y: 0 };\r\n      const pWidth = (this.parent.shapesWidth ?? this.parent.width) / this.parent.scale.x;\r\n      const pHeight = (this.parent.shapesHeight ?? this.parent.height) / this.parent.scale.y;\r\n      this.position.set(\r\n        pOffsetX + -config.offsetX * pWidth - anchor.x * pWidth + pWidth / 2,\r\n        pOffsetY + -config.offsetY * pHeight - anchor.y * pHeight + pHeight / 2\r\n      );\r\n    } else {\r\n      if (config.animation.relative) {\r\n        this.position.set(\r\n          this.object.document.x + this.object.w / 2 + pOffsetX + -config.offsetX * this.object.w + xOff,\r\n          this.object.document.y + this.object.h / 2 + pOffsetY + -config.offsetY * this.object.h + yOff\r\n        );\r\n      } else {\r\n        this.position.set(this.object.document.x + this.object.w / 2, this.object.document.y + this.object.h / 2);\r\n        this.pivot.set(\r\n          -pOffsetX / this.scale.x + (config.offsetX * this.object.w) / this.scale.x,\r\n          -pOffsetY / this.scale.y + (config.offsetY * this.object.h) / this.scale.y\r\n        );\r\n      }\r\n    }\r\n\r\n    // Set alpha but only if playOnce is disabled and the video hasn't\r\n    // finished playing yet. Otherwise we want to keep alpha as 0 to keep the video hidden\r\n    if (!this.tvaVideoEnded) {\r\n      this.alpha = config.linkOpacity ? this.object.document.alpha : config.alpha;\r\n    }\r\n\r\n    // Angle in degrees\r\n    if (fullRefresh) {\r\n      if (config.linkRotation) this.angle = this.object.document.rotation + config.angle;\r\n      else this.angle = config.angle;\r\n    } else if (!config.animation.rotate) {\r\n      if (config.linkRotation) this.angle = this.object.document.rotation + config.angle;\r\n    }\r\n\r\n    // Apply color tinting\r\n    const tint = config.inheritTint\r\n      ? this.object.document.texture.tint\r\n      : interpolateColor(config.tint, config.interpolateColor, true);\r\n    this.tint = tint ? Color.from(tint) : 0xffffff;\r\n    if (shapes) {\r\n      shapes.tint = this.tint;\r\n      shapes.alpha = this.alpha;\r\n    }\r\n\r\n    if (fullRefresh) {\r\n      if (config.animation.rotate) {\r\n        this.animate(config);\r\n      } else {\r\n        this.stopAnimation();\r\n      }\r\n    }\r\n\r\n    // Apply filters\r\n    if (fullRefresh) this._applyFilters(config);\r\n    //if (fullRefresh) this.filters = this._getFilters(config);\r\n\r\n    if (preview && this.children) {\r\n      this.children.forEach((ch) => {\r\n        if (ch instanceof TVAOverlay) ch.refresh(null, { preview: true });\r\n      });\r\n    }\r\n\r\n    if (this.htmlOverlay) {\r\n      // this.htmlOverlay.setPosition({\r\n      //   left: this.x + shapes.x,\r\n      //   top: this.y + shapes.y,\r\n      //   width: dimensions.width * this.scale.x,\r\n      //   height: dimensions.height * this.scale.y,\r\n      //   angle: this.angle,\r\n      // });\r\n\r\n      this.htmlOverlay.setPosition({\r\n        left: this.x - this.pivot.x * this.scale.x - this.width * this.anchor.x,\r\n        top: this.y - this.pivot.y * this.scale.y - this.height * this.anchor.y,\r\n        width: this.width,\r\n        height: this.height,\r\n        angle: this.angle,\r\n      });\r\n\r\n      // this.htmlOverlay.setPosition({\r\n      //   left: this.x - shapes.pivot.x - dimensions.width / 2,\r\n      //   top: this.y - shapes.pivot.y - dimensions.height / 2,\r\n      //   width: dimensions.width,\r\n      //   height: dimensions.height,\r\n      //   angle: this.angle,\r\n      // });\r\n    }\r\n\r\n    this.ready = true;\r\n  }\r\n\r\n  _activateTicker() {\r\n    this._deactivateTicker();\r\n    canvas.app.ticker.add(this.updatePosition, this, PIXI.UPDATE_PRIORITY.HIGH);\r\n  }\r\n\r\n  _deactivateTicker() {\r\n    canvas.app.ticker.remove(this.updatePosition, this);\r\n  }\r\n\r\n  updatePosition() {\r\n    let coord = canvas.canvasCoordinatesFromClient({\r\n      x: window.innerWidth / 2 + this.overlayConfig.offsetX * window.innerWidth,\r\n      y: window.innerHeight / 2 + this.overlayConfig.offsetY * window.innerHeight,\r\n    });\r\n    this.position.set(coord.x, coord.y);\r\n  }\r\n\r\n  async _applyFilters(config) {\r\n    const filterName = config.filter;\r\n    const FilterClass = PIXI.filters[filterName];\r\n    const options = mergeObject(FILTERS[filterName]?.defaultValues || {}, config.filterOptions);\r\n    let filter;\r\n    if (FilterClass) {\r\n      if (FILTERS[filterName]?.argType === 'args') {\r\n        let args = [];\r\n        const controls = FILTERS[filterName]?.controls;\r\n        if (controls) {\r\n          controls.forEach((c) => args.push(options[c.name]));\r\n        }\r\n        filter = new FilterClass(...args);\r\n      } else if (FILTERS[filterName]?.argType === 'options') {\r\n        filter = new FilterClass(options);\r\n      } else {\r\n        filter = new FilterClass();\r\n      }\r\n    } else if (filterName === 'OutlineOverlayFilter') {\r\n      filter = OutlineFilter.create(options);\r\n      filter.thickness = options.trueThickness ?? 1;\r\n      filter.animate = options.animate ?? false;\r\n    } else if (filterName === 'Token Magic FX') {\r\n      this.applyTVAFilters(await constructTMFXFilters(options.params || [], this));\r\n      return;\r\n    }\r\n\r\n    if (filter) {\r\n      this.applyTVAFilters([filter]);\r\n      this.filters = [filter];\r\n    } else {\r\n      this.removeTVAFilters();\r\n    }\r\n\r\n    if (this.overlayConfig.ui && this.overlayConfig.bottom) this.applyReverseMask();\r\n    else this.removeReverseMask();\r\n  }\r\n\r\n  applyReverseMask() {\r\n    if (!this.filters?.find((f) => f.tvaReverse)) {\r\n      const filters = this.filters || [];\r\n      const reverseMask = ReverseMaskFilter.create({\r\n        uMaskSampler: canvas.primary.tokensRenderTexture,\r\n        channel: 'a',\r\n      });\r\n      reverseMask.tvaReverse = true;\r\n      filters.push(reverseMask);\r\n      this.filters = filters;\r\n    }\r\n    if (!this.filters) filters = [];\r\n  }\r\n\r\n  removeReverseMask() {\r\n    if (this.filters?.length) {\r\n      this.filters = this.filters.filter((f) => !f.tvaReverse);\r\n    }\r\n  }\r\n\r\n  applyTVAFilters(filters) {\r\n    if (filters?.length) {\r\n      this.removeTVAFilters();\r\n      this.filters = (this.filters || []).concat(filters);\r\n    }\r\n  }\r\n\r\n  removeTVAFilters() {\r\n    if (this.filters) this.filters = this.filters.filter((f) => !f.tvaFilter);\r\n  }\r\n\r\n  async stopAnimation() {\r\n    if (this.animationName) {\r\n      CanvasAnimation.terminateAnimation(this.animationName);\r\n    }\r\n  }\r\n\r\n  async animate(config) {\r\n    if (!this.animationName) this.animationName = this.object.sourceId + '.' + randomID(5);\r\n\r\n    let newAngle = this.angle + (config.animation.clockwise ? 360 : -360);\r\n    const rotate = [{ parent: this, attribute: 'angle', to: newAngle }];\r\n\r\n    const completed = await CanvasAnimation.animate(rotate, {\r\n      duration: config.animation.duration,\r\n      name: this.animationName,\r\n    });\r\n    if (completed) {\r\n      this.animate(config);\r\n    }\r\n  }\r\n\r\n  _registerHooks(configuration) {\r\n    if (configuration.linkStageScale) registerOverlayRefreshHook(this, 'canvasPan');\r\n    else unregisterOverlayRefreshHooks(this, 'canvasPan');\r\n  }\r\n\r\n  _swapChildren(to) {\r\n    const from = this.pseudoTexture;\r\n    if (from.shapes) {\r\n      this.removeChild(this.pseudoTexture.shapes);\r\n      const children = from.shapes.removeChildren();\r\n      if (to?.shapes) children.forEach((c) => to.shapes.addChild(c)?.refresh());\r\n      else children.forEach((c) => this.addChild(c)?.refresh());\r\n    } else if (to?.shapes) {\r\n      const children = this.removeChildren();\r\n      children.forEach((c) => to.shapes.addChild(c)?.refresh());\r\n    }\r\n  }\r\n\r\n  _destroyTexture() {\r\n    if (this.texture.textLabel || this.texture.destroyable) {\r\n      this.texture.destroy(true);\r\n    }\r\n    if (this.pseudoTexture?.shapes) {\r\n      this.removeChild(this.pseudoTexture.shapes);\r\n      this.pseudoTexture.shapes.destroy();\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    this.stopAnimation();\r\n    unregisterOverlayRefreshHooks(this);\r\n\r\n    if (this.children) {\r\n      for (const ch of this.children) {\r\n        if (ch instanceof TVAOverlay) ch.tvaRemove = true;\r\n      }\r\n      removeMarkedOverlays(this.object);\r\n      if (this.pseudoTexture.shapes) {\r\n        this.pseudoTexture.shapes.children.forEach((c) => c.destroy());\r\n        this.removeChild(this.pseudoTexture.shapes)?.destroy();\r\n        //  this.pseudoTexture.shapes.destroy();\r\n      }\r\n    }\r\n\r\n    if (this.texture.textLabel || this.texture.destroyable) {\r\n      return super.destroy(true);\r\n    } else if (this.texture?.baseTexture.resource?.source?.tagName === 'VIDEO') {\r\n      this.texture.baseTexture.destroy();\r\n    }\r\n\r\n    if (this.htmlOverlay) this.htmlOverlay.remove();\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  // Foundry BUG Fix\r\n  calculateTrimmedVertices() {\r\n    return PIXI.Sprite.prototype.calculateTrimmedVertices.call(this);\r\n  }\r\n\r\n  addHTMLOverlay() {\r\n    this.htmlOverlay = new HTMLOverlay(this.overlayConfig, this.object);\r\n  }\r\n}\r\n\r\nasync function constructTMFXFilters(paramsArray, sprite) {\r\n  if (typeof TokenMagic === 'undefined') return [];\r\n\r\n  try {\r\n    paramsArray = eval(paramsArray);\r\n  } catch (e) {\r\n    return [];\r\n  }\r\n\r\n  if (!Array.isArray(paramsArray)) {\r\n    paramsArray = TokenMagic.getPreset(paramsArray);\r\n  }\r\n  if (!(paramsArray instanceof Array && paramsArray.length > 0)) return [];\r\n\r\n  let filters = [];\r\n  for (const params of paramsArray) {\r\n    if (!params.hasOwnProperty('filterType') || !TMFXFilterTypes.hasOwnProperty(params.filterType)) {\r\n      // one invalid ? all rejected.\r\n      return [];\r\n    }\r\n\r\n    if (!params.hasOwnProperty('rank')) {\r\n      params.rank = 5000;\r\n    }\r\n\r\n    if (!params.hasOwnProperty('filterId') || params.filterId == null) {\r\n      params.filterId = randomID();\r\n    }\r\n\r\n    if (!params.hasOwnProperty('enabled') || !(typeof params.enabled === 'boolean')) {\r\n      params.enabled = true;\r\n    }\r\n\r\n    params.filterInternalId = randomID();\r\n\r\n    const gms = game.users.filter((user) => user.isGM);\r\n    params.filterOwner = gms.length ? gms[0].id : game.data.userId;\r\n    // params.placeableType = placeable._TMFXgetPlaceableType();\r\n    params.updateId = randomID();\r\n\r\n    const filterClass = await getTMFXFilter(params.filterType);\r\n    if (filterClass) {\r\n      filterClass.prototype.assignPlaceable = function () {\r\n        this.targetPlaceable = sprite.object;\r\n        this.placeableImg = sprite;\r\n      };\r\n\r\n      filterClass.prototype._TMFXsetAnimeFlag = async function () {};\r\n\r\n      const filter = new filterClass(params);\r\n      if (filter) {\r\n        // Patch fixes\r\n        filter.placeableImg = sprite;\r\n        filter.targetPlaceable = sprite.object;\r\n        // end of fixes\r\n        filter.tvaFilter = true;\r\n        filters.unshift(filter);\r\n      }\r\n    }\r\n  }\r\n  return filters;\r\n}\r\n\r\nasync function getTMFXFilter(id) {\r\n  if (id in TMFXFilterTypes) {\r\n    if (id in LOADED_TMFXFilters) return LOADED_TMFXFilters[id];\r\n    else {\r\n      try {\r\n        const className = TMFXFilterTypes[id];\r\n        let fxModule = await import(`../../../tokenmagic/fx/filters/${className}.js`);\r\n        if (fxModule && fxModule[className]) {\r\n          LOADED_TMFXFilters[id] = fxModule[className];\r\n          return fxModule[className];\r\n        }\r\n      } catch (e) {}\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nconst LOADED_TMFXFilters = {};\r\n\r\nconst TMFXFilterTypes = {\r\n  adjustment: 'FilterAdjustment',\r\n  distortion: 'FilterDistortion',\r\n  oldfilm: 'FilterOldFilm',\r\n  glow: 'FilterGlow',\r\n  outline: 'FilterOutline',\r\n  bevel: 'FilterBevel',\r\n  xbloom: 'FilterXBloom',\r\n  shadow: 'FilterDropShadow',\r\n  twist: 'FilterTwist',\r\n  zoomblur: 'FilterZoomBlur',\r\n  blur: 'FilterBlur',\r\n  bulgepinch: 'FilterBulgePinch',\r\n  zapshadow: 'FilterRemoveShadow',\r\n  ray: 'FilterRays',\r\n  fog: 'FilterFog',\r\n  xfog: 'FilterXFog',\r\n  electric: 'FilterElectric',\r\n  wave: 'FilterWaves',\r\n  shockwave: 'FilterShockwave',\r\n  fire: 'FilterFire',\r\n  fumes: 'FilterFumes',\r\n  smoke: 'FilterSmoke',\r\n  flood: 'FilterFlood',\r\n  images: 'FilterMirrorImages',\r\n  field: 'FilterForceField',\r\n  xray: 'FilterXRays',\r\n  liquid: 'FilterLiquid',\r\n  xglow: 'FilterGleamingGlow',\r\n  pixel: 'FilterPixelate',\r\n  web: 'FilterSpiderWeb',\r\n  ripples: 'FilterSolarRipples',\r\n  globes: 'FilterGlobes',\r\n  transform: 'FilterTransform',\r\n  splash: 'FilterSplash',\r\n  polymorph: 'FilterPolymorph',\r\n  xfire: 'FilterXFire',\r\n  sprite: 'FilterSprite',\r\n  replaceColor: 'FilterReplaceColor',\r\n  ddTint: 'FilterDDTint',\r\n};\r\n\r\nclass OutlineFilter extends OutlineOverlayFilter {\r\n  /** @inheritdoc */\r\n  static createFragmentShader() {\r\n    return `\r\n    varying vec2 vTextureCoord;\r\n    varying vec2 vFilterCoord;\r\n    uniform sampler2D uSampler;\r\n    \r\n    uniform vec2 thickness;\r\n    uniform vec4 outlineColor;\r\n    uniform vec4 filterClamp;\r\n    uniform float alphaThreshold;\r\n    uniform float time;\r\n    uniform bool knockout;\r\n    uniform bool wave;\r\n    \r\n    ${this.CONSTANTS}\r\n    ${this.WAVE()}\r\n    \r\n    void main(void) {\r\n        float dist = distance(vFilterCoord, vec2(0.5)) * 2.0;\r\n        vec4 ownColor = texture2D(uSampler, vTextureCoord);\r\n        vec4 wColor = wave ? outlineColor * \r\n                             wcos(0.0, 1.0, dist * 75.0, \r\n                                  -time * 0.01 + 3.0 * dot(vec4(1.0), ownColor)) \r\n                             * 0.33 * (1.0 - dist) : vec4(0.0);\r\n        float texAlpha = smoothstep(alphaThreshold, 1.0, ownColor.a);\r\n        vec4 curColor;\r\n        float maxAlpha = 0.;\r\n        vec2 displaced;\r\n        for ( float angle = 0.0; angle <= TWOPI; angle += ${this.#quality.toFixed(7)} ) {\r\n            displaced.x = vTextureCoord.x + thickness.x * cos(angle);\r\n            displaced.y = vTextureCoord.y + thickness.y * sin(angle);\r\n            curColor = texture2D(uSampler, clamp(displaced, filterClamp.xy, filterClamp.zw));\r\n            curColor.a = clamp((curColor.a - 0.6) * 2.5, 0.0, 1.0);\r\n            maxAlpha = max(maxAlpha, curColor.a);\r\n        }\r\n        float resultAlpha = max(maxAlpha, texAlpha);\r\n        vec3 result = (ownColor.rgb + outlineColor.rgb * (1.0 - texAlpha)) * resultAlpha;\r\n        gl_FragColor = vec4((ownColor.rgb + outlineColor.rgb * (1. - ownColor.a)) * resultAlpha, resultAlpha);\r\n    }\r\n    `;\r\n  }\r\n\r\n  static get #quality() {\r\n    switch (canvas.performance.mode) {\r\n      case CONST.CANVAS_PERFORMANCE_MODES.LOW:\r\n        return (Math.PI * 2) / 10;\r\n      case CONST.CANVAS_PERFORMANCE_MODES.MED:\r\n        return (Math.PI * 2) / 20;\r\n      default:\r\n        return (Math.PI * 2) / 30;\r\n    }\r\n  }\r\n}\r\n","import { FEATURE_CONTROL } from '../settings.js';\r\nimport { HTMLOverlay } from '../sprite/HTMLOverlay.js';\r\nimport { TVAOverlay } from '../sprite/TVAOverlay.js';\r\nimport { drawOverlays } from '../token/overlay.js';\r\nimport { registerHook, unregisterHook } from './hooks.js';\r\n\r\nconst feature_id = 'Overlays';\r\n\r\nexport function registerOverlayHooks() {\r\n  if (!FEATURE_CONTROL[feature_id]) {\r\n    [\r\n      'refreshToken',\r\n      'destroyToken',\r\n      'updateActor',\r\n      'renderCombatTracker',\r\n      'updateToken',\r\n      'createToken',\r\n      'renderHeadsUpDisplay',\r\n    ].forEach((id) => unregisterHook(feature_id, id));\r\n    return;\r\n  }\r\n\r\n  registerHook(feature_id, 'createToken', async function (token) {\r\n    if (token.object) drawOverlays(token.object);\r\n  });\r\n\r\n  registerHook(feature_id, 'updateToken', async function (token) {\r\n    if (token.object) drawOverlays(token.object);\r\n  });\r\n\r\n  registerHook(feature_id, 'refreshToken', (token) => {\r\n    if (token.tvaOverlays)\r\n      for (const child of token.tvaOverlays) {\r\n        if (child instanceof TVAOverlay) {\r\n          child.refresh(null, { preview: false, fullRefresh: false });\r\n        }\r\n      }\r\n  });\r\n\r\n  registerHook(feature_id, 'destroyToken', (token) => {\r\n    if (token.tvaOverlays)\r\n      for (const child of token.tvaOverlays) {\r\n        child.parent?.removeChild(child)?.destroy();\r\n      }\r\n  });\r\n\r\n  registerHook(feature_id, 'updateActor', async function (actor) {\r\n    if (actor.getActiveTokens)\r\n      actor.getActiveTokens(true).forEach((token) => {\r\n        drawOverlays(token);\r\n      });\r\n  });\r\n\r\n  registerHook(feature_id, 'renderCombatTracker', function () {\r\n    for (const tkn of canvas.tokens.placeables) {\r\n      drawOverlays(tkn);\r\n    }\r\n  });\r\n\r\n  registerHook(feature_id, 'renderHeadsUpDisplay', () => {\r\n    HTMLOverlay.hudRendered();\r\n  });\r\n}\r\n\r\nconst REFRESH_HOOKS = {};\r\n\r\nexport function registerOverlayRefreshHook(tvaOverlay, hookName) {\r\n  if (!(hookName in REFRESH_HOOKS)) {\r\n    registerHook('TVAOverlayRefresh', hookName, () => {\r\n      REFRESH_HOOKS[hookName]?.forEach((s) => s.refresh());\r\n    });\r\n    REFRESH_HOOKS[hookName] = [tvaOverlay];\r\n  } else if (!REFRESH_HOOKS[hookName].find((s) => s == tvaOverlay)) {\r\n    REFRESH_HOOKS[hookName].push(tvaOverlay);\r\n  }\r\n}\r\n\r\nexport function unregisterOverlayRefreshHooks(tvaOverlay, hookName = null) {\r\n  const unregister = function (hook) {\r\n    if (REFRESH_HOOKS[hook]) {\r\n      let index = REFRESH_HOOKS[hook].findIndex((s) => s == tvaOverlay);\r\n      if (index > -1) {\r\n        REFRESH_HOOKS[hook].splice(index, 1);\r\n        if (!REFRESH_HOOKS[hook].length) {\r\n          unregisterHook('TVAOverlayRefresh', hook);\r\n          delete REFRESH_HOOKS[hook];\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  if (hookName) unregister(hookName);\r\n  else {\r\n    Object.keys(REFRESH_HOOKS).forEach((k) => unregister(k));\r\n  }\r\n}\r\n","export class HTMLOverlay {\r\n  static container = null;\r\n  static renderQueue = [];\r\n  static hudReady = false;\r\n\r\n  static hudRendered() {\r\n    HTMLOverlay.hudReady = true;\r\n    HTMLOverlay.renderQueue.forEach((ov) => ov._render());\r\n    HTMLOverlay.renderQueue = [];\r\n  }\r\n\r\n  constructor(overlayConfig, token) {\r\n    this.overlayConfig = overlayConfig;\r\n    this.token = token;\r\n\r\n    if (HTMLOverlay.hudReady) this._render();\r\n    else HTMLOverlay.renderQueue.push(this);\r\n  }\r\n\r\n  _render() {\r\n    if (!HTMLOverlay.container) {\r\n      HTMLOverlay.container = $('<div id=\"tva-html-overlays\"></div>');\r\n      $('#hud').append(HTMLOverlay.container);\r\n    }\r\n    this.element = $(renderTemplate(this.overlayConfig, this.getData()));\r\n    HTMLOverlay.container.append(this.element);\r\n    this.setPosition();\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n\r\n  getData(options = {}) {\r\n    const data = this.token.document.toObject();\r\n    return foundry.utils.mergeObject(data, {\r\n      isGM: game.user.isGM,\r\n    });\r\n  }\r\n\r\n  setPosition({ left, top, width, height, scale, angle, origin } = {}) {\r\n    if (!HTMLOverlay.hudReady) return;\r\n    const ratio = canvas.dimensions.size / 100;\r\n    const position = {\r\n      width: width || this.token.document.width * 100,\r\n      height: height || this.token.document.height * 100,\r\n      left: left ?? this.token.document.x,\r\n      top: top ?? this.token.document.y,\r\n    };\r\n    if (ratio !== 1) position.transform = `scale(${ratio})`;\r\n    this.element.css(position);\r\n    if (angle != null) {\r\n      this.element.css({ transform: 'rotate(' + angle + 'deg)' });\r\n    }\r\n    if (origin != null) {\r\n      this.element.css({ 'transform-origin': origin.x + 'px ' + origin.y + 'px' });\r\n    }\r\n  }\r\n\r\n  /** @override */\r\n  activateListeners(html) {}\r\n}\r\n\r\nconst _templateCache = {};\r\n\r\nfunction constructTemplate(ovConfig) {\r\n  if (!_templateCache.hasOwnProperty(ovConfig.id)) {\r\n    const compiled = Handlebars.compile(\r\n      '<form class=\"tva-html-overlay\"><section class=\"window-content\">' + ovConfig.html.template + '</section></form>'\r\n    );\r\n    Handlebars.registerPartial(ovConfig.id, compiled);\r\n    _templateCache[ovConfig.id] = compiled;\r\n  }\r\n  return _templateCache[ovConfig.id];\r\n}\r\n\r\nfunction renderTemplate(ovConfig, data) {\r\n  const template = constructTemplate(ovConfig);\r\n  return template(data || {}, {\r\n    allowProtoMethodsByDefault: true,\r\n    allowProtoPropertiesByDefault: true,\r\n  });\r\n}\r\n","import { registerEffectIconHooks } from './effectIconHooks.js';\r\nimport { registerArtSelectButtonHooks } from './artSelectButtonHooks.js';\r\nimport { registerOverlayHooks } from './overlayHooks.js';\r\nimport { registerEffectMappingHooks } from './effectMappingHooks.js';\r\nimport { registerHUDHooks } from './hudHooks.js';\r\nimport { registerUserMappingHooks } from './userMappingHooks.js';\r\nimport { registerWildcardHooks } from './wildcardHooks.js';\r\nimport { registerPopRandomizeHooks } from './popUpRandomizeHooks.js';\r\nimport { TVA_CONFIG } from '../settings.js';\r\n\r\nexport const REGISTERED_HOOKS = {};\r\n\r\nexport function registerHook(feature_id, name, fn, { once = false } = {}) {\r\n  if (!(feature_id in REGISTERED_HOOKS)) REGISTERED_HOOKS[feature_id] = {};\r\n  if (name in REGISTERED_HOOKS[feature_id]) return;\r\n  if (TVA_CONFIG.debug) console.info(`TVA | Registering Hook`, { feature_id, name, fn, once });\r\n  const num = Hooks.on(name, fn, { once });\r\n  REGISTERED_HOOKS[feature_id][name] = num;\r\n}\r\n\r\nexport function unregisterHook(feature_id, name) {\r\n  if (feature_id in REGISTERED_HOOKS && name in REGISTERED_HOOKS[feature_id]) {\r\n    if (TVA_CONFIG.debug)\r\n      console.info(`TVA | Un-Registering Hook`, {\r\n        feature_id,\r\n        name,\r\n        id: REGISTERED_HOOKS[feature_id][name],\r\n      });\r\n    Hooks.off(name, REGISTERED_HOOKS[feature_id][name]);\r\n    delete REGISTERED_HOOKS[feature_id][name];\r\n  }\r\n}\r\n\r\nexport function registerAllHooks() {\r\n  // Hide effect icons\r\n  registerEffectIconHooks();\r\n  // Display overlays\r\n  registerOverlayHooks();\r\n  // Insert Art Select buttons and contextmenu listeners\r\n  registerArtSelectButtonHooks();\r\n  // Effect Mapping related listening for state changes and applying configurations\r\n  registerEffectMappingHooks();\r\n  // Display HUD buttons for Tokens and Tiles\r\n  registerHUDHooks();\r\n  // Default Wildcard image controls\r\n  registerWildcardHooks();\r\n  // User to Image mappings for Tile and Tokens\r\n  registerUserMappingHooks();\r\n  // Handle pop-ups and randomization on token/actor create\r\n  registerPopRandomizeHooks();\r\n}\r\n","import { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\r\nimport { registerHook, unregisterHook } from './hooks.js';\r\n\r\nconst feature_id = 'EffectIcons';\r\n\r\nexport function registerEffectIconHooks() {\r\n  // OnHover settings specific hooks\r\n  if (FEATURE_CONTROL[feature_id] && TVA_CONFIG.displayEffectIconsOnHover) {\r\n    registerHook(feature_id, 'hoverToken', (token, hoverIn) => {\r\n      if (token.effects) {\r\n        token.effects.visible = hoverIn;\r\n      }\r\n    });\r\n  } else {\r\n    unregisterHook(feature_id, 'hoverToken');\r\n  }\r\n\r\n  if (FEATURE_CONTROL[feature_id] && TVA_CONFIG.displayEffectIconsOnHover) {\r\n    registerHook(feature_id, 'highlightObjects', (active) => {\r\n      if (canvas.tokens.active) {\r\n        for (const tkn of canvas.tokens.placeables) {\r\n          if (tkn.effects) {\r\n            tkn.effects.visible = active || tkn.hover;\r\n          }\r\n        }\r\n      }\r\n    });\r\n  } else {\r\n    unregisterHook(feature_id, 'highlightObjects');\r\n  }\r\n}\r\n","import { insertArtSelectButton } from '../../applications/artSelect.js';\r\nimport { showArtSelect } from '../../token-variants.mjs';\r\nimport { TVA_CONFIG } from '../settings.js';\r\nimport { SEARCH_TYPE, updateActorImage } from '../utils.js';\r\nimport { registerHook, unregisterHook } from './hooks.js';\r\n\r\nconst feature_id = 'ArtSelect';\r\n\r\nexport function registerArtSelectButtonHooks() {\r\n  // Insert right-click listeners to open up ArtSelect forms from various contexts\r\n  if (TVA_CONFIG.permissions.portrait_right_click[game.user.role]) {\r\n    registerHook(feature_id, 'renderActorSheet', _modActorSheet);\r\n    registerHook(feature_id, 'renderItemSheet', _modItemSheet);\r\n    registerHook(feature_id, 'renderItemActionSheet', _modItemSheet);\r\n    registerHook(feature_id, 'renderJournalSheet', _modJournalSheet);\r\n    registerHook(feature_id, 'renderRollTableConfig', _modRollTableSheet);\r\n  } else {\r\n    [\r\n      'renderActorSheet',\r\n      'renderItemSheet',\r\n      'renderItemActionSheet',\r\n      'renderJournalSheet',\r\n      'renderRollTableConfig',\r\n    ].forEach((name) => unregisterHook(feature_id, name));\r\n  }\r\n\r\n  // Insert buttons\r\n  if (TVA_CONFIG.permissions.image_path_button[game.user.role]) {\r\n    registerHook(feature_id, 'renderTileConfig', _modTileConfig);\r\n    registerHook(feature_id, 'renderMeasuredTemplateConfig', _modTemplateConfig);\r\n    registerHook(feature_id, 'renderTokenConfig', _modTokenConfig);\r\n    registerHook(feature_id, 'renderDrawingConfig', _modDrawingConfig);\r\n    registerHook(feature_id, 'renderNoteConfig', _modNoteConfig);\r\n    registerHook(feature_id, 'renderSceneConfig', _modSceneConfig);\r\n    registerHook(feature_id, 'renderMacroConfig', _modMacroConfig);\r\n    registerHook(feature_id, 'renderActiveEffectConfig', _modActiveEffectConfig);\r\n  } else {\r\n    [\r\n      'renderTileConfig',\r\n      'renderMeasuredTemplateConfig',\r\n      'renderTokenConfig',\r\n      'renderDrawingConfig',\r\n      'renderNoteConfig',\r\n      'renderSceneConfig',\r\n      `renderActiveEffectConfig`,\r\n    ].forEach((name) => unregisterHook(feature_id, name));\r\n  }\r\n}\r\n\r\nfunction _modTokenConfig(config, html) {\r\n  insertArtSelectButton(html, 'texture.src', {\r\n    search: config.object.name,\r\n    searchType: SEARCH_TYPE.TOKEN,\r\n  });\r\n}\r\n\r\nfunction _modTemplateConfig(config, html) {\r\n  insertArtSelectButton(html, 'texture', { search: 'Template', searchType: SEARCH_TYPE.TILE });\r\n}\r\n\r\nfunction _modDrawingConfig(config, html) {\r\n  insertArtSelectButton(html, 'texture', {\r\n    search: 'Drawing',\r\n    searchType: TVA_CONFIG.customImageCategories.includes('Drawing') ? 'Drawing' : SEARCH_TYPE.TILE,\r\n  });\r\n}\r\n\r\nfunction _modNoteConfig(config, html) {\r\n  insertArtSelectButton(html, 'icon.custom', {\r\n    search: 'Note',\r\n    searchType: TVA_CONFIG.customImageCategories.includes('Note') ? 'Note' : SEARCH_TYPE.ITEM,\r\n  });\r\n}\r\n\r\nfunction _modSceneConfig(config, html) {\r\n  insertArtSelectButton(html, 'background.src', {\r\n    search: config.object.name,\r\n    searchType: TVA_CONFIG.customImageCategories.includes('Scene') ? 'Scene' : SEARCH_TYPE.TILE,\r\n  });\r\n  insertArtSelectButton(html, 'foreground', {\r\n    search: config.object.name,\r\n    searchType: TVA_CONFIG.customImageCategories.includes('Scene') ? 'Scene' : SEARCH_TYPE.TILE,\r\n  });\r\n  insertArtSelectButton(html, 'fogOverlay', {\r\n    search: config.object.name,\r\n    searchType: TVA_CONFIG.customImageCategories.includes('Fog') ? 'Fog' : SEARCH_TYPE.TILE,\r\n  });\r\n}\r\n\r\nfunction _modTileConfig(tileConfig, html) {\r\n  insertArtSelectButton(html, 'texture.src', {\r\n    search: tileConfig.object.getFlag('token-variants', 'tileName') || 'Tile',\r\n    searchType: SEARCH_TYPE.TILE,\r\n  });\r\n}\r\n\r\nfunction _modActiveEffectConfig(effectConfig, html) {\r\n  const inserted = insertArtSelectButton(html, 'icon', {\r\n    search: effectConfig.object.name || 'Active Effect',\r\n    searchType: TVA_CONFIG.customImageCategories.includes('Active Effect') ? 'Active Effect' : SEARCH_TYPE.ITEM,\r\n  });\r\n  if (!inserted) {\r\n    const img = $(html).find('.effect-icon');\r\n    img.on('contextmenu', () => {\r\n      showArtSelect(effectConfig.object?.name ?? 'Active Effect', {\r\n        searchType: SEARCH_TYPE.ITEM,\r\n        callback: (imgSrc) => img.attr('src', imgSrc),\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nfunction _modItemSheet(itemSheet, html, options) {\r\n  $(html)\r\n    .find('img.profile, .profile-img, [data-edit=\"img\"]')\r\n    .on('contextmenu', () => {\r\n      const item = itemSheet.object;\r\n      if (!item) return;\r\n      showArtSelect(item.name, {\r\n        searchType: SEARCH_TYPE.ITEM,\r\n        callback: (imgSrc) => item.update({ img: imgSrc }),\r\n      });\r\n    });\r\n}\r\n\r\nfunction _modMacroConfig(macroConfig, html, options) {\r\n  const img = $(html).find('.sheet-header > img');\r\n  img.on('contextmenu', () => {\r\n    showArtSelect(macroConfig.object?.name ?? 'Macro', {\r\n      searchType: SEARCH_TYPE.MACRO,\r\n      callback: (imgSrc) => img.attr('src', imgSrc),\r\n    });\r\n  });\r\n}\r\n\r\nfunction _modJournalSheet(journalSheet, html, options) {\r\n  $(html)\r\n    .find('.header-button.entry-image')\r\n    .on('contextmenu', () => {\r\n      const journal = journalSheet.object;\r\n      if (!journal) return;\r\n      showArtSelect(journal.name, {\r\n        searchType: SEARCH_TYPE.JOURNAL,\r\n        callback: (imgSrc) => journal.update({ img: imgSrc }),\r\n      });\r\n    });\r\n}\r\n\r\nfunction _modRollTableSheet(sheet, html) {\r\n  $(html)\r\n    .find('.result-image')\r\n    .on('contextmenu', (event) => {\r\n      const table = sheet.object;\r\n      if (!table) return;\r\n      const img = $(event.target).closest('.result-image').find('img');\r\n      showArtSelect(table.name, {\r\n        searchType: TVA_CONFIG.customImageCategories.includes('RollTable') ? 'RollTable' : SEARCH_TYPE.ITEM,\r\n        callback: (imgSrc) => {\r\n          img.attr('src', imgSrc);\r\n          sheet._onSubmit(event);\r\n        },\r\n      });\r\n    });\r\n}\r\n\r\n/**\r\n * Adds right-click listener to Actor Sheet profile image to open up\r\n * the 'Art Select' screen.\r\n */\r\nfunction _modActorSheet(actorSheet, html, options) {\r\n  if (options.editable && TVA_CONFIG.permissions.portrait_right_click[game.user.role]) {\r\n    let profile = null;\r\n    let profileQueries = {\r\n      all: ['.profile', '.profile-img', '.profile-image'],\r\n      pf2e: ['.player-image', '.actor-icon', '.sheet-header img', '.actor-image'],\r\n    };\r\n\r\n    for (let query of profileQueries.all) {\r\n      profile = html[0].querySelector(query);\r\n      if (profile) break;\r\n    }\r\n\r\n    if (!profile && game.system.id in profileQueries) {\r\n      for (let query of profileQueries[game.system.id]) {\r\n        profile = html[0].querySelector(query);\r\n        if (profile) break;\r\n      }\r\n    }\r\n\r\n    if (!profile) {\r\n      console.warn('TVA |', game.i18n.localize('token-variants.notifications.warn.profile-image-not-found'));\r\n      return;\r\n    }\r\n\r\n    profile.addEventListener(\r\n      'contextmenu',\r\n      function (ev) {\r\n        showArtSelect(actorSheet.object.name, {\r\n          callback: (imgSrc, name) => updateActorImage(actorSheet.object, imgSrc),\r\n          searchType: SEARCH_TYPE.PORTRAIT,\r\n          object: actorSheet.object,\r\n        });\r\n      },\r\n      false\r\n    );\r\n  }\r\n}\r\n","import { renderTileHUD } from '../../applications/tileHUD.js';\r\nimport { renderTokenHUD } from '../../applications/tokenHUD.js';\r\nimport { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\r\nimport { registerHook, unregisterHook } from './hooks.js';\r\n\r\nconst feature_id = 'HUD';\r\n\r\nexport function registerHUDHooks() {\r\n  if (FEATURE_CONTROL[feature_id] && TVA_CONFIG.tilesEnabled) {\r\n    registerHook(feature_id, 'renderTileHUD', renderTileHUD);\r\n  } else {\r\n    unregisterHook(feature_id, 'renderTileHUD');\r\n  }\r\n\r\n  if (\r\n    FEATURE_CONTROL[feature_id] &&\r\n    (TVA_CONFIG.permissions.hudFullAccess[game.user.role] || TVA_CONFIG.permissions.hud[game.user.role])\r\n  ) {\r\n    registerHook(feature_id, 'renderTokenHUD', renderTokenHUD);\r\n  } else {\r\n    unregisterHook(feature_id, 'renderTokenHUD');\r\n  }\r\n}\r\n","import { getFileName, isImage, isVideo, SEARCH_TYPE, keyPressed } from '../scripts/utils.js';\r\nimport { TVA_CONFIG } from '../scripts/settings.js';\r\nimport FlagsConfig from './flagsConfig.js';\r\nimport { doImageSearch } from '../scripts/search.js';\r\nimport UserList from './userList.js';\r\n\r\nexport async function renderTileHUD(hud, html, tileData, searchText = '', fp_files = null) {\r\n  const tile = hud.object;\r\n  const hudSettings = TVA_CONFIG.hud;\r\n\r\n  if (!hudSettings.enableSideMenu || !TVA_CONFIG.tilesEnabled) return;\r\n\r\n  const button = $(`\r\n  <div class=\"control-icon\" data-action=\"token-variants-side-selector\">\r\n    <img\r\n      id=\"token-variants-side-button\"\r\n      src=\"modules/token-variants/img/token-images.svg\"\r\n      width=\"36\"\r\n      height=\"36\"\r\n      title=\"${game.i18n.localize('token-variants.windows.art-select.select-variant')}\"\r\n    />\r\n  </div>\r\n`);\r\n\r\n  html.find('div.right').last().append(button);\r\n  html.find('div.right').click(_deactivateTokenVariantsSideSelector);\r\n\r\n  button.click((event) => _onButtonClick(event, tile));\r\n  button.contextmenu((event) => _onButtonRightClick(event, tile));\r\n}\r\n\r\nasync function _onButtonClick(event, tile) {\r\n  if (keyPressed('config')) {\r\n    setNameDialog(tile);\r\n    return;\r\n  }\r\n\r\n  const button = $(event.target).closest('.control-icon');\r\n\r\n  // De-activate 'Status Effects'\r\n  button.closest('div.right').find('div.control-icon.effects').removeClass('active');\r\n  button.closest('div.right').find('.status-effects').removeClass('active');\r\n\r\n  // Remove contextmenu\r\n  button.find('.contextmenu').remove();\r\n\r\n  // Toggle variants side menu\r\n  button.toggleClass('active');\r\n  let variantsWrap = button.find('.token-variants-wrap');\r\n  if (button.hasClass('active')) {\r\n    if (!variantsWrap.length) {\r\n      variantsWrap = await renderSideSelect(tile);\r\n      if (variantsWrap) button.find('img').after(variantsWrap);\r\n      else return;\r\n    }\r\n    variantsWrap.addClass('active');\r\n  } else {\r\n    variantsWrap.removeClass('active');\r\n  }\r\n}\r\n\r\nfunction _onButtonRightClick(event, tile) {\r\n  // Display side menu if button is not active yet\r\n  const button = $(event.target).closest('.control-icon');\r\n  if (!button.hasClass('active')) {\r\n    // button.trigger('click');\r\n    button.addClass('active');\r\n  }\r\n\r\n  if (button.find('.contextmenu').length) {\r\n    // Contextmenu already displayed. Remove and activate images\r\n    button.find('.contextmenu').remove();\r\n    button.removeClass('active').trigger('click');\r\n    //button.find('.token-variants-wrap.images').addClass('active');\r\n  } else {\r\n    // Contextmenu is not displayed. Hide images, create it and add it\r\n    button.find('.token-variants-wrap.images').removeClass('active');\r\n    const contextMenu = $(`\r\n    <div class=\"token-variants-wrap contextmenu active\">\r\n      <div class=\"token-variants-context-menu active\">\r\n        <input class=\"token-variants-side-search\" type=\"text\" />\r\n        <button class=\"flags\" type=\"button\"><i class=\"fab fa-font-awesome-flag\"></i><label>Flags</label></button>\r\n        <button class=\"file-picker\" type=\"button\"><i class=\"fas fa-file-import fa-fw\"></i><label>Browse Folders</label></button>\r\n      </div>\r\n    </div>\r\n      `);\r\n    button.append(contextMenu);\r\n\r\n    // Register contextmenu listeners\r\n    contextMenu\r\n      .find('.token-variants-side-search')\r\n      .on('keydown', (event) => _onImageSearchKeyUp(event, tile))\r\n      .on('click', (event) => {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n      });\r\n    contextMenu.find('.flags').click((event) => {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      new FlagsConfig(tile).render(true);\r\n    });\r\n    contextMenu.find('.file-picker').click(async (event) => {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      new FilePicker({\r\n        type: 'folder',\r\n        callback: async (path, fp) => {\r\n          const content = await FilePicker.browse(fp.activeSource, fp.result.target);\r\n          let files = content.files.filter((f) => isImage(f) || isVideo(f));\r\n          if (files.length) {\r\n            button.find('.token-variants-wrap').remove();\r\n            const sideSelect = await renderSideSelect(tile, null, files);\r\n            if (sideSelect) {\r\n              sideSelect.addClass('active');\r\n              button.append(sideSelect);\r\n            }\r\n          }\r\n        },\r\n      }).render(true);\r\n    });\r\n  }\r\n}\r\n\r\nfunction _deactivateTokenVariantsSideSelector(event) {\r\n  const controlIcon = $(event.target).closest('.control-icon');\r\n  const dataAction = controlIcon.attr('data-action');\r\n\r\n  switch (dataAction) {\r\n    case 'effects':\r\n      break; // Effects button\r\n    case 'thwildcard-selector':\r\n      break; // Token HUD Wildcard module button\r\n    default:\r\n      return;\r\n  }\r\n\r\n  $(event.target)\r\n    .closest('div.right')\r\n    .find('.control-icon[data-action=\"token-variants-side-selector\"]')\r\n    .removeClass('active');\r\n  $(event.target).closest('div.right').find('.token-variants-wrap').removeClass('active');\r\n}\r\n\r\nasync function renderSideSelect(tile, searchText = null, fp_files = null) {\r\n  const hudSettings = TVA_CONFIG.hud;\r\n  const worldHudSettings = TVA_CONFIG.worldHud;\r\n  const FULL_ACCESS = TVA_CONFIG.permissions.hudFullAccess[game.user.role];\r\n  let images = [];\r\n  let variants = [];\r\n  let imageDuplicates = new Set();\r\n  const pushImage = (img) => {\r\n    if (imageDuplicates.has(img.path)) {\r\n      if (!images.find((obj) => obj.path === img.path && obj.name === img.name)) {\r\n        images.push(img);\r\n      }\r\n    } else {\r\n      images.push(img);\r\n      imageDuplicates.add(img.path);\r\n    }\r\n  };\r\n\r\n  if (!fp_files) {\r\n    if (searchText !== null && !searchText) return;\r\n\r\n    if (!searchText) {\r\n      variants = tile.document.getFlag('token-variants', 'variants') || [];\r\n      variants.forEach((variant) => {\r\n        for (const name of variant.names) {\r\n          pushImage({ path: variant.imgSrc, name: name });\r\n        }\r\n      });\r\n\r\n      // Parse directory flag and include the images\r\n      const directoryFlag = tile.document.getFlag('token-variants', 'directory');\r\n      if (directoryFlag) {\r\n        let dirFlagImages;\r\n        try {\r\n          let path = directoryFlag.path;\r\n          let source = directoryFlag.source;\r\n          let bucket = '';\r\n          if (source.startsWith('s3:')) {\r\n            bucket = source.substring(3, source.length);\r\n            source = 's3';\r\n          }\r\n          const content = await FilePicker.browse(source, path, {\r\n            type: 'imagevideo',\r\n            bucket,\r\n          });\r\n          dirFlagImages = content.files;\r\n        } catch (err) {\r\n          dirFlagImages = [];\r\n        }\r\n        dirFlagImages.forEach((f) => {\r\n          if (isImage(f) || isVideo(f)) pushImage({ path: f, name: getFileName(f) });\r\n        });\r\n      }\r\n    }\r\n\r\n    // Perform the search if needed\r\n    const search = searchText ?? tile.document.getFlag('token-variants', 'tileName');\r\n    const noSearch = !search || (!searchText && worldHudSettings.displayOnlySharedImages);\r\n    let artSearch = noSearch\r\n      ? null\r\n      : await doImageSearch(search, {\r\n          searchType: SEARCH_TYPE.TILE,\r\n          searchOptions: { keywordSearch: worldHudSettings.includeKeywords },\r\n        });\r\n\r\n    if (artSearch) {\r\n      artSearch.forEach((results) => {\r\n        images.push(...results);\r\n      });\r\n    }\r\n  } else {\r\n    images = fp_files.map((f) => {\r\n      return { path: f, name: getFileName(f) };\r\n    });\r\n  }\r\n\r\n  // Retrieving the possibly custom name attached as a flag to the token\r\n  let tileImageName = tile.document.getFlag('token-variants', 'name');\r\n  if (!tileImageName) {\r\n    tileImageName = getFileName(tile.document.texture.src);\r\n  }\r\n\r\n  let imagesParsed = [];\r\n\r\n  for (const imageObj of images) {\r\n    const img = isImage(imageObj.path);\r\n    const vid = isVideo(imageObj.path);\r\n\r\n    let shared = false;\r\n    if (game.user.isGM) {\r\n      variants.forEach((variant) => {\r\n        if (variant.imgSrc === imageObj.path && variant.names.includes(imageObj.name)) {\r\n          shared = true;\r\n        }\r\n      });\r\n    }\r\n\r\n    const userMappings = tile.document.getFlag('token-variants', 'userMappings') || {};\r\n    const [title, style] = genTitleAndStyle(userMappings, imageObj.path, imageObj.name);\r\n\r\n    imagesParsed.push({\r\n      route: imageObj.path,\r\n      name: imageObj.name,\r\n      used: imageObj.path === tile.document.texture.src && imageObj.name === tileImageName,\r\n      img,\r\n      vid,\r\n      unknownType: !img && !vid,\r\n      shared: shared,\r\n      hasConfig: false, //hasConfig,\r\n      title: title,\r\n      style: game.user.isGM && style ? 'box-shadow: ' + style + ';' : null,\r\n    });\r\n  }\r\n\r\n  //\r\n  // Render\r\n  //\r\n  const imageDisplay = hudSettings.displayAsImage;\r\n  const imageOpacity = hudSettings.imageOpacity / 100;\r\n\r\n  const sideSelect = $(\r\n    await renderTemplate('modules/token-variants/templates/sideSelect.html', {\r\n      imagesParsed,\r\n      imageDisplay,\r\n      imageOpacity,\r\n      autoplay: !TVA_CONFIG.playVideoOnHover,\r\n    })\r\n  );\r\n\r\n  // Activate listeners\r\n  sideSelect.find('video').hover(\r\n    function () {\r\n      if (TVA_CONFIG.playVideoOnHover) {\r\n        this.play();\r\n        $(this).siblings('.fa-play').hide();\r\n      }\r\n    },\r\n    function () {\r\n      if (TVA_CONFIG.pauseVideoOnHoverOut) {\r\n        this.pause();\r\n        this.currentTime = 0;\r\n        $(this).siblings('.fa-play').show();\r\n      }\r\n    }\r\n  );\r\n  sideSelect.find('.token-variants-button-select').click((event) => _onImageClick(event, tile));\r\n\r\n  if (FULL_ACCESS) {\r\n    sideSelect\r\n      .find('.token-variants-button-select')\r\n      .on('contextmenu', (event) => _onImageRightClick(event, tile));\r\n  }\r\n\r\n  return sideSelect;\r\n}\r\n\r\nasync function _onImageClick(event, tile) {\r\n  event.preventDefault();\r\n  event.stopPropagation();\r\n\r\n  if (!tile) return;\r\n\r\n  const imgButton = $(event.target).closest('.token-variants-button-select');\r\n  const imgSrc = imgButton.attr('data-name');\r\n  const name = imgButton.attr('data-filename');\r\n  if (imgSrc) {\r\n    canvas.tiles.hud.clear();\r\n    await tile.document.update({ img: imgSrc });\r\n    try {\r\n      if (getFileName(imgSrc) !== name) await tile.document.setFlag('token-variants', 'name', name);\r\n    } catch (e) {}\r\n  }\r\n}\r\n\r\nasync function _onImageRightClick(event, tile) {\r\n  event.preventDefault();\r\n  event.stopPropagation();\r\n\r\n  if (!tile) return;\r\n\r\n  const imgButton = $(event.target).closest('.token-variants-button-select');\r\n  const imgSrc = imgButton.attr('data-name');\r\n  const name = imgButton.attr('data-filename');\r\n\r\n  if (!imgSrc || !name) return;\r\n\r\n  if (keyPressed('config') && game.user.isGM) {\r\n    const regenStyle = (tile, img) => {\r\n      const mappings = tile.document.getFlag('token-variants', 'userMappings') || {};\r\n      const name = imgButton.attr('data-filename');\r\n      const [title, style] = genTitleAndStyle(mappings, img, name);\r\n      imgButton\r\n        .closest('.token-variants-wrap')\r\n        .find(`.token-variants-button-select[data-name='${img}']`)\r\n        .css('box-shadow', style)\r\n        .prop('title', title);\r\n    };\r\n    new UserList(tile, imgSrc, regenStyle).render(true);\r\n    return;\r\n  }\r\n\r\n  let variants = tile.document.getFlag('token-variants', 'variants') || [];\r\n\r\n  // Remove selected variant if present in the flag, add otherwise\r\n  let del = false;\r\n  let updated = false;\r\n  for (let variant of variants) {\r\n    if (variant.imgSrc === imgSrc) {\r\n      let fNames = variant.names.filter((name) => name !== name);\r\n      if (fNames.length === 0) {\r\n        del = true;\r\n      } else if (fNames.length === variant.names.length) {\r\n        fNames.push(name);\r\n      }\r\n      variant.names = fNames;\r\n      updated = true;\r\n      break;\r\n    }\r\n  }\r\n  if (del) variants = variants.filter((variant) => variant.imgSrc !== imgSrc);\r\n  else if (!updated) variants.push({ imgSrc: imgSrc, names: [name] });\r\n\r\n  // Set shared variants as a flag\r\n  tile.document.unsetFlag('token-variants', 'variants');\r\n  if (variants.length > 0) {\r\n    tile.document.setFlag('token-variants', 'variants', variants);\r\n  }\r\n  imgButton.find('.fa-share').toggleClass('active'); // Display green arrow\r\n}\r\n\r\nasync function _onImageSearchKeyUp(event, tile) {\r\n  if (event.key === 'Enter' || event.keyCode === 13) {\r\n    event.preventDefault();\r\n    if (event.target.value.length >= 3) {\r\n      const button = $(event.target).closest('.control-icon');\r\n      button.find('.token-variants-wrap').remove();\r\n      const sideSelect = await renderSideSelect(tile, event.target.value);\r\n      if (sideSelect) {\r\n        sideSelect.addClass('active');\r\n        button.append(sideSelect);\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction genTitleAndStyle(mappings, imgSrc, name) {\r\n  let title = TVA_CONFIG.worldHud.showFullPath ? imgSrc : name;\r\n  let style = '';\r\n  let offset = 2;\r\n  for (const [userId, img] of Object.entries(mappings)) {\r\n    if (img === imgSrc) {\r\n      const user = game.users.get(userId);\r\n      if (!user) continue;\r\n      if (style.length === 0) {\r\n        style = `inset 0 0 0 ${offset}px ${user.color}`;\r\n      } else {\r\n        style += `, inset 0 0 0 ${offset}px ${user.color}`;\r\n      }\r\n      offset += 2;\r\n      title += `\\nDisplayed to: ${user.name}`;\r\n    }\r\n  }\r\n  return [title, style];\r\n}\r\n\r\nfunction setNameDialog(tile) {\r\n  const tileName = tile.document.getFlag('token-variants', 'tileName') || tile.id;\r\n  new Dialog({\r\n    title: `Assign a name to the Tile (3+ chars)`,\r\n    content: `<table style=\"width:100%\"><tr><th style=\"width:50%\"><label>Tile Name</label></th><td style=\"width:50%\"><input type=\"text\" name=\"input\" value=\"${tileName}\"/></td></tr></table>`,\r\n    buttons: {\r\n      Ok: {\r\n        label: `Save`,\r\n        callback: (html) => {\r\n          const name = html.find('input').val();\r\n          if (name) {\r\n            canvas.tiles.hud.clear();\r\n            tile.document.setFlag('token-variants', 'tileName', name);\r\n          }\r\n        },\r\n      },\r\n    },\r\n  }).render(true);\r\n}\r\n","export default class FlagsConfig extends FormApplication {\r\n  constructor(obj) {\r\n    super({}, {});\r\n    if (obj instanceof Tile) {\r\n      this.objectToFlag = obj.document;\r\n      this.isTile = true;\r\n    } else {\r\n      this.objectToFlag = game.actors.get(obj.document.actorId) || obj.document;\r\n    }\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-token-flags',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/flagsConfig.html',\r\n      resizable: true,\r\n      minimizable: false,\r\n      title: 'Flags',\r\n      width: 500,\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n    const popups = this.objectToFlag.getFlag('token-variants', 'popups');\r\n    const disableNameSearch = this.objectToFlag.getFlag('token-variants', 'disableNameSearch');\r\n    const directory = this.objectToFlag.getFlag('token-variants', 'directory') || {};\r\n\r\n    return mergeObject(data, {\r\n      popups: popups,\r\n      popupsSetFlag: popups != null,\r\n      disableNameSearch: disableNameSearch,\r\n      disableNameSearchSetFlag: disableNameSearch != null,\r\n      directory: directory.path,\r\n      directorySource: directory.source,\r\n      directorySetFlag: !isEmpty(directory),\r\n      tile: this.isTile,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n    html.find('.controlFlag').click((e) => {\r\n      $(e.target).siblings('.flag').prop('disabled', !e.target.checked);\r\n    });\r\n    html.find('.directory-fp').click((event) => {\r\n      new FilePicker({\r\n        type: 'folder',\r\n        activeSource: 'data',\r\n        callback: (path, fp) => {\r\n          html.find('[name=\"directory\"]').val(fp.result.target);\r\n          $(event.target)\r\n            .closest('button')\r\n            .attr('title', 'Directory: ' + fp.result.target);\r\n          const sourceEl = html.find('[name=\"directorySource\"]');\r\n          if (fp.activeSource === 's3') {\r\n            sourceEl.val(`s3:${fp.result.bucket}`);\r\n          } else {\r\n            sourceEl.val(fp.activeSource);\r\n          }\r\n        },\r\n      }).render(true);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {\r\n    if ('directory' in formData) {\r\n      formData.directory = { path: formData.directory, source: formData.directorySource };\r\n    }\r\n\r\n    ['popups', 'disableNameSearch', 'directory'].forEach((flag) => {\r\n      if (flag in formData) {\r\n        this.objectToFlag.setFlag('token-variants', flag, formData[flag]);\r\n      } else {\r\n        this.objectToFlag.unsetFlag('token-variants', flag);\r\n      }\r\n    });\r\n  }\r\n}\r\n","import { isInitialized } from '../token-variants.mjs';\r\nimport { Fuse } from './fuse/fuse.js';\r\nimport { getSearchOptions, TVA_CONFIG } from './settings.js';\r\nimport {\r\n  callForgeVTT,\r\n  decodeURIComponentSafely,\r\n  decodeURISafely,\r\n  flattenSearchResults,\r\n  getFileName,\r\n  getFileNameWithExt,\r\n  getFilePath,\r\n  getFilters,\r\n  isImage,\r\n  isVideo,\r\n  parseKeywords,\r\n  simplifyName,\r\n  simplifyPath,\r\n} from './utils.js';\r\n\r\n// True if in the middle of caching image paths\r\nlet caching = false;\r\nexport function isCaching() {\r\n  return caching;\r\n}\r\n\r\n// Cached images\r\nlet CACHED_IMAGES = {};\r\n\r\n/**\r\n * @param {string} search Text to be used as the search criteria\r\n * @param {object} [options={}] Options which customize the search\r\n * @param {SEARCH_TYPE|string} [options.searchType] Controls filters applied to the search results\r\n * @param {Boolean} [options.simpleResults] Results will be returned as an array of all image paths found\r\n * @param {Function[]} [options.callback] Function to be called with the found images\r\n * @param {object} [options.searchOptions] Override search settings\r\n * @returns {Promise<Map<string, Array<object>|Array<string>>} All images found split by original criteria and keywords\r\n */\r\nexport async function doImageSearch(\r\n  search,\r\n  {\r\n    searchType = SEARCH_TYPE.PORTRAIT_AND_TOKEN,\r\n    simpleResults = false,\r\n    callback = null,\r\n    searchOptions = {},\r\n  } = {}\r\n) {\r\n  if (caching) return;\r\n\r\n  searchOptions = mergeObject(searchOptions, getSearchOptions(), { overwrite: false });\r\n\r\n  search = search.trim();\r\n\r\n  if (TVA_CONFIG.debug)\r\n    console.info('TVA | STARTING: Art Search', search, searchType, searchOptions);\r\n\r\n  let searches = [search];\r\n  let allImages = new Map();\r\n  const keywords = parseKeywords(searchOptions.excludedKeywords);\r\n\r\n  if (searchOptions.keywordSearch) {\r\n    searches = searches.concat(\r\n      search\r\n        .split(/[_\\- :,\\|\\(\\)\\[\\]]/)\r\n        .filter((word) => word.length > 2 && !keywords.includes(word.toLowerCase()))\r\n        .reverse()\r\n    );\r\n  }\r\n\r\n  let usedImages = new Set();\r\n  for (const search of searches) {\r\n    if (allImages.get(search) !== undefined) continue;\r\n\r\n    let results = await findImages(search, searchType, searchOptions);\r\n    results = results.filter((pathObj) => !usedImages.has(pathObj));\r\n\r\n    allImages.set(search, results);\r\n    results.forEach(usedImages.add, usedImages);\r\n  }\r\n\r\n  if (TVA_CONFIG.debug) console.info('TVA | ENDING: Art Search');\r\n\r\n  if (simpleResults) {\r\n    allImages = Array.from(usedImages).map((obj) => obj.path);\r\n  }\r\n\r\n  if (callback) callback(allImages);\r\n  return allImages;\r\n}\r\n\r\n/**\r\n * @param {*} search Text to be used as the search criteria\r\n * @param {object} [options={}] Options which customize the search\r\n * @param {SEARCH_TYPE|string} [options.searchType] Controls filters applied to the search results\r\n * @param {Actor} [options.actor] Used to retrieve 'shared' images from if enabled in the Randomizer Settings\r\n * @param {Function[]} [options.callback] Function to be called with the random image\r\n * @param {object} [options.searchOptions] Override search settings\r\n * @param {object} [options.randomizerOptions] Override randomizer settings. These take precedence over searchOptions\r\n * @returns Array<string>|null} Image path and name\r\n */\r\nexport async function doRandomSearch(\r\n  search,\r\n  {\r\n    searchType = SEARCH_TYPE.PORTRAIT_AND_TOKEN,\r\n    actor = null,\r\n    callback = null,\r\n    randomizerOptions = {},\r\n    searchOptions = {},\r\n  } = {}\r\n) {\r\n  if (caching) return null;\r\n\r\n  const results = flattenSearchResults(\r\n    await _randSearchUtil(search, {\r\n      searchType: searchType,\r\n      actor: actor,\r\n      randomizerOptions: randomizerOptions,\r\n      searchOptions: searchOptions,\r\n    })\r\n  );\r\n  if (results.length === 0) return null;\r\n\r\n  // Pick random image\r\n  let randImageNum = Math.floor(Math.random() * results.length);\r\n  if (callback) callback([results[randImageNum].path, results[randImageNum].name]);\r\n  return [results[randImageNum].path, results[randImageNum].name];\r\n}\r\n\r\nexport async function doSyncSearch(\r\n  search,\r\n  target,\r\n  { searchType = SEARCH_TYPE.TOKEN, actor = null, randomizerOptions = {} } = {}\r\n) {\r\n  if (caching) return null;\r\n\r\n  const results = flattenSearchResults(\r\n    await _randSearchUtil(search, { searchType, actor, randomizerOptions })\r\n  );\r\n\r\n  // Find the image with the most similar name\r\n  const fuse = new Fuse(results, {\r\n    keys: ['name'],\r\n    minMatchCharLength: 1,\r\n    ignoreLocation: true,\r\n    threshold: 0.4,\r\n  });\r\n\r\n  const fResults = fuse.search(target);\r\n\r\n  if (fResults && fResults.length !== 0) {\r\n    return [fResults[0].item.path, fResults[0].item.name];\r\n  } else {\r\n    return null;\r\n  }\r\n}\r\n\r\nasync function _randSearchUtil(\r\n  search,\r\n  {\r\n    searchType = SEARCH_TYPE.PORTRAIT_AND_TOKEN,\r\n    actor = null,\r\n    randomizerOptions = {},\r\n    searchOptions = {},\r\n  } = {}\r\n) {\r\n  const randSettings = mergeObject(randomizerOptions, TVA_CONFIG.randomizer, { overwrite: false });\r\n  if (\r\n    !(\r\n      randSettings.tokenName ||\r\n      randSettings.actorName ||\r\n      randSettings.keywords ||\r\n      randSettings.shared ||\r\n      randSettings.wildcard\r\n    )\r\n  )\r\n    return null;\r\n\r\n  // Randomizer settings take precedence\r\n  searchOptions.keywordSearch = randSettings.keywords;\r\n\r\n  // Swap search to the actor name if need be\r\n  if (randSettings.actorName && actor) {\r\n    search = actor.name;\r\n  }\r\n\r\n  // Gather all images\r\n  let results =\r\n    randSettings.actorName || randSettings.tokenName || randSettings.keywords\r\n      ? await doImageSearch(search, {\r\n          searchType: searchType,\r\n          searchOptions: searchOptions,\r\n        })\r\n      : new Map();\r\n\r\n  if (!randSettings.tokenName && !randSettings.actorName) {\r\n    results.delete(search);\r\n  }\r\n  if (randSettings.shared && actor) {\r\n    let sharedVariants = actor.getFlag('token-variants', 'variants') || [];\r\n    if (sharedVariants.length != 0) {\r\n      const sv = [];\r\n      sharedVariants.forEach((variant) => {\r\n        variant.names.forEach((name) => {\r\n          sv.push({ path: variant.imgSrc, name: name });\r\n        });\r\n      });\r\n      results.set('variants95436723', sv);\r\n    }\r\n  }\r\n  if (randSettings.wildcard && actor) {\r\n    let protoImg = actor.prototypeToken.texture.src;\r\n    if (protoImg.includes('*') || (protoImg.includes('{') && protoImg.includes('}'))) {\r\n      // Modified version of Actor.getTokenImages()\r\n      const getTokenImages = async (actor) => {\r\n        if (actor._tokenImages) return actor._tokenImages;\r\n        let source = 'data';\r\n        const browseOptions = { wildcard: true };\r\n\r\n        // Support non-user sources\r\n        if (/\\.s3\\./.test(protoImg)) {\r\n          source = 's3';\r\n          const { bucket, keyPrefix } = FilePicker.parseS3URL(protoImg);\r\n          if (bucket) {\r\n            browseOptions.bucket = bucket;\r\n            protoImg = keyPrefix;\r\n          }\r\n        } else if (protoImg.startsWith('icons/')) source = 'public';\r\n\r\n        // Retrieve wildcard content\r\n        try {\r\n          const content = await FilePicker.browse(source, protoImg, browseOptions);\r\n          return content.files;\r\n        } catch (err) {\r\n          return [];\r\n        }\r\n      };\r\n\r\n      const wildcardImages = (await getTokenImages(actor))\r\n        .filter((img) => !img.includes('*') && (isImage(img) || isVideo(img)))\r\n        .map((variant) => {\r\n          return { path: variant, name: getFileName(variant) };\r\n        });\r\n      results.set('variants95436623', wildcardImages);\r\n    }\r\n  }\r\n\r\n  return results;\r\n}\r\n\r\n/**\r\n * Recursive image search through a directory\r\n * @param {*} path starting path\r\n * @param {*} options.apiKey ForgeVTT AssetLibrary API key\r\n * @param {*} found_images all the images found\r\n * @returns void\r\n */\r\nasync function walkFindImages(path, { apiKey = '' } = {}, found_images) {\r\n  let files = {};\r\n  if (!path.source) {\r\n    path.source = 'data';\r\n  }\r\n  const typeKey = path.types.sort().join(',');\r\n  try {\r\n    if (path.source.startsWith('s3:')) {\r\n      files = await FilePicker.browse('s3', path.text, {\r\n        bucket: path.source.replace('s3:', ''),\r\n      });\r\n    } else if (path.source.startsWith('forgevtt')) {\r\n      if (apiKey) {\r\n        const response = await callForgeVTT(path.text, apiKey);\r\n        files.files = response.files.map((f) => f.url);\r\n      } else {\r\n        files = await FilePicker.browse('forgevtt', path.text, { recursive: true });\r\n      }\r\n    } else if (path.source.startsWith('forge-bazaar')) {\r\n      files = await FilePicker.browse('forge-bazaar', path.text, { recursive: true });\r\n    } else if (path.source.startsWith('imgur')) {\r\n      await fetch('https://api.imgur.com/3/gallery/album/' + path.text, {\r\n        headers: {\r\n          Authorization:\r\n            'Client-ID ' +\r\n            (TVA_CONFIG.imgurClientId ? TVA_CONFIG.imgurClientId : 'df9d991443bb222'),\r\n          Accept: 'application/json',\r\n        },\r\n      })\r\n        .then((response) => response.json())\r\n        .then(async function (result) {\r\n          if (!result.success) {\r\n            return;\r\n          }\r\n          result.data.images.forEach((img) => {\r\n            const rtName = img.title ?? img.description ?? getFileName(img.link);\r\n            _addToFound({ path: decodeURISafely(img.link), name: rtName }, typeKey, found_images);\r\n          });\r\n        })\r\n        .catch((error) => console.warn('TVA |', error));\r\n      return;\r\n    } else if (path.source.startsWith('rolltable')) {\r\n      const table = game.tables.contents.find((t) => t.name === path.text);\r\n      if (!table) {\r\n        const rollTableName = path.text;\r\n        ui.notifications.warn(\r\n          game.i18n.format('token-variants.notifications.warn.invalid-table', {\r\n            rollTableName,\r\n          })\r\n        );\r\n      } else {\r\n        for (let baseTableData of table.results) {\r\n          const rtPath = baseTableData.img;\r\n          const rtName = baseTableData.text || getFileName(rtPath);\r\n          _addToFound({ path: decodeURISafely(rtPath), name: rtName }, typeKey, found_images);\r\n        }\r\n      }\r\n      return;\r\n    } else if (path.source.startsWith('json')) {\r\n      await fetch(path.text, {\r\n        headers: {\r\n          Accept: 'application/json',\r\n        },\r\n      })\r\n        .then((response) => response.json())\r\n        .then(async function (result) {\r\n          if (!result.length > 0) {\r\n            return;\r\n          }\r\n          result.forEach((img) => {\r\n            const rtName = img.name ?? getFileName(img.path);\r\n            _addToFound(\r\n              { path: decodeURISafely(img.path), name: rtName, tags: img.tags },\r\n              typeKey,\r\n              found_images\r\n            );\r\n          });\r\n        })\r\n        .catch((error) => console.warn('TVA |', error));\r\n      return;\r\n    } else {\r\n      files = await FilePicker.browse(path.source, path.text);\r\n    }\r\n  } catch (err) {\r\n    console.warn(\r\n      `TVA | ${game.i18n.localize('token-variants.notifications.warn.path-not-found')} ${\r\n        path.source\r\n      }:${path.text}`\r\n    );\r\n    return;\r\n  }\r\n\r\n  if (files.target == '.') return;\r\n\r\n  if (files.files) {\r\n    files.files.forEach((tokenSrc) => {\r\n      _addToFound(\r\n        { path: decodeURISafely(tokenSrc), name: getFileName(tokenSrc) },\r\n        typeKey,\r\n        found_images\r\n      );\r\n    });\r\n  }\r\n\r\n  // ForgeVTT requires special treatment\r\n  // Bazaar paths fail recursive search if one level above root\r\n  if (path.source.startsWith('forgevtt')) return;\r\n  else if (\r\n    path.source.startsWith('forge-bazaar') &&\r\n    !['modules', 'systems', 'worlds', 'assets'].includes(path.text.replaceAll(/[\\/\\\\]/g, ''))\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  for (let f_dir of files.dirs) {\r\n    await walkFindImages(\r\n      { text: f_dir, source: path.source, types: path.types },\r\n      { apiKey: apiKey },\r\n      found_images\r\n    );\r\n  }\r\n}\r\n\r\nfunction _addToFound(img, typeKey, found_images) {\r\n  if (isImage(img.path) || isVideo(img.path)) {\r\n    if (found_images[typeKey] == null) {\r\n      found_images[typeKey] = [img];\r\n    } else {\r\n      found_images[typeKey].push(img);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Recursive walks through all paths exposed to the module and caches them\r\n * @param {*} searchType\r\n * @returns\r\n */\r\nasync function walkAllPaths(searchType) {\r\n  const found_images = {};\r\n  const paths = _filterPathsByType(TVA_CONFIG.searchPaths, searchType);\r\n\r\n  for (const path of paths) {\r\n    if ((path.cache && caching) || (!path.cache && !caching))\r\n      await walkFindImages(path, {}, found_images);\r\n  }\r\n\r\n  // ForgeVTT specific path handling\r\n  const userId = typeof ForgeAPI !== 'undefined' ? await ForgeAPI.getUserId() : '';\r\n  for (const uid in TVA_CONFIG.forgeSearchPaths) {\r\n    const apiKey = TVA_CONFIG.forgeSearchPaths[uid].apiKey;\r\n    const paths = _filterPathsByType(TVA_CONFIG.forgeSearchPaths[uid].paths, searchType);\r\n    if (uid === userId) {\r\n      for (const path of paths) {\r\n        if ((path.cache && caching) || (!path.cache && !caching))\r\n          await walkFindImages(path, {}, found_images);\r\n      }\r\n    } else if (apiKey) {\r\n      for (const path of paths) {\r\n        if ((path.cache && caching) || (!path.cache && !caching)) {\r\n          if (path.share) await walkFindImages(path, { apiKey: apiKey }, found_images);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return found_images;\r\n}\r\n\r\nfunction _filterPathsByType(paths, searchType) {\r\n  if (!searchType) return paths;\r\n  return paths.filter((p) => p.types.includes(searchType));\r\n}\r\n\r\nexport async function findImagesFuzzy(name, searchType, searchOptions, forceSearchName = false) {\r\n  if (TVA_CONFIG.debug)\r\n    console.info(\r\n      'TVA | STARTING: Fuzzy Image Search',\r\n      name,\r\n      searchType,\r\n      searchOptions,\r\n      forceSearchName\r\n    );\r\n\r\n  const filters = getFilters(searchType, searchOptions.searchFilters);\r\n\r\n  const fuse = new Fuse([], {\r\n    keys: [!forceSearchName && searchOptions.runSearchOnPath ? 'path' : 'name', 'tags'],\r\n    includeScore: true,\r\n    includeMatches: true,\r\n    minMatchCharLength: 1,\r\n    ignoreLocation: true,\r\n    threshold: searchOptions.algorithm.fuzzyThreshold,\r\n  });\r\n\r\n  const found_images = await walkAllPaths(searchType);\r\n\r\n  for (const container of [CACHED_IMAGES, found_images]) {\r\n    for (const typeKey in container) {\r\n      const types = typeKey.split(',');\r\n      if (types.includes(searchType)) {\r\n        for (const imgObj of container[typeKey]) {\r\n          if (\r\n            _imagePassesFilter(imgObj.name, imgObj.path, filters, searchOptions.runSearchOnPath)\r\n          ) {\r\n            fuse.add(imgObj);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  let results;\r\n  if (name === '') {\r\n    results = fuse.getIndex().docs.slice(0, searchOptions.algorithm.fuzzyLimit);\r\n  } else {\r\n    results = fuse.search(name).slice(0, searchOptions.algorithm.fuzzyLimit);\r\n    results = results.map((r) => {\r\n      r.item.indices = r.matches[0].indices;\r\n      r.item.score = r.score;\r\n      return r.item;\r\n    });\r\n  }\r\n\r\n  if (TVA_CONFIG.debug) console.info('TVA | ENDING: Fuzzy Image Search', results);\r\n\r\n  return results;\r\n}\r\n\r\nasync function findImagesExact(name, searchType, searchOptions) {\r\n  if (TVA_CONFIG.debug)\r\n    console.info('TVA | STARTING: Exact Image Search', name, searchType, searchOptions);\r\n\r\n  const found_images = await walkAllPaths(searchType);\r\n\r\n  const simpleName = simplifyName(name);\r\n  const filters = getFilters(searchType, searchOptions.searchFilters);\r\n\r\n  const matchedImages = [];\r\n\r\n  for (const container of [CACHED_IMAGES, found_images]) {\r\n    for (const typeKey in container) {\r\n      const types = typeKey.split(',');\r\n      if (types.includes(searchType)) {\r\n        for (const imgOBj of container[typeKey]) {\r\n          if (\r\n            _exactSearchMatchesImage(\r\n              simpleName,\r\n              imgOBj.path,\r\n              imgOBj.name,\r\n              filters,\r\n              searchOptions.runSearchOnPath\r\n            )\r\n          ) {\r\n            matchedImages.push(imgOBj);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  if (TVA_CONFIG.debug) console.info('TVA | ENDING: Exact Image Search', matchedImages);\r\n  return matchedImages;\r\n}\r\n\r\nasync function findImages(name, searchType = '', searchOptions = {}) {\r\n  const sOptions = mergeObject(searchOptions, getSearchOptions(), { overwrite: false });\r\n  if (sOptions.algorithm.exact) {\r\n    return await findImagesExact(name, searchType, sOptions);\r\n  } else {\r\n    return await findImagesFuzzy(name, searchType, sOptions);\r\n  }\r\n}\r\n\r\n/**\r\n * Checks if image path and name match the provided search text and filters\r\n * @param imagePath image path\r\n * @param imageName image name\r\n * @param filters filters to be applied\r\n * @returns true|false\r\n */\r\nfunction _exactSearchMatchesImage(\r\n  simplifiedSearch,\r\n  imagePath,\r\n  imageName,\r\n  filters,\r\n  runSearchOnPath\r\n) {\r\n  // Is the search text contained in the name/path\r\n  const simplified = runSearchOnPath ? simplifyPath(imagePath) : simplifyName(imageName);\r\n  if (!simplified.includes(simplifiedSearch)) {\r\n    return false;\r\n  }\r\n\r\n  if (!filters) return true;\r\n  return _imagePassesFilter(imageName, imagePath, filters, runSearchOnPath);\r\n}\r\n\r\nfunction _imagePassesFilter(imageName, imagePath, filters, runSearchOnPath) {\r\n  // Filters are applied to path depending on the 'runSearchOnPath' setting, and actual or custom rolltable name\r\n  let text;\r\n  if (runSearchOnPath) {\r\n    text = decodeURIComponentSafely(imagePath);\r\n  } else if (getFileName(imagePath) === imageName) {\r\n    text = getFileNameWithExt(imagePath);\r\n  } else {\r\n    text = imageName;\r\n  }\r\n\r\n  if (filters.regex) {\r\n    return filters.regex.test(text);\r\n  }\r\n  if (filters.include) {\r\n    if (!text.includes(filters.include)) return false;\r\n  }\r\n  if (filters.exclude) {\r\n    if (text.includes(filters.exclude)) return false;\r\n  }\r\n  return true;\r\n}\r\n\r\n// ===================================\r\n// ==== CACHING RELATED FUNCTIONS ====\r\n// ===================================\r\n\r\nexport async function saveCache(cacheFile) {\r\n  const data = {};\r\n\r\n  const caches = Object.keys(CACHED_IMAGES);\r\n  for (const c of caches) {\r\n    if (!(c in data)) data[c] = [];\r\n    for (const img of CACHED_IMAGES[c]) {\r\n      if (img.tags) {\r\n        data[c].push([img.path, img.name, img.tags]);\r\n      } else if (getFileName(img.path) === img.name) {\r\n        data[c].push(img.path);\r\n      } else {\r\n        data[c].push([img.path, img.name]);\r\n      }\r\n    }\r\n  }\r\n\r\n  let file = new File([JSON.stringify(data)], getFileNameWithExt(cacheFile), {\r\n    type: 'text/plain',\r\n  });\r\n  FilePicker.upload('data', getFilePath(cacheFile), file);\r\n}\r\n\r\n/**\r\n * Search for and cache all the found token art\r\n */\r\nexport async function cacheImages({\r\n  staticCache = TVA_CONFIG.staticCache,\r\n  staticCacheFile = TVA_CONFIG.staticCacheFile,\r\n} = {}) {\r\n  if (caching) return;\r\n  caching = true;\r\n\r\n  if (!isInitialized() && staticCache) {\r\n    if (await _readCacheFromFile(staticCacheFile)) {\r\n      caching = false;\r\n      return;\r\n    }\r\n  }\r\n\r\n  if (!TVA_CONFIG.disableNotifs)\r\n    ui.notifications.info(game.i18n.format('token-variants.notifications.info.caching-started'));\r\n\r\n  if (TVA_CONFIG.debug) console.info('TVA | STARTING: Token Caching');\r\n  const found_images = await walkAllPaths();\r\n  CACHED_IMAGES = found_images;\r\n\r\n  if (TVA_CONFIG.debug) console.info('TVA | ENDING: Token Caching');\r\n\r\n  caching = false;\r\n  if (!TVA_CONFIG.disableNotifs)\r\n    ui.notifications.info(\r\n      game.i18n.format('token-variants.notifications.info.caching-finished', {\r\n        imageCount: Object.keys(CACHED_IMAGES).reduce(\r\n          (count, types) => count + CACHED_IMAGES[types].length,\r\n          0\r\n        ),\r\n      })\r\n    );\r\n\r\n  if (staticCache && game.user.isGM) {\r\n    saveCache(staticCacheFile);\r\n  }\r\n}\r\n\r\nasync function _readCacheFromFile(fileName) {\r\n  CACHED_IMAGES = {};\r\n  try {\r\n    await jQuery.getJSON(fileName, (json) => {\r\n      for (let category in json) {\r\n        CACHED_IMAGES[category] = [];\r\n\r\n        for (const img of json[category]) {\r\n          if (Array.isArray(img)) {\r\n            if (img.length === 3) {\r\n              CACHED_IMAGES[category].push({ path: img[0], name: img[1], tags: img[2] });\r\n            } else {\r\n              CACHED_IMAGES[category].push({ path: img[0], name: img[1] });\r\n            }\r\n          } else {\r\n            CACHED_IMAGES[category].push({ path: img, name: getFileName(img) });\r\n          }\r\n        }\r\n      }\r\n      if (!TVA_CONFIG.disableNotifs)\r\n        ui.notifications.info(\r\n          `Token Variant Art: Using Static Cache (${Object.keys(CACHED_IMAGES).reduce(\r\n            (count, c) => count + CACHED_IMAGES[c].length,\r\n            0\r\n          )} images)`\r\n        );\r\n    });\r\n  } catch (error) {\r\n    ui.notifications.warn(`Token Variant Art: Static Cache not found`);\r\n    CACHED_IMAGES = {};\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n","/**\r\n * Fuse.js v6.5.3 - Lightweight fuzzy-search (http://fusejs.io)\r\n *\r\n * Copyright (c) 2021 Kiro Risk (http://kiro.me)\r\n * All Rights Reserved. Apache Software License 2.0\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n */\r\n\r\nfunction ownKeys(object, enumerableOnly) {\r\n  var keys = Object.keys(object);\r\n\r\n  if (Object.getOwnPropertySymbols) {\r\n    var symbols = Object.getOwnPropertySymbols(object);\r\n    enumerableOnly &&\r\n      (symbols = symbols.filter(function (sym) {\r\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\r\n      })),\r\n      keys.push.apply(keys, symbols);\r\n  }\r\n\r\n  return keys;\r\n}\r\n\r\nfunction _objectSpread2(target) {\r\n  for (var i = 1; i < arguments.length; i++) {\r\n    var source = null != arguments[i] ? arguments[i] : {};\r\n    i % 2\r\n      ? ownKeys(Object(source), !0).forEach(function (key) {\r\n          _defineProperty(target, key, source[key]);\r\n        })\r\n      : Object.getOwnPropertyDescriptors\r\n      ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source))\r\n      : ownKeys(Object(source)).forEach(function (key) {\r\n          Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\r\n        });\r\n  }\r\n\r\n  return target;\r\n}\r\n\r\nfunction _typeof(obj) {\r\n  '@babel/helpers - typeof';\r\n\r\n  return (\r\n    (_typeof =\r\n      'function' == typeof Symbol && 'symbol' == typeof Symbol.iterator\r\n        ? function (obj) {\r\n            return typeof obj;\r\n          }\r\n        : function (obj) {\r\n            return obj &&\r\n              'function' == typeof Symbol &&\r\n              obj.constructor === Symbol &&\r\n              obj !== Symbol.prototype\r\n              ? 'symbol'\r\n              : typeof obj;\r\n          }),\r\n    _typeof(obj)\r\n  );\r\n}\r\n\r\nfunction _classCallCheck(instance, Constructor) {\r\n  if (!(instance instanceof Constructor)) {\r\n    throw new TypeError('Cannot call a class as a function');\r\n  }\r\n}\r\n\r\nfunction _defineProperties(target, props) {\r\n  for (var i = 0; i < props.length; i++) {\r\n    var descriptor = props[i];\r\n    descriptor.enumerable = descriptor.enumerable || false;\r\n    descriptor.configurable = true;\r\n    if ('value' in descriptor) descriptor.writable = true;\r\n    Object.defineProperty(target, descriptor.key, descriptor);\r\n  }\r\n}\r\n\r\nfunction _createClass(Constructor, protoProps, staticProps) {\r\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\r\n  if (staticProps) _defineProperties(Constructor, staticProps);\r\n  Object.defineProperty(Constructor, 'prototype', {\r\n    writable: false,\r\n  });\r\n  return Constructor;\r\n}\r\n\r\nfunction _defineProperty(obj, key, value) {\r\n  if (key in obj) {\r\n    Object.defineProperty(obj, key, {\r\n      value: value,\r\n      enumerable: true,\r\n      configurable: true,\r\n      writable: true,\r\n    });\r\n  } else {\r\n    obj[key] = value;\r\n  }\r\n\r\n  return obj;\r\n}\r\n\r\nfunction _inherits(subClass, superClass) {\r\n  if (typeof superClass !== 'function' && superClass !== null) {\r\n    throw new TypeError('Super expression must either be null or a function');\r\n  }\r\n\r\n  Object.defineProperty(subClass, 'prototype', {\r\n    value: Object.create(superClass && superClass.prototype, {\r\n      constructor: {\r\n        value: subClass,\r\n        writable: true,\r\n        configurable: true,\r\n      },\r\n    }),\r\n    writable: false,\r\n  });\r\n  if (superClass) _setPrototypeOf(subClass, superClass);\r\n}\r\n\r\nfunction _getPrototypeOf(o) {\r\n  _getPrototypeOf = Object.setPrototypeOf\r\n    ? Object.getPrototypeOf\r\n    : function _getPrototypeOf(o) {\r\n        return o.__proto__ || Object.getPrototypeOf(o);\r\n      };\r\n  return _getPrototypeOf(o);\r\n}\r\n\r\nfunction _setPrototypeOf(o, p) {\r\n  _setPrototypeOf =\r\n    Object.setPrototypeOf ||\r\n    function _setPrototypeOf(o, p) {\r\n      o.__proto__ = p;\r\n      return o;\r\n    };\r\n\r\n  return _setPrototypeOf(o, p);\r\n}\r\n\r\nfunction _isNativeReflectConstruct() {\r\n  if (typeof Reflect === 'undefined' || !Reflect.construct) return false;\r\n  if (Reflect.construct.sham) return false;\r\n  if (typeof Proxy === 'function') return true;\r\n\r\n  try {\r\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\r\n    return true;\r\n  } catch (e) {\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction _assertThisInitialized(self) {\r\n  if (self === void 0) {\r\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\r\n  }\r\n\r\n  return self;\r\n}\r\n\r\nfunction _possibleConstructorReturn(self, call) {\r\n  if (call && (typeof call === 'object' || typeof call === 'function')) {\r\n    return call;\r\n  } else if (call !== void 0) {\r\n    throw new TypeError('Derived constructors may only return object or undefined');\r\n  }\r\n\r\n  return _assertThisInitialized(self);\r\n}\r\n\r\nfunction _createSuper(Derived) {\r\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\r\n\r\n  return function _createSuperInternal() {\r\n    var Super = _getPrototypeOf(Derived),\r\n      result;\r\n\r\n    if (hasNativeReflectConstruct) {\r\n      var NewTarget = _getPrototypeOf(this).constructor;\r\n\r\n      result = Reflect.construct(Super, arguments, NewTarget);\r\n    } else {\r\n      result = Super.apply(this, arguments);\r\n    }\r\n\r\n    return _possibleConstructorReturn(this, result);\r\n  };\r\n}\r\n\r\nfunction _toConsumableArray(arr) {\r\n  return (\r\n    _arrayWithoutHoles(arr) ||\r\n    _iterableToArray(arr) ||\r\n    _unsupportedIterableToArray(arr) ||\r\n    _nonIterableSpread()\r\n  );\r\n}\r\n\r\nfunction _arrayWithoutHoles(arr) {\r\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\r\n}\r\n\r\nfunction _iterableToArray(iter) {\r\n  if (\r\n    (typeof Symbol !== 'undefined' && iter[Symbol.iterator] != null) ||\r\n    iter['@@iterator'] != null\r\n  )\r\n    return Array.from(iter);\r\n}\r\n\r\nfunction _unsupportedIterableToArray(o, minLen) {\r\n  if (!o) return;\r\n  if (typeof o === 'string') return _arrayLikeToArray(o, minLen);\r\n  var n = Object.prototype.toString.call(o).slice(8, -1);\r\n  if (n === 'Object' && o.constructor) n = o.constructor.name;\r\n  if (n === 'Map' || n === 'Set') return Array.from(o);\r\n  if (n === 'Arguments' || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))\r\n    return _arrayLikeToArray(o, minLen);\r\n}\r\n\r\nfunction _arrayLikeToArray(arr, len) {\r\n  if (len == null || len > arr.length) len = arr.length;\r\n\r\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\r\n\r\n  return arr2;\r\n}\r\n\r\nfunction _nonIterableSpread() {\r\n  throw new TypeError(\r\n    'Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.'\r\n  );\r\n}\r\n\r\nfunction isArray(value) {\r\n  return !Array.isArray ? getTag(value) === '[object Array]' : Array.isArray(value);\r\n} // Adapted from: https://github.com/lodash/lodash/blob/master/.internal/baseToString.js\r\n\r\nvar INFINITY = 1 / 0;\r\nfunction baseToString(value) {\r\n  // Exit early for strings to avoid a performance hit in some environments.\r\n  if (typeof value == 'string') {\r\n    return value;\r\n  }\r\n\r\n  var result = value + '';\r\n  return result == '0' && 1 / value == -INFINITY ? '-0' : result;\r\n}\r\nfunction toString(value) {\r\n  return value == null ? '' : baseToString(value);\r\n}\r\nfunction isString(value) {\r\n  return typeof value === 'string';\r\n}\r\nfunction isNumber(value) {\r\n  return typeof value === 'number';\r\n} // Adapted from: https://github.com/lodash/lodash/blob/master/isBoolean.js\r\n\r\nfunction isBoolean(value) {\r\n  return (\r\n    value === true ||\r\n    value === false ||\r\n    (isObjectLike(value) && getTag(value) == '[object Boolean]')\r\n  );\r\n}\r\nfunction isObject(value) {\r\n  return _typeof(value) === 'object';\r\n} // Checks if `value` is object-like.\r\n\r\nfunction isObjectLike(value) {\r\n  return isObject(value) && value !== null;\r\n}\r\nfunction isDefined(value) {\r\n  return value !== undefined && value !== null;\r\n}\r\nfunction isBlank(value) {\r\n  return !value.trim().length;\r\n} // Gets the `toStringTag` of `value`.\r\n// Adapted from: https://github.com/lodash/lodash/blob/master/.internal/getTag.js\r\n\r\nfunction getTag(value) {\r\n  return value == null\r\n    ? value === undefined\r\n      ? '[object Undefined]'\r\n      : '[object Null]'\r\n    : Object.prototype.toString.call(value);\r\n}\r\n\r\nvar EXTENDED_SEARCH_UNAVAILABLE = 'Extended search is not available';\r\nvar INCORRECT_INDEX_TYPE = \"Incorrect 'index' type\";\r\nvar LOGICAL_SEARCH_INVALID_QUERY_FOR_KEY = function LOGICAL_SEARCH_INVALID_QUERY_FOR_KEY(key) {\r\n  return 'Invalid value for key '.concat(key);\r\n};\r\nvar PATTERN_LENGTH_TOO_LARGE = function PATTERN_LENGTH_TOO_LARGE(max) {\r\n  return 'Pattern length exceeds max of '.concat(max, '.');\r\n};\r\nvar MISSING_KEY_PROPERTY = function MISSING_KEY_PROPERTY(name) {\r\n  return 'Missing '.concat(name, ' property in key');\r\n};\r\nvar INVALID_KEY_WEIGHT_VALUE = function INVALID_KEY_WEIGHT_VALUE(key) {\r\n  return \"Property 'weight' in key '\".concat(key, \"' must be a positive integer\");\r\n};\r\n\r\nvar hasOwn = Object.prototype.hasOwnProperty;\r\n\r\nvar KeyStore = /*#__PURE__*/ (function () {\r\n  function KeyStore(keys) {\r\n    var _this = this;\r\n\r\n    _classCallCheck(this, KeyStore);\r\n\r\n    this._keys = [];\r\n    this._keyMap = {};\r\n    var totalWeight = 0;\r\n    keys.forEach(function (key) {\r\n      var obj = createKey(key);\r\n      totalWeight += obj.weight;\r\n\r\n      _this._keys.push(obj);\r\n\r\n      _this._keyMap[obj.id] = obj;\r\n      totalWeight += obj.weight;\r\n    }); // Normalize weights so that their sum is equal to 1\r\n\r\n    this._keys.forEach(function (key) {\r\n      key.weight /= totalWeight;\r\n    });\r\n  }\r\n\r\n  _createClass(KeyStore, [\r\n    {\r\n      key: 'get',\r\n      value: function get(keyId) {\r\n        return this._keyMap[keyId];\r\n      },\r\n    },\r\n    {\r\n      key: 'keys',\r\n      value: function keys() {\r\n        return this._keys;\r\n      },\r\n    },\r\n    {\r\n      key: 'toJSON',\r\n      value: function toJSON() {\r\n        return JSON.stringify(this._keys);\r\n      },\r\n    },\r\n  ]);\r\n\r\n  return KeyStore;\r\n})();\r\nfunction createKey(key) {\r\n  var path = null;\r\n  var id = null;\r\n  var src = null;\r\n  var weight = 1;\r\n\r\n  if (isString(key) || isArray(key)) {\r\n    src = key;\r\n    path = createKeyPath(key);\r\n    id = createKeyId(key);\r\n  } else {\r\n    if (!hasOwn.call(key, 'name')) {\r\n      throw new Error(MISSING_KEY_PROPERTY('name'));\r\n    }\r\n\r\n    var name = key.name;\r\n    src = name;\r\n\r\n    if (hasOwn.call(key, 'weight')) {\r\n      weight = key.weight;\r\n\r\n      if (weight <= 0) {\r\n        throw new Error(INVALID_KEY_WEIGHT_VALUE(name));\r\n      }\r\n    }\r\n\r\n    path = createKeyPath(name);\r\n    id = createKeyId(name);\r\n  }\r\n\r\n  return {\r\n    path: path,\r\n    id: id,\r\n    weight: weight,\r\n    src: src,\r\n  };\r\n}\r\nfunction createKeyPath(key) {\r\n  return isArray(key) ? key : key.split('.');\r\n}\r\nfunction createKeyId(key) {\r\n  return isArray(key) ? key.join('.') : key;\r\n}\r\n\r\nfunction get(obj, path) {\r\n  var list = [];\r\n  var arr = false;\r\n\r\n  var deepGet = function deepGet(obj, path, index) {\r\n    if (!isDefined(obj)) {\r\n      return;\r\n    }\r\n\r\n    if (!path[index]) {\r\n      // If there's no path left, we've arrived at the object we care about.\r\n      list.push(obj);\r\n    } else {\r\n      var key = path[index];\r\n      var value = obj[key];\r\n\r\n      if (!isDefined(value)) {\r\n        return;\r\n      } // If we're at the last value in the path, and if it's a string/number/bool,\r\n      // add it to the list\r\n\r\n      if (index === path.length - 1 && (isString(value) || isNumber(value) || isBoolean(value))) {\r\n        list.push(toString(value));\r\n      } else if (isArray(value)) {\r\n        arr = true; // Search each item in the array.\r\n\r\n        for (var i = 0, len = value.length; i < len; i += 1) {\r\n          deepGet(value[i], path, index + 1);\r\n        }\r\n      } else if (path.length) {\r\n        // An object. Recurse further.\r\n        deepGet(value, path, index + 1);\r\n      }\r\n    }\r\n  }; // Backwards compatibility (since path used to be a string)\r\n\r\n  deepGet(obj, isString(path) ? path.split('.') : path, 0);\r\n  return arr ? list : list[0];\r\n}\r\n\r\nvar MatchOptions = {\r\n  // Whether the matches should be included in the result set. When `true`, each record in the result\r\n  // set will include the indices of the matched characters.\r\n  // These can consequently be used for highlighting purposes.\r\n  includeMatches: false,\r\n  // When `true`, the matching function will continue to the end of a search pattern even if\r\n  // a perfect match has already been located in the string.\r\n  findAllMatches: false,\r\n  // Minimum number of characters that must be matched before a result is considered a match\r\n  minMatchCharLength: 1,\r\n};\r\nvar BasicOptions = {\r\n  // When `true`, the algorithm continues searching to the end of the input even if a perfect\r\n  // match is found before the end of the same input.\r\n  isCaseSensitive: false,\r\n  // When true, the matching function will continue to the end of a search pattern even if\r\n  includeScore: false,\r\n  // List of properties that will be searched. This also supports nested properties.\r\n  keys: [],\r\n  // Whether to sort the result list, by score\r\n  shouldSort: true,\r\n  // Default sort function: sort by ascending score, ascending index\r\n  sortFn: function sortFn(a, b) {\r\n    return a.score === b.score ? (a.idx < b.idx ? -1 : 1) : a.score < b.score ? -1 : 1;\r\n  },\r\n};\r\nvar FuzzyOptions = {\r\n  // Approximately where in the text is the pattern expected to be found?\r\n  location: 0,\r\n  // At what point does the match algorithm give up. A threshold of '0.0' requires a perfect match\r\n  // (of both letters and location), a threshold of '1.0' would match anything.\r\n  threshold: 0.6,\r\n  // Determines how close the match must be to the fuzzy location (specified above).\r\n  // An exact letter match which is 'distance' characters away from the fuzzy location\r\n  // would score as a complete mismatch. A distance of '0' requires the match be at\r\n  // the exact location specified, a threshold of '1000' would require a perfect match\r\n  // to be within 800 characters of the fuzzy location to be found using a 0.8 threshold.\r\n  distance: 100,\r\n};\r\nvar AdvancedOptions = {\r\n  // When `true`, it enables the use of unix-like search commands\r\n  useExtendedSearch: false,\r\n  // The get function to use when fetching an object's properties.\r\n  // The default will search nested paths *ie foo.bar.baz*\r\n  getFn: get,\r\n  // When `true`, search will ignore `location` and `distance`, so it won't matter\r\n  // where in the string the pattern appears.\r\n  // More info: https://fusejs.io/concepts/scoring-theory.html#fuzziness-score\r\n  ignoreLocation: false,\r\n  // When `true`, the calculation for the relevance score (used for sorting) will\r\n  // ignore the field-length norm.\r\n  // More info: https://fusejs.io/concepts/scoring-theory.html#field-length-norm\r\n  ignoreFieldNorm: false,\r\n  // The weight to determine how much field length norm effects scoring.\r\n  fieldNormWeight: 1,\r\n};\r\nvar Config = _objectSpread2(\r\n  _objectSpread2(_objectSpread2(_objectSpread2({}, BasicOptions), MatchOptions), FuzzyOptions),\r\n  AdvancedOptions\r\n);\r\n\r\nvar SPACE = /[^ ]+/g; // Field-length norm: the shorter the field, the higher the weight.\r\n// Set to 3 decimals to reduce index size.\r\n\r\nfunction norm() {\r\n  var weight = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;\r\n  var mantissa = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 3;\r\n  var cache = new Map();\r\n  var m = Math.pow(10, mantissa);\r\n  return {\r\n    get: function get(value) {\r\n      var numTokens = value.match(SPACE).length;\r\n\r\n      if (cache.has(numTokens)) {\r\n        return cache.get(numTokens);\r\n      } // Default function is 1/sqrt(x), weight makes that variable\r\n\r\n      var norm = 1 / Math.pow(numTokens, 0.5 * weight); // In place of `toFixed(mantissa)`, for faster computation\r\n\r\n      var n = parseFloat(Math.round(norm * m) / m);\r\n      cache.set(numTokens, n);\r\n      return n;\r\n    },\r\n    clear: function clear() {\r\n      cache.clear();\r\n    },\r\n  };\r\n}\r\n\r\nvar FuseIndex = /*#__PURE__*/ (function () {\r\n  function FuseIndex() {\r\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\r\n      _ref$getFn = _ref.getFn,\r\n      getFn = _ref$getFn === void 0 ? Config.getFn : _ref$getFn,\r\n      _ref$fieldNormWeight = _ref.fieldNormWeight,\r\n      fieldNormWeight =\r\n        _ref$fieldNormWeight === void 0 ? Config.fieldNormWeight : _ref$fieldNormWeight;\r\n\r\n    _classCallCheck(this, FuseIndex);\r\n\r\n    this.norm = norm(fieldNormWeight, 3);\r\n    this.getFn = getFn;\r\n    this.isCreated = false;\r\n    this.setIndexRecords();\r\n  }\r\n\r\n  _createClass(FuseIndex, [\r\n    {\r\n      key: 'setSources',\r\n      value: function setSources() {\r\n        var docs = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\r\n        this.docs = docs;\r\n      },\r\n    },\r\n    {\r\n      key: 'setIndexRecords',\r\n      value: function setIndexRecords() {\r\n        var records = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\r\n        this.records = records;\r\n      },\r\n    },\r\n    {\r\n      key: 'setKeys',\r\n      value: function setKeys() {\r\n        var _this = this;\r\n\r\n        var keys = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\r\n        this.keys = keys;\r\n        this._keysMap = {};\r\n        keys.forEach(function (key, idx) {\r\n          _this._keysMap[key.id] = idx;\r\n        });\r\n      },\r\n    },\r\n    {\r\n      key: 'create',\r\n      value: function create() {\r\n        var _this2 = this;\r\n\r\n        if (this.isCreated || !this.docs.length) {\r\n          return;\r\n        }\r\n\r\n        this.isCreated = true; // List is Array<String>\r\n\r\n        if (isString(this.docs[0])) {\r\n          this.docs.forEach(function (doc, docIndex) {\r\n            _this2._addString(doc, docIndex);\r\n          });\r\n        } else {\r\n          // List is Array<Object>\r\n          this.docs.forEach(function (doc, docIndex) {\r\n            _this2._addObject(doc, docIndex);\r\n          });\r\n        }\r\n\r\n        this.norm.clear();\r\n      }, // Adds a doc to the end of the index\r\n    },\r\n    {\r\n      key: 'add',\r\n      value: function add(doc) {\r\n        var idx = this.size();\r\n\r\n        if (isString(doc)) {\r\n          this._addString(doc, idx);\r\n        } else {\r\n          this._addObject(doc, idx);\r\n        }\r\n      }, // Removes the doc at the specified index of the index\r\n    },\r\n    {\r\n      key: 'removeAt',\r\n      value: function removeAt(idx) {\r\n        this.records.splice(idx, 1); // Change ref index of every subsquent doc\r\n\r\n        for (var i = idx, len = this.size(); i < len; i += 1) {\r\n          this.records[i].i -= 1;\r\n        }\r\n      },\r\n    },\r\n    {\r\n      key: 'getValueForItemAtKeyId',\r\n      value: function getValueForItemAtKeyId(item, keyId) {\r\n        return item[this._keysMap[keyId]];\r\n      },\r\n    },\r\n    {\r\n      key: 'size',\r\n      value: function size() {\r\n        return this.records.length;\r\n      },\r\n    },\r\n    {\r\n      key: '_addString',\r\n      value: function _addString(doc, docIndex) {\r\n        if (!isDefined(doc) || isBlank(doc)) {\r\n          return;\r\n        }\r\n\r\n        var record = {\r\n          v: doc,\r\n          i: docIndex,\r\n          n: this.norm.get(doc),\r\n        };\r\n        this.records.push(record);\r\n      },\r\n    },\r\n    {\r\n      key: '_addObject',\r\n      value: function _addObject(doc, docIndex) {\r\n        var _this3 = this;\r\n\r\n        var record = {\r\n          i: docIndex,\r\n          $: {},\r\n        }; // Iterate over every key (i.e, path), and fetch the value at that key\r\n\r\n        this.keys.forEach(function (key, keyIndex) {\r\n          var value = _this3.getFn(doc, key.path);\r\n\r\n          if (!isDefined(value)) {\r\n            return;\r\n          }\r\n\r\n          if (isArray(value)) {\r\n            (function () {\r\n              var subRecords = [];\r\n              var stack = [\r\n                {\r\n                  nestedArrIndex: -1,\r\n                  value: value,\r\n                },\r\n              ];\r\n\r\n              while (stack.length) {\r\n                var _stack$pop = stack.pop(),\r\n                  nestedArrIndex = _stack$pop.nestedArrIndex,\r\n                  _value = _stack$pop.value;\r\n\r\n                if (!isDefined(_value)) {\r\n                  continue;\r\n                }\r\n\r\n                if (isString(_value) && !isBlank(_value)) {\r\n                  var subRecord = {\r\n                    v: _value,\r\n                    i: nestedArrIndex,\r\n                    n: _this3.norm.get(_value),\r\n                  };\r\n                  subRecords.push(subRecord);\r\n                } else if (isArray(_value)) {\r\n                  _value.forEach(function (item, k) {\r\n                    stack.push({\r\n                      nestedArrIndex: k,\r\n                      value: item,\r\n                    });\r\n                  });\r\n                } else;\r\n              }\r\n\r\n              record.$[keyIndex] = subRecords;\r\n            })();\r\n          } else if (!isBlank(value)) {\r\n            var subRecord = {\r\n              v: value,\r\n              n: _this3.norm.get(value),\r\n            };\r\n            record.$[keyIndex] = subRecord;\r\n          }\r\n        });\r\n        this.records.push(record);\r\n      },\r\n    },\r\n    {\r\n      key: 'toJSON',\r\n      value: function toJSON() {\r\n        return {\r\n          keys: this.keys,\r\n          records: this.records,\r\n        };\r\n      },\r\n    },\r\n  ]);\r\n\r\n  return FuseIndex;\r\n})();\r\nfunction createIndex(keys, docs) {\r\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\r\n    _ref2$getFn = _ref2.getFn,\r\n    getFn = _ref2$getFn === void 0 ? Config.getFn : _ref2$getFn,\r\n    _ref2$fieldNormWeight = _ref2.fieldNormWeight,\r\n    fieldNormWeight =\r\n      _ref2$fieldNormWeight === void 0 ? Config.fieldNormWeight : _ref2$fieldNormWeight;\r\n\r\n  var myIndex = new FuseIndex({\r\n    getFn: getFn,\r\n    fieldNormWeight: fieldNormWeight,\r\n  });\r\n  myIndex.setKeys(keys.map(createKey));\r\n  myIndex.setSources(docs);\r\n  myIndex.create();\r\n  return myIndex;\r\n}\r\nfunction parseIndex(data) {\r\n  var _ref3 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\r\n    _ref3$getFn = _ref3.getFn,\r\n    getFn = _ref3$getFn === void 0 ? Config.getFn : _ref3$getFn,\r\n    _ref3$fieldNormWeight = _ref3.fieldNormWeight,\r\n    fieldNormWeight =\r\n      _ref3$fieldNormWeight === void 0 ? Config.fieldNormWeight : _ref3$fieldNormWeight;\r\n\r\n  var keys = data.keys,\r\n    records = data.records;\r\n  var myIndex = new FuseIndex({\r\n    getFn: getFn,\r\n    fieldNormWeight: fieldNormWeight,\r\n  });\r\n  myIndex.setKeys(keys);\r\n  myIndex.setIndexRecords(records);\r\n  return myIndex;\r\n}\r\n\r\nfunction computeScore$1(pattern) {\r\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\r\n    _ref$errors = _ref.errors,\r\n    errors = _ref$errors === void 0 ? 0 : _ref$errors,\r\n    _ref$currentLocation = _ref.currentLocation,\r\n    currentLocation = _ref$currentLocation === void 0 ? 0 : _ref$currentLocation,\r\n    _ref$expectedLocation = _ref.expectedLocation,\r\n    expectedLocation = _ref$expectedLocation === void 0 ? 0 : _ref$expectedLocation,\r\n    _ref$distance = _ref.distance,\r\n    distance = _ref$distance === void 0 ? Config.distance : _ref$distance,\r\n    _ref$ignoreLocation = _ref.ignoreLocation,\r\n    ignoreLocation = _ref$ignoreLocation === void 0 ? Config.ignoreLocation : _ref$ignoreLocation;\r\n\r\n  var accuracy = errors / pattern.length;\r\n\r\n  if (ignoreLocation) {\r\n    return accuracy;\r\n  }\r\n\r\n  var proximity = Math.abs(expectedLocation - currentLocation);\r\n\r\n  if (!distance) {\r\n    // Dodge divide by zero error.\r\n    return proximity ? 1.0 : accuracy;\r\n  }\r\n\r\n  return accuracy + proximity / distance;\r\n}\r\n\r\nfunction convertMaskToIndices() {\r\n  var matchmask = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\r\n  var minMatchCharLength =\r\n    arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Config.minMatchCharLength;\r\n  var indices = [];\r\n  var start = -1;\r\n  var end = -1;\r\n  var i = 0;\r\n\r\n  for (var len = matchmask.length; i < len; i += 1) {\r\n    var match = matchmask[i];\r\n\r\n    if (match && start === -1) {\r\n      start = i;\r\n    } else if (!match && start !== -1) {\r\n      end = i - 1;\r\n\r\n      if (end - start + 1 >= minMatchCharLength) {\r\n        indices.push([start, end]);\r\n      }\r\n\r\n      start = -1;\r\n    }\r\n  } // (i-1 - start) + 1 => i - start\r\n\r\n  if (matchmask[i - 1] && i - start >= minMatchCharLength) {\r\n    indices.push([start, i - 1]);\r\n  }\r\n\r\n  return indices;\r\n}\r\n\r\n// Machine word size\r\nvar MAX_BITS = 32;\r\n\r\nfunction search(text, pattern, patternAlphabet) {\r\n  var _ref = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {},\r\n    _ref$location = _ref.location,\r\n    location = _ref$location === void 0 ? Config.location : _ref$location,\r\n    _ref$distance = _ref.distance,\r\n    distance = _ref$distance === void 0 ? Config.distance : _ref$distance,\r\n    _ref$threshold = _ref.threshold,\r\n    threshold = _ref$threshold === void 0 ? Config.threshold : _ref$threshold,\r\n    _ref$findAllMatches = _ref.findAllMatches,\r\n    findAllMatches = _ref$findAllMatches === void 0 ? Config.findAllMatches : _ref$findAllMatches,\r\n    _ref$minMatchCharLeng = _ref.minMatchCharLength,\r\n    minMatchCharLength =\r\n      _ref$minMatchCharLeng === void 0 ? Config.minMatchCharLength : _ref$minMatchCharLeng,\r\n    _ref$includeMatches = _ref.includeMatches,\r\n    includeMatches = _ref$includeMatches === void 0 ? Config.includeMatches : _ref$includeMatches,\r\n    _ref$ignoreLocation = _ref.ignoreLocation,\r\n    ignoreLocation = _ref$ignoreLocation === void 0 ? Config.ignoreLocation : _ref$ignoreLocation;\r\n\r\n  if (pattern.length > MAX_BITS) {\r\n    throw new Error(PATTERN_LENGTH_TOO_LARGE(MAX_BITS));\r\n  }\r\n\r\n  var patternLen = pattern.length; // Set starting location at beginning text and initialize the alphabet.\r\n\r\n  var textLen = text.length; // Handle the case when location > text.length\r\n\r\n  var expectedLocation = Math.max(0, Math.min(location, textLen)); // Highest score beyond which we give up.\r\n\r\n  var currentThreshold = threshold; // Is there a nearby exact match? (speedup)\r\n\r\n  var bestLocation = expectedLocation; // Performance: only computer matches when the minMatchCharLength > 1\r\n  // OR if `includeMatches` is true.\r\n\r\n  var computeMatches = minMatchCharLength > 1 || includeMatches; // A mask of the matches, used for building the indices\r\n\r\n  var matchMask = computeMatches ? Array(textLen) : [];\r\n  var index; // Get all exact matches, here for speed up\r\n\r\n  while ((index = text.indexOf(pattern, bestLocation)) > -1) {\r\n    var score = computeScore$1(pattern, {\r\n      currentLocation: index,\r\n      expectedLocation: expectedLocation,\r\n      distance: distance,\r\n      ignoreLocation: ignoreLocation,\r\n    });\r\n    currentThreshold = Math.min(score, currentThreshold);\r\n    bestLocation = index + patternLen;\r\n\r\n    if (computeMatches) {\r\n      var i = 0;\r\n\r\n      while (i < patternLen) {\r\n        matchMask[index + i] = 1;\r\n        i += 1;\r\n      }\r\n    }\r\n  } // Reset the best location\r\n\r\n  bestLocation = -1;\r\n  var lastBitArr = [];\r\n  var finalScore = 1;\r\n  var binMax = patternLen + textLen;\r\n  var mask = 1 << (patternLen - 1);\r\n\r\n  for (var _i = 0; _i < patternLen; _i += 1) {\r\n    // Scan for the best match; each iteration allows for one more error.\r\n    // Run a binary search to determine how far from the match location we can stray\r\n    // at this error level.\r\n    var binMin = 0;\r\n    var binMid = binMax;\r\n\r\n    while (binMin < binMid) {\r\n      var _score2 = computeScore$1(pattern, {\r\n        errors: _i,\r\n        currentLocation: expectedLocation + binMid,\r\n        expectedLocation: expectedLocation,\r\n        distance: distance,\r\n        ignoreLocation: ignoreLocation,\r\n      });\r\n\r\n      if (_score2 <= currentThreshold) {\r\n        binMin = binMid;\r\n      } else {\r\n        binMax = binMid;\r\n      }\r\n\r\n      binMid = Math.floor((binMax - binMin) / 2 + binMin);\r\n    } // Use the result from this iteration as the maximum for the next.\r\n\r\n    binMax = binMid;\r\n    var start = Math.max(1, expectedLocation - binMid + 1);\r\n    var finish = findAllMatches\r\n      ? textLen\r\n      : Math.min(expectedLocation + binMid, textLen) + patternLen; // Initialize the bit array\r\n\r\n    var bitArr = Array(finish + 2);\r\n    bitArr[finish + 1] = (1 << _i) - 1;\r\n\r\n    for (var j = finish; j >= start; j -= 1) {\r\n      var currentLocation = j - 1;\r\n      var charMatch = patternAlphabet[text.charAt(currentLocation)];\r\n\r\n      if (computeMatches) {\r\n        // Speed up: quick bool to int conversion (i.e, `charMatch ? 1 : 0`)\r\n        matchMask[currentLocation] = +!!charMatch;\r\n      } // First pass: exact match\r\n\r\n      bitArr[j] = ((bitArr[j + 1] << 1) | 1) & charMatch; // Subsequent passes: fuzzy match\r\n\r\n      if (_i) {\r\n        bitArr[j] |= ((lastBitArr[j + 1] | lastBitArr[j]) << 1) | 1 | lastBitArr[j + 1];\r\n      }\r\n\r\n      if (bitArr[j] & mask) {\r\n        finalScore = computeScore$1(pattern, {\r\n          errors: _i,\r\n          currentLocation: currentLocation,\r\n          expectedLocation: expectedLocation,\r\n          distance: distance,\r\n          ignoreLocation: ignoreLocation,\r\n        }); // This match will almost certainly be better than any existing match.\r\n        // But check anyway.\r\n\r\n        if (finalScore <= currentThreshold) {\r\n          // Indeed it is\r\n          currentThreshold = finalScore;\r\n          bestLocation = currentLocation; // Already passed `loc`, downhill from here on in.\r\n\r\n          if (bestLocation <= expectedLocation) {\r\n            break;\r\n          } // When passing `bestLocation`, don't exceed our current distance from `expectedLocation`.\r\n\r\n          start = Math.max(1, 2 * expectedLocation - bestLocation);\r\n        }\r\n      }\r\n    } // No hope for a (better) match at greater error levels.\r\n\r\n    var _score = computeScore$1(pattern, {\r\n      errors: _i + 1,\r\n      currentLocation: expectedLocation,\r\n      expectedLocation: expectedLocation,\r\n      distance: distance,\r\n      ignoreLocation: ignoreLocation,\r\n    });\r\n\r\n    if (_score > currentThreshold) {\r\n      break;\r\n    }\r\n\r\n    lastBitArr = bitArr;\r\n  }\r\n\r\n  var result = {\r\n    isMatch: bestLocation >= 0,\r\n    // Count exact matches (those with a score of 0) to be \"almost\" exact\r\n    score: Math.max(0.001, finalScore),\r\n  };\r\n\r\n  if (computeMatches) {\r\n    var indices = convertMaskToIndices(matchMask, minMatchCharLength);\r\n\r\n    if (!indices.length) {\r\n      result.isMatch = false;\r\n    } else if (includeMatches) {\r\n      result.indices = indices;\r\n    }\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nfunction createPatternAlphabet(pattern) {\r\n  var mask = {};\r\n\r\n  for (var i = 0, len = pattern.length; i < len; i += 1) {\r\n    var _char = pattern.charAt(i);\r\n\r\n    mask[_char] = (mask[_char] || 0) | (1 << (len - i - 1));\r\n  }\r\n\r\n  return mask;\r\n}\r\n\r\nvar BitapSearch = /*#__PURE__*/ (function () {\r\n  function BitapSearch(pattern) {\r\n    var _this = this;\r\n\r\n    var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\r\n      _ref$location = _ref.location,\r\n      location = _ref$location === void 0 ? Config.location : _ref$location,\r\n      _ref$threshold = _ref.threshold,\r\n      threshold = _ref$threshold === void 0 ? Config.threshold : _ref$threshold,\r\n      _ref$distance = _ref.distance,\r\n      distance = _ref$distance === void 0 ? Config.distance : _ref$distance,\r\n      _ref$includeMatches = _ref.includeMatches,\r\n      includeMatches = _ref$includeMatches === void 0 ? Config.includeMatches : _ref$includeMatches,\r\n      _ref$findAllMatches = _ref.findAllMatches,\r\n      findAllMatches = _ref$findAllMatches === void 0 ? Config.findAllMatches : _ref$findAllMatches,\r\n      _ref$minMatchCharLeng = _ref.minMatchCharLength,\r\n      minMatchCharLength =\r\n        _ref$minMatchCharLeng === void 0 ? Config.minMatchCharLength : _ref$minMatchCharLeng,\r\n      _ref$isCaseSensitive = _ref.isCaseSensitive,\r\n      isCaseSensitive =\r\n        _ref$isCaseSensitive === void 0 ? Config.isCaseSensitive : _ref$isCaseSensitive,\r\n      _ref$ignoreLocation = _ref.ignoreLocation,\r\n      ignoreLocation = _ref$ignoreLocation === void 0 ? Config.ignoreLocation : _ref$ignoreLocation;\r\n\r\n    _classCallCheck(this, BitapSearch);\r\n\r\n    this.options = {\r\n      location: location,\r\n      threshold: threshold,\r\n      distance: distance,\r\n      includeMatches: includeMatches,\r\n      findAllMatches: findAllMatches,\r\n      minMatchCharLength: minMatchCharLength,\r\n      isCaseSensitive: isCaseSensitive,\r\n      ignoreLocation: ignoreLocation,\r\n    };\r\n    this.pattern = isCaseSensitive ? pattern : pattern.toLowerCase();\r\n    this.chunks = [];\r\n\r\n    if (!this.pattern.length) {\r\n      return;\r\n    }\r\n\r\n    var addChunk = function addChunk(pattern, startIndex) {\r\n      _this.chunks.push({\r\n        pattern: pattern,\r\n        alphabet: createPatternAlphabet(pattern),\r\n        startIndex: startIndex,\r\n      });\r\n    };\r\n\r\n    var len = this.pattern.length;\r\n\r\n    if (len > MAX_BITS) {\r\n      var i = 0;\r\n      var remainder = len % MAX_BITS;\r\n      var end = len - remainder;\r\n\r\n      while (i < end) {\r\n        addChunk(this.pattern.substr(i, MAX_BITS), i);\r\n        i += MAX_BITS;\r\n      }\r\n\r\n      if (remainder) {\r\n        var startIndex = len - MAX_BITS;\r\n        addChunk(this.pattern.substr(startIndex), startIndex);\r\n      }\r\n    } else {\r\n      addChunk(this.pattern, 0);\r\n    }\r\n  }\r\n\r\n  _createClass(BitapSearch, [\r\n    {\r\n      key: 'searchIn',\r\n      value: function searchIn(text) {\r\n        var _this$options = this.options,\r\n          isCaseSensitive = _this$options.isCaseSensitive,\r\n          includeMatches = _this$options.includeMatches;\r\n\r\n        if (!isCaseSensitive) {\r\n          text = text.toLowerCase();\r\n        } // Exact match\r\n\r\n        if (this.pattern === text) {\r\n          var _result = {\r\n            isMatch: true,\r\n            score: 0,\r\n          };\r\n\r\n          if (includeMatches) {\r\n            _result.indices = [[0, text.length - 1]];\r\n          }\r\n\r\n          return _result;\r\n        } // Otherwise, use Bitap algorithm\r\n\r\n        var _this$options2 = this.options,\r\n          location = _this$options2.location,\r\n          distance = _this$options2.distance,\r\n          threshold = _this$options2.threshold,\r\n          findAllMatches = _this$options2.findAllMatches,\r\n          minMatchCharLength = _this$options2.minMatchCharLength,\r\n          ignoreLocation = _this$options2.ignoreLocation;\r\n        var allIndices = [];\r\n        var totalScore = 0;\r\n        var hasMatches = false;\r\n        this.chunks.forEach(function (_ref2) {\r\n          var pattern = _ref2.pattern,\r\n            alphabet = _ref2.alphabet,\r\n            startIndex = _ref2.startIndex;\r\n\r\n          var _search = search(text, pattern, alphabet, {\r\n              location: location + startIndex,\r\n              distance: distance,\r\n              threshold: threshold,\r\n              findAllMatches: findAllMatches,\r\n              minMatchCharLength: minMatchCharLength,\r\n              includeMatches: includeMatches,\r\n              ignoreLocation: ignoreLocation,\r\n            }),\r\n            isMatch = _search.isMatch,\r\n            score = _search.score,\r\n            indices = _search.indices;\r\n\r\n          if (isMatch) {\r\n            hasMatches = true;\r\n          }\r\n\r\n          totalScore += score;\r\n\r\n          if (isMatch && indices) {\r\n            allIndices = [].concat(_toConsumableArray(allIndices), _toConsumableArray(indices));\r\n          }\r\n        });\r\n        var result = {\r\n          isMatch: hasMatches,\r\n          score: hasMatches ? totalScore / this.chunks.length : 1,\r\n        };\r\n\r\n        if (hasMatches && includeMatches) {\r\n          result.indices = allIndices;\r\n        }\r\n\r\n        return result;\r\n      },\r\n    },\r\n  ]);\r\n\r\n  return BitapSearch;\r\n})();\r\n\r\nvar BaseMatch = /*#__PURE__*/ (function () {\r\n  function BaseMatch(pattern) {\r\n    _classCallCheck(this, BaseMatch);\r\n\r\n    this.pattern = pattern;\r\n  }\r\n\r\n  _createClass(\r\n    BaseMatch,\r\n    [\r\n      {\r\n        key: 'search',\r\n        value: function /*text*/ search() {},\r\n      },\r\n    ],\r\n    [\r\n      {\r\n        key: 'isMultiMatch',\r\n        value: function isMultiMatch(pattern) {\r\n          return getMatch(pattern, this.multiRegex);\r\n        },\r\n      },\r\n      {\r\n        key: 'isSingleMatch',\r\n        value: function isSingleMatch(pattern) {\r\n          return getMatch(pattern, this.singleRegex);\r\n        },\r\n      },\r\n    ]\r\n  );\r\n\r\n  return BaseMatch;\r\n})();\r\n\r\nfunction getMatch(pattern, exp) {\r\n  var matches = pattern.match(exp);\r\n  return matches ? matches[1] : null;\r\n}\r\n\r\nvar ExactMatch = /*#__PURE__*/ (function (_BaseMatch) {\r\n  _inherits(ExactMatch, _BaseMatch);\r\n\r\n  var _super = _createSuper(ExactMatch);\r\n\r\n  function ExactMatch(pattern) {\r\n    _classCallCheck(this, ExactMatch);\r\n\r\n    return _super.call(this, pattern);\r\n  }\r\n\r\n  _createClass(\r\n    ExactMatch,\r\n    [\r\n      {\r\n        key: 'search',\r\n        value: function search(text) {\r\n          var isMatch = text === this.pattern;\r\n          return {\r\n            isMatch: isMatch,\r\n            score: isMatch ? 0 : 1,\r\n            indices: [0, this.pattern.length - 1],\r\n          };\r\n        },\r\n      },\r\n    ],\r\n    [\r\n      {\r\n        key: 'type',\r\n        get: function get() {\r\n          return 'exact';\r\n        },\r\n      },\r\n      {\r\n        key: 'multiRegex',\r\n        get: function get() {\r\n          return /^=\"(.*)\"$/;\r\n        },\r\n      },\r\n      {\r\n        key: 'singleRegex',\r\n        get: function get() {\r\n          return /^=(.*)$/;\r\n        },\r\n      },\r\n    ]\r\n  );\r\n\r\n  return ExactMatch;\r\n})(BaseMatch);\r\n\r\nvar InverseExactMatch = /*#__PURE__*/ (function (_BaseMatch) {\r\n  _inherits(InverseExactMatch, _BaseMatch);\r\n\r\n  var _super = _createSuper(InverseExactMatch);\r\n\r\n  function InverseExactMatch(pattern) {\r\n    _classCallCheck(this, InverseExactMatch);\r\n\r\n    return _super.call(this, pattern);\r\n  }\r\n\r\n  _createClass(\r\n    InverseExactMatch,\r\n    [\r\n      {\r\n        key: 'search',\r\n        value: function search(text) {\r\n          var index = text.indexOf(this.pattern);\r\n          var isMatch = index === -1;\r\n          return {\r\n            isMatch: isMatch,\r\n            score: isMatch ? 0 : 1,\r\n            indices: [0, text.length - 1],\r\n          };\r\n        },\r\n      },\r\n    ],\r\n    [\r\n      {\r\n        key: 'type',\r\n        get: function get() {\r\n          return 'inverse-exact';\r\n        },\r\n      },\r\n      {\r\n        key: 'multiRegex',\r\n        get: function get() {\r\n          return /^!\"(.*)\"$/;\r\n        },\r\n      },\r\n      {\r\n        key: 'singleRegex',\r\n        get: function get() {\r\n          return /^!(.*)$/;\r\n        },\r\n      },\r\n    ]\r\n  );\r\n\r\n  return InverseExactMatch;\r\n})(BaseMatch);\r\n\r\nvar PrefixExactMatch = /*#__PURE__*/ (function (_BaseMatch) {\r\n  _inherits(PrefixExactMatch, _BaseMatch);\r\n\r\n  var _super = _createSuper(PrefixExactMatch);\r\n\r\n  function PrefixExactMatch(pattern) {\r\n    _classCallCheck(this, PrefixExactMatch);\r\n\r\n    return _super.call(this, pattern);\r\n  }\r\n\r\n  _createClass(\r\n    PrefixExactMatch,\r\n    [\r\n      {\r\n        key: 'search',\r\n        value: function search(text) {\r\n          var isMatch = text.startsWith(this.pattern);\r\n          return {\r\n            isMatch: isMatch,\r\n            score: isMatch ? 0 : 1,\r\n            indices: [0, this.pattern.length - 1],\r\n          };\r\n        },\r\n      },\r\n    ],\r\n    [\r\n      {\r\n        key: 'type',\r\n        get: function get() {\r\n          return 'prefix-exact';\r\n        },\r\n      },\r\n      {\r\n        key: 'multiRegex',\r\n        get: function get() {\r\n          return /^\\^\"(.*)\"$/;\r\n        },\r\n      },\r\n      {\r\n        key: 'singleRegex',\r\n        get: function get() {\r\n          return /^\\^(.*)$/;\r\n        },\r\n      },\r\n    ]\r\n  );\r\n\r\n  return PrefixExactMatch;\r\n})(BaseMatch);\r\n\r\nvar InversePrefixExactMatch = /*#__PURE__*/ (function (_BaseMatch) {\r\n  _inherits(InversePrefixExactMatch, _BaseMatch);\r\n\r\n  var _super = _createSuper(InversePrefixExactMatch);\r\n\r\n  function InversePrefixExactMatch(pattern) {\r\n    _classCallCheck(this, InversePrefixExactMatch);\r\n\r\n    return _super.call(this, pattern);\r\n  }\r\n\r\n  _createClass(\r\n    InversePrefixExactMatch,\r\n    [\r\n      {\r\n        key: 'search',\r\n        value: function search(text) {\r\n          var isMatch = !text.startsWith(this.pattern);\r\n          return {\r\n            isMatch: isMatch,\r\n            score: isMatch ? 0 : 1,\r\n            indices: [0, text.length - 1],\r\n          };\r\n        },\r\n      },\r\n    ],\r\n    [\r\n      {\r\n        key: 'type',\r\n        get: function get() {\r\n          return 'inverse-prefix-exact';\r\n        },\r\n      },\r\n      {\r\n        key: 'multiRegex',\r\n        get: function get() {\r\n          return /^!\\^\"(.*)\"$/;\r\n        },\r\n      },\r\n      {\r\n        key: 'singleRegex',\r\n        get: function get() {\r\n          return /^!\\^(.*)$/;\r\n        },\r\n      },\r\n    ]\r\n  );\r\n\r\n  return InversePrefixExactMatch;\r\n})(BaseMatch);\r\n\r\nvar SuffixExactMatch = /*#__PURE__*/ (function (_BaseMatch) {\r\n  _inherits(SuffixExactMatch, _BaseMatch);\r\n\r\n  var _super = _createSuper(SuffixExactMatch);\r\n\r\n  function SuffixExactMatch(pattern) {\r\n    _classCallCheck(this, SuffixExactMatch);\r\n\r\n    return _super.call(this, pattern);\r\n  }\r\n\r\n  _createClass(\r\n    SuffixExactMatch,\r\n    [\r\n      {\r\n        key: 'search',\r\n        value: function search(text) {\r\n          var isMatch = text.endsWith(this.pattern);\r\n          return {\r\n            isMatch: isMatch,\r\n            score: isMatch ? 0 : 1,\r\n            indices: [text.length - this.pattern.length, text.length - 1],\r\n          };\r\n        },\r\n      },\r\n    ],\r\n    [\r\n      {\r\n        key: 'type',\r\n        get: function get() {\r\n          return 'suffix-exact';\r\n        },\r\n      },\r\n      {\r\n        key: 'multiRegex',\r\n        get: function get() {\r\n          return /^\"(.*)\"\\$$/;\r\n        },\r\n      },\r\n      {\r\n        key: 'singleRegex',\r\n        get: function get() {\r\n          return /^(.*)\\$$/;\r\n        },\r\n      },\r\n    ]\r\n  );\r\n\r\n  return SuffixExactMatch;\r\n})(BaseMatch);\r\n\r\nvar InverseSuffixExactMatch = /*#__PURE__*/ (function (_BaseMatch) {\r\n  _inherits(InverseSuffixExactMatch, _BaseMatch);\r\n\r\n  var _super = _createSuper(InverseSuffixExactMatch);\r\n\r\n  function InverseSuffixExactMatch(pattern) {\r\n    _classCallCheck(this, InverseSuffixExactMatch);\r\n\r\n    return _super.call(this, pattern);\r\n  }\r\n\r\n  _createClass(\r\n    InverseSuffixExactMatch,\r\n    [\r\n      {\r\n        key: 'search',\r\n        value: function search(text) {\r\n          var isMatch = !text.endsWith(this.pattern);\r\n          return {\r\n            isMatch: isMatch,\r\n            score: isMatch ? 0 : 1,\r\n            indices: [0, text.length - 1],\r\n          };\r\n        },\r\n      },\r\n    ],\r\n    [\r\n      {\r\n        key: 'type',\r\n        get: function get() {\r\n          return 'inverse-suffix-exact';\r\n        },\r\n      },\r\n      {\r\n        key: 'multiRegex',\r\n        get: function get() {\r\n          return /^!\"(.*)\"\\$$/;\r\n        },\r\n      },\r\n      {\r\n        key: 'singleRegex',\r\n        get: function get() {\r\n          return /^!(.*)\\$$/;\r\n        },\r\n      },\r\n    ]\r\n  );\r\n\r\n  return InverseSuffixExactMatch;\r\n})(BaseMatch);\r\n\r\nvar FuzzyMatch = /*#__PURE__*/ (function (_BaseMatch) {\r\n  _inherits(FuzzyMatch, _BaseMatch);\r\n\r\n  var _super = _createSuper(FuzzyMatch);\r\n\r\n  function FuzzyMatch(pattern) {\r\n    var _this;\r\n\r\n    var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\r\n      _ref$location = _ref.location,\r\n      location = _ref$location === void 0 ? Config.location : _ref$location,\r\n      _ref$threshold = _ref.threshold,\r\n      threshold = _ref$threshold === void 0 ? Config.threshold : _ref$threshold,\r\n      _ref$distance = _ref.distance,\r\n      distance = _ref$distance === void 0 ? Config.distance : _ref$distance,\r\n      _ref$includeMatches = _ref.includeMatches,\r\n      includeMatches = _ref$includeMatches === void 0 ? Config.includeMatches : _ref$includeMatches,\r\n      _ref$findAllMatches = _ref.findAllMatches,\r\n      findAllMatches = _ref$findAllMatches === void 0 ? Config.findAllMatches : _ref$findAllMatches,\r\n      _ref$minMatchCharLeng = _ref.minMatchCharLength,\r\n      minMatchCharLength =\r\n        _ref$minMatchCharLeng === void 0 ? Config.minMatchCharLength : _ref$minMatchCharLeng,\r\n      _ref$isCaseSensitive = _ref.isCaseSensitive,\r\n      isCaseSensitive =\r\n        _ref$isCaseSensitive === void 0 ? Config.isCaseSensitive : _ref$isCaseSensitive,\r\n      _ref$ignoreLocation = _ref.ignoreLocation,\r\n      ignoreLocation = _ref$ignoreLocation === void 0 ? Config.ignoreLocation : _ref$ignoreLocation;\r\n\r\n    _classCallCheck(this, FuzzyMatch);\r\n\r\n    _this = _super.call(this, pattern);\r\n    _this._bitapSearch = new BitapSearch(pattern, {\r\n      location: location,\r\n      threshold: threshold,\r\n      distance: distance,\r\n      includeMatches: includeMatches,\r\n      findAllMatches: findAllMatches,\r\n      minMatchCharLength: minMatchCharLength,\r\n      isCaseSensitive: isCaseSensitive,\r\n      ignoreLocation: ignoreLocation,\r\n    });\r\n    return _this;\r\n  }\r\n\r\n  _createClass(\r\n    FuzzyMatch,\r\n    [\r\n      {\r\n        key: 'search',\r\n        value: function search(text) {\r\n          return this._bitapSearch.searchIn(text);\r\n        },\r\n      },\r\n    ],\r\n    [\r\n      {\r\n        key: 'type',\r\n        get: function get() {\r\n          return 'fuzzy';\r\n        },\r\n      },\r\n      {\r\n        key: 'multiRegex',\r\n        get: function get() {\r\n          return /^\"(.*)\"$/;\r\n        },\r\n      },\r\n      {\r\n        key: 'singleRegex',\r\n        get: function get() {\r\n          return /^(.*)$/;\r\n        },\r\n      },\r\n    ]\r\n  );\r\n\r\n  return FuzzyMatch;\r\n})(BaseMatch);\r\n\r\nvar IncludeMatch = /*#__PURE__*/ (function (_BaseMatch) {\r\n  _inherits(IncludeMatch, _BaseMatch);\r\n\r\n  var _super = _createSuper(IncludeMatch);\r\n\r\n  function IncludeMatch(pattern) {\r\n    _classCallCheck(this, IncludeMatch);\r\n\r\n    return _super.call(this, pattern);\r\n  }\r\n\r\n  _createClass(\r\n    IncludeMatch,\r\n    [\r\n      {\r\n        key: 'search',\r\n        value: function search(text) {\r\n          var location = 0;\r\n          var index;\r\n          var indices = [];\r\n          var patternLen = this.pattern.length; // Get all exact matches\r\n\r\n          while ((index = text.indexOf(this.pattern, location)) > -1) {\r\n            location = index + patternLen;\r\n            indices.push([index, location - 1]);\r\n          }\r\n\r\n          var isMatch = !!indices.length;\r\n          return {\r\n            isMatch: isMatch,\r\n            score: isMatch ? 0 : 1,\r\n            indices: indices,\r\n          };\r\n        },\r\n      },\r\n    ],\r\n    [\r\n      {\r\n        key: 'type',\r\n        get: function get() {\r\n          return 'include';\r\n        },\r\n      },\r\n      {\r\n        key: 'multiRegex',\r\n        get: function get() {\r\n          return /^'\"(.*)\"$/;\r\n        },\r\n      },\r\n      {\r\n        key: 'singleRegex',\r\n        get: function get() {\r\n          return /^'(.*)$/;\r\n        },\r\n      },\r\n    ]\r\n  );\r\n\r\n  return IncludeMatch;\r\n})(BaseMatch);\r\n\r\nvar searchers = [\r\n  ExactMatch,\r\n  IncludeMatch,\r\n  PrefixExactMatch,\r\n  InversePrefixExactMatch,\r\n  InverseSuffixExactMatch,\r\n  SuffixExactMatch,\r\n  InverseExactMatch,\r\n  FuzzyMatch,\r\n];\r\nvar searchersLen = searchers.length; // Regex to split by spaces, but keep anything in quotes together\r\n\r\nvar SPACE_RE = / +(?=([^\\\"]*\\\"[^\\\"]*\\\")*[^\\\"]*$)/;\r\nvar OR_TOKEN = '|'; // Return a 2D array representation of the query, for simpler parsing.\r\n// Example:\r\n// \"^core go$ | rb$ | py$ xy$\" => [[\"^core\", \"go$\"], [\"rb$\"], [\"py$\", \"xy$\"]]\r\n\r\nfunction parseQuery(pattern) {\r\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\r\n  return pattern.split(OR_TOKEN).map(function (item) {\r\n    var query = item\r\n      .trim()\r\n      .split(SPACE_RE)\r\n      .filter(function (item) {\r\n        return item && !!item.trim();\r\n      });\r\n    var results = [];\r\n\r\n    for (var i = 0, len = query.length; i < len; i += 1) {\r\n      var queryItem = query[i]; // 1. Handle multiple query match (i.e, once that are quoted, like `\"hello world\"`)\r\n\r\n      var found = false;\r\n      var idx = -1;\r\n\r\n      while (!found && ++idx < searchersLen) {\r\n        var searcher = searchers[idx];\r\n        var token = searcher.isMultiMatch(queryItem);\r\n\r\n        if (token) {\r\n          results.push(new searcher(token, options));\r\n          found = true;\r\n        }\r\n      }\r\n\r\n      if (found) {\r\n        continue;\r\n      } // 2. Handle single query matches (i.e, once that are *not* quoted)\r\n\r\n      idx = -1;\r\n\r\n      while (++idx < searchersLen) {\r\n        var _searcher = searchers[idx];\r\n\r\n        var _token = _searcher.isSingleMatch(queryItem);\r\n\r\n        if (_token) {\r\n          results.push(new _searcher(_token, options));\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    return results;\r\n  });\r\n}\r\n\r\n// to a singl match\r\n\r\nvar MultiMatchSet = new Set([FuzzyMatch.type, IncludeMatch.type]);\r\n/**\r\n * Command-like searching\r\n * ======================\r\n *\r\n * Given multiple search terms delimited by spaces.e.g. `^jscript .python$ ruby !java`,\r\n * search in a given text.\r\n *\r\n * Search syntax:\r\n *\r\n * | Token       | Match type                 | Description                            |\r\n * | ----------- | -------------------------- | -------------------------------------- |\r\n * | `jscript`   | fuzzy-match                | Items that fuzzy match `jscript`       |\r\n * | `=scheme`   | exact-match                | Items that are `scheme`                |\r\n * | `'python`   | include-match              | Items that include `python`            |\r\n * | `!ruby`     | inverse-exact-match        | Items that do not include `ruby`       |\r\n * | `^java`     | prefix-exact-match         | Items that start with `java`           |\r\n * | `!^earlang` | inverse-prefix-exact-match | Items that do not start with `earlang` |\r\n * | `.js$`      | suffix-exact-match         | Items that end with `.js`              |\r\n * | `!.go$`     | inverse-suffix-exact-match | Items that do not end with `.go`       |\r\n *\r\n * A single pipe character acts as an OR operator. For example, the following\r\n * query matches entries that start with `core` and end with either`go`, `rb`,\r\n * or`py`.\r\n *\r\n * ```\r\n * ^core go$ | rb$ | py$\r\n * ```\r\n */\r\n\r\nvar ExtendedSearch = /*#__PURE__*/ (function () {\r\n  function ExtendedSearch(pattern) {\r\n    var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\r\n      _ref$isCaseSensitive = _ref.isCaseSensitive,\r\n      isCaseSensitive =\r\n        _ref$isCaseSensitive === void 0 ? Config.isCaseSensitive : _ref$isCaseSensitive,\r\n      _ref$includeMatches = _ref.includeMatches,\r\n      includeMatches = _ref$includeMatches === void 0 ? Config.includeMatches : _ref$includeMatches,\r\n      _ref$minMatchCharLeng = _ref.minMatchCharLength,\r\n      minMatchCharLength =\r\n        _ref$minMatchCharLeng === void 0 ? Config.minMatchCharLength : _ref$minMatchCharLeng,\r\n      _ref$ignoreLocation = _ref.ignoreLocation,\r\n      ignoreLocation = _ref$ignoreLocation === void 0 ? Config.ignoreLocation : _ref$ignoreLocation,\r\n      _ref$findAllMatches = _ref.findAllMatches,\r\n      findAllMatches = _ref$findAllMatches === void 0 ? Config.findAllMatches : _ref$findAllMatches,\r\n      _ref$location = _ref.location,\r\n      location = _ref$location === void 0 ? Config.location : _ref$location,\r\n      _ref$threshold = _ref.threshold,\r\n      threshold = _ref$threshold === void 0 ? Config.threshold : _ref$threshold,\r\n      _ref$distance = _ref.distance,\r\n      distance = _ref$distance === void 0 ? Config.distance : _ref$distance;\r\n\r\n    _classCallCheck(this, ExtendedSearch);\r\n\r\n    this.query = null;\r\n    this.options = {\r\n      isCaseSensitive: isCaseSensitive,\r\n      includeMatches: includeMatches,\r\n      minMatchCharLength: minMatchCharLength,\r\n      findAllMatches: findAllMatches,\r\n      ignoreLocation: ignoreLocation,\r\n      location: location,\r\n      threshold: threshold,\r\n      distance: distance,\r\n    };\r\n    this.pattern = isCaseSensitive ? pattern : pattern.toLowerCase();\r\n    this.query = parseQuery(this.pattern, this.options);\r\n  }\r\n\r\n  _createClass(\r\n    ExtendedSearch,\r\n    [\r\n      {\r\n        key: 'searchIn',\r\n        value: function searchIn(text) {\r\n          var query = this.query;\r\n\r\n          if (!query) {\r\n            return {\r\n              isMatch: false,\r\n              score: 1,\r\n            };\r\n          }\r\n\r\n          var _this$options = this.options,\r\n            includeMatches = _this$options.includeMatches,\r\n            isCaseSensitive = _this$options.isCaseSensitive;\r\n          text = isCaseSensitive ? text : text.toLowerCase();\r\n          var numMatches = 0;\r\n          var allIndices = [];\r\n          var totalScore = 0; // ORs\r\n\r\n          for (var i = 0, qLen = query.length; i < qLen; i += 1) {\r\n            var searchers = query[i]; // Reset indices\r\n\r\n            allIndices.length = 0;\r\n            numMatches = 0; // ANDs\r\n\r\n            for (var j = 0, pLen = searchers.length; j < pLen; j += 1) {\r\n              var searcher = searchers[j];\r\n\r\n              var _searcher$search = searcher.search(text),\r\n                isMatch = _searcher$search.isMatch,\r\n                indices = _searcher$search.indices,\r\n                score = _searcher$search.score;\r\n\r\n              if (isMatch) {\r\n                numMatches += 1;\r\n                totalScore += score;\r\n\r\n                if (includeMatches) {\r\n                  var type = searcher.constructor.type;\r\n\r\n                  if (MultiMatchSet.has(type)) {\r\n                    allIndices = [].concat(\r\n                      _toConsumableArray(allIndices),\r\n                      _toConsumableArray(indices)\r\n                    );\r\n                  } else {\r\n                    allIndices.push(indices);\r\n                  }\r\n                }\r\n              } else {\r\n                totalScore = 0;\r\n                numMatches = 0;\r\n                allIndices.length = 0;\r\n                break;\r\n              }\r\n            } // OR condition, so if TRUE, return\r\n\r\n            if (numMatches) {\r\n              var result = {\r\n                isMatch: true,\r\n                score: totalScore / numMatches,\r\n              };\r\n\r\n              if (includeMatches) {\r\n                result.indices = allIndices;\r\n              }\r\n\r\n              return result;\r\n            }\r\n          } // Nothing was matched\r\n\r\n          return {\r\n            isMatch: false,\r\n            score: 1,\r\n          };\r\n        },\r\n      },\r\n    ],\r\n    [\r\n      {\r\n        key: 'condition',\r\n        value: function condition(_, options) {\r\n          return options.useExtendedSearch;\r\n        },\r\n      },\r\n    ]\r\n  );\r\n\r\n  return ExtendedSearch;\r\n})();\r\n\r\nvar registeredSearchers = [];\r\nfunction register() {\r\n  registeredSearchers.push.apply(registeredSearchers, arguments);\r\n}\r\nfunction createSearcher(pattern, options) {\r\n  for (var i = 0, len = registeredSearchers.length; i < len; i += 1) {\r\n    var searcherClass = registeredSearchers[i];\r\n\r\n    if (searcherClass.condition(pattern, options)) {\r\n      return new searcherClass(pattern, options);\r\n    }\r\n  }\r\n\r\n  return new BitapSearch(pattern, options);\r\n}\r\n\r\nvar LogicalOperator = {\r\n  AND: '$and',\r\n  OR: '$or',\r\n};\r\nvar KeyType = {\r\n  PATH: '$path',\r\n  PATTERN: '$val',\r\n};\r\n\r\nvar isExpression = function isExpression(query) {\r\n  return !!(query[LogicalOperator.AND] || query[LogicalOperator.OR]);\r\n};\r\n\r\nvar isPath = function isPath(query) {\r\n  return !!query[KeyType.PATH];\r\n};\r\n\r\nvar isLeaf = function isLeaf(query) {\r\n  return !isArray(query) && isObject(query) && !isExpression(query);\r\n};\r\n\r\nvar convertToExplicit = function convertToExplicit(query) {\r\n  return _defineProperty(\r\n    {},\r\n    LogicalOperator.AND,\r\n    Object.keys(query).map(function (key) {\r\n      return _defineProperty({}, key, query[key]);\r\n    })\r\n  );\r\n}; // When `auto` is `true`, the parse function will infer and initialize and add\r\n// the appropriate `Searcher` instance\r\n\r\nfunction parse(query, options) {\r\n  var _ref3 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\r\n    _ref3$auto = _ref3.auto,\r\n    auto = _ref3$auto === void 0 ? true : _ref3$auto;\r\n\r\n  var next = function next(query) {\r\n    var keys = Object.keys(query);\r\n    var isQueryPath = isPath(query);\r\n\r\n    if (!isQueryPath && keys.length > 1 && !isExpression(query)) {\r\n      return next(convertToExplicit(query));\r\n    }\r\n\r\n    if (isLeaf(query)) {\r\n      var key = isQueryPath ? query[KeyType.PATH] : keys[0];\r\n      var pattern = isQueryPath ? query[KeyType.PATTERN] : query[key];\r\n\r\n      if (!isString(pattern)) {\r\n        throw new Error(LOGICAL_SEARCH_INVALID_QUERY_FOR_KEY(key));\r\n      }\r\n\r\n      var obj = {\r\n        keyId: createKeyId(key),\r\n        pattern: pattern,\r\n      };\r\n\r\n      if (auto) {\r\n        obj.searcher = createSearcher(pattern, options);\r\n      }\r\n\r\n      return obj;\r\n    }\r\n\r\n    var node = {\r\n      children: [],\r\n      operator: keys[0],\r\n    };\r\n    keys.forEach(function (key) {\r\n      var value = query[key];\r\n\r\n      if (isArray(value)) {\r\n        value.forEach(function (item) {\r\n          node.children.push(next(item));\r\n        });\r\n      }\r\n    });\r\n    return node;\r\n  };\r\n\r\n  if (!isExpression(query)) {\r\n    query = convertToExplicit(query);\r\n  }\r\n\r\n  return next(query);\r\n}\r\n\r\nfunction computeScore(results, _ref) {\r\n  var _ref$ignoreFieldNorm = _ref.ignoreFieldNorm,\r\n    ignoreFieldNorm =\r\n      _ref$ignoreFieldNorm === void 0 ? Config.ignoreFieldNorm : _ref$ignoreFieldNorm;\r\n  results.forEach(function (result) {\r\n    var totalScore = 1;\r\n    result.matches.forEach(function (_ref2) {\r\n      var key = _ref2.key,\r\n        norm = _ref2.norm,\r\n        score = _ref2.score;\r\n      var weight = key ? key.weight : null;\r\n      totalScore *= Math.pow(\r\n        score === 0 && weight ? Number.EPSILON : score,\r\n        (weight || 1) * (ignoreFieldNorm ? 1 : norm)\r\n      );\r\n    });\r\n    result.score = totalScore;\r\n  });\r\n}\r\n\r\nfunction transformMatches(result, data) {\r\n  var matches = result.matches;\r\n  data.matches = [];\r\n\r\n  if (!isDefined(matches)) {\r\n    return;\r\n  }\r\n\r\n  matches.forEach(function (match) {\r\n    if (!isDefined(match.indices) || !match.indices.length) {\r\n      return;\r\n    }\r\n\r\n    var indices = match.indices,\r\n      value = match.value;\r\n    var obj = {\r\n      indices: indices,\r\n      value: value,\r\n    };\r\n\r\n    if (match.key) {\r\n      obj.key = match.key.src;\r\n    }\r\n\r\n    if (match.idx > -1) {\r\n      obj.refIndex = match.idx;\r\n    }\r\n\r\n    data.matches.push(obj);\r\n  });\r\n}\r\n\r\nfunction transformScore(result, data) {\r\n  data.score = result.score;\r\n}\r\n\r\nfunction format(results, docs) {\r\n  var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\r\n    _ref$includeMatches = _ref.includeMatches,\r\n    includeMatches = _ref$includeMatches === void 0 ? Config.includeMatches : _ref$includeMatches,\r\n    _ref$includeScore = _ref.includeScore,\r\n    includeScore = _ref$includeScore === void 0 ? Config.includeScore : _ref$includeScore;\r\n\r\n  var transformers = [];\r\n  if (includeMatches) transformers.push(transformMatches);\r\n  if (includeScore) transformers.push(transformScore);\r\n  return results.map(function (result) {\r\n    var idx = result.idx;\r\n    var data = {\r\n      item: docs[idx],\r\n      refIndex: idx,\r\n    };\r\n\r\n    if (transformers.length) {\r\n      transformers.forEach(function (transformer) {\r\n        transformer(result, data);\r\n      });\r\n    }\r\n\r\n    return data;\r\n  });\r\n}\r\n\r\nvar Fuse$1 = /*#__PURE__*/ (function () {\r\n  function Fuse(docs) {\r\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\r\n    var index = arguments.length > 2 ? arguments[2] : undefined;\r\n\r\n    _classCallCheck(this, Fuse);\r\n\r\n    this.options = _objectSpread2(_objectSpread2({}, Config), options);\r\n\r\n    if (this.options.useExtendedSearch && !true) {\r\n      throw new Error(EXTENDED_SEARCH_UNAVAILABLE);\r\n    }\r\n\r\n    this._keyStore = new KeyStore(this.options.keys);\r\n    this.setCollection(docs, index);\r\n  }\r\n\r\n  _createClass(Fuse, [\r\n    {\r\n      key: 'setCollection',\r\n      value: function setCollection(docs, index) {\r\n        this._docs = docs;\r\n\r\n        if (index && !(index instanceof FuseIndex)) {\r\n          throw new Error(INCORRECT_INDEX_TYPE);\r\n        }\r\n\r\n        this._myIndex =\r\n          index ||\r\n          createIndex(this.options.keys, this._docs, {\r\n            getFn: this.options.getFn,\r\n            fieldNormWeight: this.options.fieldNormWeight,\r\n          });\r\n      },\r\n    },\r\n    {\r\n      key: 'add',\r\n      value: function add(doc) {\r\n        if (!isDefined(doc)) {\r\n          return;\r\n        }\r\n\r\n        this._docs.push(doc);\r\n\r\n        this._myIndex.add(doc);\r\n      },\r\n    },\r\n    {\r\n      key: 'remove',\r\n      value: function remove() {\r\n        var predicate =\r\n          arguments.length > 0 && arguments[0] !== undefined\r\n            ? arguments[0]\r\n            : function () /* doc, idx */\r\n              {\r\n                return false;\r\n              };\r\n        var results = [];\r\n\r\n        for (var i = 0, len = this._docs.length; i < len; i += 1) {\r\n          var doc = this._docs[i];\r\n\r\n          if (predicate(doc, i)) {\r\n            this.removeAt(i);\r\n            i -= 1;\r\n            len -= 1;\r\n            results.push(doc);\r\n          }\r\n        }\r\n\r\n        return results;\r\n      },\r\n    },\r\n    {\r\n      key: 'removeAt',\r\n      value: function removeAt(idx) {\r\n        this._docs.splice(idx, 1);\r\n\r\n        this._myIndex.removeAt(idx);\r\n      },\r\n    },\r\n    {\r\n      key: 'getIndex',\r\n      value: function getIndex() {\r\n        return this._myIndex;\r\n      },\r\n    },\r\n    {\r\n      key: 'search',\r\n      value: function search(query) {\r\n        var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\r\n          _ref$limit = _ref.limit,\r\n          limit = _ref$limit === void 0 ? -1 : _ref$limit;\r\n\r\n        var _this$options = this.options,\r\n          includeMatches = _this$options.includeMatches,\r\n          includeScore = _this$options.includeScore,\r\n          shouldSort = _this$options.shouldSort,\r\n          sortFn = _this$options.sortFn,\r\n          ignoreFieldNorm = _this$options.ignoreFieldNorm;\r\n        var results = isString(query)\r\n          ? isString(this._docs[0])\r\n            ? this._searchStringList(query)\r\n            : this._searchObjectList(query)\r\n          : this._searchLogical(query);\r\n        computeScore(results, {\r\n          ignoreFieldNorm: ignoreFieldNorm,\r\n        });\r\n\r\n        if (shouldSort) {\r\n          results.sort(sortFn);\r\n        }\r\n\r\n        if (isNumber(limit) && limit > -1) {\r\n          results = results.slice(0, limit);\r\n        }\r\n\r\n        return format(results, this._docs, {\r\n          includeMatches: includeMatches,\r\n          includeScore: includeScore,\r\n        });\r\n      },\r\n    },\r\n    {\r\n      key: '_searchStringList',\r\n      value: function _searchStringList(query) {\r\n        var searcher = createSearcher(query, this.options);\r\n        var records = this._myIndex.records;\r\n        var results = []; // Iterate over every string in the index\r\n\r\n        records.forEach(function (_ref2) {\r\n          var text = _ref2.v,\r\n            idx = _ref2.i,\r\n            norm = _ref2.n;\r\n\r\n          if (!isDefined(text)) {\r\n            return;\r\n          }\r\n\r\n          var _searcher$searchIn = searcher.searchIn(text),\r\n            isMatch = _searcher$searchIn.isMatch,\r\n            score = _searcher$searchIn.score,\r\n            indices = _searcher$searchIn.indices;\r\n\r\n          if (isMatch) {\r\n            results.push({\r\n              item: text,\r\n              idx: idx,\r\n              matches: [\r\n                {\r\n                  score: score,\r\n                  value: text,\r\n                  norm: norm,\r\n                  indices: indices,\r\n                },\r\n              ],\r\n            });\r\n          }\r\n        });\r\n        return results;\r\n      },\r\n    },\r\n    {\r\n      key: '_searchLogical',\r\n      value: function _searchLogical(query) {\r\n        var _this = this;\r\n\r\n        var expression = parse(query, this.options);\r\n\r\n        var evaluate = function evaluate(node, item, idx) {\r\n          if (!node.children) {\r\n            var keyId = node.keyId,\r\n              searcher = node.searcher;\r\n\r\n            var matches = _this._findMatches({\r\n              key: _this._keyStore.get(keyId),\r\n              value: _this._myIndex.getValueForItemAtKeyId(item, keyId),\r\n              searcher: searcher,\r\n            });\r\n\r\n            if (matches && matches.length) {\r\n              return [\r\n                {\r\n                  idx: idx,\r\n                  item: item,\r\n                  matches: matches,\r\n                },\r\n              ];\r\n            }\r\n\r\n            return [];\r\n          }\r\n\r\n          var res = [];\r\n\r\n          for (var i = 0, len = node.children.length; i < len; i += 1) {\r\n            var child = node.children[i];\r\n            var result = evaluate(child, item, idx);\r\n\r\n            if (result.length) {\r\n              res.push.apply(res, _toConsumableArray(result));\r\n            } else if (node.operator === LogicalOperator.AND) {\r\n              return [];\r\n            }\r\n          }\r\n\r\n          return res;\r\n        };\r\n\r\n        var records = this._myIndex.records;\r\n        var resultMap = {};\r\n        var results = [];\r\n        records.forEach(function (_ref3) {\r\n          var item = _ref3.$,\r\n            idx = _ref3.i;\r\n\r\n          if (isDefined(item)) {\r\n            var expResults = evaluate(expression, item, idx);\r\n\r\n            if (expResults.length) {\r\n              // Dedupe when adding\r\n              if (!resultMap[idx]) {\r\n                resultMap[idx] = {\r\n                  idx: idx,\r\n                  item: item,\r\n                  matches: [],\r\n                };\r\n                results.push(resultMap[idx]);\r\n              }\r\n\r\n              expResults.forEach(function (_ref4) {\r\n                var _resultMap$idx$matche;\r\n\r\n                var matches = _ref4.matches;\r\n\r\n                (_resultMap$idx$matche = resultMap[idx].matches).push.apply(\r\n                  _resultMap$idx$matche,\r\n                  _toConsumableArray(matches)\r\n                );\r\n              });\r\n            }\r\n          }\r\n        });\r\n        return results;\r\n      },\r\n    },\r\n    {\r\n      key: '_searchObjectList',\r\n      value: function _searchObjectList(query) {\r\n        var _this2 = this;\r\n\r\n        var searcher = createSearcher(query, this.options);\r\n        var _this$_myIndex = this._myIndex,\r\n          keys = _this$_myIndex.keys,\r\n          records = _this$_myIndex.records;\r\n        var results = []; // List is Array<Object>\r\n\r\n        records.forEach(function (_ref5) {\r\n          var item = _ref5.$,\r\n            idx = _ref5.i;\r\n\r\n          if (!isDefined(item)) {\r\n            return;\r\n          }\r\n\r\n          var matches = []; // Iterate over every key (i.e, path), and fetch the value at that key\r\n\r\n          keys.forEach(function (key, keyIndex) {\r\n            matches.push.apply(\r\n              matches,\r\n              _toConsumableArray(\r\n                _this2._findMatches({\r\n                  key: key,\r\n                  value: item[keyIndex],\r\n                  searcher: searcher,\r\n                })\r\n              )\r\n            );\r\n          });\r\n\r\n          if (matches.length) {\r\n            results.push({\r\n              idx: idx,\r\n              item: item,\r\n              matches: matches,\r\n            });\r\n          }\r\n        });\r\n        return results;\r\n      },\r\n    },\r\n    {\r\n      key: '_findMatches',\r\n      value: function _findMatches(_ref6) {\r\n        var key = _ref6.key,\r\n          value = _ref6.value,\r\n          searcher = _ref6.searcher;\r\n\r\n        if (!isDefined(value)) {\r\n          return [];\r\n        }\r\n\r\n        var matches = [];\r\n\r\n        if (isArray(value)) {\r\n          value.forEach(function (_ref7) {\r\n            var text = _ref7.v,\r\n              idx = _ref7.i,\r\n              norm = _ref7.n;\r\n\r\n            if (!isDefined(text)) {\r\n              return;\r\n            }\r\n\r\n            var _searcher$searchIn2 = searcher.searchIn(text),\r\n              isMatch = _searcher$searchIn2.isMatch,\r\n              score = _searcher$searchIn2.score,\r\n              indices = _searcher$searchIn2.indices;\r\n\r\n            if (isMatch) {\r\n              matches.push({\r\n                score: score,\r\n                key: key,\r\n                value: text,\r\n                idx: idx,\r\n                norm: norm,\r\n                indices: indices,\r\n              });\r\n            }\r\n          });\r\n        } else {\r\n          var text = value.v,\r\n            norm = value.n;\r\n\r\n          var _searcher$searchIn3 = searcher.searchIn(text),\r\n            isMatch = _searcher$searchIn3.isMatch,\r\n            score = _searcher$searchIn3.score,\r\n            indices = _searcher$searchIn3.indices;\r\n\r\n          if (isMatch) {\r\n            matches.push({\r\n              score: score,\r\n              key: key,\r\n              value: text,\r\n              norm: norm,\r\n              indices: indices,\r\n            });\r\n          }\r\n        }\r\n\r\n        return matches;\r\n      },\r\n    },\r\n  ]);\r\n\r\n  return Fuse;\r\n})();\r\n\r\nFuse$1.version = '6.5.3';\r\nFuse$1.createIndex = createIndex;\r\nFuse$1.parseIndex = parseIndex;\r\nFuse$1.config = Config;\r\n\r\n{\r\n  Fuse$1.parseQuery = parse;\r\n}\r\n\r\n{\r\n  register(ExtendedSearch);\r\n}\r\n\r\nexport var Fuse = Fuse$1;\r\n","import { TVA_CONFIG, updateSettings } from '../scripts/settings.js';\r\nimport { SEARCH_TYPE, decodeURISafely } from '../scripts/utils.js';\r\nimport { insertArtSelectButton } from './artSelect.js';\r\n\r\nexport default class UserList extends FormApplication {\r\n  constructor(object, img, regenStyle) {\r\n    super({}, {});\r\n    this.object = object;\r\n    this.img = img;\r\n    this.regenStyle = regenStyle;\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-user-list',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/userList.html',\r\n      resizable: false,\r\n      minimizable: false,\r\n      title: 'User To Image',\r\n      width: 300,\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n    const mappings = this.object.document.getFlag('token-variants', 'userMappings') || {};\r\n    let users = [];\r\n    game.users.forEach((user) => {\r\n      users.push({\r\n        avatar: user.avatar,\r\n        name: user.name,\r\n        apply: user.id in mappings && mappings[user.id] === this.img,\r\n        userId: user.id,\r\n        color: user.color,\r\n      });\r\n    });\r\n    data.users = users;\r\n    data.invisibleImage = TVA_CONFIG.invisibleImage;\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n    insertArtSelectButton(html, 'invisibleImage', {\r\n      search: 'Invisible Image',\r\n      searchType: SEARCH_TYPE.TOKEN,\r\n    });\r\n  }\r\n\r\n  async _updateObject(event, formData) {\r\n    const mappings = this.object.document.getFlag('token-variants', 'userMappings') || {};\r\n\r\n    if (formData.invisibleImage !== TVA_CONFIG.invisibleImage) {\r\n      updateSettings({ invisibleImage: decodeURISafely(formData.invisibleImage) });\r\n    }\r\n    delete formData.invisibleImage;\r\n\r\n    const affectedImages = [this.img];\r\n\r\n    for (const [userId, apply] of Object.entries(formData)) {\r\n      if (apply) {\r\n        if (mappings[userId] && mappings[userId] !== this.img)\r\n          affectedImages.push(mappings[userId]);\r\n        mappings[userId] = this.img;\r\n      } else if (mappings[userId] === this.img) {\r\n        delete mappings[userId];\r\n        mappings['-=' + userId] = null;\r\n      }\r\n    }\r\n\r\n    if (Object.keys(mappings).filter((userId) => !userId.startsWith('-=')).length === 0) {\r\n      await this.object.document.unsetFlag('token-variants', 'userMappings');\r\n    } else {\r\n      await this.object.document.setFlag('token-variants', 'userMappings', mappings);\r\n    }\r\n\r\n    for (const img of affectedImages) {\r\n      this.regenStyle(this.object, img);\r\n    }\r\n  }\r\n}\r\n","import {\r\n  getFileName,\r\n  isImage,\r\n  isVideo,\r\n  SEARCH_TYPE,\r\n  keyPressed,\r\n  updateActorImage,\r\n  updateTokenImage,\r\n  decodeURISafely,\r\n} from '../scripts/utils.js';\r\nimport TokenCustomConfig from './tokenCustomConfig.js';\r\nimport EffectMappingForm from './effectMappingForm.js';\r\nimport { TVA_CONFIG } from '../scripts/settings.js';\r\nimport UserList from './userList.js';\r\nimport FlagsConfig from './flagsConfig.js';\r\nimport RandomizerConfig from './randomizerConfig.js';\r\nimport { doImageSearch, findImagesFuzzy } from '../scripts/search.js';\r\n\r\nexport const TOKEN_HUD_VARIANTS = { variants: null, actor: null };\r\n\r\nexport async function renderTokenHUD(hud, html, token, searchText = '', fp_files = null) {\r\n  activateStatusEffectListeners(token);\r\n\r\n  const hudSettings = TVA_CONFIG.hud;\r\n  const FULL_ACCESS = TVA_CONFIG.permissions.hudFullAccess[game.user.role];\r\n  const PARTIAL_ACCESS = TVA_CONFIG.permissions.hud[game.user.role];\r\n\r\n  // Check if the HUD button should be displayed\r\n  if (\r\n    !hudSettings.enableSideMenu ||\r\n    (!PARTIAL_ACCESS && !FULL_ACCESS) ||\r\n    token.flags['token-variants']?.disableHUDButton\r\n  )\r\n    return;\r\n\r\n  const tokenActor = game.actors.get(token.actorId);\r\n\r\n  // Disable button if Token HUD Wildcard is enabled and appropriate setting is set\r\n  if (TVA_CONFIG.worldHud.disableIfTHWEnabled && game.modules.get('token-hud-wildcard')?.active) {\r\n    if (tokenActor && tokenActor.prototypeToken.randomImg) return;\r\n  }\r\n\r\n  const button = $(`\r\n  <div class=\"control-icon\" data-action=\"token-variants-side-selector\">\r\n    <img\r\n      id=\"token-variants-side-button\"\r\n      src=\"modules/token-variants/img/token-images.svg\"\r\n      width=\"36\"\r\n      height=\"36\"\r\n      title=\"Left-click: Image Menu&#013;Right-click: Search & Additional settings\"\r\n    />\r\n  </div>\r\n`);\r\n\r\n  html.find('div.right').last().append(button);\r\n  html.find('div.right').click(_deactivateTokenVariantsSideSelector);\r\n\r\n  button.click((event) => _onButtonClick(event, token));\r\n  if (FULL_ACCESS) {\r\n    button.contextmenu((event) => _onButtonRightClick(event, hud, html, token));\r\n  }\r\n}\r\n\r\nasync function _onButtonClick(event, token) {\r\n  const button = $(event.target).closest('.control-icon');\r\n\r\n  // De-activate 'Status Effects'\r\n  button.closest('div.right').find('div.control-icon.effects').removeClass('active');\r\n  button.closest('div.right').find('.status-effects').removeClass('active');\r\n\r\n  // Remove contextmenu\r\n  button.find('.contextmenu').remove();\r\n\r\n  // Toggle variants side menu\r\n  button.toggleClass('active');\r\n  let variantsWrap = button.find('.token-variants-wrap');\r\n  if (button.hasClass('active')) {\r\n    if (!variantsWrap.length) {\r\n      variantsWrap = await renderSideSelect(token);\r\n      if (variantsWrap) button.find('img').after(variantsWrap);\r\n      else return;\r\n    }\r\n    variantsWrap.addClass('active');\r\n  } else {\r\n    variantsWrap.removeClass('active');\r\n  }\r\n}\r\n\r\nfunction _onButtonRightClick(event, hud, html, token) {\r\n  // Display side menu if button is not active yet\r\n  const button = $(event.target).closest('.control-icon');\r\n  if (!button.hasClass('active')) {\r\n    // button.trigger('click');\r\n    button.addClass('active');\r\n  }\r\n\r\n  if (button.find('.contextmenu').length) {\r\n    // Contextmenu already displayed. Remove and activate images\r\n    button.find('.contextmenu').remove();\r\n    button.removeClass('active').trigger('click');\r\n    //button.find('.token-variants-wrap.images').addClass('active');\r\n  } else {\r\n    // Contextmenu is not displayed. Hide images, create it and add it\r\n    button.find('.token-variants-wrap.images').removeClass('active');\r\n    const contextMenu = $(`\r\n    <div class=\"token-variants-wrap contextmenu active\">\r\n      <div class=\"token-variants-context-menu active\">\r\n        <input class=\"token-variants-side-search\" type=\"text\" />\r\n        <button class=\"flags\" type=\"button\"><i class=\"fab fa-font-awesome-flag\"></i><label>Flags</label></button>\r\n        <button class=\"file-picker\" type=\"button\"><i class=\"fas fa-file-import fa-fw\"></i><label>Browse Folders</label></button>\r\n        <button class=\"effectConfig\" type=\"button\"><i class=\"fas fa-sun\"></i><label>Mappings</label></button>\r\n        <button class=\"randomizerConfig\" type=\"button\"><i class=\"fas fa-dice\"></i><label>Randomizer</label></button>\r\n      </div>\r\n    </div>\r\n      `);\r\n    button.append(contextMenu);\r\n\r\n    // Register contextmenu listeners\r\n    contextMenu\r\n      .find('.token-variants-side-search')\r\n      .on('keyup', (event) => _onImageSearchKeyUp(event, token))\r\n      .on('click', (event) => {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n      });\r\n    contextMenu.find('.flags').click((event) => {\r\n      const tkn = canvas.tokens.get(token._id);\r\n      if (tkn) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        new FlagsConfig(tkn).render(true);\r\n      }\r\n    });\r\n    contextMenu.find('.file-picker').click(async (event) => {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      new FilePicker({\r\n        type: 'imagevideo',\r\n        callback: async (path, fp) => {\r\n          const content = await FilePicker.browse(fp.activeSource, fp.result.target);\r\n          let files = content.files.filter((f) => isImage(f) || isVideo(f));\r\n          if (files.length) {\r\n            button.find('.token-variants-wrap').remove();\r\n            const sideSelect = await renderSideSelect(token, '', files);\r\n            if (sideSelect) {\r\n              sideSelect.addClass('active');\r\n              button.append(sideSelect);\r\n            }\r\n          }\r\n        },\r\n      }).render(true);\r\n    });\r\n    contextMenu.find('.effectConfig').click((event) => {\r\n      new EffectMappingForm(token).render(true);\r\n    });\r\n    contextMenu.find('.randomizerConfig').click((event) => {\r\n      new RandomizerConfig(token).render(true);\r\n    });\r\n  }\r\n}\r\n\r\nfunction _deactivateTokenVariantsSideSelector(event) {\r\n  const controlIcon = $(event.target).closest('.control-icon');\r\n  const dataAction = controlIcon.attr('data-action');\r\n\r\n  switch (dataAction) {\r\n    case 'effects':\r\n      break; // Effects button\r\n    case 'thwildcard-selector':\r\n      break; // Token HUD Wildcard module button\r\n    default:\r\n      return;\r\n  }\r\n\r\n  $(event.target)\r\n    .closest('div.right')\r\n    .find('.control-icon[data-action=\"token-variants-side-selector\"]')\r\n    .removeClass('active');\r\n  $(event.target).closest('div.right').find('.token-variants-wrap').removeClass('active');\r\n}\r\n\r\nasync function renderSideSelect(token, searchText = '', fp_files = null) {\r\n  const hudSettings = TVA_CONFIG.hud;\r\n  const worldHudSettings = TVA_CONFIG.worldHud;\r\n  const FULL_ACCESS = TVA_CONFIG.permissions.hudFullAccess[game.user.role];\r\n  const PARTIAL_ACCESS = TVA_CONFIG.permissions.hud[game.user.role];\r\n\r\n  const tokenActor = game.actors.get(token.actorId);\r\n\r\n  let images = [];\r\n  let actorVariants = [];\r\n  let imageDuplicates = new Set();\r\n  const pushImage = (img) => {\r\n    if (imageDuplicates.has(img.path)) {\r\n      if (!images.find((obj) => obj.path === img.path && obj.name === img.name)) {\r\n        images.push(img);\r\n      }\r\n    } else {\r\n      images.push(img);\r\n      imageDuplicates.add(img.path);\r\n    }\r\n  };\r\n\r\n  actorVariants = getVariants(tokenActor);\r\n\r\n  if (!fp_files) {\r\n    if (!searchText) {\r\n      // Insert current token image\r\n      if (token.texture?.src && token.texture?.src !== CONST.DEFAULT_TOKEN) {\r\n        pushImage({\r\n          path: decodeURISafely(token.texture.src),\r\n          name: token.flags?.['token-variants']?.name ?? getFileName(token.texture.src),\r\n        });\r\n      }\r\n\r\n      if (tokenActor) {\r\n        // Insert default token image\r\n        const defaultImg =\r\n          tokenActor.prototypeToken?.flags['token-variants']?.['randomImgDefault'] ||\r\n          tokenActor.prototypeToken?.flags['token-hud-wildcard']?.['default'] ||\r\n          '';\r\n        if (defaultImg) {\r\n          pushImage({ path: decodeURISafely(defaultImg), name: getFileName(defaultImg) });\r\n        }\r\n\r\n        if (FULL_ACCESS || PARTIAL_ACCESS) {\r\n          actorVariants.forEach((variant) => {\r\n            for (const name of variant.names) {\r\n              pushImage({ path: decodeURISafely(variant.imgSrc), name: name });\r\n            }\r\n          });\r\n        }\r\n\r\n        // Parse directory flag and include the images\r\n        if (FULL_ACCESS || PARTIAL_ACCESS) {\r\n          const directoryFlag = tokenActor.getFlag('token-variants', 'directory');\r\n          if (directoryFlag) {\r\n            let dirFlagImages;\r\n            try {\r\n              let path = directoryFlag.path;\r\n              let source = directoryFlag.source;\r\n              let bucket = '';\r\n              if (source.startsWith('s3:')) {\r\n                bucket = source.substring(3, source.length);\r\n                source = 's3';\r\n              }\r\n              const content = await FilePicker.browse(source, path, {\r\n                type: 'imagevideo',\r\n                bucket,\r\n              });\r\n              dirFlagImages = content.files;\r\n            } catch (err) {\r\n              dirFlagImages = [];\r\n            }\r\n            dirFlagImages = dirFlagImages.forEach((f) => {\r\n              if (isImage(f) || isVideo(f)) pushImage({ path: decodeURISafely(f), name: getFileName(f) });\r\n            });\r\n          }\r\n        }\r\n\r\n        if (\r\n          (FULL_ACCESS || PARTIAL_ACCESS) &&\r\n          worldHudSettings.includeWildcard &&\r\n          !worldHudSettings.displayOnlySharedImages\r\n        ) {\r\n          // Merge wildcard images\r\n          const protoImg = tokenActor.prototypeToken.texture.src;\r\n          if (tokenActor.prototypeToken.randomImg) {\r\n            (await tokenActor.getTokenImages())\r\n              .filter((img) => !img.includes('*'))\r\n              .forEach((img) => {\r\n                pushImage({ path: decodeURISafely(img), name: getFileName(img) });\r\n              });\r\n          } else if (protoImg.includes('*') || protoImg.includes('{') || protoImg.includes('}')) {\r\n            // Modified version of Actor.getTokenImages()\r\n            const getTokenImages = async () => {\r\n              if (tokenActor._tokenImages) return tokenActor._tokenImages;\r\n\r\n              let source = 'data';\r\n              let pattern = tokenActor.prototypeToken.texture.src;\r\n              const browseOptions = { wildcard: true };\r\n\r\n              // Support non-user sources\r\n              if (/\\.s3\\./.test(pattern)) {\r\n                source = 's3';\r\n                const { bucket, keyPrefix } = FilePicker.parseS3URL(pattern);\r\n                if (bucket) {\r\n                  browseOptions.bucket = bucket;\r\n                  pattern = keyPrefix;\r\n                }\r\n              } else if (pattern.startsWith('icons/')) source = 'public';\r\n\r\n              // Retrieve wildcard content\r\n              try {\r\n                const content = await FilePicker.browse(source, pattern, browseOptions);\r\n                tokenActor._tokenImages = content.files;\r\n              } catch (err) {\r\n                tokenActor._tokenImages = [];\r\n              }\r\n              return tokenActor._tokenImages;\r\n            };\r\n\r\n            (await getTokenImages())\r\n              .filter((img) => !img.includes('*') && (isImage(img) || isVideo(img)))\r\n              .forEach((variant) => {\r\n                pushImage({ path: decodeURISafely(variant), name: getFileName(variant) });\r\n              });\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // Perform image search if needed\r\n    if (FULL_ACCESS) {\r\n      let search;\r\n      if (searchText) {\r\n        search = searchText.length > 2 ? searchText : null;\r\n      } else {\r\n        if (worldHudSettings.displayOnlySharedImages || tokenActor?.getFlag('token-variants', 'disableNameSearch')) {\r\n          // No search\r\n        } else if (token.name.length > 2) {\r\n          search = token.name;\r\n        }\r\n      }\r\n\r\n      if (search) {\r\n        let artSearch = await doImageSearch(search, {\r\n          searchType: SEARCH_TYPE.TOKEN,\r\n          searchOptions: { keywordSearch: worldHudSettings.includeKeywords },\r\n        });\r\n\r\n        // Merge full search, and keywords into a single array\r\n        if (artSearch) {\r\n          artSearch.forEach((results) => {\r\n            results.forEach((img) => pushImage(img));\r\n          });\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    images = fp_files.map((f) => {\r\n      return { path: decodeURISafely(f), name: getFileName(f) };\r\n    });\r\n  }\r\n\r\n  // Retrieving the possibly custom name attached as a flag to the token\r\n  let tokenImageName = '';\r\n  if (token.flags['token-variants'] && token.flags['token-variants']['name']) {\r\n    tokenImageName = token.flags['token-variants']['name'];\r\n  } else {\r\n    tokenImageName = getFileName(token.texture.src);\r\n  }\r\n\r\n  let imagesParsed = [];\r\n  const tokenConfigs = (TVA_CONFIG.tokenConfigs || []).flat();\r\n  const tkn = canvas.tokens.get(token._id);\r\n  const userMappings = tkn.document.getFlag('token-variants', 'userMappings') || {};\r\n\r\n  for (const imageObj of images) {\r\n    const img = isImage(imageObj.path);\r\n    const vid = isVideo(imageObj.path);\r\n\r\n    const hasConfig = Boolean(\r\n      tokenConfigs.find((config) => config.tvImgSrc === imageObj.path && config.tvImgName === imageObj.name)\r\n    );\r\n    let shared = false;\r\n    if (TVA_CONFIG.permissions.hudFullAccess[game.user.role]) {\r\n      actorVariants.forEach((variant) => {\r\n        if (variant.imgSrc === imageObj.path && variant.names.includes(imageObj.name)) {\r\n          shared = true;\r\n        }\r\n      });\r\n    }\r\n\r\n    const [title, style] = genTitleAndStyle(userMappings, imageObj.path, imageObj.name);\r\n\r\n    imagesParsed.push({\r\n      route: imageObj.path,\r\n      name: imageObj.name,\r\n      used: imageObj.path === token.texture.src && imageObj.name === tokenImageName,\r\n      img,\r\n      vid,\r\n      unknownType: !img && !vid,\r\n      shared: shared,\r\n      hasConfig: hasConfig,\r\n      title: title,\r\n      style: game.user.isGM && style ? 'box-shadow: ' + style + ';' : null,\r\n    });\r\n  }\r\n\r\n  //\r\n  // Render\r\n  //\r\n  const imageDisplay = hudSettings.displayAsImage;\r\n  const imageOpacity = hudSettings.imageOpacity / 100;\r\n\r\n  const sideSelect = $(\r\n    await renderTemplate('modules/token-variants/templates/sideSelect.html', {\r\n      imagesParsed,\r\n      imageDisplay,\r\n      imageOpacity,\r\n      tokenHud: true,\r\n    })\r\n  );\r\n\r\n  // Activate listeners\r\n  sideSelect.find('video').hover(\r\n    function () {\r\n      if (TVA_CONFIG.playVideoOnHover) {\r\n        this.play();\r\n        $(this).siblings('.fa-play').hide();\r\n      }\r\n    },\r\n    function () {\r\n      if (TVA_CONFIG.pauseVideoOnHoverOut) {\r\n        this.pause();\r\n        this.currentTime = 0;\r\n        $(this).siblings('.fa-play').show();\r\n      }\r\n    }\r\n  );\r\n  sideSelect.find('.token-variants-button-select').click((event) => _onImageClick(event, token._id));\r\n\r\n  if (FULL_ACCESS) {\r\n    sideSelect.find('.token-variants-button-select').on('contextmenu', (event) => _onImageRightClick(event, token._id));\r\n  }\r\n\r\n  return sideSelect;\r\n}\r\n\r\nasync function _onImageClick(event, tokenId) {\r\n  event.preventDefault();\r\n  event.stopPropagation();\r\n\r\n  const token = canvas.tokens.controlled.find((t) => t.document.id === tokenId);\r\n  if (!token) return;\r\n\r\n  const worldHudSettings = TVA_CONFIG.worldHud;\r\n\r\n  const imgButton = $(event.target).closest('.token-variants-button-select');\r\n  const imgSrc = imgButton.attr('data-name');\r\n  const name = imgButton.attr('data-filename');\r\n\r\n  if (!imgSrc || !name) return;\r\n\r\n  if (keyPressed('config') && game.user.isGM) {\r\n    const toggleCog = (saved) => {\r\n      const cog = imgButton.find('.fa-cog');\r\n      if (saved) {\r\n        cog.addClass('active');\r\n      } else {\r\n        cog.removeClass('active');\r\n      }\r\n    };\r\n    new TokenCustomConfig(token, {}, imgSrc, name, toggleCog).render(true);\r\n  } else if (token.document.texture.src === imgSrc) {\r\n    let tokenImageName = token.document.getFlag('token-variants', 'name');\r\n    if (!tokenImageName) tokenImageName = getFileName(token.document.texture.src);\r\n    if (tokenImageName !== name) {\r\n      await updateTokenImage(imgSrc, {\r\n        token: token,\r\n        imgName: name,\r\n        animate: worldHudSettings.animate,\r\n      });\r\n      if (token.actor && worldHudSettings.updateActorImage) {\r\n        if (worldHudSettings.useNameSimilarity) {\r\n          updateActorWithSimilarName(imgSrc, name, token.actor);\r\n        } else {\r\n          updateActorImage(token.actor, imgSrc, { imgName: name });\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    await updateTokenImage(imgSrc, {\r\n      token: token,\r\n      imgName: name,\r\n      animate: worldHudSettings.animate,\r\n    });\r\n    if (token.actor && worldHudSettings.updateActorImage) {\r\n      if (worldHudSettings.useNameSimilarity) {\r\n        updateActorWithSimilarName(imgSrc, name, token.actor);\r\n      } else {\r\n        updateActorImage(token.actor, imgSrc, { imgName: name });\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nasync function _onImageRightClick(event, tokenId) {\r\n  event.preventDefault();\r\n  event.stopPropagation();\r\n  let token = canvas.tokens.controlled.find((t) => t.document.id === tokenId);\r\n  if (!token) return;\r\n\r\n  const imgButton = $(event.target).closest('.token-variants-button-select');\r\n  const imgSrc = imgButton.attr('data-name');\r\n  const name = imgButton.attr('data-filename');\r\n\r\n  if (!imgSrc || !name) return;\r\n\r\n  if (keyPressed('config') && game.user.isGM) {\r\n    const regenStyle = (token, img) => {\r\n      const mappings = token.document.getFlag('token-variants', 'userMappings') || {};\r\n      const name = imgButton.attr('data-filename');\r\n      const [title, style] = genTitleAndStyle(mappings, img, name);\r\n      imgButton\r\n        .closest('.token-variants-wrap')\r\n        .find(`.token-variants-button-select[data-name='${img}']`)\r\n        .css('box-shadow', style)\r\n        .prop('title', title);\r\n    };\r\n    new UserList(token, imgSrc, regenStyle).render(true);\r\n  } else if (token.actor) {\r\n    let tokenActor = game.actors.get(token.actor.id);\r\n    let variants = getVariants(tokenActor);\r\n\r\n    // Remove selected variant if present in the flag, add otherwise\r\n    let del = false;\r\n    let updated = false;\r\n    for (let variant of variants) {\r\n      if (variant.imgSrc === imgSrc) {\r\n        let fNames = variant.names.filter((name) => name !== name);\r\n        if (fNames.length === 0) {\r\n          del = true;\r\n        } else if (fNames.length === variant.names.length) {\r\n          fNames.push(name);\r\n        }\r\n        variant.names = fNames;\r\n        updated = true;\r\n        break;\r\n      }\r\n    }\r\n    if (del) variants = variants.filter((variant) => variant.imgSrc !== imgSrc);\r\n    else if (!updated) variants.push({ imgSrc: imgSrc, names: [name] });\r\n\r\n    // Set shared variants as an actor flag\r\n    setVariants(tokenActor, variants);\r\n    imgButton.find('.fa-share').toggleClass('active'); // Display green arrow\r\n  }\r\n}\r\n\r\nasync function _onImageSearchKeyUp(event, token) {\r\n  event.preventDefault();\r\n  event.stopPropagation();\r\n  if (event.key === 'Enter' || event.keyCode === 13) {\r\n    if (event.target.value.length >= 3) {\r\n      const button = $(event.target).closest('.control-icon');\r\n      button.find('.token-variants-wrap').remove();\r\n      const sideSelect = await renderSideSelect(token, event.target.value);\r\n      if (sideSelect) {\r\n        sideSelect.addClass('active');\r\n        button.append(sideSelect);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction genTitleAndStyle(mappings, imgSrc, name) {\r\n  let title = TVA_CONFIG.worldHud.showFullPath ? imgSrc : name;\r\n  let style = '';\r\n  let offset = 2;\r\n  for (const [userId, img] of Object.entries(mappings)) {\r\n    if (img === imgSrc) {\r\n      const user = game.users.get(userId);\r\n      if (!user) continue;\r\n      if (style.length === 0) {\r\n        style = `inset 0 0 0 ${offset}px ${user.color}`;\r\n      } else {\r\n        style += `, inset 0 0 0 ${offset}px ${user.color}`;\r\n      }\r\n      offset += 2;\r\n      title += `\\nDisplayed to: ${user.name}`;\r\n    }\r\n  }\r\n  return [title, style];\r\n}\r\n\r\nasync function updateActorWithSimilarName(imgSrc, imgName, actor) {\r\n  const results = await findImagesFuzzy(\r\n    imgName,\r\n    SEARCH_TYPE.PORTRAIT,\r\n    {\r\n      algorithm: {\r\n        fuzzyThreshold: 0.4,\r\n        fuzzyLimit: 50,\r\n      },\r\n    },\r\n    true\r\n  );\r\n\r\n  if (results && results.length !== 0) {\r\n    updateActorImage(actor, results[0].path, { imgName: results[0].name });\r\n  } else {\r\n    updateActorImage(actor, imgSrc, { imgName: imgName });\r\n  }\r\n}\r\n\r\nfunction activateStatusEffectListeners(token) {\r\n  if (TVA_CONFIG.permissions.statusConfig[game.user.role] && token.actorId && game.actors.get(token.actorId)) {\r\n    $('.control-icon[data-action=\"effects\"]')\r\n      .find('img:first')\r\n      .click((event) => {\r\n        event.preventDefault();\r\n        if (keyPressed('config')) {\r\n          event.stopPropagation();\r\n          new EffectMappingForm(token).render(true);\r\n        }\r\n      });\r\n\r\n    $('.control-icon[data-action=\"visibility\"]')\r\n      .find('img')\r\n      .click((event) => {\r\n        event.preventDefault();\r\n        if (keyPressed('config')) {\r\n          event.stopPropagation();\r\n          new EffectMappingForm(token, {\r\n            createMapping: { label: 'In Combat', expression: 'token-variants-visibility' },\r\n          }).render(true);\r\n        }\r\n      });\r\n\r\n    $('.control-icon[data-action=\"combat\"]')\r\n      .find('img')\r\n      .click((event) => {\r\n        event.preventDefault();\r\n        if (keyPressed('config')) {\r\n          event.stopPropagation();\r\n          new EffectMappingForm(token, {\r\n            createMapping: { label: 'In Combat', expression: 'token-variants-combat' },\r\n          }).render(true);\r\n        }\r\n      });\r\n\r\n    $('.status-effects')\r\n      .find('img')\r\n      .click((event) => {\r\n        event.preventDefault();\r\n        if (keyPressed('config')) {\r\n          event.stopPropagation();\r\n\r\n          let effectName = event.target.getAttribute('title');\r\n          if (game.system.id === 'pf2e') {\r\n            effectName = $(event.target).closest('picture').attr('title');\r\n          }\r\n          new EffectMappingForm(token, {\r\n            createMapping: { label: effectName, expression: effectName },\r\n          }).render(true);\r\n        }\r\n      });\r\n  }\r\n}\r\n\r\nfunction getVariants(actor) {\r\n  if (TOKEN_HUD_VARIANTS.variants) return TOKEN_HUD_VARIANTS.variants;\r\n  else return actor?.getFlag('token-variants', 'variants') || [];\r\n}\r\n\r\nfunction setVariants(actor, variants) {\r\n  TOKEN_HUD_VARIANTS.variants = variants;\r\n  TOKEN_HUD_VARIANTS.actor = actor;\r\n}\r\n","import { showArtSelect } from '../token-variants.mjs';\r\nimport { SEARCH_TYPE, getFileName, isVideo, keyPressed, mergeMappings } from '../scripts/utils.js';\r\nimport TokenCustomConfig from './tokenCustomConfig.js';\r\nimport { TVA_CONFIG, getFlagMappings, migrateMappings, updateSettings } from '../scripts/settings.js';\r\nimport EditJsonConfig from './configJsonEdit.js';\r\nimport EditScriptConfig from './configScriptEdit.js';\r\nimport { OverlayConfig } from './overlayConfig.js';\r\nimport { showMappingSelectDialog, showOverlayJsonConfigDialog, showTokenCaptureDialog } from './dialogs.js';\r\nimport { DEFAULT_ACTIVE_EFFECT_CONFIG } from '../scripts/models.js';\r\nimport { updateWithEffectMapping } from '../scripts/hooks/effectMappingHooks.js';\r\nimport { drawOverlays } from '../scripts/token/overlay.js';\r\nimport { Templates } from './templates.js';\r\n\r\n// Persist group toggles across forms\r\nlet TOGGLED_GROUPS;\r\nconst NO_IMAGE = 'modules\\\\token-variants\\\\img\\\\empty.webp';\r\n\r\nexport default class EffectMappingForm extends FormApplication {\r\n  constructor(token, { globalMappings = false, callback = null, createMapping = null } = {}) {\r\n    super({}, { title: (globalMappings ? 'GLOBAL ' : 'ACTOR  ') + 'Mappings' });\r\n\r\n    this.token = token;\r\n    if (globalMappings) {\r\n      this.globalMappings = deepClone(TVA_CONFIG.globalMappings).filter(Boolean);\r\n    }\r\n    if (!globalMappings) this.objectToFlag = game.actors.get(token.actorId);\r\n    this.callback = callback;\r\n    TOGGLED_GROUPS = game.settings.get('token-variants', 'effectMappingToggleGroups') || {\r\n      Default: true,\r\n    };\r\n    this.createMapping = createMapping;\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-active-effect-config',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/effectMappingForm.html',\r\n      resizable: true,\r\n      minimizable: false,\r\n      closeOnSubmit: false,\r\n      width: 1020,\r\n      height: 'auto',\r\n      scrollY: ['ol.token-variant-table'],\r\n    });\r\n  }\r\n\r\n  _processConfig(mapping) {\r\n    if (!mapping.config) mapping.config = {};\r\n    let hasTokenConfig = Object.keys(mapping.config).filter((k) => mapping.config[k]).length;\r\n    if (mapping.config.flags) hasTokenConfig--;\r\n    if (mapping.config.tv_script) hasTokenConfig--;\r\n\r\n    return {\r\n      id: mapping.id || randomID(8),\r\n      label: mapping.label,\r\n      expression: mapping.expression,\r\n      codeExp: mapping.codeExp,\r\n      hasCodeExp: Boolean(mapping.codeExp),\r\n      highlightedExpression: highlightOperators(mapping.expression),\r\n      imgName: mapping.imgName,\r\n      imgSrc: mapping.imgSrc,\r\n      isVideo: mapping.imgSrc ? isVideo(mapping.imgSrc) : false,\r\n      priority: mapping.priority,\r\n      hasConfig: mapping.config ? !isEmpty(mapping.config) : false,\r\n      hasScript: mapping.config && mapping.config.tv_script,\r\n      hasTokenConfig: hasTokenConfig > 0,\r\n      config: mapping.config,\r\n      overlay: mapping.overlay,\r\n      alwaysOn: mapping.alwaysOn,\r\n      tokens: mapping.tokens,\r\n      tokensString: mapping.tokens?.join(',') ?? '',\r\n      tokenIDs: mapping.tokens?.length\r\n        ? 'Assigned Tokens\\n' + mapping.tokens.join('\\n') + '\\n\\n[CLICK TO UNASSIGN]'\r\n        : '',\r\n      disabled: mapping.disabled,\r\n      overlayConfig: mapping.overlayConfig,\r\n      targetActors: mapping.targetActors,\r\n      group: mapping.group,\r\n      parentID: mapping.overlayConfig?.parentID,\r\n    };\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n\r\n    data.NO_IMAGE = NO_IMAGE;\r\n\r\n    let mappings = [];\r\n    if (this.object.mappings) {\r\n      mappings = this.object.mappings.map(this._processConfig);\r\n    } else {\r\n      const effectMappings = this.globalMappings ?? getFlagMappings(this.objectToFlag);\r\n      mappings = effectMappings.map(this._processConfig);\r\n\r\n      if (this.createMapping && !effectMappings.find((m) => m.expression === this.createMapping.expression)) {\r\n        mappings.push(this._processConfig(this._getNewEffectConfig(this.createMapping)));\r\n      }\r\n      this.createMapping = null;\r\n    }\r\n\r\n    mappings = mappings.sort((m1, m2) => {\r\n      if (!m1.label && m2.label) return -1;\r\n      else if (m1.label && !m2.label) return 1;\r\n\r\n      if (!m1.overlayConfig?.parentID && m2.overlayConfig?.parentID) return -1;\r\n      else if (m1.overlayConfig?.parentID && !m2.overlayConfig?.parentID) return 1;\r\n\r\n      let priorityDiff = m1.priority - m2.priority;\r\n      if (priorityDiff === 0) return m1.label.localeCompare(m2.label);\r\n      return priorityDiff;\r\n    });\r\n\r\n    const [sMappings, groupedMappings] = sortMappingsToGroups(mappings);\r\n    data.groups = Object.keys(groupedMappings);\r\n\r\n    this.object.mappings = sMappings;\r\n    data.groupedMappings = groupedMappings;\r\n    data.global = Boolean(this.globalMappings);\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n    html.find('.delete-mapping').click(this._onRemove.bind(this));\r\n    html.find('.clone-mapping').click(this._onClone.bind(this));\r\n    html.find('.create-mapping').click(this._onCreate.bind(this));\r\n    html.find('.save-mappings').click(this._onSaveMappings.bind(this));\r\n    if (TVA_CONFIG.permissions.image_path_button[game.user.role]) {\r\n      html.find('.mapping-image img').click(this._onImageClick.bind(this));\r\n      html.find('.mapping-image img').mousedown(this._onImageMouseDown.bind(this));\r\n      html.find('.mapping-image video').click(this._onImageClick.bind(this));\r\n      html.find('.mapping-target').click(this._onConfigureApplicableActors.bind(this));\r\n    }\r\n    html.find('.mapping-image img').contextmenu(this._onImageRightClick.bind(this));\r\n    html.find('.mapping-image video').contextmenu(this._onImageRightClick.bind(this));\r\n    html.find('.mapping-config i.config').click(this._onConfigClick.bind(this));\r\n    html.find('.mapping-config i.config-edit').click(this._onConfigEditClick.bind(this));\r\n    html.find('.mapping-config i.config-script').click(this._onConfigScriptClick.bind(this));\r\n    html.find('.mapping-overlay i.overlay-config').click(this._onOverlayConfigClick.bind(this));\r\n    html.on('contextmenu', '.mapping-overlay i.overlay-config', this._onOverlayConfigRightClick.bind(this));\r\n    html.find('.mapping-overlay input').on('change', this._onOverlayChange).trigger('change');\r\n    html.find('.div-input').on('input paste focus click', this._onExpressionChange);\r\n    const app = this;\r\n    html\r\n      .find('.group-toggle > a')\r\n      .on('click', this._onGroupToggle.bind(this))\r\n      .each(function () {\r\n        const group = $(this).closest('.group-toggle');\r\n        const groupName = group.data('group');\r\n        if (!TOGGLED_GROUPS[groupName]) {\r\n          $(this).trigger('click');\r\n        }\r\n      });\r\n    this.setPosition({ width: 1020 });\r\n    html.find('.mapping-disable > input').on('change', this._onDisable.bind(this));\r\n    html.find('.group-disable > a').on('click', this._onGroupDisable.bind(this));\r\n    html.find('.group-delete').on('click', this._onGroupDelete.bind(this));\r\n    html.find('.mapping-group > input').on('change', this._onGroupChange.bind(this));\r\n    html.find('.expression-switch').on('click', this._onExpressionSwitch.bind(this));\r\n    html\r\n      .find('.expression-code textarea')\r\n      .focus((event) => $(event.target).animate({ height: '10em' }, 500, () => this.setPosition()))\r\n      .focusout((event) =>\r\n        $(event.target).animate({ height: '1em' }, 500, () => {\r\n          if (this._state === Application.RENDER_STATES.RENDERED) this.setPosition();\r\n        })\r\n      );\r\n    html.find('.tokens').on('click', this._onTokensRemove.bind(this));\r\n  }\r\n\r\n  async _onTokensRemove(event) {\r\n    await this._onSubmit(event);\r\n\r\n    const li = event.currentTarget.closest('.table-row');\r\n    const mapping = this.object.mappings[li.dataset.index];\r\n    mapping.tokens = undefined;\r\n\r\n    this.render();\r\n  }\r\n\r\n  _onExpressionSwitch(event) {\r\n    const container = $(event.target).closest('.expression-container');\r\n    const divInput = container.find('.div-input');\r\n    const codeExp = container.find('.expression-code');\r\n\r\n    if (codeExp.hasClass('hidden')) {\r\n      codeExp.removeClass('hidden');\r\n      divInput.addClass('hidden');\r\n    } else {\r\n      codeExp.addClass('hidden');\r\n      divInput.removeClass('hidden');\r\n    }\r\n  }\r\n\r\n  async _onDisable(event) {\r\n    const groupName = $(event.target).closest('.table-row').data('group');\r\n    const disableGroupToggle = $(event.target)\r\n      .closest('.token-variant-table')\r\n      .find(`.group-disable[data-group=\"${groupName}\"]`);\r\n\r\n    const checkboxes = $(event.target)\r\n      .closest('.token-variant-table')\r\n      .find(`[data-group=\"${groupName}\"] > .mapping-disable`);\r\n    const numChecked = checkboxes.find('input:checked').length;\r\n\r\n    if (checkboxes.length !== numChecked) {\r\n      disableGroupToggle.addClass('active');\r\n    } else disableGroupToggle.removeClass('active');\r\n  }\r\n\r\n  async _onGroupDisable(event) {\r\n    const group = $(event.target).closest('.group-disable');\r\n    const groupName = group.data('group');\r\n    const chks = $(event.target).closest('form').find(`[data-group=\"${groupName}\"]`).find('.mapping-disable > input');\r\n\r\n    if (group.hasClass('active')) {\r\n      group.removeClass('active');\r\n      chks.prop('checked', true);\r\n    } else {\r\n      group.addClass('active');\r\n      chks.prop('checked', false);\r\n    }\r\n  }\r\n\r\n  async _onGroupDelete(event) {\r\n    const group = $(event.target).closest('.group-delete');\r\n    const groupName = group.data('group');\r\n    await this._onSubmit(event);\r\n    this.object.mappings = this.object.mappings.filter((m) => m.group !== groupName);\r\n    this.render();\r\n  }\r\n\r\n  async _onGroupChange(event) {\r\n    const input = $(event.target);\r\n    let group = input.val().trim();\r\n    if (!group) group = 'Default';\r\n    input.val(group);\r\n\r\n    await this._onSubmit(event);\r\n    this.render();\r\n  }\r\n\r\n  _onGroupToggle(event) {\r\n    const group = $(event.target).closest('.group-toggle');\r\n    const groupName = group.data('group');\r\n    const form = $(event.target).closest('form');\r\n    form.find(`li[data-group=\"${groupName}\"]`).toggle();\r\n    if (group.hasClass('active')) {\r\n      group.removeClass('active');\r\n      group.find('i').addClass('fa-rotate-180');\r\n      TOGGLED_GROUPS[groupName] = false;\r\n    } else {\r\n      group.addClass('active');\r\n      group.find('i').removeClass('fa-rotate-180');\r\n      TOGGLED_GROUPS[groupName] = true;\r\n    }\r\n    game.settings.set('token-variants', 'effectMappingToggleGroups', TOGGLED_GROUPS);\r\n    this.setPosition({ height: 'auto' });\r\n  }\r\n\r\n  async _onExpressionChange(event) {\r\n    var el = event.target;\r\n\r\n    // Update the hidden input field so that the text entered in the div will be submitted via the form\r\n    $(el).siblings('input').val(event.target.innerText);\r\n\r\n    // The rest of the function is to handle operator highlighting and management of the caret position\r\n\r\n    if (!el.childNodes.length) return;\r\n\r\n    // Calculate the true/total caret offset within the div\r\n    const sel = window.getSelection();\r\n    const focusNode = sel.focusNode;\r\n    let offset = sel.focusOffset;\r\n\r\n    for (const ch of el.childNodes) {\r\n      if (ch === focusNode || ch.childNodes[0] === focusNode) break;\r\n      offset += ch.nodeName === 'SPAN' ? ch.innerText.length : ch.length;\r\n    }\r\n\r\n    // Highlight the operators and update the div\r\n    let text = highlightOperators(event.target.innerText);\r\n    $(event.target).html(text);\r\n\r\n    // Set the new caret position with the div\r\n    setCaretPosition(el, offset);\r\n  }\r\n\r\n  async _onOverlayChange(event) {\r\n    if (event.target.checked) {\r\n      $(event.target).siblings('a').show();\r\n    } else {\r\n      $(event.target).siblings('a').hide();\r\n    }\r\n  }\r\n\r\n  async _onOverlayConfigClick(event) {\r\n    const li = event.currentTarget.closest('.table-row');\r\n    const mapping = this.object.mappings[li.dataset.index];\r\n\r\n    new OverlayConfig(\r\n      mapping.overlayConfig,\r\n      (config) => {\r\n        mapping.overlayConfig = config;\r\n        const gear = $(li).find('.mapping-overlay > a');\r\n        if (config?.parentID && config.parentID !== 'TOKEN') {\r\n          gear.addClass('child');\r\n          gear.attr('title', 'Child Of: ' + config.parentID);\r\n        } else {\r\n          gear.removeClass('child');\r\n          gear.attr('title', '');\r\n        }\r\n      },\r\n      mapping.id,\r\n      this.token\r\n    ).render(true);\r\n  }\r\n\r\n  async _onOverlayConfigRightClick(event) {\r\n    const li = event.currentTarget.closest('.table-row');\r\n    const mapping = this.object.mappings[li.dataset.index];\r\n    showOverlayJsonConfigDialog(mapping.overlayConfig, (config) => (mapping.overlayConfig = config));\r\n  }\r\n\r\n  async _toggleActiveControls(event) {\r\n    const li = event.currentTarget.closest('.table-row');\r\n    const mapping = this.object.mappings[li.dataset.index];\r\n    const tokenConfig = $(event.target).closest('.mapping-config').find('.config');\r\n    const configEdit = $(event.target).closest('.mapping-config').find('.config-edit');\r\n    const scriptEdit = $(event.target).closest('.mapping-config').find('.config-script');\r\n\r\n    let hasTokenConfig = Object.keys(mapping.config).filter((k) => mapping.config[k]).length;\r\n    if (mapping.config.flags) hasTokenConfig--;\r\n    if (mapping.config.tv_script) hasTokenConfig--;\r\n\r\n    if (hasTokenConfig) tokenConfig.addClass('active');\r\n    else tokenConfig.removeClass('active');\r\n\r\n    if (Object.keys(mapping.config).filter((k) => mapping.config[k]).length) configEdit.addClass('active');\r\n    else configEdit.removeClass('active');\r\n\r\n    if (mapping.config.tv_script) scriptEdit.addClass('active');\r\n    else scriptEdit.removeClass('active');\r\n  }\r\n\r\n  async _onConfigScriptClick(event) {\r\n    const li = event.currentTarget.closest('.table-row');\r\n    const mapping = this.object.mappings[li.dataset.index];\r\n\r\n    new EditScriptConfig(mapping.config?.tv_script, (script) => {\r\n      if (!mapping.config) mapping.config = {};\r\n      if (script) mapping.config.tv_script = script;\r\n      else delete mapping.config.tv_script;\r\n      this._toggleActiveControls(event);\r\n    }).render(true);\r\n  }\r\n\r\n  async _onConfigEditClick(event) {\r\n    const li = event.currentTarget.closest('.table-row');\r\n    const mapping = this.object.mappings[li.dataset.index];\r\n\r\n    new EditJsonConfig(mapping.config, (config) => {\r\n      mapping.config = config;\r\n      this._toggleActiveControls(event);\r\n    }).render(true);\r\n  }\r\n\r\n  async _onConfigClick(event) {\r\n    const li = event.currentTarget.closest('.table-row');\r\n    const mapping = this.object.mappings[li.dataset.index];\r\n    new TokenCustomConfig(\r\n      this.token,\r\n      {},\r\n      null,\r\n      null,\r\n      (config) => {\r\n        if (!config || isEmpty(config)) {\r\n          config = {};\r\n          config.tv_script = mapping.config.tv_script;\r\n          config.flags = mapping.config.flags;\r\n        }\r\n        mapping.config = config;\r\n        this._toggleActiveControls(event);\r\n      },\r\n      mapping.config ? mapping.config : {}\r\n    ).render(true);\r\n  }\r\n\r\n  _removeImage(event) {\r\n    const vid = $(event.target).closest('.mapping-image').find('video');\r\n    const img = $(event.target).closest('.mapping-image').find('img');\r\n    vid.add(img).attr('src', '').attr('title', '');\r\n    vid.hide();\r\n    img.show();\r\n    img.attr('src', NO_IMAGE);\r\n    $(event.target).siblings('.imgSrc').val('');\r\n    $(event.target).siblings('.imgName').val('');\r\n  }\r\n\r\n  async _onImageMouseDown(event) {\r\n    if (event.which === 2) {\r\n      this._removeImage(event);\r\n    }\r\n  }\r\n\r\n  async _onImageClick(event) {\r\n    if (keyPressed('config')) {\r\n      this._removeImage(event);\r\n      return;\r\n    }\r\n\r\n    let search = this.token.name;\r\n    if (search === 'Unknown') {\r\n      const li = event.currentTarget.closest('.table-row');\r\n      const mapping = this.object.mappings[li.dataset.index];\r\n      search = mapping.label;\r\n    }\r\n\r\n    showArtSelect(search, {\r\n      searchType: SEARCH_TYPE.TOKEN,\r\n      callback: (imgSrc, imgName) => {\r\n        const vid = $(event.target).closest('.mapping-image').find('video');\r\n        const img = $(event.target).closest('.mapping-image').find('img');\r\n        vid.add(img).attr('src', imgSrc).attr('title', imgName);\r\n        if (isVideo(imgSrc)) {\r\n          vid.show();\r\n          img.hide();\r\n        } else {\r\n          vid.hide();\r\n          img.show();\r\n        }\r\n        $(event.target).siblings('.imgSrc').val(imgSrc);\r\n        $(event.target).siblings('.imgName').val(imgName);\r\n      },\r\n    });\r\n  }\r\n\r\n  async _onImageRightClick(event) {\r\n    if (keyPressed('config')) {\r\n      this._removeImage(event);\r\n      return;\r\n    }\r\n\r\n    const li = event.currentTarget.closest('.table-row');\r\n    const mapping = this.object.mappings[li.dataset.index];\r\n\r\n    new FilePicker({\r\n      type: 'imagevideo',\r\n      current: mapping.imgSrc,\r\n      callback: (path) => {\r\n        const vid = $(event.target).closest('.mapping-image').find('video');\r\n        const img = $(event.target).closest('.mapping-image').find('img');\r\n        vid.add(img).attr('src', path).attr('title', getFileName(path));\r\n        if (isVideo(path)) {\r\n          vid.show();\r\n          img.hide();\r\n        } else {\r\n          vid.hide();\r\n          img.show();\r\n        }\r\n        $(event.target).siblings('.imgSrc').val(path);\r\n        $(event.target).siblings('.imgName').val(getFileName(path));\r\n      },\r\n    }).render();\r\n  }\r\n\r\n  async _onRemove(event) {\r\n    event.preventDefault();\r\n    await this._onSubmit(event);\r\n    const li = event.currentTarget.closest('.table-row');\r\n    this.object.mappings.splice(li.dataset.index, 1);\r\n    this.render();\r\n  }\r\n\r\n  async _onClone(event) {\r\n    event.preventDefault();\r\n    await this._onSubmit(event);\r\n    const li = event.currentTarget.closest('.table-row');\r\n    const clone = deepClone(this.object.mappings[li.dataset.index]);\r\n    clone.label = clone.label + ' - Copy';\r\n    clone.id = randomID(8);\r\n    this.object.mappings.push(clone);\r\n    this.render();\r\n  }\r\n\r\n  async _onCreate(event) {\r\n    event.preventDefault();\r\n    await this._onSubmit(event);\r\n    this.object.mappings.push(this._getNewEffectConfig());\r\n    this.render();\r\n  }\r\n\r\n  _getNewEffectConfig({ label = '', expression = '' } = {}) {\r\n    // if (textOverlay) {\r\n    //   TOGGLED_GROUPS['Text Overlays'] = true;\r\n    //   return {\r\n    //     id: randomID(8),\r\n    //     label: label,\r\n    //     expression: label,\r\n    //     highlightedExpression: highlightOperators(label),\r\n    //     imgName: '',\r\n    //     imgSrc: '',\r\n    //     priority: 50,\r\n    //     overlay: false,\r\n    //     alwaysOn: false,\r\n    //     disabled: false,\r\n    //     group: 'Text Overlays',\r\n    //     overlay: true,\r\n    //     overlayConfig: mergeObject(\r\n    //       DEFAULT_OVERLAY_CONFIG,\r\n    //       {\r\n    //         img: '',\r\n    //         linkScale: false,\r\n    //         linkRotation: false,\r\n    //         linkMirror: false,\r\n    //         offsetY: 0.5 + Math.round(Math.random() * 0.3 * 100) / 100,\r\n    //         offsetX: 0,\r\n    //         scaleX: 0.68,\r\n    //         scaleY: 0.68,\r\n    //         text: {\r\n    //           text: '{{effect}}',\r\n    //           fontFamily: CONFIG.defaultFontFamily,\r\n    //           fontSize: 36,\r\n    //           fill: new Color(Math.round(Math.random() * 16777215)).toString(),\r\n    //           stroke: '#000000',\r\n    //           strokeThickness: 2,\r\n    //           dropShadow: false,\r\n    //           curve: {\r\n    //             radius: 160,\r\n    //             invert: false,\r\n    //           },\r\n    //         },\r\n    //         animation: {\r\n    //           rotate: true,\r\n    //           duration: 10000 + Math.round(Math.random() * 14000) + 10000,\r\n    //           clockwise: true,\r\n    //         },\r\n    //       },\r\n    //       { inplace: false }\r\n    //     ),\r\n    //   };\r\n    // } else {\r\n    TOGGLED_GROUPS['Default'] = true;\r\n    return mergeObject(deepClone(DEFAULT_ACTIVE_EFFECT_CONFIG), {\r\n      label,\r\n      expression,\r\n      id: randomID(8),\r\n    });\r\n    // }\r\n  }\r\n\r\n  _getHeaderButtons() {\r\n    const buttons = super._getHeaderButtons();\r\n\r\n    buttons.unshift({\r\n      label: 'Export',\r\n      class: 'token-variants-export',\r\n      icon: 'fas fa-file-export',\r\n      onclick: (ev) => this._exportConfigs(ev),\r\n    });\r\n    buttons.unshift({\r\n      label: 'Import',\r\n      class: 'token-variants-import',\r\n      icon: 'fas fa-file-import',\r\n      onclick: (ev) => this._importConfigs(ev),\r\n    });\r\n\r\n    buttons.unshift({\r\n      label: 'Templates',\r\n      class: 'token-variants-templates',\r\n      icon: 'fa-solid fa-book',\r\n      onclick: async (ev) => {\r\n        new Templates({\r\n          mappings: this.globalMappings ?? getFlagMappings(this.objectToFlag),\r\n          callback: (templateName, mappings) => {\r\n            this._insertMappings(ev, mappings);\r\n          },\r\n        }).render(true);\r\n      },\r\n    });\r\n\r\n    if (this.globalMappings) return buttons;\r\n\r\n    buttons.unshift({\r\n      label: 'Copy Global Config',\r\n      class: 'token-variants-copy-global',\r\n      icon: 'fas fa-globe',\r\n      onclick: (ev) => this._copyGlobalConfig(ev),\r\n    });\r\n    buttons.unshift({\r\n      label: 'Open Global',\r\n      class: 'token-variants-open-global',\r\n      icon: 'fas fa-globe',\r\n      onclick: async (ev) => {\r\n        await this.close();\r\n        new EffectMappingForm(this.token, { globalMappings: true }).render(true);\r\n      },\r\n    });\r\n\r\n    buttons.unshift({\r\n      label: '',\r\n      class: 'token-variants-print-token',\r\n      icon: 'fa fa-print',\r\n      onclick: () => showTokenCaptureDialog(canvas.tokens.get(this.token._id)),\r\n    });\r\n    return buttons;\r\n  }\r\n\r\n  async _exportConfigs(event) {\r\n    let mappings;\r\n    let filename = '';\r\n    if (this.globalMappings) {\r\n      mappings = { globalMappings: deepClone(TVA_CONFIG.globalMappings) };\r\n      filename = 'token-variants-global-mappings.json';\r\n    } else {\r\n      mappings = {\r\n        globalMappings: deepClone(getFlagMappings(this.objectToFlag)),\r\n      };\r\n\r\n      let actorName = this.objectToFlag.name ?? 'Actor';\r\n      actorName = actorName.replace(/[/\\\\?%*:|\"<>]/g, '-');\r\n      filename = 'token-variants-' + actorName + '.json';\r\n    }\r\n\r\n    if (mappings && !isEmpty(mappings)) {\r\n      saveDataToFile(JSON.stringify(mappings, null, 2), 'text/json', filename);\r\n    }\r\n  }\r\n\r\n  async _importConfigs(event) {\r\n    const content = await renderTemplate('templates/apps/import-data.html', {\r\n      entity: 'token-variants',\r\n      name: 'settings',\r\n    });\r\n    let dialog = new Promise((resolve, reject) => {\r\n      new Dialog(\r\n        {\r\n          title: 'Import Effect Configurations',\r\n          content: content,\r\n          buttons: {\r\n            import: {\r\n              icon: '<i class=\"fas fa-file-import\"></i>',\r\n              label: game.i18n.localize('token-variants.common.import'),\r\n              callback: (html) => {\r\n                const form = html.find('form')[0];\r\n                if (!form.data.files.length) return ui.notifications?.error('You did not upload a data file!');\r\n                readTextFromFile(form.data.files[0]).then((json) => {\r\n                  json = JSON.parse(json);\r\n                  if (!json || !('globalMappings' in json)) {\r\n                    return ui.notifications?.error('No mappings found within the file!');\r\n                  }\r\n\r\n                  this._insertMappings(event, migrateMappings(json.globalMappings));\r\n                  resolve(true);\r\n                });\r\n              },\r\n            },\r\n            no: {\r\n              icon: '<i class=\"fas fa-times\"></i>',\r\n              label: 'Cancel',\r\n              callback: (html) => resolve(false),\r\n            },\r\n          },\r\n          default: 'import',\r\n        },\r\n        {\r\n          width: 400,\r\n        }\r\n      ).render(true);\r\n    });\r\n    return await dialog;\r\n  }\r\n\r\n  _copyGlobalConfig(event) {\r\n    showMappingSelectDialog(TVA_CONFIG.globalMappings, {\r\n      title1: 'Global Mappings',\r\n      title2: 'Select Mappings to Copy:',\r\n      buttonTitle: 'Copy',\r\n      callback: (mappings) => {\r\n        this._insertMappings(event, mappings);\r\n      },\r\n    });\r\n  }\r\n\r\n  async _insertMappings(event, mappings) {\r\n    const cMappings = deepClone(mappings).map(this._processConfig);\r\n    await this._onSubmit(event);\r\n    mergeMappings(cMappings, this.object.mappings);\r\n    this.render();\r\n  }\r\n\r\n  _onConfigureApplicableActors(event) {\r\n    const li = event.currentTarget.closest('.table-row');\r\n    const mapping = this.object.mappings[li.dataset.index];\r\n\r\n    let actorTypes = (game.system.entityTypes ?? game.system.documentTypes)['Actor'];\r\n    let actors = [];\r\n    for (const t of actorTypes) {\r\n      const label = CONFIG['Actor']?.typeLabels?.[t] ?? t;\r\n      actors.push({\r\n        id: t,\r\n        label: game.i18n.has(label) ? game.i18n.localize(label) : t,\r\n        enabled: !mapping.targetActors || mapping.targetActors.includes(t),\r\n      });\r\n    }\r\n\r\n    let content = '<form style=\"overflow-y: scroll; height:250x;\">';\r\n    for (const act of actors) {\r\n      content += `\r\n      <div class=\"form-group\">\r\n        <label>${act.label}</label>\r\n        <div class=\"form-fields\">\r\n            <input type=\"checkbox\" name=\"${act.id}\" data-dtype=\"Boolean\" ${act.enabled ? 'checked' : ''}>\r\n        </div>\r\n      </div>\r\n      `;\r\n    }\r\n    content += `</form><div class=\"form-group\"><button type=\"button\" class=\"select-all\">Select all</div>`;\r\n\r\n    new Dialog({\r\n      title: `Configure Applicable Actors`,\r\n      content: content,\r\n      buttons: {\r\n        Ok: {\r\n          label: `Save`,\r\n          callback: async (html) => {\r\n            let targetActors = [];\r\n            html.find('input[type=\"checkbox\"]').each(function () {\r\n              if (this.checked) {\r\n                targetActors.push(this.name);\r\n              }\r\n            });\r\n            mapping.targetActors = targetActors;\r\n          },\r\n        },\r\n      },\r\n      render: (html) => {\r\n        html.find('.select-all').click(() => {\r\n          html.find('input[type=\"checkbox\"]').prop('checked', true);\r\n        });\r\n      },\r\n    }).render(true);\r\n  }\r\n\r\n  // TODO fix this spaghetti code related to globalMappings...\r\n  async _onSaveMappings(event) {\r\n    await this._onSubmit(event);\r\n    if (this.objectToFlag || this.globalMappings) {\r\n      // First filter out empty mappings\r\n      let mappings = this.object.mappings;\r\n      mappings = mappings.filter((m) => Boolean(m.label?.trim()) || Boolean(m.expression?.trim()));\r\n\r\n      // Make sure a priority is assigned\r\n      for (const mapping of mappings) {\r\n        mapping.priority = mapping.priority ? mapping.priority : 50;\r\n        mapping.overlayConfig = mapping.overlayConfig ?? {};\r\n        mapping.overlayConfig.label = mapping.label;\r\n      }\r\n\r\n      if (mappings.length !== 0) {\r\n        const effectMappings = mappings.map((m) =>\r\n          mergeObject(DEFAULT_ACTIVE_EFFECT_CONFIG, m, {\r\n            inplace: false,\r\n            insertKeys: false,\r\n            recursive: false,\r\n          })\r\n        );\r\n        if (this.globalMappings) {\r\n          updateSettings({ globalMappings: effectMappings });\r\n        } else {\r\n          await this.objectToFlag.setFlag('token-variants', 'effectMappings', effectMappings);\r\n        }\r\n      } else if (this.globalMappings) {\r\n        updateSettings({ globalMappings: [] });\r\n      } else {\r\n        await this.objectToFlag.unsetFlag('token-variants', 'effectMappings');\r\n      }\r\n\r\n      const tokens = this.globalMappings ? canvas.tokens.placeables : this.objectToFlag.getActiveTokens();\r\n      for (const tkn of tokens) {\r\n        if (TVA_CONFIG.filterEffectIcons) {\r\n          await tkn.drawEffects();\r\n        }\r\n        await updateWithEffectMapping(tkn);\r\n        drawOverlays(tkn);\r\n      }\r\n\r\n      // Instruct users on other scenes to refresh the overlays\r\n      const message = {\r\n        handlerName: 'drawOverlays',\r\n        args: { all: true, sceneId: canvas.scene.id },\r\n        type: 'UPDATE',\r\n      };\r\n      game.socket?.emit('module.token-variants', message);\r\n    }\r\n    if (this.callback) this.callback();\r\n    this.close();\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {\r\n    const mappings = expandObject(formData).mappings ?? {};\r\n\r\n    // Merge form data with internal mappings\r\n    for (let i = 0; i < this.object.mappings.length; i++) {\r\n      const m1 = mappings[i];\r\n      const m2 = this.object.mappings[i];\r\n      m2.id = m1.id;\r\n      m2.label = m1.label.replaceAll(String.fromCharCode(160), ' ');\r\n      m2.expression = m1.expression.replaceAll(String.fromCharCode(160), ' ');\r\n      m2.codeExp = m1.codeExp?.trim();\r\n      m2.imgSrc = m1.imgSrc;\r\n      m2.imgName = m1.imgName;\r\n      m2.priority = m1.priority;\r\n      m2.overlay = m1.overlay;\r\n      m2.alwaysOn = m1.alwaysOn;\r\n      m2.tokens = m1.tokens?.split(',');\r\n      m2.disabled = m1.disabled;\r\n      m2.group = m1.group;\r\n    }\r\n  }\r\n}\r\n\r\n// Insert <span/> around operators\r\nfunction highlightOperators(text) {\r\n  // text = text.replaceAll(' ', '&nbsp;');\r\n\r\n  const re = new RegExp('([a-zA-Z\\\\.\\\\-\\\\|\\\\+]+)([><=]+)(\".*?\"|-?\\\\d+)(%{0,1})', `gi`);\r\n  text = text.replace(re, function replace(match) {\r\n    return '<span class=\"hp-expression\">' + match + '</span>';\r\n  });\r\n\r\n  for (const op of ['\\\\(', '\\\\)', '&&', '||', '\\\\!', '\\\\*', '\\\\{', '\\\\}']) {\r\n    text = text.replaceAll(op, `<span>${op}</span>`);\r\n  }\r\n  return text;\r\n}\r\n\r\n// Move caret to a specific point in a DOM element\r\nfunction setCaretPosition(el, pos) {\r\n  for (var node of el.childNodes) {\r\n    // Check if it's a text node\r\n    if (node.nodeType == 3) {\r\n      if (node.length >= pos) {\r\n        var range = document.createRange(),\r\n          sel = window.getSelection();\r\n        range.setStart(node, pos);\r\n        range.collapse(true);\r\n        sel.removeAllRanges();\r\n        sel.addRange(range);\r\n        return -1; // We are done\r\n      } else {\r\n        pos -= node.length;\r\n      }\r\n    } else {\r\n      pos = setCaretPosition(node, pos);\r\n      if (pos == -1) {\r\n        return -1; // No need to finish the for loop\r\n      }\r\n    }\r\n  }\r\n  return pos;\r\n}\r\n\r\nexport function sortMappingsToGroups(mappings) {\r\n  mappings.sort((m1, m2) => {\r\n    if (!m1.label && m2.label) return -1;\r\n    else if (m1.label && !m2.label) return 1;\r\n\r\n    if (!m1.overlayConfig?.parentID && m2.overlayConfig?.parentID) return -1;\r\n    else if (m1.overlayConfig?.parentID && !m2.overlayConfig?.parentID) return 1;\r\n\r\n    let priorityDiff = m1.priority - m2.priority;\r\n    if (priorityDiff === 0) return m1.label.localeCompare(m2.label);\r\n    return priorityDiff;\r\n  });\r\n\r\n  let groupedMappings = { Default: { list: [], active: false } };\r\n  mappings.forEach((mapping, index) => {\r\n    mapping.i = index; // assign so that we can reference the mapping inside of an array\r\n    if (!mapping.group || !mapping.group.trim()) mapping.group = 'Default';\r\n    if (!(mapping.group in groupedMappings)) groupedMappings[mapping.group] = { list: [], active: false };\r\n    if (!mapping.disabled) groupedMappings[mapping.group].active = true;\r\n    groupedMappings[mapping.group].list.push(mapping);\r\n  });\r\n  return [mappings, groupedMappings];\r\n}\r\n","export default class EditJsonConfig extends FormApplication {\r\n  constructor(config, callback) {\r\n    super({}, {});\r\n    this.config = config;\r\n    this.callback = callback;\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-config-json-edit',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/configJsonEdit.html',\r\n      resizable: true,\r\n      minimizable: false,\r\n      title: 'Edit Token Configuration',\r\n      width: 400,\r\n      height: 380,\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n\r\n    data.hasConfig = this.config != null && Object.keys(this.config).length !== 0;\r\n    data.config = JSON.stringify(data.hasConfig ? this.config : {}, null, 2);\r\n\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n    html.on('input', '.command textarea', this._validateJSON.bind(this));\r\n    // Override 'Tab' key to insert spaces\r\n    html.on('keydown', '.command textarea', function (e) {\r\n      if (e.key === 'Tab' && !e.shiftKey) {\r\n        e.preventDefault();\r\n        var start = this.selectionStart;\r\n        var end = this.selectionEnd;\r\n        this.value = this.value.substring(0, start) + '  ' + this.value.substring(end);\r\n        this.selectionStart = this.selectionEnd = start + 2;\r\n        return false;\r\n      }\r\n    });\r\n\r\n    html.find('.remove').click(this._onRemove.bind(this));\r\n    html.find('.format').click(this._onFormat.bind(this));\r\n  }\r\n\r\n  async _validateJSON(event) {\r\n    const controls = $(event.target).closest('form').find('button[type=\"submit\"], button.format');\r\n    try {\r\n      this.config = JSON.parse(event.target.value);\r\n      this.config = expandObject(this.config);\r\n      this.flag = this.config.flag;\r\n      controls.prop('disabled', false);\r\n    } catch (e) {\r\n      controls.prop('disabled', true);\r\n    }\r\n  }\r\n\r\n  async _onRemove(event) {\r\n    this.config = {};\r\n    this.submit();\r\n  }\r\n\r\n  async _onFormat(event) {\r\n    $(event.target)\r\n      .closest('form')\r\n      .find('textarea[name=\"config\"]')\r\n      .val(JSON.stringify(this.config, null, 2));\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {\r\n    if (this.callback) this.callback(this.config);\r\n  }\r\n}\r\n","export default class EditScriptConfig extends FormApplication {\r\n  constructor(script, callback) {\r\n    super({}, {});\r\n    this.script = script;\r\n    this.callback = callback;\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-config-script-edit',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/configScriptEdit.html',\r\n      resizable: true,\r\n      minimizable: false,\r\n      title: 'Scripts',\r\n      width: 640,\r\n      height: 640,\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n\r\n    const script = this.script ? this.script : {};\r\n    data.hasScript = !isEmpty(script);\r\n    data.onApply = script.onApply;\r\n    data.onRemove = script.onRemove;\r\n    data.macroOnApply = script.macroOnApply;\r\n    data.macroOnRemove = script.macroOnRemove;\r\n\r\n    data.tmfxPreset = script.tmfxPreset;\r\n    data.tmfxActive = game.modules.get('tokenmagic')?.active;\r\n    if (data.tmfxActive) {\r\n      data.tmfxPresets = TokenMagic.getPresets().map((p) => p.name);\r\n    }\r\n\r\n    data.ceActive = game.modules.get('dfreds-convenient-effects')?.active;\r\n    if (data.ceActive) {\r\n      data.ceEffect = script.ceEffect ?? { apply: true, remove: true };\r\n      data.ceEffects = game.dfreds.effects.all.map((ef) => ef.name);\r\n    }\r\n\r\n    data.macros = game.macros.map((m) => m.name);\r\n\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n    // Override 'Tab' key to insert spaces\r\n    html.on('keydown', '.command textarea', function (e) {\r\n      if (e.key === 'Tab' && !e.shiftKey) {\r\n        e.preventDefault();\r\n        var start = this.selectionStart;\r\n        var end = this.selectionEnd;\r\n        this.value = this.value.substring(0, start) + '  ' + this.value.substring(end);\r\n        this.selectionStart = this.selectionEnd = start + 2;\r\n        return false;\r\n      }\r\n    });\r\n\r\n    html.find('.remove').click(this._onRemove.bind(this));\r\n  }\r\n\r\n  async _onRemove(event) {\r\n    if (this.callback) this.callback(null);\r\n    this.close();\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {\r\n    formData = expandObject(formData);\r\n    ['onApply', 'onRemove', 'macroOnApply', 'macroOnRemove'].forEach((k) => {\r\n      formData[k] = formData[k].trim();\r\n    });\r\n    if (formData.ceEffect?.name) formData.ceEffect.name = formData.ceEffect.name.trim();\r\n\r\n    if (\r\n      !formData.onApply &&\r\n      !formData.onRemove &&\r\n      !formData.tmfxPreset &&\r\n      !formData.ceEffect.name &&\r\n      !formData.macroOnApply &&\r\n      !formData.macroOnRemove\r\n    ) {\r\n      if (this.callback) this.callback(null);\r\n    } else {\r\n      if (this.callback) this.callback(formData);\r\n    }\r\n  }\r\n}\r\n","import { toggleTemplateOnSelected } from '../scripts/hooks/effectMappingHooks.js';\r\nimport { CORE_TEMPLATES } from '../scripts/mappingTemplates.js';\r\nimport { TVA_CONFIG, updateSettings } from '../scripts/settings.js';\r\nimport { BASE_IMAGE_CATEGORIES, uploadTokenImage } from '../scripts/utils.js';\r\nimport { sortMappingsToGroups } from './effectMappingForm.js';\r\nimport { Templates } from './templates.js';\r\nimport TokenCustomConfig from './tokenCustomConfig.js';\r\n\r\n// Edit overlay configuration as a json string\r\nexport function showOverlayJsonConfigDialog(overlayConfig, callback) {\r\n  const config = deepClone(overlayConfig || {});\r\n  delete config.effect;\r\n  let content = `<div style=\"height: 300px;\" class=\"form-group stacked command\"><textarea style=\"height: 300px;\" class=\"configJson\">${JSON.stringify(\r\n    config,\r\n    null,\r\n    2\r\n  )}</textarea></div>`;\r\n\r\n  new Dialog({\r\n    title: `Overlay Configuration`,\r\n    content: content,\r\n    buttons: {\r\n      yes: {\r\n        icon: \"<i class='fas fa-save'></i>\",\r\n        label: 'Save',\r\n        callback: (html) => {\r\n          let json = $(html).find('.configJson').val();\r\n          if (json) {\r\n            try {\r\n              json = JSON.parse(json);\r\n            } catch (e) {\r\n              console.warn(`TVA |`, e);\r\n              json = {};\r\n            }\r\n          } else {\r\n            json = {};\r\n          }\r\n          callback(json);\r\n        },\r\n      },\r\n    },\r\n    default: 'yes',\r\n  }).render(true);\r\n}\r\n\r\n// Change categories assigned to a path\r\nexport async function showPathSelectCategoryDialog(event) {\r\n  event.preventDefault();\r\n  const typesInput = $(event.target).closest('.path-category').find('input');\r\n  const selectedTypes = typesInput.val().split(',');\r\n\r\n  const categories = BASE_IMAGE_CATEGORIES.concat(TVA_CONFIG.customImageCategories);\r\n\r\n  let content = '<div class=\"token-variants-popup-settings\">';\r\n\r\n  // Split into rows of 4\r\n  const splits = [];\r\n  let currSplit = [];\r\n  for (let i = 0; i < categories.length; i++) {\r\n    if (i > 0 && i + 1 != categories.length && i % 4 == 0) {\r\n      splits.push(currSplit);\r\n      currSplit = [];\r\n    }\r\n    currSplit.push(categories[i]);\r\n  }\r\n  if (currSplit.length) splits.push(currSplit);\r\n\r\n  for (const split of splits) {\r\n    content += '<header class=\"table-header flexrow\">';\r\n    for (const type of split) {\r\n      content += `<label>${type}</label>`;\r\n    }\r\n    content += '</header><ul class=\"setting-list\"><li class=\"setting form-group\"><div class=\"form-fields\">';\r\n    for (const type of split) {\r\n      content += `<input class=\"category\" type=\"checkbox\" name=\"${type}\" data-dtype=\"Boolean\" ${\r\n        selectedTypes.includes(type) ? 'checked' : ''\r\n      }>`;\r\n    }\r\n    content += '</div></li></ul>';\r\n  }\r\n  content += '</div>';\r\n\r\n  new Dialog({\r\n    title: `Image Categories/Filters`,\r\n    content: content,\r\n    buttons: {\r\n      yes: {\r\n        icon: \"<i class='fas fa-save'></i>\",\r\n        label: 'Apply',\r\n        callback: (html) => {\r\n          const types = [];\r\n          $(html)\r\n            .find('.category')\r\n            .each(function () {\r\n              if ($(this).is(':checked')) {\r\n                types.push($(this).attr('name'));\r\n              }\r\n            });\r\n          typesInput.val(types.join(','));\r\n        },\r\n      },\r\n    },\r\n    default: 'yes',\r\n  }).render(true);\r\n}\r\n\r\n// Change configs assigned to a path\r\nexport async function showPathSelectConfigForm(event) {\r\n  event.preventDefault();\r\n  const configInput = $(event.target).closest('.path-config').find('input');\r\n  let config = {};\r\n  try {\r\n    config = JSON.parse(configInput.val());\r\n  } catch (e) {}\r\n\r\n  const setting = game.settings.get('core', DefaultTokenConfig.SETTING);\r\n  const data = new foundry.data.PrototypeToken(setting);\r\n  const token = new TokenDocument(data, { actor: null });\r\n  new TokenCustomConfig(\r\n    token,\r\n    {},\r\n    null,\r\n    null,\r\n    (conf) => {\r\n      if (!conf) conf = {};\r\n      if (conf.flags == null || isEmpty(conf.flags)) delete conf.flags;\r\n      configInput.val(JSON.stringify(conf));\r\n      const cog = configInput.siblings('.select-config');\r\n      if (isEmpty(conf)) cog.removeClass('active');\r\n      else cog.addClass('active');\r\n    },\r\n    config\r\n  ).render(true);\r\n}\r\n\r\nexport async function showTokenCaptureDialog(token) {\r\n  if (!token) return;\r\n  let content = `<form>\r\n<div class=\"form-group\">\r\n  <label>Image Name</label>\r\n  <input type=\"text\" name=\"name\" value=\"${token.name}\">\r\n</div>\r\n<div class=\"form-group\">\r\n  <label>Image Path</label>\r\n    <div class=\"form-fields\">\r\n      <input type=\"text\" name=\"path\" value=\"modules/token-variants/\">\r\n      <button type=\"button\" class=\"file-picker\" data-type=\"folder\" data-target=\"path\" title=\"Browse Folders\" tabindex=\"-1\">\r\n        <i class=\"fas fa-file-import fa-fw\"></i>\r\n      </button>\r\n    </div>\r\n</div>\r\n<div class=\"form-group slim\">\r\n  <label>Width <span class=\"units\">(pixels)</span></label>\r\n  <div class=\"form-fields\">\r\n      <input type=\"number\" step=\"1\" name=\"width\" value=\"${token.mesh.texture.width}\">\r\n  </div>\r\n</div>\r\n<div class=\"form-group slim\">\r\n  <label>Height <span class=\"units\">(pixels)</span></label>\r\n  <div class=\"form-fields\">\r\n      <input type=\"number\" step=\"1\" name=\"height\" value=\"${token.mesh.texture.height}\">\r\n  </div>\r\n</div>\r\n<div class=\"form-group slim\">\r\n  <label>Scale</label>\r\n  <div class=\"form-fields\">\r\n    <input type=\"number\" step=\"any\" name=\"scale\" value=\"3\">\r\n  </div>\r\n</div>\r\n</form>`;\r\n\r\n  new Dialog({\r\n    title: `Save Token/Overlay Image`,\r\n    content: content,\r\n    buttons: {\r\n      yes: {\r\n        icon: \"<i class='fas fa-save'></i>\",\r\n        label: 'Save',\r\n        callback: (html) => {\r\n          const options = {};\r\n          $(html)\r\n            .find('[name]')\r\n            .each(function () {\r\n              let val = parseFloat(this.value);\r\n              if (isNaN(val)) val = this.value;\r\n              options[this.name] = val;\r\n            });\r\n          uploadTokenImage(token, options);\r\n        },\r\n      },\r\n    },\r\n    render: (html) => {\r\n      html.find('.file-picker').click(() => {\r\n        new FilePicker({\r\n          type: 'folder',\r\n          current: html.find('[name=\"path\"]').val(),\r\n          callback: (path) => {\r\n            html.find('[name=\"path\"]').val(path);\r\n          },\r\n        }).render();\r\n      });\r\n    },\r\n    default: 'yes',\r\n  }).render(true);\r\n}\r\n\r\nexport function showMappingSelectDialog(\r\n  mappings,\r\n  { title1 = 'Mappings', title2 = 'Select Mappings', buttonTitle = 'Confirm', callback = null } = {}\r\n) {\r\n  if (!mappings || !mappings.length) return;\r\n\r\n  let content = `<form style=\"overflow-y: scroll; height:400px;\"><h2>${title2}</h2>`;\r\n\r\n  const [_, mappingGroups] = sortMappingsToGroups(mappings);\r\n  for (const [group, obj] of Object.entries(mappingGroups)) {\r\n    if (obj.list.length) {\r\n      content += `<h4 style=\"text-align:center;\"><b>${group}</b></h4>`;\r\n      for (const mapping of obj.list) {\r\n        content += `\r\n        <div class=\"form-group\">\r\n          <label>${mapping.label}</label>\r\n          <div class=\"form-fields\">\r\n              <input type=\"checkbox\" name=\"${mapping.id}\" data-dtype=\"Boolean\">\r\n          </div>\r\n        </div>\r\n        `;\r\n      }\r\n    }\r\n  }\r\n\r\n  content += `</form><div class=\"form-group\"><button type=\"button\" class=\"select-all\">Select all</div>`;\r\n\r\n  new Dialog({\r\n    title: title1,\r\n    content: content,\r\n    buttons: {\r\n      Ok: {\r\n        label: buttonTitle,\r\n        callback: async (html) => {\r\n          if (!callback) return;\r\n          const selectedMappings = [];\r\n          html.find('input[type=\"checkbox\"]').each(function () {\r\n            if (this.checked) {\r\n              const mapping = mappings.find((m) => m.id === this.name);\r\n              if (mapping) {\r\n                const cMapping = deepClone(mapping);\r\n                selectedMappings.push(cMapping);\r\n                delete cMapping.targetActors;\r\n              }\r\n            }\r\n          });\r\n          callback(selectedMappings);\r\n        },\r\n      },\r\n    },\r\n    render: (html) => {\r\n      html.find('.select-all').click(() => {\r\n        html.find('input[type=\"checkbox\"]').prop('checked', true);\r\n      });\r\n    },\r\n  }).render(true);\r\n}\r\n\r\nexport function showUserTemplateCreateDialog(mappings) {\r\n  let content = `\r\n<div class=\"form-group\">\r\n  <label>Template Name</label>\r\n  <div class=\"form-fields\">\r\n    <input type=\"text\" name=\"templateName\" data-dtype=\"String\" value=\"\">\r\n  </div>\r\n</div>\r\n<div class=\"form-group\">\r\n  <label>Hover Text (optional)</label>\r\n  <div class=\"form-fields\">\r\n    <input type=\"text\" name=\"templateHint\" data-dtype=\"String\" value=\"\">\r\n  </div>\r\n</div>\r\n<div class=\"form-group\">\r\n  <label>Hover Image (optional)</label>\r\n  <div class=\"form-fields\">\r\n    <input type=\"text\" name=\"img\" data-dtype=\"String\" value=\"\">\r\n  </div>\r\n</div>`;\r\n\r\n  let dialog;\r\n  dialog = new Dialog({\r\n    title: 'Mapping Templates',\r\n    content,\r\n    buttons: {\r\n      create: {\r\n        label: 'Create Template',\r\n        callback: (html) => {\r\n          const name = html.find('[name=\"templateName\"]').val().trim();\r\n          const hint = html.find('[name=\"templateHint\"]').val().trim();\r\n          const img = html.find('[name=\"img\"]').val().trim();\r\n          if (name.trim()) {\r\n            TVA_CONFIG.templateMappings.push({ id: randomID(), name, hint, img, mappings: deepClone(mappings) });\r\n            updateSettings({ templateMappings: TVA_CONFIG.templateMappings });\r\n          }\r\n        },\r\n      },\r\n      cancel: {\r\n        label: 'Cancel',\r\n      },\r\n    },\r\n    default: 'cancel',\r\n  });\r\n  dialog.render(true);\r\n}\r\n\r\nexport function toggleTemplateDialog() {\r\n  new Templates({ callback: (templateName, mappings) => toggleTemplateOnSelected(templateName, mappings) }).render(\r\n    true\r\n  );\r\n}\r\n","export const CORE_TEMPLATES = [\r\n  {\r\n    name: 'Tint Red when HP is bellow 10%',\r\n    hint: 'Tint token red when HP falls bellow 10%',\r\n    img: 'https://user-images.githubusercontent.com/7693704/243428871-c52130b3-2f12-4de7-a86e-fabc67e865a9.png',\r\n    group: 'Health',\r\n    mappings: [\r\n      {\r\n        id: 'MmLSOlJx',\r\n        label: 'Tint Red',\r\n        expression: 'hp<=10%',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {\r\n          texture: {\r\n            tint: '#ff0000',\r\n          },\r\n        },\r\n        overlay: false,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          label: 'Tint Red',\r\n        },\r\n        group: 'Low HP',\r\n        i: 0,\r\n      },\r\n    ],\r\n    id: 'Ob9LP35K',\r\n  },\r\n  {\r\n    name: 'Health State Text Overlay',\r\n    hint: `Displays text overlay based on percentage health. \\n0% < hp <= 25% : Critical\\n25% < hp <= 50% : Bloodied\\n50% < hp <= 75% : Wounded\\n75% < hp : Healthy`,\r\n    img: 'https://user-images.githubusercontent.com/7693704/243426356-ceab629c-c16c-42b3-9004-af7dafb62eb7.png',\r\n    group: 'Health',\r\n    mappings: [\r\n      {\r\n        id: 'jqaFdwkQ',\r\n        label: 'Bloodied',\r\n        expression: 'hp>25% && hp<=50%',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          parent: '',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionX: false,\r\n          linkDimensionY: false,\r\n          linkOpacity: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: 0.51,\r\n          scaleX: 0.76,\r\n          scaleY: 0.76,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 1,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Bloodied',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#ff5900',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: null,\r\n            },\r\n          },\r\n          label: 'Bloodied',\r\n          id: 'jqaFdwkQ',\r\n        },\r\n        group: 'Health State Overlay',\r\n        i: 0,\r\n      },\r\n      {\r\n        id: 'm4GQVz5O',\r\n        label: 'Critical',\r\n        expression: 'hp>0 && hp<=25%',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          parent: '',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionX: false,\r\n          linkDimensionY: false,\r\n          linkOpacity: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: 0.51,\r\n          scaleX: 0.76,\r\n          scaleY: 0.76,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 1,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Critical',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#ff0000',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: null,\r\n            },\r\n          },\r\n          label: 'Critical',\r\n          id: 'm4GQVz5O',\r\n        },\r\n        group: 'Health State Overlay',\r\n        i: 1,\r\n      },\r\n      {\r\n        id: 'H1wrS5N1',\r\n        label: 'Healthy',\r\n        expression: 'hp>75%',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          parent: '',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionX: false,\r\n          linkDimensionY: false,\r\n          linkOpacity: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: 0.51,\r\n          scaleX: 0.76,\r\n          scaleY: 0.76,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 1,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Healthy',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#2bff00',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: null,\r\n            },\r\n          },\r\n          label: 'Healthy',\r\n          id: 'H1wrS5N1',\r\n        },\r\n        group: 'Health State Overlay',\r\n        i: 2,\r\n      },\r\n      {\r\n        id: 'IojJZS7v',\r\n        label: 'Wounded',\r\n        expression: 'hp>50% && hp<=75%',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          parent: '',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionX: false,\r\n          linkDimensionY: false,\r\n          linkOpacity: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: 0.51,\r\n          scaleX: 0.76,\r\n          scaleY: 0.76,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 1,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Wounded',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#ffbb00',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: null,\r\n            },\r\n          },\r\n          label: 'Wounded',\r\n          id: 'IojJZS7v',\r\n        },\r\n        group: 'Health State Overlay',\r\n        i: 3,\r\n      },\r\n    ],\r\n    id: 'JNClkgGU',\r\n  },\r\n  {\r\n    name: 'Health State Text Overlay - Passed Check',\r\n    hint: 'Same as Health State Text Overlay except also requiring the Token actor to have Reveal Health active effect applied to it.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/243429385-f62b111c-3d9c-4cd8-9c27-f5b13e09fea2.png',\r\n    group: 'Health',\r\n    mappings: [\r\n      {\r\n        id: 'k0XbFE7a',\r\n        label: 'Bloodied',\r\n        expression: 'Reveal Health && hp>25% && hp<=50%',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          parent: '',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionX: false,\r\n          linkDimensionY: false,\r\n          linkOpacity: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: 0.51,\r\n          scaleX: 0.76,\r\n          scaleY: 0.76,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 1,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Bloodied',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#ff5900',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: null,\r\n            },\r\n          },\r\n          label: 'Bloodied',\r\n          id: 'k0XbFE7a',\r\n        },\r\n        group: 'Health State Overlay - Passed Check',\r\n        i: 0,\r\n      },\r\n      {\r\n        id: 'a1VxhnWK',\r\n        label: 'Critical',\r\n        expression: 'Reveal Health && hp>0 && hp<=25%',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          parent: '',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionX: false,\r\n          linkDimensionY: false,\r\n          linkOpacity: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: 0.51,\r\n          scaleX: 0.76,\r\n          scaleY: 0.76,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 1,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Critical',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#ff0000',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: null,\r\n            },\r\n          },\r\n          label: 'Critical',\r\n          id: 'a1VxhnWK',\r\n        },\r\n        group: 'Health State Overlay - Passed Check',\r\n        i: 1,\r\n      },\r\n      {\r\n        id: 'DNuBTXe8',\r\n        label: 'Healthy',\r\n        expression: 'Reveal Health && hp>75%',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          parent: '',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionX: false,\r\n          linkDimensionY: false,\r\n          linkOpacity: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: 0.51,\r\n          scaleX: 0.76,\r\n          scaleY: 0.76,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 1,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Healthy',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#2bff00',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: null,\r\n            },\r\n          },\r\n          label: 'Healthy',\r\n          id: 'DNuBTXe8',\r\n        },\r\n        group: 'Health State Overlay - Passed Check',\r\n        i: 2,\r\n      },\r\n      {\r\n        id: 'ROPjrvLu',\r\n        label: 'Wounded',\r\n        expression: 'Reveal Health && hp>50% && hp<=75%',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          parent: '',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionX: false,\r\n          linkDimensionY: false,\r\n          linkOpacity: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: 0.51,\r\n          scaleX: 0.76,\r\n          scaleY: 0.76,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 1,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Wounded',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#ffbb00',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: null,\r\n            },\r\n          },\r\n          label: 'Wounded',\r\n          id: 'ROPjrvLu',\r\n        },\r\n        group: 'Health State Overlay - Passed Check',\r\n        i: 3,\r\n      },\r\n    ],\r\n    id: '0ZJQiOdD',\r\n  },\r\n  {\r\n    name: 'Fancy Nameplate',\r\n    hint: 'Displays a curved red nameplate underneath the token.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/244439674-12510686-2f72-44b3-8a1d-e6cc7fbb00c6.png',\r\n    mappings: [\r\n      {\r\n        id: 'DTbwvQiG',\r\n        label: 'Token Nameplate',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          parent: '',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionX: false,\r\n          linkDimensionY: false,\r\n          linkOpacity: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: -0.51,\r\n          scaleX: 0.68,\r\n          scaleY: 0.68,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '{{name}}',\r\n            fontFamily: 'Modesto Condensed',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#ff0000',\r\n            dropShadow: 'true',\r\n            strokeThickness: 3,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 450,\r\n              invert: true,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              line: {\r\n                width: 1,\r\n                color: '#111111',\r\n                alpha: 1,\r\n              },\r\n              fill: {\r\n                color: '#111111',\r\n                alpha: 1,\r\n              },\r\n            },\r\n          ],\r\n          label: 'Token Nameplate',\r\n        },\r\n        group: 'Nameplate',\r\n        i: 0,\r\n      },\r\n    ],\r\n    id: 'Ik1uNcWU',\r\n  },\r\n  {\r\n    name: 'Info Box #1',\r\n    hint: 'Displays information about the token/actor when hovering over or controlling them. This box will adjust to canvas zoom.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/244441852-b50f3ca6-e0c3-4ce0-b498-ddd00edcbdca.png',\r\n    system: 'dnd5e',\r\n    group: 'Info',\r\n    mappings: [\r\n      {\r\n        id: 'W8BPK9hv',\r\n        label: 'Box Background',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'W8BPK9hv',\r\n          parentID: '',\r\n          ui: true,\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: true,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.55,\r\n          offsetY: 0,\r\n          scaleX: 0.73,\r\n          scaleY: 0.73,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'DropShadowFilter',\r\n          filterOptions: {\r\n            rotation: 45,\r\n            distance: 16.9,\r\n            color: '#000000',\r\n            alpha: 0.52,\r\n            shadowOnly: false,\r\n            blur: 2,\r\n            quality: 3,\r\n          },\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: true,\r\n          limitOnHighlight: false,\r\n          limitOnControl: true,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'rectangle',\r\n                x: '0',\r\n                y: '0',\r\n                width: '450',\r\n                height: '200',\r\n                radius: '0',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: 2,\r\n                color: '#ffffff',\r\n                alpha: 1,\r\n              },\r\n              fill: {\r\n                color: '#508fe2',\r\n                color2: '',\r\n                prc: '',\r\n                alpha: 0.55,\r\n              },\r\n            },\r\n          ],\r\n          effect: '',\r\n          label: 'Box Background',\r\n        },\r\n        group: 'Info Box',\r\n        i: 0,\r\n      },\r\n      {\r\n        id: 'bkoP4Qpo',\r\n        label: 'Legendary Actions',\r\n        expression: 'actor.system.resources.legact.max>0',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'bkoP4Qpo',\r\n          parentID: 'W8BPK9hv',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.47,\r\n          offsetY: -0.02,\r\n          scaleX: 0.5,\r\n          scaleY: 0.5,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Legendary: Action {{actor.system.resources.legact.value}}/{{actor.system.resources.legact.max}} Resistance {{actor.system.resources.legres.value}}/{{actor.system.resources.legres.max}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Legendary Actions',\r\n        },\r\n        group: 'Info Box',\r\n        i: 1,\r\n      },\r\n      {\r\n        id: 'OvcWUW13',\r\n        label: 'Mods',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'OvcWUW13',\r\n          parentID: 'W8BPK9hv',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: -0.38,\r\n          scaleX: 0.57,\r\n          scaleY: 0.57,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'STR {{actor.system.abilities.str.mod}}  DEX {{actor.system.abilities.dex.mod}}  CON {{actor.system.abilities.con.mod}}  INT {{actor.system.abilities.int.mod}}  WIS {{actor.system.abilities.wis.mod}}  CHA {{actor.system.abilities.cha.mod}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Mods',\r\n        },\r\n        group: 'Info Box',\r\n        i: 2,\r\n      },\r\n      {\r\n        id: 'jybTYLTB',\r\n        label: 'Token Name',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 51,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'jybTYLTB',\r\n          parentID: 'W8BPK9hv',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.47,\r\n          offsetY: 0.35,\r\n          scaleX: 0.77,\r\n          scaleY: 0.77,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Name: {{name}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Token Name',\r\n        },\r\n        group: 'Info Box',\r\n        i: 3,\r\n      },\r\n      {\r\n        id: 'bGbHPbw6',\r\n        label: 'HP',\r\n        expression: 'hp>40%',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 52,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'bGbHPbw6',\r\n          parentID: 'W8BPK9hv',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.47,\r\n          offsetY: 0.23,\r\n          scaleX: 0.82,\r\n          scaleY: 0.82,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'HP: {{actor.system.attributes.hp.value}}/{{actor.system.attributes.hp.max}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#6b6b6b',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'HP',\r\n        },\r\n        group: 'Info Box',\r\n        i: 4,\r\n      },\r\n      {\r\n        id: 'S9gXdyGY',\r\n        label: 'Low HP',\r\n        expression: 'hp<=40%',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 52,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'S9gXdyGY',\r\n          parentID: 'W8BPK9hv',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.47,\r\n          offsetY: 0.23,\r\n          scaleX: 0.82,\r\n          scaleY: 0.82,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'HP: {{actor.system.attributes.hp.value}}/{{actor.system.attributes.hp.max}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#ff0000',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#6b6b6b',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Low HP',\r\n        },\r\n        group: 'Info Box',\r\n        i: 5,\r\n      },\r\n      {\r\n        id: 'k9Ws74Hc',\r\n        label: 'Actor AC',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 53,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'k9Ws74Hc',\r\n          parentID: 'W8BPK9hv',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.25,\r\n          offsetY: 0.46,\r\n          scaleX: 1,\r\n          scaleY: 1,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'AC: {{actor.system.attributes.ac.value}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Actor AC',\r\n        },\r\n        group: 'Info Box',\r\n        i: 6,\r\n      },\r\n      {\r\n        id: 'eIxjLZmy',\r\n        label: 'Movement Label',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 54,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'eIxjLZmy',\r\n          parentID: 'W8BPK9hv',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.25,\r\n          offsetY: 0.2,\r\n          scaleX: 0.61,\r\n          scaleY: 0.61,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Movement',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Movement Label',\r\n        },\r\n        group: 'Info Box',\r\n        i: 7,\r\n      },\r\n      {\r\n        id: 'k5xYpZAZ',\r\n        label: 'Movement Walk',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 55,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'k5xYpZAZ',\r\n          parentID: 'W8BPK9hv',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.36,\r\n          offsetY: -0.03,\r\n          scaleX: 1,\r\n          scaleY: 1,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '{{actor.system.attributes.movement.walk}}ft',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Movement Walk',\r\n        },\r\n        group: 'Info Box',\r\n        i: 8,\r\n      },\r\n      {\r\n        id: 'dHHZRQXG',\r\n        label: 'Movement Fly',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 56,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'dHHZRQXG',\r\n          parentID: 'W8BPK9hv',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.36,\r\n          offsetY: -0.16,\r\n          scaleX: 0.33,\r\n          scaleY: 0.33,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Fly {{actor.system.attributes.movement.fly}}, Swim {{actor.system.attributes.movement.swim}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Movement Fly',\r\n        },\r\n        group: 'Info Box',\r\n        i: 9,\r\n      },\r\n    ],\r\n    id: 'wuMcLy3T',\r\n  },\r\n  {\r\n    name: 'Info Box #2',\r\n    hint: 'Displays information about the token/actor when hovering over or controlling them. This box will adjust to canvas zoom.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/244750685-81988600-5153-4d29-acb0-2c62111bed14.png',\r\n    system: 'dnd5e',\r\n    mappings: [\r\n      {\r\n        id: 'f0pV6Pnl',\r\n        label: 'Box Background',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'f0pV6Pnl',\r\n          parentID: '',\r\n          ui: true,\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: true,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.55,\r\n          offsetY: 0,\r\n          scaleX: 1,\r\n          scaleY: 1,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: true,\r\n          limitOnHighlight: false,\r\n          limitOnControl: true,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'rectangle',\r\n                x: '0',\r\n                y: '0',\r\n                width: '200',\r\n                height: '300',\r\n                radius: '0',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: 2,\r\n                color: '#ffffff',\r\n                alpha: 1,\r\n              },\r\n              fill: {\r\n                color: '#2e5a94',\r\n                color2: '',\r\n                prc: '',\r\n                alpha: 0.9,\r\n              },\r\n            },\r\n          ],\r\n          effect: '',\r\n          label: 'Box Background',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 0,\r\n      },\r\n      {\r\n        id: 'n2Adi1fi',\r\n        label: 'HP',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 51,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'n2Adi1fi',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.45,\r\n          offsetY: 0.42,\r\n          scaleX: 0.84,\r\n          scaleY: 0.84,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'HP: {{actor.system.attributes.hp.value}}/{{actor.system.attributes.hp.max}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'HP',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 1,\r\n      },\r\n      {\r\n        id: 'hCKVzw3Z',\r\n        label: ' AC',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 52,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'hCKVzw3Z',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.45,\r\n          offsetY: 0.31,\r\n          scaleX: 0.84,\r\n          scaleY: 0.84,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'AC: {{actor.system.attributes.ac.value}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: ' AC',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 2,\r\n      },\r\n      {\r\n        id: '2nYmUTwu',\r\n        label: ' Speed',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 53,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: '2nYmUTwu',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.45,\r\n          offsetY: 0.2,\r\n          scaleX: 0.84,\r\n          scaleY: 0.84,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Speed: {{actor.system.attributes.movement.walk}}ft',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: ' Speed',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 3,\r\n      },\r\n      {\r\n        id: 's1NtDiUV',\r\n        label: 'Perception',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 54,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 's1NtDiUV',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: 0.15,\r\n          scaleX: 0.84,\r\n          scaleY: 0.84,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Perception',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Perception',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 4,\r\n      },\r\n      {\r\n        id: 'jYeRIoG2',\r\n        label: 'Passive Perception',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 55,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'jYeRIoG2',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.47,\r\n          offsetY: 0,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Passive: {{actor.system.skills.prc.passive}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Passive Perception',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 5,\r\n      },\r\n      {\r\n        id: 'KYMdkTVI',\r\n        label: 'Active Perception',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 56,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'KYMdkTVI',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.48,\r\n          offsetY: 0,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 1,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Active: {{actor.system.skills.prc.total}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Active Perception',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 6,\r\n      },\r\n      {\r\n        id: 'Ewbg54II',\r\n        label: 'CHA',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'Ewbg54II',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.31,\r\n          offsetY: -0.3,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'CHA\\\\n{{actor.system.abilities.cha.mod}} {{actor.system.abilities.cha.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'CHA',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 7,\r\n      },\r\n      {\r\n        id: '2le1Nagp',\r\n        label: 'CON',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: '2le1Nagp',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.31,\r\n          offsetY: -0.11,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'CON\\\\n{{actor.system.abilities.con.mod}} {{actor.system.abilities.con.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'CON',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 8,\r\n      },\r\n      {\r\n        id: 'ahKmjzLj',\r\n        label: 'DEX',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'ahKmjzLj',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: -0.11,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'DEX\\\\n{{actor.system.abilities.dex.mod}} {{actor.system.abilities.dex.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'DEX',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 9,\r\n      },\r\n      {\r\n        id: 'gQzyq0zm',\r\n        label: 'INT',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'gQzyq0zm',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.32,\r\n          offsetY: -0.3,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'INT\\\\n{{actor.system.abilities.int.mod}} {{actor.system.abilities.int.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'INT',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 10,\r\n      },\r\n      {\r\n        id: 'hYGg1oAt',\r\n        label: 'STR',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'hYGg1oAt',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.32,\r\n          offsetY: -0.11,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'STR\\\\n{{actor.system.abilities.str.mod}} {{actor.system.abilities.str.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'STR',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 11,\r\n      },\r\n      {\r\n        id: 'uQ5zS3K6',\r\n        label: 'WIS',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'uQ5zS3K6',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: -0.3,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'WIS\\\\n{{actor.system.abilities.wis.mod}} {{actor.system.abilities.wis.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'WIS',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 12,\r\n      },\r\n    ],\r\n    id: 'Wtq9HDsX',\r\n  },\r\n  {\r\n    name: 'Info Box #3',\r\n    hint: 'Displays information about the token/actor when hovering over or controlling them. This box will adjust to canvas zoom.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/244750246-794625b9-9e1d-4322-9265-fc295f02ca2b.png',\r\n    system: 'dnd5e',\r\n    mappings: [\r\n      {\r\n        id: 'Gt11vjXV',\r\n        label: 'Box Background',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'Gt11vjXV',\r\n          parentID: '',\r\n          ui: true,\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: true,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.55,\r\n          offsetY: 0,\r\n          scaleX: 1,\r\n          scaleY: 1,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: true,\r\n          limitOnHighlight: false,\r\n          limitOnControl: true,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'rectangle',\r\n                x: '0',\r\n                y: '0',\r\n                width: '240',\r\n                height: '300',\r\n                radius: '0',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: 2,\r\n                color: '#ffffff',\r\n                alpha: 1,\r\n              },\r\n              fill: {\r\n                color: '#2e5a94',\r\n                color2: '',\r\n                prc: '',\r\n                alpha: 0.9,\r\n              },\r\n            },\r\n          ],\r\n          effect: '',\r\n          label: 'Box Background',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 0,\r\n      },\r\n      {\r\n        id: 'o4XWzdDM',\r\n        label: 'HP',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 51,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'o4XWzdDM',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.44,\r\n          offsetY: 0.42,\r\n          scaleX: 0.84,\r\n          scaleY: 0.84,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: ' {{actor.system.attributes.hp.value}}/{{actor.system.attributes.hp.max}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'HP',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 1,\r\n      },\r\n      {\r\n        id: 'eAv2dSV6',\r\n        label: 'AC',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 52,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'eAv2dSV6',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.43,\r\n          offsetY: 0.28,\r\n          scaleX: 0.84,\r\n          scaleY: 0.84,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: ' {{actor.system.attributes.ac.value}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'AC',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 2,\r\n      },\r\n      {\r\n        id: 'SCfkWTni',\r\n        label: 'Fly Speed',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 53,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'SCfkWTni',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.04,\r\n          offsetY: 0.13,\r\n          scaleX: 0.84,\r\n          scaleY: 0.84,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: ' {{actor.system.attributes.movement.fly}}ft',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Fly Speed',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 3,\r\n      },\r\n      {\r\n        id: 'e5LPzVta',\r\n        label: 'Walk Speed',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 53,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'e5LPzVta',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.45,\r\n          offsetY: 0.13,\r\n          scaleX: 0.84,\r\n          scaleY: 0.84,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: ' {{actor.system.attributes.movement.walk}}ft',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Walk Speed',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 4,\r\n      },\r\n      {\r\n        id: 'XlopagaT',\r\n        label: 'Passive Perception',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 55,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'XlopagaT',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.45,\r\n          offsetY: -0.02,\r\n          scaleX: 0.83,\r\n          scaleY: 0.83,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: ' {{actor.system.skills.prc.passive}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Passive Perception',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 5,\r\n      },\r\n      {\r\n        id: 'CeXgVxA0',\r\n        label: 'Active Perception',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 56,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'CeXgVxA0',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.03,\r\n          offsetY: -0.02,\r\n          scaleX: 0.83,\r\n          scaleY: 0.83,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: ' {{actor.system.skills.prc.total}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Active Perception',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 6,\r\n      },\r\n      {\r\n        id: '0WWf1iGM',\r\n        label: 'CHA',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: '0WWf1iGM',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.31,\r\n          offsetY: -0.3,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'CHA\\\\n{{actor.system.abilities.cha.mod}}  {{actor.system.abilities.cha.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'CHA',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 7,\r\n      },\r\n      {\r\n        id: 'AU8tTXat',\r\n        label: 'CON',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'AU8tTXat',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.31,\r\n          offsetY: -0.11,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'CON\\\\n{{actor.system.abilities.con.mod}}  {{actor.system.abilities.con.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'CON',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 8,\r\n      },\r\n      {\r\n        id: 'JZKNmgvY',\r\n        label: 'DEX',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'JZKNmgvY',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: -0.11,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'DEX\\\\n{{actor.system.abilities.dex.mod}}  {{actor.system.abilities.dex.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'DEX',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 9,\r\n      },\r\n      {\r\n        id: 'AUGurJtx',\r\n        label: 'INT',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'AUGurJtx',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.32,\r\n          offsetY: -0.3,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'INT\\\\n{{actor.system.abilities.int.mod}}  {{actor.system.abilities.int.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'INT',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 10,\r\n      },\r\n      {\r\n        id: 'z0PMTFxo',\r\n        label: 'STR',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'z0PMTFxo',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.32,\r\n          offsetY: -0.11,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'STR\\\\n{{actor.system.abilities.str.mod}}  {{actor.system.abilities.str.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'STR',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 11,\r\n      },\r\n      {\r\n        id: 'YXUiGPBv',\r\n        label: 'WIS',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'YXUiGPBv',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: -0.3,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'WIS\\\\n{{actor.system.abilities.wis.mod}}  {{actor.system.abilities.wis.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'WIS',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 12,\r\n      },\r\n    ],\r\n    id: 'vQJ3coCJ',\r\n  },\r\n  {\r\n    name: 'Facing Direction',\r\n    hint: 'Displays an arrow in the top-right corner of the token showing the direction it is facing.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/244647284-2213caf5-6d49-4413-ab5f-83901ffbc8e6.png',\r\n    mappings: [\r\n      {\r\n        id: '9UEOkJ1J',\r\n        label: 'Arrow',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: '9UEOkJ1J',\r\n          parentID: '',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: true,\r\n          animation: {\r\n            relative: true,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.5,\r\n          offsetY: 0.5,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 90,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '➢',\r\n            fontFamily: 'Signika',\r\n            fontSize: 63,\r\n            letterSpacing: 0,\r\n            fill: '#ff0000',\r\n            dropShadow: null,\r\n            strokeThickness: 3,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Arrow',\r\n        },\r\n        group: 'Facing Direction',\r\n        i: 0,\r\n      },\r\n    ],\r\n    id: 'Z8CTgmOg',\r\n  },\r\n  {\r\n    name: 'Combat Markers',\r\n    hint: 'Displays rotating markers for tokens in combat.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/257478593-81b9192d-1ffe-4f0b-8e5d-806218d7e25f.png',\r\n    mappings: [\r\n      {\r\n        id: '9R3glzOK',\r\n        label: 'Your Turn is Next!',\r\n        expression: 'combat-turn-next',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          label: 'Your Turn is Next!',\r\n          parent: '',\r\n          underlay: true,\r\n          bottom: true,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: true,\r\n            duration: 30000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: false,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: 0,\r\n          scaleX: 1.6,\r\n          scaleY: 1.6,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Next Turn  =  = =  =  =  = Next turn =  =  =  =  = ',\r\n            fontFamily: 'Signika',\r\n            fontSize: 41,\r\n            letterSpacing: 0,\r\n            fill: '#e6a800',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 125,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n        },\r\n        group: 'Combat',\r\n        i: 0,\r\n      },\r\n      {\r\n        id: 'qoWG5AD0',\r\n        label: 'Your Turn!',\r\n        expression: 'combat-turn',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          label: 'Your Turn!',\r\n          parent: '',\r\n          underlay: true,\r\n          bottom: true,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: true,\r\n            duration: 30000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: false,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: 0,\r\n          scaleX: 1.6,\r\n          scaleY: 1.6,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '= Your Turn  =  = =  =  =  = Your turn =  =  =  =  =  ',\r\n            fontFamily: 'Signika',\r\n            fontSize: 41,\r\n            letterSpacing: 0,\r\n            fill: '#00ace6',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 125,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n        },\r\n        group: 'Combat',\r\n        i: 1,\r\n      },\r\n    ],\r\n    id: 'YpoX5zxO',\r\n  },\r\n  {\r\n    name: 'Disposition Markers',\r\n    hint: 'Displays circles underneath tokens coloured based on their disposition.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/246497702-5de47dc9-21ef-43a1-86db-b3f85eb8ddb1.png',\r\n    mappings: [\r\n      {\r\n        id: 'TzP6MBC1',\r\n        label: 'Friendly',\r\n        expression: 'disposition=1',\r\n        codeExp: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'TzP6MBC1',\r\n          parentID: '',\r\n          underlay: true,\r\n          bottom: true,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: '5000',\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          imgLinked: false,\r\n          repeating: false,\r\n          alpha: '1',\r\n          tint: '#1acb2f',\r\n          interpolateColor: {\r\n            color2: '',\r\n            prc: '',\r\n          },\r\n          width: '',\r\n          height: '',\r\n          scaleX: '0.24',\r\n          scaleY: '0.24',\r\n          angle: '0',\r\n          pOffsetX: '',\r\n          pOffsetY: '',\r\n          offsetX: '0',\r\n          offsetY: '0',\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedToOwner: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnHUD: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            repeating: false,\r\n            fontFamily: 'Signika',\r\n            fill: '#FFFFFF',\r\n            interpolateColor: {\r\n              color2: '',\r\n              prc: '',\r\n            },\r\n            fontSize: '36',\r\n            align: 'center',\r\n            letterSpacing: '0',\r\n            dropShadow: 'true',\r\n            strokeThickness: '1',\r\n            stroke: '#111111',\r\n            wordWrap: false,\r\n            wordWrapWidth: '200',\r\n            breakWords: false,\r\n            maxHeight: '0',\r\n            curve: {\r\n              angle: '0',\r\n              radius: '0',\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'ellipse',\r\n                x: '0',\r\n                y: '0',\r\n                width: '{{object.w}} * @scale',\r\n                height: '{{object.h}} * @scale',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: '0',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ffffff',\r\n                alpha: '0.75',\r\n                interpolateColor: {\r\n                  color2: '',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'ellipse',\r\n                x: '{{object.w}} * @inner',\r\n                y: '{{object.w}} * @inner',\r\n                width: '{{object.w}} * @scale - {{object.w}} * @inner',\r\n                height: '{{object.h}} * @scale - {{object.h}} * @inner',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: '0',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#b8b8b8',\r\n                alpha: '0.7',\r\n                interpolateColor: {\r\n                  color2: '',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n          ],\r\n          variables: [\r\n            {\r\n              name: 'scale',\r\n              value: '2.3',\r\n            },\r\n            {\r\n              name: 'inner',\r\n              value: '0.3',\r\n            },\r\n          ],\r\n          effect: '',\r\n          interactivity: [],\r\n          label: 'Friendly',\r\n        },\r\n        group: 'Disposition Markers',\r\n        i: 2,\r\n      },\r\n      {\r\n        id: 'oIsQWISB',\r\n        label: 'Hostile',\r\n        expression: 'disposition=-1',\r\n        codeExp: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'oIsQWISB',\r\n          parentID: '',\r\n          underlay: true,\r\n          bottom: true,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: '5000',\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          imgLinked: false,\r\n          repeating: false,\r\n          alpha: '1',\r\n          tint: '#eb0000',\r\n          interpolateColor: {\r\n            color2: '',\r\n            prc: '',\r\n          },\r\n          width: '',\r\n          height: '',\r\n          scaleX: '0.24',\r\n          scaleY: '0.24',\r\n          angle: '0',\r\n          pOffsetX: '',\r\n          pOffsetY: '',\r\n          offsetX: '0',\r\n          offsetY: '0',\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedToOwner: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnHUD: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            repeating: false,\r\n            fontFamily: 'Signika',\r\n            fill: '#FFFFFF',\r\n            interpolateColor: {\r\n              color2: '',\r\n              prc: '',\r\n            },\r\n            fontSize: '36',\r\n            align: 'center',\r\n            letterSpacing: '0',\r\n            dropShadow: 'true',\r\n            strokeThickness: '1',\r\n            stroke: '#111111',\r\n            wordWrap: false,\r\n            wordWrapWidth: '200',\r\n            breakWords: false,\r\n            maxHeight: '0',\r\n            curve: {\r\n              angle: '0',\r\n              radius: '0',\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'ellipse',\r\n                x: '0',\r\n                y: '0',\r\n                width: '{{object.w}} * @scale',\r\n                height: '{{object.h}} * @scale',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: '0',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ffffff',\r\n                alpha: '0.75',\r\n                interpolateColor: {\r\n                  color2: '',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'ellipse',\r\n                x: '{{object.w}} * @inner',\r\n                y: '{{object.w}} * @inner',\r\n                width: '{{object.w}} * @scale - {{object.w}} * @inner',\r\n                height: '{{object.h}} * @scale - {{object.h}} * @inner',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: '0',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#b8b8b8',\r\n                alpha: '0.7',\r\n                interpolateColor: {\r\n                  color2: '',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n          ],\r\n          variables: [\r\n            {\r\n              name: 'scale',\r\n              value: '2.3',\r\n            },\r\n            {\r\n              name: 'inner',\r\n              value: '0.3',\r\n            },\r\n          ],\r\n          effect: '',\r\n          interactivity: [],\r\n          label: 'Hostile',\r\n        },\r\n        group: 'Disposition Markers',\r\n        i: 3,\r\n      },\r\n      {\r\n        id: 'fYxJ9Bbc',\r\n        label: 'Neutral',\r\n        expression: 'disposition=0',\r\n        codeExp: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'fYxJ9Bbc',\r\n          parentID: '',\r\n          underlay: true,\r\n          bottom: true,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: '5000',\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          imgLinked: false,\r\n          repeating: false,\r\n          alpha: '1',\r\n          tint: '',\r\n          interpolateColor: {\r\n            color2: '',\r\n            prc: '',\r\n          },\r\n          width: '',\r\n          height: '',\r\n          scaleX: '0.24',\r\n          scaleY: '0.24',\r\n          angle: '0',\r\n          pOffsetX: '',\r\n          pOffsetY: '',\r\n          offsetX: '0',\r\n          offsetY: '0',\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedToOwner: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnHUD: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            repeating: false,\r\n            fontFamily: 'Signika',\r\n            fill: '#FFFFFF',\r\n            interpolateColor: {\r\n              color2: '',\r\n              prc: '',\r\n            },\r\n            fontSize: '36',\r\n            align: 'center',\r\n            letterSpacing: '0',\r\n            dropShadow: 'true',\r\n            strokeThickness: '1',\r\n            stroke: '#111111',\r\n            wordWrap: false,\r\n            wordWrapWidth: '200',\r\n            breakWords: false,\r\n            maxHeight: '0',\r\n            curve: {\r\n              angle: '0',\r\n              radius: '0',\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'ellipse',\r\n                x: '0',\r\n                y: '0',\r\n                width: '{{object.w}} * @scale',\r\n                height: '{{object.h}} * @scale',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: '0',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ffffff',\r\n                alpha: '0.75',\r\n                interpolateColor: {\r\n                  color2: '',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'ellipse',\r\n                x: '{{object.w}} * @inner',\r\n                y: '{{object.w}} * @inner',\r\n                width: '{{object.w}} * @scale - {{object.w}} * @inner',\r\n                height: '{{object.h}} * @scale - {{object.h}} * @inner',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: '0',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#b8b8b8',\r\n                alpha: '0.7',\r\n                interpolateColor: {\r\n                  color2: '',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n          ],\r\n          variables: [\r\n            {\r\n              name: 'scale',\r\n              value: '2.3',\r\n            },\r\n            {\r\n              name: 'inner',\r\n              value: '0.3',\r\n            },\r\n          ],\r\n          effect: '',\r\n          interactivity: [],\r\n          label: 'Neutral',\r\n        },\r\n        group: 'Disposition Markers',\r\n        i: 4,\r\n      },\r\n      {\r\n        id: 'PyEXXb5J',\r\n        label: 'Secret',\r\n        expression: 'disposition=-2',\r\n        codeExp: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'PyEXXb5J',\r\n          parentID: '',\r\n          underlay: true,\r\n          bottom: true,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: '5000',\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          imgLinked: false,\r\n          repeating: false,\r\n          alpha: '1',\r\n          tint: '#ba24ff',\r\n          interpolateColor: {\r\n            color2: '',\r\n            prc: '',\r\n          },\r\n          width: '',\r\n          height: '',\r\n          scaleX: '0.24',\r\n          scaleY: '0.24',\r\n          angle: '0',\r\n          pOffsetX: '',\r\n          pOffsetY: '',\r\n          offsetX: '0',\r\n          offsetY: '0',\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedToOwner: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnHUD: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            repeating: false,\r\n            fontFamily: 'Signika',\r\n            fill: '#FFFFFF',\r\n            interpolateColor: {\r\n              color2: '',\r\n              prc: '',\r\n            },\r\n            fontSize: '36',\r\n            align: 'center',\r\n            letterSpacing: '0',\r\n            dropShadow: 'true',\r\n            strokeThickness: '1',\r\n            stroke: '#111111',\r\n            wordWrap: false,\r\n            wordWrapWidth: '200',\r\n            breakWords: false,\r\n            maxHeight: '0',\r\n            curve: {\r\n              angle: '0',\r\n              radius: '0',\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'ellipse',\r\n                x: '0',\r\n                y: '0',\r\n                width: '{{object.w}} * @scale',\r\n                height: '{{object.h}} * @scale',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: '0',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ffffff',\r\n                alpha: '0.75',\r\n                interpolateColor: {\r\n                  color2: '',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'ellipse',\r\n                x: '{{object.w}} * @inner',\r\n                y: '{{object.w}} * @inner',\r\n                width: '{{object.w}} * @scale - {{object.w}} * @inner',\r\n                height: '{{object.h}} * @scale - {{object.h}} * @inner',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: '0',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#b8b8b8',\r\n                alpha: '0.7',\r\n                interpolateColor: {\r\n                  color2: '',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n          ],\r\n          variables: [\r\n            {\r\n              name: 'scale',\r\n              value: '2.3',\r\n            },\r\n            {\r\n              name: 'inner',\r\n              value: '0.3',\r\n            },\r\n          ],\r\n          effect: '',\r\n          interactivity: [],\r\n          label: 'Secret',\r\n        },\r\n        group: 'Disposition Markers',\r\n        i: 5,\r\n      },\r\n    ],\r\n    id: 'yjqfAagB',\r\n  },\r\n  {\r\n    name: 'Health Bar',\r\n    hint: 'A recreation of the standard health bar using Overlays.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/257246890-d41894a0-7f40-4e91-a47a-bc10d6f198e6.png',\r\n    group: 'Health',\r\n    mappings: [\r\n      {\r\n        id: 'dgIBKbcU',\r\n        label: 'Health Bar',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'dgIBKbcU',\r\n          parentID: '',\r\n          ui: true,\r\n          underlay: true,\r\n          bottom: true,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          repeating: false,\r\n          alpha: 1,\r\n          tint: '',\r\n          interpolateColor: {\r\n            color2: '',\r\n            prc: '',\r\n          },\r\n          offsetX: 0,\r\n          offsetY: -0.5,\r\n          scaleX: 1,\r\n          scaleY: 1,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 1,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            repeating: false,\r\n            fontFamily: 'Signika',\r\n            fill: '#FFFFFF',\r\n            interpolateColor: {\r\n              color2: '',\r\n              prc: '',\r\n            },\r\n            fontSize: 36,\r\n            align: 'left',\r\n            letterSpacing: 0,\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'rectangle',\r\n                x: '0',\r\n                y: '0',\r\n                width: '{{object.w}}',\r\n                height: '{{object.h}} * @height',\r\n                radius: '3',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: 1,\r\n                color: '#000000',\r\n                alpha: 1,\r\n              },\r\n              fill: {\r\n                color: '#5c5c5c',\r\n                alpha: 0.65,\r\n                interpolateColor: {\r\n                  color2: '',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'rectangle',\r\n                x: '0',\r\n                y: '0',\r\n                width: '{{object.w}} * ( {{hp}} / {{hpMax}} )',\r\n                height: '{{object.h}} * @height',\r\n                radius: '3',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: 1,\r\n                color: '#000000',\r\n                alpha: 1,\r\n              },\r\n              fill: {\r\n                color: '#ff0000',\r\n                alpha: 1,\r\n                interpolateColor: {\r\n                  color2: '#74da0e',\r\n                  prc: '{{hp}} / {{hpMax}}',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n          ],\r\n          variables: [\r\n            {\r\n              name: 'height',\r\n              value: '0.079',\r\n            },\r\n          ],\r\n          effect: '',\r\n          label: 'Health Bar',\r\n        },\r\n        group: 'Health Bar',\r\n        i: 0,\r\n      },\r\n    ],\r\n    id: 'GDyvkEB4',\r\n  },\r\n  {\r\n    name: 'Health Ring',\r\n    hint: 'A ring shaped health bar.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/257246432-a339394f-489a-4436-9d4b-427c285d4f27.png',\r\n    group: 'Health',\r\n    mappings: [\r\n      {\r\n        id: 'erOTHzIc',\r\n        label: 'Health Ring',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'erOTHzIc',\r\n          parentID: '',\r\n          ui: true,\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          repeating: false,\r\n          alpha: 1,\r\n          tint: '',\r\n          interpolateColor: {\r\n            color2: '',\r\n            prc: '',\r\n          },\r\n          offsetX: 0,\r\n          offsetY: 0,\r\n          scaleX: 1.02,\r\n          scaleY: 1.02,\r\n          angle: -90,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            repeating: false,\r\n            fontFamily: 'Signika',\r\n            fill: '#ffffff',\r\n            interpolateColor: {\r\n              color2: '',\r\n              prc: '',\r\n            },\r\n            fontSize: 36,\r\n            align: 'left',\r\n            letterSpacing: 0,\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '{{object.w}} / @ringScale * @innerRadius',\r\n                outerRadius: '{{object.w}} / @ringScale * @outerRadius',\r\n                startAngle: '0',\r\n                endAngle: '360',\r\n              },\r\n              label: 'Background',\r\n              line: {\r\n                width: 0,\r\n                color: '#000000',\r\n                alpha: 1,\r\n              },\r\n              fill: {\r\n                color: '#b0b0b0',\r\n                alpha: 0.6,\r\n                interpolateColor: {\r\n                  color2: '',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '{{object.w}} / @ringScale * @innerRadius',\r\n                outerRadius: '{{object.w}} / @ringScale * @outerRadius',\r\n                startAngle: '0',\r\n                endAngle: '{{hp}} / {{hpMax}} * 360',\r\n              },\r\n              label: 'Health Tracker',\r\n              line: {\r\n                width: 0,\r\n                color: '#000000',\r\n                alpha: 1,\r\n              },\r\n              fill: {\r\n                color: '#ff0000',\r\n                alpha: 1,\r\n                interpolateColor: {\r\n                  color2: '#74da0e',\r\n                  prc: '{{hp}} / {{hpMax}}',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '{{object.w}} / @ringScale * @innerRadius',\r\n                outerRadius: '{{object.w}} / @ringScale * @outerRadius',\r\n                startAngle: '0',\r\n                endAngle: '360',\r\n              },\r\n              label: 'Outline',\r\n              line: {\r\n                width: 1,\r\n                color: '#000000',\r\n                alpha: 1,\r\n              },\r\n              fill: {\r\n                color: '#b0b0b0',\r\n                alpha: 0,\r\n                interpolateColor: {\r\n                  color2: '',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n          ],\r\n          variables: [\r\n            {\r\n              name: 'ringScale',\r\n              value: '1.8',\r\n            },\r\n            {\r\n              name: 'innerRadius',\r\n              value: '0.9',\r\n            },\r\n            {\r\n              name: 'outerRadius',\r\n              value: '1.0',\r\n            },\r\n          ],\r\n          effect: '',\r\n          label: 'Health Ring',\r\n        },\r\n        group: 'Health Ring',\r\n        i: 0,\r\n      },\r\n    ],\r\n    id: 'yITi94hC',\r\n  },\r\n  {\r\n    name: 'Health Hearts',\r\n    hint: 'Displays up to 10 hearts to the right of the token based on their current health. Each heart is representative of 10% of the health.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/257349483-1864d4ca-a2de-468d-872d-6d8c2847434a.png',\r\n    group: 'Health',\r\n    mappings: [\r\n      {\r\n        id: '4uCpbtHY',\r\n        label: 'Hearts',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: '4uCpbtHY',\r\n          parentID: '',\r\n          ui: true,\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: true,\r\n          linkDimensionsY: true,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.53,\r\n          offsetY: 0.5,\r\n          scaleX: 0.5,\r\n          scaleY: 0.5,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: ' ',\r\n            repeating: true,\r\n            repeat: {\r\n              value: '{{hp}}',\r\n              increment: '10',\r\n              isPercentage: true,\r\n              maxValue: '{{hpMax}}',\r\n              perRow: '2',\r\n              maxRows: '',\r\n            },\r\n            fontFamily: 'Signika',\r\n            fill: '#ff0000',\r\n            fontSize: 36,\r\n            align: 'left',\r\n            letterSpacing: 0,\r\n            dropShadow: null,\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Hearts',\r\n        },\r\n        group: 'Health Hearts',\r\n        i: 0,\r\n      },\r\n    ],\r\n    id: 'T2DrD0Em',\r\n  },\r\n  {\r\n    name: 'Health Circles',\r\n    hint: 'Displays up to 10 circles to the right of the token based on their current health. Each circle is representative of 10% of the health.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/257476414-c42bdbc0-c57b-4367-8207-3e2e4273094f.png',\r\n    group: 'Health',\r\n    mappings: [\r\n      {\r\n        id: '0vETg18v',\r\n        label: 'Health Circles',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: '0vETg18v',\r\n          parentID: '',\r\n          ui: true,\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: true,\r\n          linkDimensionsY: true,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          repeating: false,\r\n          alpha: 1,\r\n          tint: '',\r\n          interpolateColor: {\r\n            color2: '',\r\n            prc: '',\r\n          },\r\n          offsetX: -0.52,\r\n          offsetY: 0.6,\r\n          scaleX: 0.46,\r\n          scaleY: 0.46,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            repeating: false,\r\n            fontFamily: 'Signika',\r\n            fill: '#ffffff',\r\n            interpolateColor: {\r\n              color2: '',\r\n              prc: '',\r\n            },\r\n            fontSize: 36,\r\n            align: 'left',\r\n            letterSpacing: 0,\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'ellipse',\r\n                x: '0',\r\n                y: '0',\r\n                width: '25',\r\n                height: '25',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: 1,\r\n                color: '#000000',\r\n                alpha: 1,\r\n              },\r\n              fill: {\r\n                color: '#ff0000',\r\n                alpha: 1,\r\n                interpolateColor: {\r\n                  color2: '#74da0e',\r\n                  prc: '{{hp}} / {{hpMax}}',\r\n                },\r\n              },\r\n              repeating: true,\r\n              repeat: {\r\n                value: '{{hp}}',\r\n                increment: '10',\r\n                isPercentage: true,\r\n                maxValue: '{{hpMax}}',\r\n                perRow: '2',\r\n                maxRows: '',\r\n                paddingX: '3',\r\n                paddingY: '3',\r\n              },\r\n            },\r\n          ],\r\n          effect: '',\r\n          label: 'Health Circles',\r\n        },\r\n        group: 'Health Circles',\r\n        i: 0,\r\n      },\r\n    ],\r\n    id: 'kJ0Fi54w',\r\n  },\r\n  {\r\n    name: 'Health Squares',\r\n    hint: 'Displays up to 10 squares to the right of the token based on their current health. Each square is representative of 10% of the health.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/257477099-689cd23a-0e4a-4d9a-aaa2-bf88b169ede8.png',\r\n    group: 'Health',\r\n    mappings: [\r\n      {\r\n        id: '0vETg18v',\r\n        label: 'Health Squares',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: '0vETg18v',\r\n          parentID: '',\r\n          ui: true,\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: true,\r\n          linkDimensionsY: true,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          repeating: false,\r\n          alpha: 1,\r\n          tint: '',\r\n          interpolateColor: {\r\n            color2: '',\r\n            prc: '',\r\n          },\r\n          offsetX: -0.52,\r\n          offsetY: 0.6,\r\n          scaleX: 0.46,\r\n          scaleY: 0.46,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            repeating: false,\r\n            fontFamily: 'Signika',\r\n            fill: '#ffffff',\r\n            interpolateColor: {\r\n              color2: '',\r\n              prc: '',\r\n            },\r\n            fontSize: 36,\r\n            align: 'left',\r\n            letterSpacing: 0,\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'rectangle',\r\n                x: '0',\r\n                y: '0',\r\n                width: '50',\r\n                height: '50',\r\n                radius: '0',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: 1,\r\n                color: '#000000',\r\n                alpha: 1,\r\n              },\r\n              fill: {\r\n                color: '#ff0000',\r\n                alpha: 1,\r\n                interpolateColor: {\r\n                  color2: '#74da0e',\r\n                  prc: '{{hp}} / {{hpMax}}',\r\n                },\r\n              },\r\n              repeating: true,\r\n              repeat: {\r\n                value: '{{hp}}',\r\n                increment: '10',\r\n                isPercentage: true,\r\n                maxValue: '{{hpMax}}',\r\n                perRow: '2',\r\n                maxRows: '',\r\n                paddingX: '3',\r\n                paddingY: '3',\r\n              },\r\n            },\r\n          ],\r\n          effect: '',\r\n          label: 'Health Squares',\r\n        },\r\n        group: 'Health Squares',\r\n        i: 0,\r\n      },\r\n    ],\r\n    id: 'zzeRhmmk',\r\n  },\r\n  {\r\n    name: 'Spell Slot Ring',\r\n    hint: 'Remaining spell slots represented as a ring.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/261663740-444d86b9-ee9f-4a2f-963f-6886a2af29cc.png',\r\n    system: 'dnd5e',\r\n    mappings: [\r\n      {\r\n        id: '1SS3KhwM',\r\n        label: 'Spell Slot Ring',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: '1SS3KhwM',\r\n          parentID: '',\r\n          ui: true,\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: '5000',\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          repeating: false,\r\n          alpha: '1',\r\n          tint: '',\r\n          interpolateColor: {\r\n            color2: '',\r\n            prc: '',\r\n          },\r\n          width: '{{object.w}} * @Scale',\r\n          height: '{{object.w}} * @Scale',\r\n          scaleX: '1',\r\n          scaleY: '1',\r\n          angle: '0',\r\n          offsetX: '0',\r\n          offsetY: '0',\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedToOwner: true,\r\n          limitedUsers: [],\r\n          limitOnHover: true,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            repeating: false,\r\n            fontFamily: 'Signika',\r\n            fill: '#ffffff',\r\n            interpolateColor: {\r\n              color2: '',\r\n              prc: '',\r\n            },\r\n            fontSize: '36',\r\n            align: 'left',\r\n            letterSpacing: '0',\r\n            dropShadow: 'true',\r\n            strokeThickness: '1',\r\n            stroke: '#111111',\r\n            wordWrap: false,\r\n            wordWrapWidth: '200',\r\n            breakWords: false,\r\n            maxHeight: '0',\r\n            curve: {\r\n              angle: '0',\r\n              radius: '0',\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer ',\r\n                startAngle: '0',\r\n                endAngle: '360',\r\n              },\r\n              label: 'BaseLayer',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#3b3b3b',\r\n                alpha: '1',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90',\r\n                endAngle: '-90 + ( {{actor.system.spells.spell1.value}} * @Tick )',\r\n              },\r\n              label: '1st level',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff0000',\r\n                alpha: '1',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 4 * @Tick )',\r\n                endAngle: '-90 + ( 4 * @Tick ) + ( {{actor.system.spells.spell2.value}} * @Tick )',\r\n              },\r\n              label: '2nd Level',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff8800',\r\n                alpha: '1',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 7 * @Tick )',\r\n                endAngle: '-90 + ( 7 * @Tick ) + ( {{actor.system.spells.spell3.value}} * @Tick )',\r\n              },\r\n              label: '3rd Level',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ffdd00',\r\n                alpha: '1',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 10 * @Tick )',\r\n                endAngle: '-90 + ( 10 * @Tick ) + ( {{actor.system.spells.spell4.value}} * @Tick )',\r\n              },\r\n              label: '4th Level',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#37ff00',\r\n                alpha: '1',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 13 * @Tick )',\r\n                endAngle: '-90 + ( 13 * @Tick ) + ( {{actor.system.spells.spell5.value}} * @Tick )',\r\n              },\r\n              label: '5th Level',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#00ffcc',\r\n                alpha: '0.95',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 16 * @Tick )',\r\n                endAngle: '-90 + ( 16 * @Tick ) + ( {{actor.system.spells.spell6.value}} * @Tick )',\r\n              },\r\n              label: '6th Level',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#00b3ff',\r\n                alpha: '1',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 18 * @Tick )',\r\n                endAngle: '-90 + ( 18 * @Tick ) + ( {{actor.system.spells.spell7.value}} * @Tick )',\r\n              },\r\n              label: '7th Level',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#001eff',\r\n                alpha: '1',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 20 * @Tick )',\r\n                endAngle: '-90 + ( 20 * @Tick ) + ( {{actor.system.spells.spell8.value}} * @Tick )',\r\n              },\r\n              label: '8th Level',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ae00ff',\r\n                alpha: '1',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 21 * @Tick )',\r\n                endAngle: '-90 + ( 21 * @Tick ) + ( {{actor.system.spells.spell9.value}} * @Tick )',\r\n              },\r\n              label: '9th Level - Copy',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '1',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90',\r\n                endAngle: '-90 + ( 1 * @Tick )',\r\n              },\r\n              label: 'Outline 1',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 1 * @Tick )',\r\n                endAngle: '-90 + ( 2 * @Tick )',\r\n              },\r\n              label: 'Outline 2',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 2 * @Tick )',\r\n                endAngle: '-90 + ( 3 * @Tick )',\r\n              },\r\n              label: 'Outline 3',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 3 * @Tick )',\r\n                endAngle: '-90 + ( 4 * @Tick )',\r\n              },\r\n              label: 'Outline 4',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 4 * @Tick )',\r\n                endAngle: '-90 + ( 5 * @Tick )',\r\n              },\r\n              label: 'Outline 5',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 5 * @Tick )',\r\n                endAngle: '-90 + ( 6 * @Tick )',\r\n              },\r\n              label: 'Outline 6',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 6 * @Tick )',\r\n                endAngle: '-90 + ( 7 * @Tick )',\r\n              },\r\n              label: 'Outline 7',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 7 * @Tick )',\r\n                endAngle: '-90 + ( 8 * @Tick )',\r\n              },\r\n              label: 'Outline 8',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 8 * @Tick )',\r\n                endAngle: '-90 + ( 9 * @Tick )',\r\n              },\r\n              label: 'Outline 9',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 9 * @Tick )',\r\n                endAngle: '-90 + ( 10 * @Tick )',\r\n              },\r\n              label: 'Outline 10',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 10 * @Tick )',\r\n                endAngle: '-90 + ( 11 * @Tick )',\r\n              },\r\n              label: 'Outline 11',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 11 * @Tick )',\r\n                endAngle: '-90 + ( 12 * @Tick )',\r\n              },\r\n              label: 'Outline 12',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 12 * @Tick )',\r\n                endAngle: '-90 + ( 13 * @Tick )',\r\n              },\r\n              label: 'Outline 13',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 13 * @Tick )',\r\n                endAngle: '-90 + ( 14 * @Tick )',\r\n              },\r\n              label: 'Outline 14',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 14 * @Tick )',\r\n                endAngle: '-90 + ( 15 * @Tick )',\r\n              },\r\n              label: 'Outline 15',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 15 * @Tick )',\r\n                endAngle: '-90 + ( 16 * @Tick )',\r\n              },\r\n              label: 'Outline 16',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 16 * @Tick )',\r\n                endAngle: '-90 + ( 17 * @Tick )',\r\n              },\r\n              label: 'Outline 17',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 17 * @Tick )',\r\n                endAngle: '-90 + ( 18 * @Tick )',\r\n              },\r\n              label: 'Outline 18',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 18 * @Tick )',\r\n                endAngle: '-90 + ( 19 * @Tick )',\r\n              },\r\n              label: 'Outline 19',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 19 * @Tick )',\r\n                endAngle: '-90 + ( 20 * @Tick )',\r\n              },\r\n              label: 'Outline 20',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 20 * @Tick )',\r\n                endAngle: '-90 + ( 21 * @Tick )',\r\n              },\r\n              label: 'Outline 21',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 21 * @Tick )',\r\n                endAngle: '-90 + ( 22 * @Tick )',\r\n              },\r\n              label: 'Outline 22',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n          ],\r\n          variables: [\r\n            {\r\n              name: 'Tick',\r\n              value: '16.3636363636363636',\r\n            },\r\n            {\r\n              name: 'Inner',\r\n              value: '66',\r\n            },\r\n            {\r\n              name: 'Outer',\r\n              value: '80',\r\n            },\r\n            {\r\n              name: 'Scale',\r\n              value: '1.8',\r\n            },\r\n          ],\r\n          effect: '',\r\n          label: 'Spell Slot Ring',\r\n        },\r\n        group: 'Spell Slot Ring',\r\n        i: 0,\r\n      },\r\n      {\r\n        id: '3IAo8ZUu',\r\n        label: 'Spell Slot Numbers',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 60,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: '3IAo8ZUu',\r\n          parentID: '',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: '5000',\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          repeating: false,\r\n          alpha: '1',\r\n          tint: '',\r\n          interpolateColor: {\r\n            color2: '',\r\n            prc: '',\r\n          },\r\n          width: '{{object.w}} * @Scale',\r\n          height: '{{object.w}} * @Scale',\r\n          scaleX: '1',\r\n          scaleY: '1',\r\n          angle: '1',\r\n          offsetX: '0',\r\n          offsetY: '0.009',\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedToOwner: true,\r\n          limitedUsers: [],\r\n          limitOnHover: true,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '4455566778911112223334',\r\n            repeating: false,\r\n            fontFamily: 'Signika',\r\n            fill: '#ffffff',\r\n            interpolateColor: {\r\n              color2: '',\r\n              prc: '',\r\n            },\r\n            fontSize: '45',\r\n            align: 'left',\r\n            letterSpacing: '41.5',\r\n            dropShadow: null,\r\n            strokeThickness: '4',\r\n            stroke: '#111111',\r\n            wordWrap: false,\r\n            wordWrapWidth: '200',\r\n            breakWords: false,\r\n            maxHeight: '0',\r\n            curve: {\r\n              angle: '360',\r\n              radius: '220',\r\n              invert: false,\r\n            },\r\n          },\r\n          variables: [\r\n            {\r\n              name: 'Scale',\r\n              value: '1.85',\r\n            },\r\n          ],\r\n          effect: '',\r\n          label: 'Spell Slot Numbers',\r\n        },\r\n        group: 'Spell Slot Ring',\r\n        i: 1,\r\n      },\r\n    ],\r\n    id: 'FeFzTjjE',\r\n  },\r\n];\r\n","import { CORE_TEMPLATES } from '../scripts/mappingTemplates.js';\r\nimport { TVA_CONFIG, updateSettings } from '../scripts/settings.js';\r\nimport { showMappingSelectDialog, showUserTemplateCreateDialog } from './dialogs.js';\r\n\r\nexport class Templates extends FormApplication {\r\n  constructor({ mappings = null, callback = null } = {}) {\r\n    super({}, {});\r\n    this.mappings = mappings;\r\n    this.callback = callback;\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-templates',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/templates.html',\r\n      resizable: false,\r\n      minimizable: false,\r\n      title: 'Mapping Templates',\r\n      width: 500,\r\n      height: 'auto',\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n\r\n    if (!this.category) this.category = TVA_CONFIG.templateMappings?.length ? 'user' : 'core';\r\n    if (this.category === 'user') {\r\n      this.templates = TVA_CONFIG.templateMappings;\r\n    } else if (this.category === 'core') {\r\n      this.templates = CORE_TEMPLATES;\r\n    } else {\r\n      this.templates = await communityTemplates();\r\n    }\r\n\r\n    for (const template of this.templates) {\r\n      template.hint = template.hint?.replace(/(\\r\\n|\\n|\\r)/gm, '<br>');\r\n    }\r\n\r\n    data.category = this.category;\r\n    data.templates = this.templates;\r\n    data.allowDelete = this.category === 'user';\r\n    data.allowCreate = this.category === 'user';\r\n    data.allowCopy = this.category === 'community' || this.category === 'core';\r\n\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n\r\n    // Position tooltip\r\n    const appWindow = html.closest('#token-variants-templates');\r\n    html.find('.template').on('mouseover', (event) => {\r\n      const template = $(event.target).closest('.template');\r\n      const pos = template.position();\r\n      const tooltip = template.find('.tooltiptext');\r\n      const windowPos = appWindow.position();\r\n      tooltip.css('top', windowPos.top + pos.top).css('left', windowPos.left + pos.left);\r\n\r\n      // Lazy load image\r\n      const img = template.find('img');\r\n      if (!img.attr('src')) img.attr('src', img.data('src'));\r\n    });\r\n\r\n    if (this.callback) {\r\n      html.find('.template').on('click', async (event) => {\r\n        const li = $(event.target).closest('.template');\r\n        const id = li.data('id');\r\n        const url = li.data('url');\r\n        let mappings;\r\n        let templateName;\r\n        if (url) {\r\n          const template = await getTemplateFromFileURL(url);\r\n          if (template) mappings = template.mappings;\r\n        } else if (id) {\r\n          const template = this.templates.find((t) => t.id === id);\r\n          if (template) {\r\n            templateName = template.name;\r\n            mappings = template.mappings;\r\n          }\r\n        }\r\n\r\n        if (mappings) this.callback(templateName, mappings);\r\n      });\r\n    }\r\n\r\n    html.find('.search').on('input', () => {\r\n      const filter = html.find('.search').val().trim().toLowerCase();\r\n      html.find('.template-list li').each(function () {\r\n        const li = $(this);\r\n        const description = li.find('.description').text().trim().toLowerCase();\r\n        const name = li.data('name').trim().toLowerCase();\r\n        const createdBy = li.data('creator').trim().toLowerCase();\r\n        if (name.includes(filter) || description.includes(filter) || createdBy.includes(filter)) li.show();\r\n        else li.hide();\r\n      });\r\n    });\r\n\r\n    html.find('[name=\"category\"]').on('change', (event) => {\r\n      this.category = event.target.value;\r\n      this.render(true);\r\n    });\r\n\r\n    html.find('.delete').on('click', async (event) => {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n\r\n      const id = $(event.target).closest('.template').data('id');\r\n      if (id) {\r\n        await updateSettings({\r\n          templateMappings: TVA_CONFIG.templateMappings.filter((m) => m.id !== id),\r\n        });\r\n        this.render(true);\r\n      }\r\n    });\r\n\r\n    html.find('.copy').on('click', async (event) => {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n\r\n      const id = $(event.target).closest('.template').data('id');\r\n      if (id) {\r\n        let template;\r\n        if (this.category === 'core') {\r\n          template = deepClone(CORE_TEMPLATES.find((t) => t.id === id));\r\n        } else {\r\n          const fileURL = $(event.target).closest('.template').data('url');\r\n          if (fileURL) template = await getTemplateFromFileURL(fileURL);\r\n        }\r\n\r\n        if (template) {\r\n          TVA_CONFIG.templateMappings.push(template);\r\n          await updateSettings({\r\n            templateMappings: TVA_CONFIG.templateMappings,\r\n          });\r\n          ui.notifications.info(`Template {${template.name}} copied to User templates.`);\r\n          this.render(true);\r\n        }\r\n      }\r\n    });\r\n\r\n    html.find('.create').on('click', () => {\r\n      showMappingSelectDialog(this.mappings, {\r\n        title1: 'Create Template',\r\n        callback: (selectedMappings) => {\r\n          if (selectedMappings.length) showUserTemplateCreateDialog(selectedMappings);\r\n        },\r\n      });\r\n    });\r\n  }\r\n\r\n  _getHeaderButtons() {\r\n    const buttons = super._getHeaderButtons();\r\n    buttons.unshift({\r\n      label: 'Upload Template',\r\n      class: '.token-variants-submit-template',\r\n      icon: 'fa-solid fa-cloud-arrow-up',\r\n      onclick: () => {\r\n        new TemplateSubmissionForm().render(true);\r\n      },\r\n    });\r\n    return buttons;\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {}\r\n}\r\n\r\nclass TemplateSubmissionForm extends FormApplication {\r\n  constructor() {\r\n    super({}, {});\r\n  }\r\n\r\n  static apiKey = 'AIzaSyCJpwIkpjrG10jaHwcpllvSChxRPawcMXE';\r\n\r\n  static get pk() {\r\n    const k2 = 'AIzaSyCJpw';\r\n    const k1 = 'IkpjrG10jaHwcpllv';\r\n    const k3 = 'SChxRPawcMXE';\r\n    return k2 + k1 + k3;\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-template-submission',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/templateSubmission.html',\r\n      resizable: true,\r\n      minimizable: false,\r\n      closeOnSubmit: false,\r\n      title: 'Upload Template',\r\n      width: 500,\r\n      height: 'auto',\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n\r\n    data.systemID = game.system.id;\r\n    data.systemTitle = game.system.title;\r\n    data.templates = TVA_CONFIG.templateMappings;\r\n\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {\r\n    if (!formData.template) return;\r\n    let template = TVA_CONFIG.templateMappings.find((t) => t.id === formData.template);\r\n    if (!template) return;\r\n\r\n    const name = formData.name.trim() || template.name;\r\n    const hint = formData.hint.trim() || template.hint?.trim();\r\n    const createdBy = formData.createdBy.trim();\r\n    const system = formData.system;\r\n    const id = randomID();\r\n    const img = formData.img.trim();\r\n\r\n    const result = submitTemplate({ id, name, hint, img, createdBy, system, mappings: template.mappings });\r\n    if (result) this.close();\r\n  }\r\n}\r\n\r\nfunction _setStringField(template, fields, field) {\r\n  if (template[field] && template[field] !== '') {\r\n    fields[field] = { stringValue: template[field] };\r\n  }\r\n}\r\n\r\nasync function submitTemplate(template) {\r\n  const fields = {};\r\n  ['name', 'hint', 'img', 'id', 'createdBy', 'system'].forEach((field) => _setStringField(template, fields, field));\r\n  fields.mappings = { stringValue: JSON.stringify(template.mappings) };\r\n  fields.createTime = { integerValue: new Date().getTime() };\r\n  fields.approved = { booleanValue: false };\r\n\r\n  const response = await fetch(\r\n    `https://firestore.googleapis.com/v1/projects/tva---templates/databases/(default)/documents/templates?key=${TemplateSubmissionForm.pk}`,\r\n    {\r\n      method: 'POST',\r\n      body: JSON.stringify({\r\n        fields: fields,\r\n      }),\r\n      headers: {\r\n        Accept: 'application/json',\r\n        'Content-Type': 'application/json',\r\n      },\r\n    }\r\n  );\r\n\r\n  if (response.ok && response.status === 200) {\r\n    ui.notifications.info('Template submission completed.');\r\n    return true;\r\n  } else {\r\n    ui.notifications.warn('Template submission failed.');\r\n    return false;\r\n  }\r\n}\r\n\r\nconst SEARCH_QUERY = {\r\n  structuredQuery: {\r\n    select: {\r\n      fields: [\r\n        {\r\n          fieldPath: 'id',\r\n        },\r\n        {\r\n          fieldPath: 'name',\r\n        },\r\n        {\r\n          fieldPath: 'hint',\r\n        },\r\n        {\r\n          fieldPath: 'createdBy',\r\n        },\r\n        {\r\n          fieldPath: 'img',\r\n        },\r\n        {\r\n          fieldPath: 'system',\r\n        },\r\n      ],\r\n    },\r\n    where: {\r\n      fieldFilter: {\r\n        field: {\r\n          fieldPath: 'approved',\r\n        },\r\n        op: 'EQUAL',\r\n        value: {\r\n          booleanValue: true,\r\n        },\r\n      },\r\n    },\r\n    from: [{ collectionId: 'templates' }],\r\n    orderBy: [\r\n      {\r\n        field: {\r\n          fieldPath: 'createTime',\r\n        },\r\n      },\r\n    ],\r\n    offset: 0,\r\n    limit: 50,\r\n  },\r\n};\r\n\r\nasync function communityTemplates(search = null) {\r\n  const response = await fetch(\r\n    `https://firestore.googleapis.com/v1/projects/tva---templates/databases/(default)/documents:runQuery?key=${TemplateSubmissionForm.pk}`,\r\n    {\r\n      method: 'POST',\r\n      body: JSON.stringify(SEARCH_QUERY),\r\n      headers: {\r\n        Accept: 'application/json',\r\n        'Content-Type': 'application/json',\r\n      },\r\n    }\r\n  );\r\n\r\n  const templates = [];\r\n  if (response.ok && response.status === 200) {\r\n    const documents = await response.json();\r\n\r\n    for (let doc of documents) {\r\n      if ('document' in doc) templates.push(_docToTemplate(doc.document));\r\n    }\r\n  } else {\r\n    ui.notifications.warn('Failed to retrieve Community templates.');\r\n  }\r\n  return templates;\r\n}\r\n\r\nfunction _docToTemplate(doc) {\r\n  const template = {};\r\n  ['id', 'name', 'mappings', 'createdBy', 'img', 'hint', 'system'].forEach((f) => {\r\n    template[f] = doc.fields[f]?.stringValue || '';\r\n  });\r\n  if (template.mappings) template.mappings = JSON.parse(template.mappings);\r\n  else template.fileURL = doc.name;\r\n\r\n  if (!template.createdBy) template.createdBy = 'Anonymous';\r\n  return template;\r\n}\r\n\r\nasync function getTemplateFromFileURL(fileURL) {\r\n  const response = await fetch(`https://firestore.googleapis.com/v1/${fileURL}?key=${TemplateSubmissionForm.pk}`, {\r\n    method: 'GET',\r\n    headers: {\r\n      Accept: 'application/json',\r\n      'Content-Type': 'application/json',\r\n    },\r\n  });\r\n\r\n  if (response.ok && response.status === 200) {\r\n    const doc = await response.json();\r\n    return _docToTemplate(doc);\r\n  }\r\n  return null;\r\n}\r\n","export default class RandomizerConfig extends FormApplication {\r\n  constructor(obj) {\r\n    super({}, {});\r\n    this.actor = game.actors.get(obj.actorId);\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-token-flags',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/randomizerConfig.html',\r\n      resizable: true,\r\n      minimizable: false,\r\n      title: 'Randomizer',\r\n      width: 500,\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n    const settings = this.actor.getFlag('token-variants', 'randomizerSettings') || {};\r\n    data.randomizer = settings;\r\n    data.hasSettings = !isEmpty(settings);\r\n    data.nameForgeActive = game.modules.get('nameforge')?.active;\r\n    if (data.randomizer.nameForge?.models && Array.isArray(data.randomizer.nameForge.models)) {\r\n      data.randomizer.nameForge.models = data.randomizer.nameForge.models.join(',');\r\n    }\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n    html.find('.selectNameForgeModels').click(this._selectNameForgeModels.bind(this));\r\n\r\n    // Can't have both tokenName and actorName checkboxes checked at the same time\r\n    const tokenName = html.find('input[name=\"randomizer.tokenName\"]');\r\n    const actorName = html.find('input[name=\"randomizer.actorName\"]');\r\n    tokenName.change(() => {\r\n      if (tokenName.is(':checked')) actorName.prop('checked', false);\r\n    });\r\n    actorName.change(() => {\r\n      if (actorName.is(':checked')) tokenName.prop('checked', false);\r\n    });\r\n  }\r\n\r\n  _selectNameForgeModels(event) {\r\n    const inputSelected = $(event.target).siblings('input');\r\n    const selected = inputSelected.val().split(',');\r\n    const genCheckbox = function (name, value) {\r\n      return `\r\n      <div class=\"form-group\">\r\n        <label>${name}</label>\r\n        <div class=\"form-fields\">\r\n            <input type=\"checkbox\" name=\"model\" value=\"${value}\" data-dtype=\"Boolean\" ${\r\n        selected?.find((v) => v === value) ? 'checked' : ''\r\n      }>\r\n        </div>\r\n      </div>\r\n      `;\r\n    };\r\n\r\n    let content = '<form style=\"overflow-y: scroll; height:400px;\">';\r\n\r\n    const models = game.modules.get('nameforge').models;\r\n    for (const [k, v] of Object.entries(models.defaultModels)) {\r\n      content += genCheckbox(v.name, 'defaultModels.' + k);\r\n    }\r\n    for (const [k, v] of Object.entries(models.userModels)) {\r\n      content += genCheckbox(v.name, 'userModels.' + k);\r\n    }\r\n    content += `</form>`;\r\n\r\n    new Dialog({\r\n      title: `Name Forge Models`,\r\n      content: content,\r\n      buttons: {\r\n        Ok: {\r\n          label: `Select`,\r\n          callback: async (html) => {\r\n            const selectedModels = [];\r\n            html.find('input[type=\"checkbox\"]').each(function () {\r\n              if (this.checked) selectedModels.push(this.value);\r\n            });\r\n            inputSelected.val(selectedModels.join(','));\r\n          },\r\n        },\r\n      },\r\n    }).render(true);\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {\r\n    if (event.submitter.value === 'remove') {\r\n      await this.actor.unsetFlag('token-variants', 'randomizerSettings');\r\n    } else {\r\n      const expanded = expandObject(formData);\r\n      if (expanded.randomizer.nameForge?.models) {\r\n        expanded.randomizer.nameForge.models = expanded.randomizer.nameForge.models.split(',');\r\n      }\r\n      this.actor.setFlag('token-variants', 'randomizerSettings', expanded.randomizer);\r\n    }\r\n  }\r\n}\r\n","import { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\r\nimport { registerHook, unregisterHook } from './hooks.js';\r\n\r\nconst feature_id = 'UserMappings';\r\n\r\nexport function registerUserMappingHooks() {\r\n  if (!FEATURE_CONTROL[feature_id]) {\r\n    ['updateToken', 'updateTile', 'sightRefresh'].forEach((id) => unregisterHook(feature_id, id));\r\n    return;\r\n  }\r\n\r\n  registerHook(feature_id, 'updateToken', _updateToken);\r\n  registerHook(feature_id, 'updateTile', _updateTile);\r\n  registerHook(feature_id, 'sightRefresh', _sightRefresh);\r\n}\r\n\r\nasync function _updateToken(token, change) {\r\n  // Update User Specific Image\r\n  if (change.flags?.['token-variants']) {\r\n    if ('userMappings' in change.flags['token-variants'] || '-=userMappings' in change.flags['token-variants']) {\r\n      const t = canvas.tokens.get(token.id);\r\n      if (t) {\r\n        await t.draw();\r\n        canvas.effects.visibility.restrictVisibility();\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nasync function _updateTile(tile, change) {\r\n  // Update User Specific Image\r\n  if (change.flags?.['token-variants']) {\r\n    if ('userMappings' in change.flags['token-variants'] || '-=userMappings' in change.flags['token-variants']) {\r\n      const t = canvas.tiles.get(tile.id);\r\n      if (t) {\r\n        await t.draw();\r\n        canvas.effects.visibility.restrictVisibility();\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction _sightRefresh() {\r\n  if (!game.user.isGM) {\r\n    for (let t of canvas.tokens.placeables) {\r\n      if (_isInvisible(t)) t.visible = false;\r\n    }\r\n    for (let t of canvas.tiles.placeables) {\r\n      if (_isInvisible(t)) t.visible = false;\r\n    }\r\n  }\r\n}\r\n\r\nfunction _isInvisible(obj) {\r\n  const img = (obj.document.getFlag('token-variants', 'userMappings') || {})?.[game.userId];\r\n  return img === TVA_CONFIG.invisibleImage;\r\n}\r\n","import { insertArtSelectButton } from '../../applications/artSelect.js';\r\nimport { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\r\nimport { SEARCH_TYPE, updateTokenImage } from '../utils.js';\r\nimport { registerHook, unregisterHook } from './hooks.js';\r\n\r\nconst feature_id = 'Wildcards';\r\n\r\nexport function registerWildcardHooks() {\r\n  if (!FEATURE_CONTROL[feature_id]) {\r\n    ['renderTokenConfig', 'preCreateToken'].forEach((name) => unregisterHook(feature_id, name));\r\n    return;\r\n  }\r\n\r\n  // Insert default random image field\r\n  registerHook(feature_id, 'renderTokenConfig', _renderTokenConfig);\r\n\r\n  // Set Default Wildcard images if needed\r\n  registerHook(feature_id, 'preCreateToken', _preCreateToken);\r\n}\r\n\r\nasync function _renderTokenConfig(config, html) {\r\n  const checkboxRandomize = html.find('input[name=\"randomImg\"]');\r\n  if (checkboxRandomize.length && !html.find('.token-variants-proto').length) {\r\n    const defaultImg =\r\n      config.actor?.prototypeToken?.flags['token-variants']?.['randomImgDefault'] ||\r\n      config.actor?.prototypeToken?.flags['token-hud-wildcard']?.['default'] ||\r\n      '';\r\n\r\n    const field = await renderTemplate('/modules/token-variants/templates/protoTokenElement.html', {\r\n      defaultImg,\r\n      disableHUDButton: config.object?.getFlag('token-variants', 'disableHUDButton'),\r\n    });\r\n    checkboxRandomize.closest('.form-group').after(field);\r\n\r\n    const tvaFieldset = html.find('.token-variants-proto');\r\n\r\n    tvaFieldset.find('button').click((event) => {\r\n      event.preventDefault();\r\n      const input = tvaFieldset.find('input');\r\n      new FilePicker({ current: input.val(), field: input[0] }).browse(defaultImg);\r\n    });\r\n\r\n    insertArtSelectButton(tvaFieldset, 'flags.token-variants.randomImgDefault', {\r\n      search: config.object.name,\r\n      searchType: SEARCH_TYPE.TOKEN,\r\n    });\r\n\r\n    // Hide/Show Default Img Form Group\r\n    const rdmImgFormGroup = tvaFieldset.find('.imagevideo').closest('.form-group');\r\n    const showHideGroup = function (checked) {\r\n      if (checked) {\r\n        rdmImgFormGroup.show();\r\n      } else {\r\n        rdmImgFormGroup.hide();\r\n      }\r\n      config.setPosition();\r\n    };\r\n    checkboxRandomize.on('click', (event) => showHideGroup(event.target.checked));\r\n    showHideGroup(checkboxRandomize.is(':checked'));\r\n  }\r\n}\r\n\r\nfunction _preCreateToken(tokenDocument, data, options, userId) {\r\n  if (game.user.id !== userId) return;\r\n  const update = {};\r\n  if (tokenDocument.actor?.prototypeToken?.randomImg) {\r\n    const defaultImg =\r\n      tokenDocument.actor?.prototypeToken?.flags['token-variants']?.['randomImgDefault'] ||\r\n      tokenDocument.actor?.prototypeToken?.flags['token-hud-wildcard']?.['default'] ||\r\n      '';\r\n    if (defaultImg) update['texture.src'] = defaultImg;\r\n  }\r\n\r\n  if (TVA_CONFIG.imgNameContainsDimensions || TVA_CONFIG.imgNameContainsFADimensions) {\r\n    updateTokenImage(update['texture.src'] ?? tokenDocument.texture.src, {\r\n      token: tokenDocument,\r\n      update,\r\n    });\r\n  }\r\n\r\n  if (!isEmpty(update)) tokenDocument.updateSource(update);\r\n}\r\n","import { showArtSelect } from '../../token-variants.mjs';\r\nimport { doRandomSearch, doSyncSearch } from '../search.js';\r\nimport { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\r\nimport { keyPressed, nameForgeRandomize, SEARCH_TYPE, updateActorImage, updateTokenImage } from '../utils.js';\r\nimport { registerHook, unregisterHook } from './hooks.js';\r\n\r\nconst feature_id = 'PopUpAndRandomize';\r\n\r\nexport function registerPopRandomizeHooks() {\r\n  if (FEATURE_CONTROL[feature_id]) {\r\n    registerHook(feature_id, 'createActor', _createActor);\r\n    registerHook(feature_id, 'createToken', _createToken);\r\n  } else {\r\n    ['createActor', 'createToken'].forEach((name) => unregisterHook(feature_id, name));\r\n  }\r\n}\r\n\r\nasync function _createToken(token, options, userId) {\r\n  if (userId && game.user.id != userId) return;\r\n\r\n  // Check if random search is enabled and if so perform it\r\n  const actorRandSettings = game.actors.get(token.actorId)?.getFlag('token-variants', 'randomizerSettings');\r\n  const randSettings = mergeObject(TVA_CONFIG.randomizer, actorRandSettings ?? {}, {\r\n    inplace: false,\r\n    recursive: false,\r\n  });\r\n\r\n  let vDown = keyPressed('v');\r\n  const flagTarget = token.actor ? game.actors.get(token.actor.id) : token.document ?? token;\r\n  const popupFlag = flagTarget.getFlag('token-variants', 'popups');\r\n\r\n  if ((vDown && randSettings.tokenCopyPaste) || (!vDown && randSettings.tokenCreate)) {\r\n    let performRandomSearch = true;\r\n    if (!actorRandSettings) {\r\n      if (randSettings.representedActorDisable && token.actor) performRandomSearch = false;\r\n      if (randSettings.linkedActorDisable && token.actorLink) performRandomSearch = false;\r\n      if (_disableRandomSearchForType(randSettings, token.actor)) performRandomSearch = false;\r\n    } else {\r\n      performRandomSearch = Boolean(actorRandSettings);\r\n    }\r\n\r\n    if (performRandomSearch) {\r\n      // Randomize Token Name if need be\r\n      const randomName = await nameForgeRandomize(randSettings);\r\n      if (randomName) {\r\n        token.update({ name: randomName });\r\n      }\r\n\r\n      const img = await doRandomSearch(token.name, {\r\n        searchType: SEARCH_TYPE.TOKEN,\r\n        actor: token.actor,\r\n        randomizerOptions: randSettings,\r\n      });\r\n      if (img) {\r\n        await updateTokenImage(img[0], {\r\n          token: token,\r\n          actor: token.actor,\r\n          imgName: img[1],\r\n        });\r\n      }\r\n\r\n      if (!img) return;\r\n\r\n      if (randSettings.diffImages) {\r\n        let imgPortrait;\r\n        if (randSettings.syncImages) {\r\n          imgPortrait = await doSyncSearch(token.name, img[1], {\r\n            actor: token.actor,\r\n            searchType: SEARCH_TYPE.PORTRAIT,\r\n            randomizerOptions: randSettings,\r\n          });\r\n        } else {\r\n          imgPortrait = await doRandomSearch(token.name, {\r\n            searchType: SEARCH_TYPE.PORTRAIT,\r\n            actor: token.actor,\r\n            randomizerOptions: randSettings,\r\n          });\r\n        }\r\n\r\n        if (imgPortrait) {\r\n          await updateActorImage(token.actor, imgPortrait[0]);\r\n        }\r\n      } else if (randSettings.tokenToPortrait) {\r\n        await updateActorImage(token.actor, img[0]);\r\n      }\r\n      return;\r\n    }\r\n    if (popupFlag == null && !randSettings.popupOnDisable) {\r\n      return;\r\n    }\r\n  } else if (randSettings.tokenCreate || randSettings.tokenCopyPaste) {\r\n    return;\r\n  }\r\n\r\n  // Check if pop-up is enabled and if so open it\r\n  if (!TVA_CONFIG.permissions.popups[game.user.role]) {\r\n    return;\r\n  }\r\n\r\n  let dirKeyDown = keyPressed('popupOverride');\r\n\r\n  if (vDown && TVA_CONFIG.popup.disableAutoPopupOnTokenCopyPaste) {\r\n    return;\r\n  }\r\n\r\n  if (!dirKeyDown || (dirKeyDown && vDown)) {\r\n    if (TVA_CONFIG.popup.disableAutoPopupOnTokenCreate && !vDown) {\r\n      return;\r\n    } else if (popupFlag == null && _disablePopupForType(token.actor)) {\r\n      return;\r\n    } else if (popupFlag != null && !popupFlag) {\r\n      return;\r\n    }\r\n  }\r\n\r\n  showArtSelect(token.name, {\r\n    callback: async function (imgSrc, imgName) {\r\n      if (TVA_CONFIG.popup.twoPopups) {\r\n        await updateActorImage(token.actor, imgSrc);\r\n        _twoPopupPrompt(token.actor, imgSrc, imgName, token);\r\n      } else {\r\n        updateTokenImage(imgSrc, {\r\n          actor: token.actor,\r\n          imgName: imgName,\r\n          token: token,\r\n        });\r\n      }\r\n    },\r\n    searchType: TVA_CONFIG.popup.twoPopups ? SEARCH_TYPE.PORTRAIT : SEARCH_TYPE.TOKEN,\r\n    object: token,\r\n    preventClose: TVA_CONFIG.popup.twoPopups && TVA_CONFIG.popup.twoPopupsNoDialog,\r\n  });\r\n}\r\n\r\nasync function _createActor(actor, options, userId) {\r\n  if (userId && game.user.id != userId) return;\r\n\r\n  // Check if random search is enabled and if so perform it\r\n  const randSettings = TVA_CONFIG.randomizer;\r\n  if (randSettings.actorCreate) {\r\n    let performRandomSearch = true;\r\n    if (randSettings.linkedActorDisable && actor.prototypeToken.actorLink) performRandomSearch = false;\r\n    if (_disableRandomSearchForType(randSettings, actor)) performRandomSearch = false;\r\n\r\n    if (performRandomSearch) {\r\n      const img = await doRandomSearch(actor.name, {\r\n        searchType: SEARCH_TYPE.PORTRAIT,\r\n        actor: actor,\r\n      });\r\n      if (img) {\r\n        await updateActorImage(actor, img[0]);\r\n      }\r\n\r\n      if (!img) return;\r\n\r\n      if (randSettings.diffImages) {\r\n        let imgToken;\r\n        if (randSettings.syncImages) {\r\n          imgToken = await doSyncSearch(actor.name, img[1], { actor: actor });\r\n        } else {\r\n          imgToken = await doRandomSearch(actor.name, {\r\n            searchType: SEARCH_TYPE.TOKEN,\r\n            actor: actor,\r\n          });\r\n        }\r\n\r\n        if (imgToken) {\r\n          await updateTokenImage(imgToken[0], { actor: actor, imgName: imgToken[1] });\r\n        }\r\n      }\r\n      return;\r\n    }\r\n    if (!randSettings.popupOnDisable) {\r\n      return;\r\n    }\r\n  }\r\n\r\n  // Check if pop-up is enabled and if so open it\r\n  if (!TVA_CONFIG.permissions.popups[game.user.role]) {\r\n    return;\r\n  }\r\n\r\n  if (TVA_CONFIG.popup.disableAutoPopupOnActorCreate && !keyPressed('popupOverride')) {\r\n    return;\r\n  } else if (_disablePopupForType(actor)) {\r\n    return;\r\n  }\r\n\r\n  showArtSelect(actor.name, {\r\n    callback: async function (imgSrc, name) {\r\n      const actTokens = actor.getActiveTokens();\r\n      const token = actTokens.length === 1 ? actTokens[0] : null;\r\n      await updateActorImage(actor, imgSrc);\r\n      if (TVA_CONFIG.popup.twoPopups) _twoPopupPrompt(actor, imgSrc, name, token);\r\n      else {\r\n        updateTokenImage(imgSrc, {\r\n          actor: actor,\r\n          imgName: name,\r\n          token: token,\r\n        });\r\n      }\r\n    },\r\n    searchType: TVA_CONFIG.popup.twoPopups ? SEARCH_TYPE.PORTRAIT : SEARCH_TYPE.PORTRAIT_AND_TOKEN,\r\n    object: actor,\r\n    preventClose: TVA_CONFIG.popup.twoPopups && TVA_CONFIG.popup.twoPopupsNoDialog,\r\n  });\r\n}\r\n\r\nfunction _disableRandomSearchForType(randSettings, actor) {\r\n  if (!actor) return false;\r\n  return randSettings[`${actor.type}Disable`] ?? false;\r\n}\r\n\r\nfunction _disablePopupForType(actor) {\r\n  if (!actor) return false;\r\n  return TVA_CONFIG.popup[`${actor.type}Disable`] ?? false;\r\n}\r\n\r\nfunction _twoPopupPrompt(actor, imgSrc, imgName, token) {\r\n  if (TVA_CONFIG.popup.twoPopups && TVA_CONFIG.popup.twoPopupsNoDialog) {\r\n    showArtSelect((token ?? actor.prototypeToken).name, {\r\n      callback: (imgSrc, name) =>\r\n        updateTokenImage(imgSrc, {\r\n          actor: actor,\r\n          imgName: name,\r\n          token: token,\r\n        }),\r\n      searchType: SEARCH_TYPE.TOKEN,\r\n      object: token ? token : actor,\r\n      force: true,\r\n    });\r\n  } else if (TVA_CONFIG.popup.twoPopups) {\r\n    let d = new Dialog({\r\n      title: 'Portrait -> Token',\r\n      content: `<p>${game.i18n.localize('token-variants.windows.art-select.apply-same-art')}</p>`,\r\n      buttons: {\r\n        one: {\r\n          icon: '<i class=\"fas fa-check\"></i>',\r\n          callback: () => {\r\n            updateTokenImage(imgSrc, {\r\n              actor: actor,\r\n              imgName: imgName,\r\n              token: token,\r\n            });\r\n            const artSelects = Object.values(ui.windows).filter((app) => app instanceof ArtSelect);\r\n            for (const app of artSelects) {\r\n              app.close();\r\n            }\r\n          },\r\n        },\r\n        two: {\r\n          icon: '<i class=\"fas fa-times\"></i>',\r\n          callback: () => {\r\n            showArtSelect((token ?? actor.prototypeToken).name, {\r\n              callback: (imgSrc, name) =>\r\n                updateTokenImage(imgSrc, {\r\n                  actor: actor,\r\n                  imgName: name,\r\n                  token: token,\r\n                }),\r\n              searchType: SEARCH_TYPE.TOKEN,\r\n              object: token ? token : actor,\r\n              force: true,\r\n            });\r\n          },\r\n        },\r\n      },\r\n      default: 'one',\r\n    });\r\n    d.render(true);\r\n  }\r\n}\r\n","import { registerEffectIconWrappers } from './effectIconWrappers.js';\r\nimport { registerHideElementWrappers } from './hideElementWrappers.js';\r\nimport { registerHUDWrappers } from './hudWrappers.js';\r\nimport { registerUserMappingWrappers } from './userMappingWrappers.js';\r\n\r\nexport const REGISTERED_WRAPPERS = {};\r\n\r\nexport function registerWrapper(feature_id, name, fn, method = 'WRAPPER') {\r\n  if (typeof libWrapper !== 'function') return;\r\n  if (!(feature_id in REGISTERED_WRAPPERS)) REGISTERED_WRAPPERS[feature_id] = {};\r\n  if (name in REGISTERED_WRAPPERS[feature_id]) return;\r\n\r\n  REGISTERED_WRAPPERS[feature_id][name] = libWrapper.register('token-variants', name, fn, method);\r\n}\r\n\r\nexport function unregisterWrapper(feature_id, name) {\r\n  if (typeof libWrapper !== 'function') return;\r\n  if (feature_id in REGISTERED_WRAPPERS && name in REGISTERED_WRAPPERS[feature_id]) {\r\n    libWrapper.unregister('token-variants', REGISTERED_WRAPPERS[feature_id][name]);\r\n    delete REGISTERED_WRAPPERS[feature_id][name];\r\n  }\r\n}\r\n\r\nexport function registerAllWrappers() {\r\n  // User to Image mappings for Tile and Tokens\r\n  registerUserMappingWrappers();\r\n  // Hide effect icons\r\n  registerEffectIconWrappers();\r\n  // Token HUD Variants Management\r\n  registerHUDWrappers();\r\n  // Hide Core Token Elements\r\n  registerHideElementWrappers();\r\n}\r\n","import { getAllEffectMappings } from '../hooks/effectMappingHooks.js';\r\nimport { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\r\nimport { registerWrapper, unregisterWrapper } from './wrappers.js';\r\n\r\nconst feature_id = 'EffectIcons';\r\n\r\nexport function registerEffectIconWrappers() {\r\n  unregisterWrapper(feature_id, 'Token.prototype.drawEffects');\r\n  unregisterWrapper(feature_id, 'CombatTracker.prototype.getData');\r\n  if (!FEATURE_CONTROL[feature_id]) return;\r\n\r\n  if (\r\n    !TVA_CONFIG.disableEffectIcons &&\r\n    TVA_CONFIG.filterEffectIcons &&\r\n    !['pf1e', 'pf2e'].includes(game.system.id)\r\n  ) {\r\n    registerWrapper(feature_id, 'Token.prototype.drawEffects', _drawEffects, 'OVERRIDE');\r\n  } else if (TVA_CONFIG.disableEffectIcons) {\r\n    registerWrapper(\r\n      feature_id,\r\n      'Token.prototype.drawEffects',\r\n      _drawEffects_fullReplace,\r\n      'OVERRIDE'\r\n    );\r\n  } else if (TVA_CONFIG.displayEffectIconsOnHover) {\r\n    registerWrapper(feature_id, 'Token.prototype.drawEffects', _drawEffects_hoverOnly, 'WRAPPER');\r\n  }\r\n\r\n  if (TVA_CONFIG.disableEffectIcons || TVA_CONFIG.filterCustomEffectIcons) {\r\n    registerWrapper(\r\n      feature_id,\r\n      'CombatTracker.prototype.getData',\r\n      _combatTrackerGetData,\r\n      'WRAPPER'\r\n    );\r\n  }\r\n}\r\n\r\nasync function _drawEffects_hoverOnly(wrapped, ...args) {\r\n  let result = await wrapped(...args);\r\n  this.effects.visible = this.hover;\r\n  return result;\r\n}\r\n\r\nasync function _drawEffects_fullReplace(...args) {\r\n  this.effects.removeChildren().forEach((c) => c.destroy());\r\n  this.effects.bg = this.effects.addChild(new PIXI.Graphics());\r\n  this.effects.overlay = null;\r\n}\r\n\r\nasync function _combatTrackerGetData(wrapped, ...args) {\r\n  let data = await wrapped(...args);\r\n\r\n  if (data && data.combat && data.turns) {\r\n    const combat = data.combat;\r\n    for (const turn of data.turns) {\r\n      const combatant = combat.combatants.find((c) => c.id === turn.id);\r\n      if (combatant) {\r\n        if (TVA_CONFIG.disableEffectIcons) {\r\n          turn.effects = new Set();\r\n        } else if (TVA_CONFIG.filterEffectIcons) {\r\n          const restrictedEffects = _getRestrictedEffects(combatant.token);\r\n\r\n          // Copied from CombatTracker.getData(...)\r\n          turn.effects = new Set();\r\n          if (combatant.token) {\r\n            combatant.token.effects.forEach((e) => turn.effects.add(e));\r\n            if (combatant.token.overlayEffect) turn.effects.add(combatant.token.overlayEffect);\r\n          }\r\n\r\n          // modified to filter restricted effects\r\n          if (combatant.actor) {\r\n            for (const effect of combatant.actor.temporaryEffects) {\r\n              if (effect.statuses.has(CONFIG.specialStatusEffects.DEFEATED)) {\r\n              } else if (effect.icon && !restrictedEffects.includes(effect.name ?? effect.label))\r\n                turn.effects.add(effect.icon);\r\n            }\r\n          }\r\n          // end of copy\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return data;\r\n}\r\n\r\nasync function _drawEffects(...args) {\r\n  this.effects.renderable = false;\r\n  this.effects.removeChildren().forEach((c) => c.destroy());\r\n  this.effects.bg = this.effects.addChild(new PIXI.Graphics());\r\n  this.effects.overlay = null;\r\n\r\n  // Categorize new effects\r\n  let tokenEffects = this.document.effects;\r\n  let actorEffects = this.actor?.temporaryEffects || [];\r\n  let overlay = {\r\n    src: this.document.overlayEffect,\r\n    tint: null,\r\n  };\r\n\r\n  // Modified from the original token.drawEffects\r\n  if (TVA_CONFIG.displayEffectIconsOnHover) this.effects.visible = this.hover;\r\n  if (tokenEffects.length || actorEffects.length) {\r\n    const restrictedEffects = _getRestrictedEffects(this.document);\r\n    actorEffects = actorEffects.filter((ef) => !restrictedEffects.includes(ef.name ?? ef.label));\r\n    tokenEffects = tokenEffects.filter(\r\n      // check if it's a string here\r\n      // for tokens without representing actors effects are just stored as paths to icons\r\n      (ef) => typeof ef === 'string' || !restrictedEffects.includes(ef.name ?? ef.label)\r\n    );\r\n  }\r\n  // End of modifications\r\n\r\n  // Draw status effects\r\n  if (tokenEffects.length || actorEffects.length) {\r\n    const promises = [];\r\n\r\n    // Draw actor effects first\r\n    for (let f of actorEffects) {\r\n      if (!f.icon) continue;\r\n      const tint = Color.from(f.tint ?? null);\r\n      if (f.getFlag('core', 'overlay')) {\r\n        overlay = { src: f.icon, tint };\r\n        continue;\r\n      }\r\n      promises.push(this._drawEffect(f.icon, tint));\r\n    }\r\n\r\n    // Next draw token effects\r\n    for (let f of tokenEffects) promises.push(this._drawEffect(f, null));\r\n    await Promise.all(promises);\r\n  }\r\n\r\n  // Draw overlay effect\r\n  this.effects.overlay = await this._drawOverlay(overlay.src, overlay.tint);\r\n  this._refreshEffects();\r\n  this.effects.renderable = true;\r\n}\r\n\r\nfunction _getRestrictedEffects(tokenDoc) {\r\n  let restrictedEffects = TVA_CONFIG.filterIconList;\r\n  if (TVA_CONFIG.filterCustomEffectIcons) {\r\n    const mappings = getAllEffectMappings(tokenDoc);\r\n    if (mappings) restrictedEffects = restrictedEffects.concat(mappings.map((m) => m.expression));\r\n  }\r\n  return restrictedEffects;\r\n}\r\n","import { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\r\nimport { registerWrapper, unregisterWrapper } from './wrappers.js';\r\n\r\nconst feature_id = 'HideElement';\r\n\r\nexport function registerHideElementWrappers() {\r\n  unregisterWrapper(feature_id, 'Token.prototype._getTooltipText');\r\n  if (FEATURE_CONTROL[feature_id] && TVA_CONFIG.hideElevationTooltip) {\r\n    registerWrapper(feature_id, 'Token.prototype._getTooltipText', _getTooltipText, 'WRAPPER');\r\n  }\r\n\r\n  unregisterWrapper(feature_id, 'Token.prototype._refreshBorder');\r\n  if (FEATURE_CONTROL[feature_id] && TVA_CONFIG.hideTokenBorder) {\r\n    registerWrapper(feature_id, 'Token.prototype._refreshBorder', _refreshVisibility, 'OVERRIDE');\r\n  }\r\n}\r\n\r\nfunction _getTooltipText(wrapped, ...args) {\r\n  wrapped(...args);\r\n  return '';\r\n}\r\n\r\nfunction _refreshVisibility(...args) {}\r\n","import { TOKEN_HUD_VARIANTS } from '../../applications/tokenHUD.js';\r\nimport { Reticle } from '../reticle.js';\r\nimport { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\r\nimport { registerWrapper, unregisterWrapper } from './wrappers.js';\r\n\r\nconst feature_id = 'HUD';\r\n\r\nexport function registerHUDWrappers() {\r\n  unregisterWrapper(feature_id, 'TokenHUD.prototype.clear');\r\n  if (FEATURE_CONTROL[feature_id]) {\r\n    registerWrapper(feature_id, 'TokenHUD.prototype.clear', _clear, 'MIXED');\r\n  }\r\n}\r\n\r\nfunction _clear(wrapped, ...args) {\r\n  _applyVariantFlags();\r\n\r\n  // HUD should not close if we're in assisted overlay positioning mode\r\n  if (Reticle.active && Reticle.mode === 'hud') return;\r\n  return wrapped(...args);\r\n}\r\n\r\nasync function _applyVariantFlags() {\r\n  const { actor, variants } = TOKEN_HUD_VARIANTS;\r\n  if (actor) {\r\n    if (!variants?.length) {\r\n      actor.unsetFlag('token-variants', 'variants');\r\n    } else {\r\n      actor.setFlag('token-variants', 'variants', variants);\r\n    }\r\n  }\r\n  TOKEN_HUD_VARIANTS.actor = null;\r\n  TOKEN_HUD_VARIANTS.variants = null;\r\n}\r\n","import EffectMappingForm from '../applications/effectMappingForm.js';\r\nimport { OverlayConfig } from '../applications/overlayConfig.js';\r\nimport { TVAOverlay } from './sprite/TVAOverlay.js';\r\nimport { evaluateOverlayExpressions } from './token/overlay.js';\r\n\r\nexport class Reticle {\r\n  static app;\r\n  static fields;\r\n  static reticleOverlay;\r\n  static active = false;\r\n  static hitTest;\r\n  static token = null;\r\n  static dialog = null;\r\n\r\n  // Offset calculation controls\r\n  static mode = 'tooltip';\r\n  static increment = 1;\r\n\r\n  static _onReticleMove(event) {\r\n    if (this.reticleOverlay.isMouseDown) {\r\n      let pos = event.data.getLocalPosition(this.reticleOverlay);\r\n\r\n      this.config.pOffsetX = 0;\r\n      this.config.pOffsetY = 0;\r\n      this.config.offsetX = 0;\r\n      this.config.offsetY = 0;\r\n\r\n      if (this.mode === 'token') {\r\n        this.config.linkRotation = true;\r\n        this.config.linkMirror = true;\r\n      }\r\n\r\n      this.tvaOverlay.refresh(this.config, { preview: true });\r\n\r\n      const tCoord = { x: this.tvaOverlay.x, y: this.tvaOverlay.y };\r\n\r\n      if (this.tvaOverlay.overlayConfig.parentID) {\r\n        let parent = this.tvaOverlay;\r\n        do {\r\n          parent = parent.parent;\r\n          tCoord.x += parent.x;\r\n          tCoord.y += parent.y;\r\n        } while (!(parent instanceof TVAOverlay));\r\n      }\r\n\r\n      let dx = pos.x - tCoord.x;\r\n      let dy = pos.y - tCoord.y;\r\n\r\n      let angle = 0;\r\n      if (!this.config.animation.relative) {\r\n        angle = this.config.angle;\r\n        if (this.config.linkRotation) angle += this.tvaOverlay.object.document.rotation;\r\n      }\r\n\r\n      [dx, dy] = rotate(0, 0, dx, dy, angle);\r\n      dx = round(dx, this.increment);\r\n      dy = round(dy, this.increment);\r\n\r\n      // let lPos = event.data.getLocalPosition(this.tvaOverlay);\r\n      // console.log(lPos);\r\n      // // let dx = lPos.x;\r\n      // // let dy = lPos.y;\r\n\r\n      if (this.mode === 'static') {\r\n        this.config.pOffsetX = dx;\r\n        this.config.pOffsetY = dy;\r\n      } else if (this.mode === 'token') {\r\n        this.config.offsetX = -dx / this.tvaOverlay.object.w;\r\n        this.config.offsetY = -dy / this.tvaOverlay.object.h;\r\n      } else {\r\n        let token = this.tvaOverlay.object;\r\n\r\n        let pWidth;\r\n        let pHeight;\r\n\r\n        if (this.tvaOverlay.overlayConfig.parentID) {\r\n          pWidth =\r\n            (this.tvaOverlay.parent.shapesWidth ?? this.tvaOverlay.parent.width) / this.tvaOverlay.parent.scale.x;\r\n          pHeight =\r\n            (this.tvaOverlay.parent.shapesHeight ?? this.tvaOverlay.parent.height) / this.tvaOverlay.parent.scale.y;\r\n        } else {\r\n          pWidth = token.w;\r\n          pHeight = token.h;\r\n        }\r\n\r\n        if (this.mode === 'tooltip') {\r\n          if (Math.abs(dx) >= pWidth / 2) {\r\n            this.config.offsetX = 0.5 * (dx < 0 ? 1 : -1);\r\n            dx += (pWidth / 2) * (dx < 0 ? 1 : -1);\r\n          } else {\r\n            this.config.offsetX = -dx / this.tvaOverlay.object.w;\r\n            dx = 0;\r\n          }\r\n\r\n          if (Math.abs(dy) >= pHeight / 2) {\r\n            this.config.offsetY = 0.5 * (dy < 0 ? 1 : -1);\r\n            dy += (pHeight / 2) * (dy < 0 ? 1 : -1);\r\n          } else {\r\n            this.config.offsetY = -dy / this.tvaOverlay.object.h;\r\n            dy = 0;\r\n          }\r\n        } else {\r\n          if (Math.abs(dx) >= pWidth / 2) {\r\n            this.config.offsetX = 0.5 * (dx < 0 ? 1 : -1);\r\n            dx += (pWidth / 2) * (dx < 0 ? 1 : -1);\r\n          } else if (Math.abs(dy) >= pHeight / 2) {\r\n            this.config.offsetY = 0.5 * (dy < 0 ? 1 : -1);\r\n            dy += (pHeight / 2) * (dy < 0 ? 1 : -1);\r\n          } else {\r\n            this.config.offsetX = -dx / this.tvaOverlay.object.w;\r\n            dx = 0;\r\n            this.config.offsetY = -dy / this.tvaOverlay.object.h;\r\n            dy = 0;\r\n          }\r\n        }\r\n\r\n        this.config.pOffsetX = dx;\r\n        this.config.pOffsetY = dy;\r\n      }\r\n\r\n      this.tvaOverlay.refresh(this.config, { preview: true });\r\n    }\r\n  }\r\n\r\n  static minimizeApps() {\r\n    Object.values(ui.windows).forEach((app) => {\r\n      if (app instanceof OverlayConfig || app instanceof EffectMappingForm) {\r\n        app.minimize();\r\n      }\r\n    });\r\n  }\r\n\r\n  static maximizeApps() {\r\n    Object.values(ui.windows).forEach((app) => {\r\n      if (app instanceof OverlayConfig || app instanceof EffectMappingForm) {\r\n        app.maximize();\r\n      }\r\n    });\r\n  }\r\n\r\n  static activate({ tvaOverlay = null, config = {} } = {}) {\r\n    if (this.deactivate() || !canvas.ready) return false;\r\n    if (!tvaOverlay || !config) return false;\r\n\r\n    if (this.reticleOverlay) {\r\n      this.reticleOverlay.destroy(true);\r\n    }\r\n\r\n    const interaction = canvas.app.renderer.plugins.interaction;\r\n    if (!interaction.cursorStyles['reticle']) {\r\n      interaction.cursorStyles['reticle'] = \"url('modules/token-variants/img/reticle.webp'), auto\";\r\n    }\r\n\r\n    this.tvaOverlay = tvaOverlay;\r\n\r\n    this.minimizeApps();\r\n    this.config = evaluateOverlayExpressions(deepClone(config), this.tvaOverlay.object, {\r\n      overlayConfig: config,\r\n    });\r\n\r\n    // Setup the overlay to be always visible while we're adjusting its position\r\n    this.config.alwaysVisible = true;\r\n\r\n    this.active = true;\r\n\r\n    // Create the reticle overlay\r\n    this.reticleOverlay = new PIXI.Container();\r\n    this.reticleOverlay.hitArea = canvas.dimensions.rect;\r\n    this.reticleOverlay.cursor = 'reticle';\r\n    this.reticleOverlay.interactive = true;\r\n    this.reticleOverlay.zIndex = Infinity;\r\n\r\n    const stopEvent = function (event) {\r\n      event.preventDefault();\r\n      // event.stopPropagation();\r\n    };\r\n\r\n    this.reticleOverlay.on('mousedown', (event) => {\r\n      event.preventDefault();\r\n\r\n      if (event.data.originalEvent.which != 2 && event.data.originalEvent.nativeEvent.which != 2) {\r\n        this.reticleOverlay.isMouseDown = true;\r\n        this._onReticleMove(event);\r\n      }\r\n    });\r\n    this.reticleOverlay.on('pointermove', (event) => {\r\n      event.preventDefault();\r\n      // event.stopPropagation();\r\n      this._onReticleMove(event);\r\n    });\r\n    this.reticleOverlay.on('mouseup', (event) => {\r\n      event.preventDefault();\r\n      this.reticleOverlay.isMouseDown = false;\r\n    });\r\n    this.reticleOverlay.on('click', (event) => {\r\n      event.preventDefault();\r\n      if (event.data.originalEvent.which == 2 || event.data.originalEvent.nativeEvent.which == 2) {\r\n        this.deactivate();\r\n      }\r\n    });\r\n\r\n    canvas.stage.addChild(this.reticleOverlay);\r\n    this.dialog = displayControlDialog();\r\n    return true;\r\n  }\r\n\r\n  static deactivate() {\r\n    if (this.active) {\r\n      if (this.reticleOverlay) this.reticleOverlay.parent?.removeChild(this.reticleOverlay);\r\n      this.active = false;\r\n      this.tvaOverlay = null;\r\n      if (this.dialog && this.dialog._state !== Application.RENDER_STATES.CLOSED) this.dialog.close(true);\r\n      this.dialog = null;\r\n      this.maximizeApps();\r\n\r\n      const app = Object.values(ui.windows).find((app) => app instanceof OverlayConfig);\r\n      if (!app) {\r\n        this.config = null;\r\n        return;\r\n      }\r\n      const form = $(app.form);\r\n\r\n      ['pOffsetX', 'pOffsetY', 'offsetX', 'offsetY'].forEach((field) => {\r\n        if (field in this.config) {\r\n          form.find(`[name=\"${field}\"]`).val(this.config[field]);\r\n        }\r\n      });\r\n\r\n      if (this.mode === 'token') {\r\n        ['linkRotation', 'linkMirror'].forEach((field) => {\r\n          form.find(`[name=\"${field}\"]`).prop('checked', true);\r\n        });\r\n        ['linkDimensionsX', 'linkDimensionsY'].forEach((field) => {\r\n          form.find(`[name=\"${field}\"]`).prop('checked', false);\r\n        });\r\n      } else {\r\n        ['linkRotation', 'linkMirror'].forEach((field) => {\r\n          form.find(`[name=\"${field}\"]`).prop('checked', false);\r\n        });\r\n      }\r\n\r\n      if (this.mode === 'hud') {\r\n        form.find('[name=\"ui\"]').prop('checked', true).trigger('change');\r\n      }\r\n\r\n      form.find('[name=\"anchor.x\"]').val(this.config.anchor.x);\r\n      form.find('[name=\"anchor.y\"]').val(this.config.anchor.y).trigger('change');\r\n      this.config = null;\r\n\r\n      return true;\r\n    }\r\n  }\r\n}\r\n\r\nfunction displayControlDialog() {\r\n  const d = new Dialog({\r\n    title: 'Set Overlay Position',\r\n    content: `\r\n      <style>\r\n        .images { display: flex; }\r\n        .images a { flex: 20%; width: 50px; margin: 2px; }\r\n        .images a.active img { border-color: orange; border-width: 2px; }\r\n        .anchorlbl {margin: auto; display: table; }\r\n      </style>\r\n      <div class=\"images\">\r\n        <a data-id=\"token\"><img src=\"modules/token-variants/img/token_mode.png\"></img></a>\r\n        <a data-id=\"tooltip\"><img src=\"modules/token-variants/img/tooltip_mode.png\"></img></a>\r\n        <a data-id=\"hud\"><img src=\"modules/token-variants/img/hud_mode.png\"></img></a>\r\n        <a data-id=\"static\"><img src=\"modules/token-variants/img/static_mode.png\"></img></a>\r\n      </div>\r\n     <br>\r\n      <label class=\"anchorlbl\">Anchor</label>\r\n      <div class=\"tva-anchor\">\r\n        <input type=\"radio\" class=\"top left\" name=\"anchor\">\r\n        <input type=\"radio\" class=\"top center\" name=\"anchor\">\r\n        <input type=\"radio\" class=\"top right\" name=\"anchor\">\r\n        <input type=\"radio\" class=\"mid left\" name=\"anchor\">\r\n        <input type=\"radio\" class=\"mid center\" name=\"anchor\">\r\n        <input type=\"radio\" class=\"mid right\" name=\"anchor\">\r\n        <input type=\"radio\" class=\"bot left\" name=\"anchor\">\r\n        <input type=\"radio\" class=\"bot center\" name=\"anchor\">\r\n        <input type=\"radio\" class=\"bot right\" name=\"anchor\">\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label>Step Size</label>\r\n        <div class=\"form-fields\">\r\n          <input type=\"number\" name=\"step\" min=\"0\" step=\"1\" value=\"${Reticle.increment}\">\r\n        </div>\r\n      </div>\r\n      <p class=\"notes\"><b>Left-Click</b> to move the overlay</p>\r\n      <p class=\"notes\"><b>Middle-Click</b> or <b>Close Dialog</b> to exit overlay positioning</p>\r\n     `,\r\n    buttons: {},\r\n    render: (html) => {\r\n      // Mode Images\r\n      const images = html.find('.images a');\r\n      html.find('.images a').on('click', (event) => {\r\n        images.removeClass('active');\r\n        const target = $(event.target).closest('a');\r\n        target.addClass('active');\r\n        Reticle.mode = target.data('id');\r\n      });\r\n      html.find(`[data-id=\"${Reticle.mode}\"]`).addClass('active');\r\n\r\n      // Anchor\r\n      let anchorX = Reticle.config?.anchor?.x || 0;\r\n      let anchorY = Reticle.config?.anchor?.y || 0;\r\n\r\n      let classes = '';\r\n      if (anchorX < 0.5) classes += '.left';\r\n      else if (anchorX > 0.5) classes += '.right';\r\n      else classes += '.center';\r\n\r\n      if (anchorY < 0.5) classes += '.top';\r\n      else if (anchorY > 0.5) classes += '.bot';\r\n      else classes += '.mid';\r\n\r\n      html.find('.tva-anchor').find(classes).prop('checked', true);\r\n      // end -  Pre-select anchor\r\n\r\n      html.find('input[name=\"anchor\"]').on('change', (event) => {\r\n        const anchor = $(event.target);\r\n        let x;\r\n        let y;\r\n        if (anchor.hasClass('left')) x = 0;\r\n        else if (anchor.hasClass('center')) x = 0.5;\r\n        else x = 1;\r\n\r\n        if (anchor.hasClass('top')) y = 0;\r\n        else if (anchor.hasClass('mid')) y = 0.5;\r\n        else y = 1;\r\n\r\n        Reticle.config.anchor.x = x;\r\n        Reticle.config.anchor.y = y;\r\n      });\r\n\r\n      html.find('[name=\"step\"]').on('input', (event) => {\r\n        Reticle.increment = $(event.target).val() || 1;\r\n      });\r\n    },\r\n    close: () => Reticle.deactivate(),\r\n  });\r\n  d.render(true);\r\n  setTimeout(() => d.setPosition({ left: 200, top: window.innerHeight / 2, height: 'auto' }), 100);\r\n  return d;\r\n}\r\n\r\nfunction round(number, increment, offset = 0) {\r\n  return Math.ceil((number - offset) / increment) * increment + offset;\r\n}\r\n\r\nfunction rotate(cx, cy, x, y, angle) {\r\n  var radians = (Math.PI / 180) * angle,\r\n    cos = Math.cos(radians),\r\n    sin = Math.sin(radians),\r\n    nx = cos * (x - cx) + sin * (y - cy) + cx,\r\n    ny = cos * (y - cy) - sin * (x - cx) + cy;\r\n  return [nx, ny];\r\n}\r\n","import { TVA_CONFIG } from '../settings.js';\r\nimport { decodeURISafely } from '../utils.js';\r\nimport { registerWrapper } from './wrappers.js';\r\n\r\nconst feature_id = 'UserMappings';\r\n\r\nexport function registerUserMappingWrappers() {\r\n  registerWrapper(feature_id, 'Tile.prototype.draw', _draw);\r\n  registerWrapper(feature_id, 'Token.prototype.draw', _draw);\r\n}\r\n\r\nasync function _draw(wrapped, ...args) {\r\n  let result;\r\n\r\n  // If the Token/Tile has a UserToImage mappings momentarily set document.texture.src to it\r\n  // so that it's texture gets loaded instead of the actual Token image\r\n  const mappings = this.document.getFlag('token-variants', 'userMappings') || {};\r\n  const img = mappings[game.userId];\r\n  let previous;\r\n  if (img) {\r\n    previous = this.document.texture.src;\r\n    this.document.texture.src = img;\r\n    this.tva_iconOverride = img;\r\n    result = await wrapped(...args);\r\n    this.document.texture.src = previous;\r\n    overrideVisibility(this, img);\r\n  } else {\r\n    overrideVisibility(this);\r\n    result = await wrapped(...args);\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * If the img is the same as TVA_CONFIG.invisibleImage then we'll override the isVisible\r\n * getter to return false of this client if it's not a GM. Reset it to default if not.\r\n * @param {*} obj object whose isVisible is to be overriden\r\n * @param {*} img UserToImage mapping\r\n */\r\nfunction overrideVisibility(obj, img) {\r\n  if (img && decodeURISafely(img) === TVA_CONFIG.invisibleImage && !obj.tva_customVisibility) {\r\n    const originalIsVisible = _getIsVisibleDescriptor(obj).get;\r\n    Object.defineProperty(obj, 'isVisible', {\r\n      get: function () {\r\n        const isVisible = originalIsVisible.call(this);\r\n        if (isVisible && !game.user.isGM) return false;\r\n        return isVisible;\r\n      },\r\n      configurable: true,\r\n    });\r\n    obj.tva_customVisibility = true;\r\n  } else if (!img && obj.tva_customVisibility) {\r\n    Object.defineProperty(obj, 'isVisible', _getIsVisibleDescriptor(obj));\r\n    delete obj.tva_customVisibility;\r\n  }\r\n}\r\n\r\nfunction _getIsVisibleDescriptor(obj) {\r\n  let iObj = Object.getPrototypeOf(obj);\r\n  let descriptor = null;\r\n  while (iObj) {\r\n    descriptor = Object.getOwnPropertyDescriptor(iObj, 'isVisible');\r\n    if (descriptor) break;\r\n    iObj = Object.getPrototypeOf(iObj);\r\n  }\r\n  return descriptor;\r\n}\r\n\r\n/**\r\n * Assign an image to be displayed to only that user.\r\n * @param {*} token token the image is to be applied to\r\n * @param {*} img image to be displayed, if no image is provided unassignUserSpecificImage(...) will be called\r\n * @param {*} opts.userName name of the user that the image is to be displayed to\r\n * @param {*} opts.id id of the user that the image is to be displayed to\r\n * @returns\r\n */\r\nexport function assignUserSpecificImage(token, img, { userName = null, userId = null } = {}) {\r\n  if (!img) return unassignUserSpecificImage(token, { userName, userId });\r\n\r\n  if (userName instanceof Array) {\r\n    for (const name of userName) assignUserSpecificImage(token, img, { userName: name });\r\n    return;\r\n  }\r\n\r\n  if (userId instanceof Array) {\r\n    for (const id of userId) assignUserSpecificImage(token, img, { userId: id });\r\n    return;\r\n  }\r\n\r\n  let id = userId;\r\n  if (!id && userName) {\r\n    id = game.users.find((u) => u.name === userName)?.id;\r\n  }\r\n  if (!id) return;\r\n\r\n  const doc = token.document ?? token;\r\n  const mappings = doc.getFlag('token-variants', 'userMappings') || {};\r\n\r\n  mappings[id] = img;\r\n  doc.setFlag('token-variants', 'userMappings', mappings);\r\n}\r\n\r\n/**\r\n * Calls assignUserSpecificImage passing in all currently selected tokens.\r\n * @param {*} img image to be displayed\r\n * @param {*} opts id or name of the user as per assignUserSpecificImage(...)\r\n */\r\nexport function assignUserSpecificImageToSelected(img, opts = {}) {\r\n  const selected = [...canvas.tokens.controlled];\r\n  for (const t of selected) assignUserSpecificImage(t, img, opts);\r\n}\r\n\r\n/**\r\n * Un-assign image if one has been set to be displayed to a user.\r\n * @param {*} token token the image is to be removed from\r\n * @param {*} opts.userName name of the user that the image is to be removed for\r\n * @param {*} opts.id id of the user that the image is to be removed for\r\n */\r\nexport function unassignUserSpecificImage(token, { userName = null, userId = null } = {}) {\r\n  if (userName instanceof Array) {\r\n    for (const name of userName) unassignUserSpecificImage(token, { userName: name });\r\n    return;\r\n  }\r\n\r\n  if (userId instanceof Array) {\r\n    for (const id of userId) unassignUserSpecificImage(token, { userId: id });\r\n    return;\r\n  }\r\n\r\n  let id = userId;\r\n  if (!id && userName) {\r\n    id = game.users.find((u) => u.name === userName)?.id;\r\n  }\r\n  if (!id) {\r\n    if (!userName && !userId) (token.document ?? token).unsetFlag('token-variants', 'userMappings');\r\n  } else {\r\n    const update = {};\r\n    update['flags.token-variants.userMappings.-=' + id] = null;\r\n    (token.document ?? token).update(update);\r\n  }\r\n}\r\n\r\n/**\r\n * Calls unassignUserSpecificImage passing in all currently selected tokens.\r\n * @param {*} opts id or name of the user as per unassignUserSpecificImage(...)\r\n */\r\nexport function unassignUserSpecificImageFromSelected(opts = {}) {\r\n  const selected = [...canvas.tokens.controlled];\r\n  for (const t of selected) unassignUserSpecificImage(t, opts);\r\n}\r\n","import { showArtSelect } from '../token-variants.mjs';\r\nimport {\r\n  BASE_IMAGE_CATEGORIES,\r\n  SEARCH_TYPE,\r\n  updateActorImage,\r\n  updateTokenImage,\r\n  userRequiresImageCache,\r\n} from '../scripts/utils.js';\r\nimport { addToQueue, ArtSelect, renderFromQueue } from './artSelect.js';\r\nimport { getSearchOptions, TVA_CONFIG, updateSettings } from '../scripts/settings.js';\r\nimport ConfigureSettings from './configureSettings.js';\r\nimport MissingImageConfig from './missingImageConfig.js';\r\nimport { cacheImages, doImageSearch } from '../scripts/search.js';\r\n\r\nasync function autoApply(actor, image1, image2, formData, typeOverride) {\r\n  let portraitFound = formData.ignorePortrait;\r\n  let tokenFound = formData.ignoreToken;\r\n\r\n  if (formData.diffImages) {\r\n    let results = [];\r\n\r\n    if (!formData.ignorePortrait) {\r\n      results = await doImageSearch(actor.name, {\r\n        searchType: typeOverride ?? SEARCH_TYPE.PORTRAIT,\r\n        simpleResults: true,\r\n        searchOptions: formData.searchOptions,\r\n      });\r\n\r\n      if ((results ?? []).length != 0) {\r\n        portraitFound = true;\r\n        await updateActorImage(actor, results[0], false, formData.compendium);\r\n      }\r\n    }\r\n\r\n    if (!formData.ignoreToken) {\r\n      results = await doImageSearch(actor.prototypeToken.name, {\r\n        searchType: SEARCH_TYPE.TOKEN,\r\n        simpleResults: true,\r\n        searchOptions: formData.searchOptions,\r\n      });\r\n\r\n      if ((results ?? []).length != 0) {\r\n        tokenFound = true;\r\n        updateTokenImage(results[0], {\r\n          actor: actor,\r\n          pack: formData.compendium,\r\n          applyDefaultConfig: false,\r\n        });\r\n      }\r\n    }\r\n  } else {\r\n    let results = await doImageSearch(actor.name, {\r\n      searchType: typeOverride ?? SEARCH_TYPE.PORTRAIT_AND_TOKEN,\r\n      simpleResults: true,\r\n      searchOptions: formData.searchOptions,\r\n    });\r\n\r\n    if ((results ?? []).length != 0) {\r\n      portraitFound = tokenFound = true;\r\n      updateTokenImage(results[0], {\r\n        actor: actor,\r\n        actorUpdate: { img: results[0] },\r\n        pack: formData.compendium,\r\n        applyDefaultConfig: false,\r\n      });\r\n    }\r\n  }\r\n\r\n  if (!(tokenFound && portraitFound) && formData.autoDisplayArtSelect) {\r\n    addToArtSelectQueue(actor, image1, image2, formData, typeOverride);\r\n  }\r\n}\r\n\r\nfunction addToArtSelectQueue(actor, image1, image2, formData, typeOverride) {\r\n  if (formData.diffImages) {\r\n    if (!formData.ignorePortrait && !formData.ignoreToken) {\r\n      addToQueue(actor.name, {\r\n        searchType: typeOverride ?? SEARCH_TYPE.PORTRAIT,\r\n        object: actor,\r\n        preventClose: true,\r\n        image1: image1,\r\n        image2: image2,\r\n        displayMode: ArtSelect.IMAGE_DISPLAY.PORTRAIT,\r\n        searchOptions: formData.searchOptions,\r\n        callback: async function (imgSrc, _) {\r\n          await updateActorImage(actor, imgSrc);\r\n          showArtSelect(actor.prototypeToken.name, {\r\n            searchType: typeOverride ?? SEARCH_TYPE.TOKEN,\r\n            object: actor,\r\n            force: true,\r\n            image1: imgSrc,\r\n            image2: image2,\r\n            displayMode: ArtSelect.IMAGE_DISPLAY.TOKEN,\r\n            searchOptions: formData.searchOptions,\r\n            callback: (imgSrc, name) =>\r\n              updateTokenImage(imgSrc, {\r\n                actor: actor,\r\n                imgName: name,\r\n                applyDefaultConfig: false,\r\n              }),\r\n          });\r\n        },\r\n      });\r\n    } else if (formData.ignorePortrait) {\r\n      addToQueue(actor.name, {\r\n        searchType: typeOverride ?? SEARCH_TYPE.TOKEN,\r\n        object: actor,\r\n        image1: image1,\r\n        image2: image2,\r\n        displayMode: ArtSelect.IMAGE_DISPLAY.TOKEN,\r\n        searchOptions: formData.searchOptions,\r\n        callback: async function (imgSrc, name) {\r\n          updateTokenImage(imgSrc, {\r\n            actor: actor,\r\n            imgName: name,\r\n            applyDefaultConfig: false,\r\n          });\r\n        },\r\n      });\r\n    } else if (formData.ignoreToken) {\r\n      addToQueue(actor.name, {\r\n        searchType: typeOverride ?? SEARCH_TYPE.PORTRAIT,\r\n        object: actor,\r\n        image1: image1,\r\n        image2: image2,\r\n        displayMode: ArtSelect.IMAGE_DISPLAY.PORTRAIT,\r\n        searchOptions: formData.searchOptions,\r\n        callback: async function (imgSrc, name) {\r\n          await updateActorImage(actor, imgSrc);\r\n        },\r\n      });\r\n    }\r\n  } else {\r\n    addToQueue(actor.name, {\r\n      searchType: typeOverride ?? SEARCH_TYPE.PORTRAIT_AND_TOKEN,\r\n      object: actor,\r\n      image1: image1,\r\n      image2: image2,\r\n      displayMode: ArtSelect.IMAGE_DISPLAY.PORTRAIT_TOKEN,\r\n      searchOptions: formData.searchOptions,\r\n      callback: async function (imgSrc, name) {\r\n        await updateActorImage(actor, imgSrc);\r\n        updateTokenImage(imgSrc, {\r\n          actor: actor,\r\n          imgName: name,\r\n          applyDefaultConfig: false,\r\n        });\r\n      },\r\n    });\r\n  }\r\n}\r\n\r\nexport default class CompendiumMapConfig extends FormApplication {\r\n  constructor() {\r\n    super({}, {});\r\n    this.searchOptions = deepClone(getSearchOptions());\r\n    mergeObject(this.searchOptions, deepClone(TVA_CONFIG.compendiumMapper.searchOptions));\r\n    this._fixSearchPaths();\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-compendium-map-config',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/compendiumMap.html',\r\n      resizable: false,\r\n      minimizable: false,\r\n      title: game.i18n.localize('token-variants.settings.compendium-mapper.Name'),\r\n      width: 500,\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    let data = super.getData(options);\r\n    data = mergeObject(data, TVA_CONFIG.compendiumMapper);\r\n\r\n    const supportedPacks = ['Actor', 'Cards', 'Item', 'Macro', 'RollTable'];\r\n    data.supportedPacks = supportedPacks.join(', ');\r\n\r\n    const packs = [];\r\n    game.packs.forEach((pack) => {\r\n      if (!pack.locked && supportedPacks.includes(pack.documentName)) {\r\n        packs.push({ title: pack.title, id: pack.collection, type: pack.documentName });\r\n      }\r\n    });\r\n    data.compendiums = packs;\r\n    data.compendium = TVA_CONFIG.compendiumMapper.compendium;\r\n\r\n    data.categories = BASE_IMAGE_CATEGORIES.concat(TVA_CONFIG.customImageCategories);\r\n    data.category = TVA_CONFIG.compendiumMapper.category;\r\n\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n    html.find('.token-variants-override-category').change(this._onCategoryOverride).trigger('change');\r\n    html.find('.token-variants-auto-apply').change(this._onAutoApply);\r\n    html.find('.token-variants-diff-images').change(this._onDiffImages);\r\n    html.find(`.token-variants-search-options`).on('click', this._onSearchOptions.bind(this));\r\n    html.find(`.token-variants-missing-images`).on('click', this._onMissingImages.bind(this));\r\n\r\n    $(html).find('[name=\"compendium\"]').change(this._onCompendiumSelect.bind(this)).trigger('change');\r\n  }\r\n\r\n  async _onAutoApply(event) {\r\n    $(event.target).closest('form').find('.token-variants-auto-art-select').prop('disabled', !event.target.checked);\r\n  }\r\n\r\n  async _onCategoryOverride(event) {\r\n    $(event.target).closest('form').find('.token-variants-category').prop('disabled', !event.target.checked);\r\n  }\r\n\r\n  async _onDiffImages(event) {\r\n    $(event.target).closest('form').find('.token-variants-tp-ignore').prop('disabled', !event.target.checked);\r\n  }\r\n\r\n  async _onCompendiumSelect(event) {\r\n    const compendium = game.packs.get($(event.target).val());\r\n    if (compendium) {\r\n      $(event.target)\r\n        .closest('form')\r\n        .find('.token-specific')\r\n        .css('visibility', compendium.documentName === 'Actor' ? 'visible' : 'hidden');\r\n    }\r\n  }\r\n\r\n  _fixSearchPaths() {\r\n    if (!this.searchOptions.searchPaths?.length) {\r\n      this.searchOptions.searchPaths = deepClone(TVA_CONFIG.searchPaths);\r\n    }\r\n  }\r\n\r\n  async _onSearchOptions(event) {\r\n    this._fixSearchPaths();\r\n    new ConfigureSettings(this.searchOptions, {\r\n      searchPaths: true,\r\n      searchFilters: true,\r\n      searchAlgorithm: true,\r\n      randomizer: false,\r\n      features: false,\r\n      popup: false,\r\n      permissions: false,\r\n      worldHud: false,\r\n      misc: false,\r\n      activeEffects: false,\r\n    }).render(true);\r\n  }\r\n\r\n  async _onMissingImages(event) {\r\n    new MissingImageConfig().render(true);\r\n  }\r\n\r\n  async startMapping(formData) {\r\n    if (formData.diffImages && formData.ignoreToken && formData.ignorePortrait) {\r\n      return;\r\n    }\r\n\r\n    const originalSearchPaths = TVA_CONFIG.searchPaths;\r\n    if (formData.searchOptions.searchPaths?.length) {\r\n      TVA_CONFIG.searchPaths = formData.searchOptions.searchPaths;\r\n    }\r\n\r\n    if (formData.cache || !userRequiresImageCache() || formData.searchOptions.searchPaths?.length) {\r\n      await cacheImages();\r\n    }\r\n\r\n    const endMapping = function () {\r\n      if (formData.searchOptions.searchPaths?.length) {\r\n        TVA_CONFIG.searchPaths = originalSearchPaths;\r\n        cacheImages();\r\n      }\r\n    };\r\n\r\n    const compendium = game.packs.get(formData.compendium);\r\n    let missingImageList = TVA_CONFIG.compendiumMapper.missingImages\r\n      .filter((mi) => mi.document === 'all' || mi.document === compendium.documentName)\r\n      .map((mi) => mi.image);\r\n    const typeOverride = formData.overrideCategory ? formData.category : null;\r\n    let artSelectDisplayed = false;\r\n\r\n    let processItem;\r\n    if (compendium.documentName === 'Actor') {\r\n      processItem = async function (item) {\r\n        const actor = await compendium.getDocument(item._id);\r\n        if (actor.name === '#[CF_tempEntity]') return; // Compendium Folders module's control entity\r\n\r\n        let hasPortrait = actor.img !== CONST.DEFAULT_TOKEN && !missingImageList.includes(actor.img);\r\n        let hasToken =\r\n          actor.prototypeToken.texture.src !== CONST.DEFAULT_TOKEN &&\r\n          !missingImageList.includes(actor.prototypeToken.texture.src);\r\n        if (formData.syncImages && hasPortrait !== hasToken) {\r\n          if (hasPortrait) {\r\n            await updateTokenImage(actor.img, { actor: actor, applyDefaultConfig: false });\r\n          } else {\r\n            await updateActorImage(actor, actor.prototypeToken.texture.src);\r\n          }\r\n          hasPortrait = hasToken = true;\r\n        }\r\n\r\n        let includeThisActor = !(formData.missingOnly && hasPortrait) && !formData.ignorePortrait;\r\n        let includeThisToken = !(formData.missingOnly && hasToken) && !formData.ignoreToken;\r\n\r\n        const image1 = formData.showImages ? actor.img : '';\r\n        const image2 = formData.showImages ? actor.prototypeToken.texture.src : '';\r\n\r\n        if (includeThisActor || includeThisToken) {\r\n          if (formData.autoApply) {\r\n            await autoApply(actor, image1, image2, formData, typeOverride);\r\n          } else {\r\n            artSelectDisplayed = true;\r\n            addToArtSelectQueue(actor, image1, image2, formData, typeOverride);\r\n          }\r\n        }\r\n      };\r\n    } else {\r\n      processItem = async function (item) {\r\n        const doc = await compendium.getDocument(item._id);\r\n        if (doc.name === '#[CF_tempEntity]') return; // Compendium Folders module's control entity\r\n\r\n        let defaultImg = '';\r\n        if (doc.schema.fields.img || doc.schema.fields.texture) {\r\n          defaultImg = (doc.schema.fields.img ?? doc.schema.fields.texture).initial();\r\n        }\r\n        const hasImage = doc.img != null && doc.img !== defaultImg && !missingImageList.includes(doc.img);\r\n\r\n        let imageFound = false;\r\n        if (formData.missingOnly && hasImage) return;\r\n        if (formData.autoApply) {\r\n          let results = await doImageSearch(doc.name, {\r\n            searchType: typeOverride ?? compendium.documentName,\r\n            simpleResults: true,\r\n            searchOptions: formData.searchOptions,\r\n          });\r\n\r\n          if ((results ?? []).length != 0) {\r\n            imageFound = true;\r\n            await updateActorImage(doc, results[0], false, formData.compendium);\r\n          }\r\n        }\r\n\r\n        if (!formData.autoApply || (formData.autoDisplayArtSelect && !imageFound)) {\r\n          artSelectDisplayed = true;\r\n          addToQueue(doc.name, {\r\n            searchType: typeOverride ?? compendium.documentName,\r\n            object: doc,\r\n            image1: formData.showImages ? doc.img : '',\r\n            displayMode: ArtSelect.IMAGE_DISPLAY.IMAGE,\r\n            searchOptions: formData.searchOptions,\r\n            callback: async function (imgSrc, name) {\r\n              await updateActorImage(doc, imgSrc);\r\n            },\r\n          });\r\n        }\r\n      };\r\n    }\r\n\r\n    const allItems = [];\r\n    compendium.index.forEach((k) => {\r\n      allItems.push(k);\r\n    });\r\n\r\n    if (formData.autoApply) {\r\n      let processing = true;\r\n      let stopProcessing = false;\r\n      let processed = 0;\r\n      let counter = $(`<p>CACHING 0/${allItems.length}</p>`);\r\n      let d;\r\n\r\n      const startProcessing = async function () {\r\n        while (processing && processed < allItems.length) {\r\n          await new Promise((resolve, reject) => {\r\n            setTimeout(async () => {\r\n              await processItem(allItems[processed]);\r\n              resolve();\r\n            }, 10);\r\n          });\r\n          processed++;\r\n          counter.html(`${processed}/${allItems.length}`);\r\n        }\r\n        if (stopProcessing || processed === allItems.length) {\r\n          d?.close(true);\r\n          addToQueue('DUMMY', { execute: endMapping });\r\n          renderFromQueue();\r\n        }\r\n      };\r\n\r\n      d = new Dialog({\r\n        title: `Mapping: ${compendium.title}`,\r\n        content: `\r\n        <div style=\"text-align:center;\" class=\"fa-3x\"><i class=\"fas fa-spinner fa-pulse\"></i></div>\r\n        <div style=\"text-align:center;\" class=\"counter\"></div>\r\n        <button style=\"width:100%;\" class=\"pause\"><i class=\"fas fa-play-circle\"></i> Pause/Start</button>`,\r\n        buttons: {\r\n          cancel: {\r\n            icon: '<i class=\"fas fa-stop-circle\"></i>',\r\n            label: 'Cancel',\r\n          },\r\n        },\r\n        default: 'cancel',\r\n        render: (html) => {\r\n          html.find('.counter').append(counter);\r\n          const spinner = html.find('.fa-spinner');\r\n          html.find('.pause').on('click', () => {\r\n            if (processing) {\r\n              processing = false;\r\n              spinner.removeClass('fa-pulse');\r\n            } else {\r\n              processing = true;\r\n              startProcessing();\r\n              spinner.addClass('fa-pulse');\r\n            }\r\n          });\r\n          setTimeout(async () => startProcessing(), 1000);\r\n        },\r\n        close: () => {\r\n          if (!stopProcessing) {\r\n            stopProcessing = true;\r\n            if (!processing) startProcessing();\r\n            else processing = false;\r\n          }\r\n        },\r\n      });\r\n      d.render(true);\r\n    } else {\r\n      const tasks = allItems.map(processItem);\r\n      Promise.all(tasks).then(() => {\r\n        addToQueue('DUMMY', { execute: endMapping });\r\n        renderFromQueue();\r\n        if (formData.missingOnly && !artSelectDisplayed) {\r\n          ui.notifications.warn('Token Variant Art: No documents found containing missing images.');\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {\r\n    // If search paths are the same, remove them from searchOptions\r\n    if (\r\n      !this.searchOptions.searchPaths?.length ||\r\n      isEmpty(diffObject(this.searchOptions.searchPaths, TVA_CONFIG.searchPaths))\r\n    ) {\r\n      this.searchOptions.searchPaths = [];\r\n    }\r\n\r\n    formData.searchOptions = this.searchOptions;\r\n\r\n    await updateSettings({ compendiumMapper: formData });\r\n    if (formData.compendium) {\r\n      this.startMapping(formData);\r\n    }\r\n  }\r\n}\r\n","import { cacheImages } from '../scripts/search.js';\r\nimport { TVA_CONFIG, updateSettings } from '../scripts/settings.js';\r\nimport { getFileName } from '../scripts/utils.js';\r\nimport EffectMappingForm from './effectMappingForm.js';\r\nimport { showPathSelectCategoryDialog, showPathSelectConfigForm } from './dialogs.js';\r\n\r\nexport default class ConfigureSettings extends FormApplication {\r\n  constructor(\r\n    dummySettings,\r\n    {\r\n      searchPaths = true,\r\n      searchFilters = true,\r\n      searchAlgorithm = true,\r\n      randomizer = true,\r\n      popup = true,\r\n      permissions = true,\r\n      worldHud = true,\r\n      misc = true,\r\n      activeEffects = true,\r\n      features = false,\r\n    } = {}\r\n  ) {\r\n    super({}, {});\r\n    this.enabledTabs = {\r\n      searchPaths,\r\n      searchFilters,\r\n      searchAlgorithm,\r\n      randomizer,\r\n      features,\r\n      popup,\r\n      permissions,\r\n      worldHud,\r\n      misc,\r\n      activeEffects,\r\n    };\r\n    this.settings = foundry.utils.deepClone(TVA_CONFIG);\r\n    if (dummySettings) {\r\n      this.settings = mergeObject(this.settings, dummySettings, { insertKeys: false });\r\n      this.dummySettings = dummySettings;\r\n    }\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-configure-settings',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/configureSettings.html',\r\n      resizable: false,\r\n      minimizable: false,\r\n      title: 'Configure Settings',\r\n      width: 700,\r\n      height: 'auto',\r\n      tabs: [{ navSelector: '.sheet-tabs', contentSelector: '.content', initial: 'searchPaths' }],\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n    const settings = this.settings;\r\n\r\n    data.enabledTabs = this.enabledTabs;\r\n\r\n    // === Search Paths ===\r\n    const paths = settings.searchPaths.map((path) => {\r\n      const r = {};\r\n      r.text = path.text;\r\n      r.icon = this._pathIcon(path.source || '');\r\n      r.cache = path.cache;\r\n      r.source = path.source || '';\r\n      r.types = path.types.join(',');\r\n      r.config = JSON.stringify(path.config ?? {});\r\n      r.hasConfig = path.config && !isEmpty(path.config);\r\n      return r;\r\n    });\r\n    data.searchPaths = paths;\r\n\r\n    // === Search Filters ===\r\n    data.searchFilters = settings.searchFilters;\r\n    for (const filter in data.searchFilters) {\r\n      data.searchFilters[filter].label = filter;\r\n    }\r\n\r\n    // === Algorithm ===\r\n    data.algorithm = deepClone(settings.algorithm);\r\n    data.algorithm.fuzzyThreshold = 100 - data.algorithm.fuzzyThreshold * 100;\r\n\r\n    // === Randomizer ===\r\n    // Get all actor types defined by the game system\r\n    data.randomizer = deepClone(settings.randomizer);\r\n    const actorTypes = (game.system.entityTypes ?? game.system.documentTypes)['Actor'];\r\n    data.randomizer.actorTypes = actorTypes.reduce((obj, t) => {\r\n      const label = CONFIG['Actor']?.typeLabels?.[t] ?? t;\r\n      obj[t] = {\r\n        label: game.i18n.has(label) ? game.i18n.localize(label) : t,\r\n        disable: settings.randomizer[`${t}Disable`] ?? false,\r\n      };\r\n      return obj;\r\n    }, {});\r\n\r\n    data.randomizer.tokenToPortraitDisabled =\r\n      !(settings.randomizer.tokenCreate || settings.randomizer.tokenCopyPaste) ||\r\n      data.randomizer.diffImages;\r\n\r\n    // === Pop-up ===\r\n    data.popup = deepClone(settings.popup);\r\n    // Get all actor types defined by the game system\r\n    data.popup.actorTypes = actorTypes.reduce((obj, t) => {\r\n      const label = CONFIG['Actor']?.typeLabels?.[t] ?? t;\r\n      obj[t] = {\r\n        type: t,\r\n        label: game.i18n.has(label) ? game.i18n.localize(label) : t,\r\n        disable: settings.popup[`${t}Disable`] ?? false,\r\n      };\r\n      return obj;\r\n    }, {});\r\n\r\n    // Split into arrays of max length 3\r\n    let allTypes = [];\r\n    let tempTypes = [];\r\n    let i = 0;\r\n    for (const [key, value] of Object.entries(data.popup.actorTypes)) {\r\n      tempTypes.push(value);\r\n      i++;\r\n      if (i % 3 == 0) {\r\n        allTypes.push(tempTypes);\r\n        tempTypes = [];\r\n      }\r\n    }\r\n    if (tempTypes.length > 0) allTypes.push(tempTypes);\r\n    data.popup.actorTypes = allTypes;\r\n\r\n    // === Permissions ===\r\n    data.permissions = settings.permissions;\r\n\r\n    // === Token HUD ===\r\n    data.worldHud = deepClone(settings.worldHud);\r\n    data.worldHud.tokenHUDWildcardActive = game.modules.get('token-hud-wildcard')?.active;\r\n\r\n    // === Internal Effects ===\r\n    data.internalEffects = deepClone(settings.internalEffects);\r\n\r\n    // === Misc ===\r\n    data.keywordSearch = settings.keywordSearch;\r\n    data.excludedKeywords = settings.excludedKeywords;\r\n    data.systemHpPath = settings.systemHpPath;\r\n    data.runSearchOnPath = settings.runSearchOnPath;\r\n    data.imgurClientId = settings.imgurClientId;\r\n    data.enableStatusConfig = settings.enableStatusConfig;\r\n    data.disableNotifs = settings.disableNotifs;\r\n    data.staticCache = settings.staticCache;\r\n    data.staticCacheFile = settings.staticCacheFile;\r\n    data.stackStatusConfig = settings.stackStatusConfig;\r\n    data.mergeGroup = settings.mergeGroup;\r\n    data.customImageCategories = settings.customImageCategories.join(',');\r\n    data.disableEffectIcons = settings.disableEffectIcons;\r\n    data.displayEffectIconsOnHover = settings.displayEffectIconsOnHover;\r\n    data.filterEffectIcons = settings.filterEffectIcons;\r\n    data.hideElevationTooltip = settings.hideElevationTooltip;\r\n    data.hideTokenBorder = settings.hideTokenBorder;\r\n    data.filterCustomEffectIcons = settings.filterCustomEffectIcons;\r\n    data.filterIconList = settings.filterIconList.join(',');\r\n    data.tilesEnabled = settings.tilesEnabled;\r\n    data.updateTokenProto = settings.updateTokenProto;\r\n    data.imgNameContainsDimensions = settings.imgNameContainsDimensions;\r\n    data.imgNameContainsFADimensions = settings.imgNameContainsFADimensions;\r\n    data.playVideoOnHover = settings.playVideoOnHover;\r\n    data.pauseVideoOnHoverOut = settings.pauseVideoOnHoverOut;\r\n    data.disableImageChangeOnPolymorphed = settings.disableImageChangeOnPolymorphed;\r\n    data.disableImageUpdateOnNonPrototype = settings.disableImageUpdateOnNonPrototype;\r\n    data.disableTokenUpdateAnimation = settings.disableTokenUpdateAnimation;\r\n    data.mappingsCurrentSceneOnly = settings.mappingsCurrentSceneOnly;\r\n\r\n    // Controls\r\n    data.pathfinder = ['pf1e', 'pf2e'].includes(game.system.id);\r\n    data.dnd5e = game.system.id === 'dnd5e';\r\n\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n\r\n    // Search Paths\r\n    super.activateListeners(html);\r\n    html.find('a.create-path').click(this._onCreatePath.bind(this));\r\n    html.on('input', '.searchSource', this._onSearchSourceTextChange.bind(this));\r\n    $(html).on('click', 'a.delete-path', this._onDeletePath.bind(this));\r\n    $(html).on('click', 'a.convert-imgur', this._onConvertImgurPath.bind(this));\r\n    $(html).on('click', 'a.convert-json', this._onConvertJsonPath.bind(this));\r\n    $(html).on('click', '.path-image.source-icon a', this._onBrowseFolder.bind(this));\r\n    $(html).on('click', 'a.select-category', showPathSelectCategoryDialog.bind(this));\r\n    $(html).on('click', 'a.select-config', showPathSelectConfigForm.bind(this));\r\n\r\n    // Search Filters\r\n    html.on('input', 'input.filterRegex', this._validateRegex.bind(this));\r\n\r\n    // Active Effects\r\n    const disableEffectIcons = html.find('[name=\"disableEffectIcons\"]');\r\n    const filterEffectIcons = html.find('[name=\"filterEffectIcons\"]');\r\n    disableEffectIcons\r\n      .on('change', (e) => {\r\n        if (e.target.checked) filterEffectIcons.prop('checked', false);\r\n      })\r\n      .trigger('change');\r\n    filterEffectIcons.on('change', (e) => {\r\n      if (e.target.checked) disableEffectIcons.prop('checked', false);\r\n    });\r\n\r\n    // Algorithm\r\n    const algorithmTab = $(html).find('div[data-tab=\"searchAlgorithm\"]');\r\n    algorithmTab.find(`input[name=\"algorithm.exact\"]`).change((e) => {\r\n      $(e.target)\r\n        .closest('form')\r\n        .find('input[name=\"algorithm.fuzzy\"]')\r\n        .prop('checked', !e.target.checked);\r\n    });\r\n    algorithmTab.find(`input[name=\"algorithm.fuzzy\"]`).change((e) => {\r\n      $(e.target)\r\n        .closest('form')\r\n        .find('input[name=\"algorithm.exact\"]')\r\n        .prop('checked', !e.target.checked);\r\n    });\r\n    algorithmTab.find('input[name=\"algorithm.fuzzyThreshold\"]').change((e) => {\r\n      $(e.target).siblings('.token-variants-range-value').html(`${e.target.value}%`);\r\n    });\r\n\r\n    // Randomizer\r\n    const tokenCreate = html.find('input[name=\"randomizer.tokenCreate\"]');\r\n    const tokenCopyPaste = html.find('input[name=\"randomizer.tokenCopyPaste\"]');\r\n    const tokenToPortrait = html.find('input[name=\"randomizer.tokenToPortrait\"]');\r\n    const _toggle = () => {\r\n      tokenToPortrait.prop(\r\n        'disabled',\r\n        !(tokenCreate.is(':checked') || tokenCopyPaste.is(':checked'))\r\n      );\r\n    };\r\n    tokenCreate.change(_toggle);\r\n    tokenCopyPaste.change(_toggle);\r\n\r\n    const diffImages = html.find('input[name=\"randomizer.diffImages\"]');\r\n    const syncImages = html.find('input[name=\"randomizer.syncImages\"]');\r\n    diffImages.change(() => {\r\n      syncImages.prop('disabled', !diffImages.is(':checked'));\r\n      tokenToPortrait.prop('disabled', diffImages.is(':checked'));\r\n    });\r\n\r\n    // Token HUD\r\n    html.find('input[name=\"worldHud.updateActorImage\"]').change((event) => {\r\n      $(event.target)\r\n        .closest('form')\r\n        .find('input[name=\"worldHud.useNameSimilarity\"]')\r\n        .prop('disabled', !event.target.checked);\r\n    });\r\n\r\n    // Static Cache\r\n    html.find('button.token-variants-cache-images').click((event) => {\r\n      const tab = $(event.target).closest('.tab');\r\n      const staticOn = tab.find('input[name=\"staticCache\"]');\r\n      const staticFile = tab.find('input[name=\"staticCacheFile\"]');\r\n      cacheImages({ staticCache: staticOn.is(':checked'), staticCacheFile: staticFile.val() });\r\n    });\r\n\r\n    // Global Mappings\r\n    html.find('button.token-variants-global-mapping').click(() => {\r\n      const setting = game.settings.get('core', DefaultTokenConfig.SETTING);\r\n      const data = new foundry.data.PrototypeToken(setting);\r\n      const token = new TokenDocument(data, { actor: null });\r\n      new EffectMappingForm(token, { globalMappings: true }).render(true);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Validates regex entered into Search Filter's RegEx input field\r\n   */\r\n  async _validateRegex(event) {\r\n    if (this._validRegex(event.target.value)) {\r\n      event.target.style.backgroundColor = '';\r\n    } else {\r\n      event.target.style.backgroundColor = '#ff7066';\r\n    }\r\n  }\r\n\r\n  _validRegex(val) {\r\n    if (val) {\r\n      try {\r\n        new RegExp(val);\r\n      } catch (e) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Open a FilePicker so the user can select a local folder to use as an image source\r\n   */\r\n  async _onBrowseFolder(event) {\r\n    const pathInput = $(event.target).closest('.table-row').find('.path-text input');\r\n    const sourceInput = $(event.target).closest('.table-row').find('.path-source input');\r\n\r\n    let activeSource = sourceInput.val() || 'data';\r\n    let current = pathInput.val();\r\n\r\n    if (activeSource.startsWith('s3:')) {\r\n      const bucketName = activeSource.replace('s3:', '');\r\n      current = `${game.data.files.s3?.endpoint.protocol}//${bucketName}.${game.data.files.s3?.endpoint.host}/${current}`;\r\n    } else if (activeSource.startsWith('rolltable')) {\r\n      let content = `<select style=\"width: 100%;\" name=\"table-name\" id=\"output-tableKey\">`;\r\n\r\n      game.tables.forEach((rollTable) => {\r\n        content += `<option value='${rollTable.name}'>${rollTable.name}</option>`;\r\n      });\r\n\r\n      content += `</select>`;\r\n\r\n      new Dialog({\r\n        title: `Select a Rolltable`,\r\n        content: content,\r\n        buttons: {\r\n          yes: {\r\n            icon: \"<i class='fas fa-check'></i>\",\r\n            label: 'Select',\r\n            callback: (html) => {\r\n              pathInput.val();\r\n              const tableName = html.find(\"select[name='table-name']\").val();\r\n              pathInput.val(tableName);\r\n            },\r\n          },\r\n        },\r\n        default: 'yes',\r\n      }).render(true);\r\n      return;\r\n    }\r\n\r\n    if (activeSource === 'json') {\r\n      new FilePicker({\r\n        type: 'text',\r\n        activeSource: 'data',\r\n        current: current,\r\n        callback: (path, fp) => {\r\n          pathInput.val(path);\r\n        },\r\n      }).render(true);\r\n    } else {\r\n      new FilePicker({\r\n        type: 'folder',\r\n        activeSource: activeSource,\r\n        current: current,\r\n        callback: (path, fp) => {\r\n          pathInput.val(fp.result.target);\r\n          if (fp.activeSource === 's3') {\r\n            sourceInput.val(`s3:${fp.result.bucket}`);\r\n          } else {\r\n            sourceInput.val(fp.activeSource);\r\n          }\r\n        },\r\n      }).render(true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Converts Imgur path to a rolltable\r\n   */\r\n  async _onConvertImgurPath(event) {\r\n    event.preventDefault();\r\n\r\n    const pathInput = $(event.target).closest('.table-row').find('.path-text input');\r\n    const sourceInput = $(event.target).closest('.table-row').find('.path-source input');\r\n\r\n    const albumHash = pathInput.val();\r\n    const imgurClientId =\r\n      TVA_CONFIG.imgurClientId === '' ? 'df9d991443bb222' : TVA_CONFIG.imgurClientId;\r\n\r\n    fetch('https://api.imgur.com/3/gallery/album/' + albumHash, {\r\n      headers: {\r\n        Authorization: 'Client-ID ' + imgurClientId,\r\n        Accept: 'application/json',\r\n      },\r\n    })\r\n      .then((response) => response.json())\r\n      .then(\r\n        async function (result) {\r\n          if (!result.success && location.hostname === 'localhost') {\r\n            ui.notifications.warn(\r\n              game.i18n.format('token-variants.notifications.warn.imgur-localhost')\r\n            );\r\n            return;\r\n          }\r\n\r\n          const data = result.data;\r\n\r\n          let resultsArray = [];\r\n          data.images.forEach((img, i) => {\r\n            resultsArray.push({\r\n              type: 0,\r\n              text: img.title ?? img.description ?? '',\r\n              weight: 1,\r\n              range: [i + 1, i + 1],\r\n              collection: 'Text',\r\n              drawn: false,\r\n              img: img.link,\r\n            });\r\n          });\r\n\r\n          await RollTable.create({\r\n            name: data.title,\r\n            description:\r\n              'Token Variant Art auto generated RollTable: https://imgur.com/gallery/' + albumHash,\r\n            results: resultsArray,\r\n            replacement: true,\r\n            displayRoll: true,\r\n            img: 'modules/token-variants/img/token-images.svg',\r\n          });\r\n\r\n          pathInput.val(data.title);\r\n          sourceInput.val('rolltable').trigger('input');\r\n        }.bind(this)\r\n      )\r\n      .catch((error) => console.warn('TVA | ', error));\r\n  }\r\n\r\n  /**\r\n   * Converts Json path to a rolltable\r\n   */\r\n  async _onConvertJsonPath(event) {\r\n    event.preventDefault();\r\n\r\n    const pathInput = $(event.target).closest('.table-row').find('.path-text input');\r\n    const sourceInput = $(event.target).closest('.table-row').find('.path-source input');\r\n\r\n    const jsonPath = pathInput.val();\r\n\r\n    fetch(jsonPath, {\r\n      headers: {\r\n        Accept: 'application/json',\r\n      },\r\n    })\r\n      .then((response) => response.json())\r\n      .then(\r\n        async function (result) {\r\n          if (!result.length > 0) {\r\n            ui.notifications.warn(\r\n              game.i18n.format('token-variants.notifications.warn.json-localhost')\r\n            );\r\n            return;\r\n          }\r\n\r\n          const data = result;\r\n          data.title = getFileName(jsonPath);\r\n\r\n          let resultsArray = [];\r\n          data.forEach((img, i) => {\r\n            resultsArray.push({\r\n              type: 0,\r\n              text: img.name ?? '',\r\n              weight: 1,\r\n              range: [i + 1, i + 1],\r\n              collection: 'Text',\r\n              drawn: false,\r\n              img: img.path,\r\n            });\r\n          });\r\n\r\n          await RollTable.create({\r\n            name: data.title,\r\n            description: 'Token Variant Art auto generated RollTable: ' + jsonPath,\r\n            results: resultsArray,\r\n            replacement: true,\r\n            displayRoll: true,\r\n            img: 'modules/token-variants/img/token-images.svg',\r\n          });\r\n\r\n          pathInput.val(data.title);\r\n          sourceInput.val('rolltable').trigger('input');\r\n        }.bind(this)\r\n      )\r\n      .catch((error) => console.warn('TVA | ', error));\r\n  }\r\n\r\n  /**\r\n   * Generates a new search path row\r\n   */\r\n  async _onCreatePath(event) {\r\n    event.preventDefault();\r\n    const table = $(event.currentTarget).closest('.token-variant-table');\r\n    let row = `\r\n    <li class=\"table-row flexrow\">\r\n        <div class=\"path-image source-icon\">\r\n            <a><i class=\"${this._pathIcon('')}\"></i></a>\r\n        </div>\r\n        <div class=\"path-source\">\r\n          <input class=\"searchSource\" type=\"text\" name=\"searchPaths.source\" value=\"\" placeholder=\"data\"/>\r\n        </div>\r\n        <div class=\"path-text\">\r\n            <input class=\"searchPath\" type=\"text\" name=\"searchPaths.text\" value=\"\" placeholder=\"Path to folder\"/>\r\n        </div>\r\n        <div class=\"imgur-control\">\r\n            <a class=\"convert-imgur\" title=\"Convert to Rolltable\"><i class=\"fas fa-angle-double-left\"></i></a>\r\n        </div>\r\n        <div class=\"json-control\">\r\n          <a class=\"convert-json\" title=\"Convert to Rolltable\"><i class=\"fas fa-angle-double-left\"></i></a>\r\n        </div>\r\n        <div class=\"path-category\">\r\n            <a class=\"select-category\" title=\"Select image categories/filters\"><i class=\"fas fa-swatchbook\"></i></a>\r\n            <input type=\"hidden\" name=\"searchPaths.types\" value=\"Portrait,Token,PortraitAndToken\">\r\n        </div>\r\n        <div class=\"path-config\">\r\n          <a class=\"select-config\" title=\"Apply configuration to images under this path.\"><i class=\"fas fa-cog fa-lg\"></i></a>\r\n          <input type=\"hidden\" name=\"searchPaths.config\" value=\"{}\">\r\n         </div>\r\n        <div class=\"path-cache\">\r\n            <input type=\"checkbox\" name=\"searchPaths.cache\" data-dtype=\"Boolean\" checked/>\r\n        </div>\r\n        <div class=\"path-controls\">\r\n            <a class=\"delete-path\" title=\"Delete path\"><i class=\"fas fa-trash\"></i></a>\r\n        </div>\r\n    </li>\r\n  `;\r\n    table.append(row);\r\n\r\n    this._reIndexPaths(table);\r\n\r\n    this.setPosition(); // Auto-resize window\r\n  }\r\n\r\n  async _reIndexPaths(table) {\r\n    table\r\n      .find('.path-source')\r\n      .find('input')\r\n      .each(function (index) {\r\n        $(this).attr('name', `searchPaths.${index}.source`);\r\n      });\r\n\r\n    table\r\n      .find('.path-text')\r\n      .find('input')\r\n      .each(function (index) {\r\n        $(this).attr('name', `searchPaths.${index}.text`);\r\n      });\r\n\r\n    table\r\n      .find('.path-cache')\r\n      .find('input')\r\n      .each(function (index) {\r\n        $(this).attr('name', `searchPaths.${index}.cache`);\r\n      });\r\n    table\r\n      .find('.path-category')\r\n      .find('input')\r\n      .each(function (index) {\r\n        $(this).attr('name', `searchPaths.${index}.types`);\r\n      });\r\n    table\r\n      .find('.path-config')\r\n      .find('input')\r\n      .each(function (index) {\r\n        $(this).attr('name', `searchPaths.${index}.config`);\r\n      });\r\n  }\r\n\r\n  async _onDeletePath(event) {\r\n    event.preventDefault();\r\n\r\n    const li = event.currentTarget.closest('.table-row');\r\n    li.remove();\r\n\r\n    const table = $(event.currentTarget).closest('.token-variant-table');\r\n    this._reIndexPaths(table);\r\n\r\n    this.setPosition(); // Auto-resize window\r\n  }\r\n\r\n  async _onSearchSourceTextChange(event) {\r\n    const image = this._pathIcon(event.target.value);\r\n    const imgur = image === 'fas fa-info';\r\n    const json = image === 'fas fa-brackets-curly';\r\n\r\n    const imgurControl = $(event.currentTarget).closest('.table-row').find('.imgur-control');\r\n    if (imgur) imgurControl.addClass('active');\r\n    else imgurControl.removeClass('active');\r\n\r\n    const jsonControl = $(event.currentTarget).closest('.table-row').find('.json-control');\r\n    if (json) jsonControl.addClass('active');\r\n    else jsonControl.removeClass('active');\r\n\r\n    $(event.currentTarget).closest('.table-row').find('.path-image i').attr('class', image);\r\n  }\r\n\r\n  // Return icon appropriate for the path provided\r\n  _pathIcon(source) {\r\n    if (source.startsWith('s3')) {\r\n      return 'fas fa-database';\r\n    } else if (source.startsWith('rolltable')) {\r\n      return 'fas fa-dice';\r\n    } else if (source.startsWith('forgevtt') || source.startsWith('forge-bazaar')) {\r\n      return 'fas fa-hammer';\r\n    } else if (source.startsWith('imgur')) {\r\n      return 'fas fa-info';\r\n    } else if (source.startsWith('json')) {\r\n      return 'fas fa-brackets-curly';\r\n    }\r\n\r\n    return 'fas fa-folder';\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {\r\n    const settings = this.settings;\r\n    formData = expandObject(formData);\r\n\r\n    // Search Paths\r\n    settings.searchPaths = formData.hasOwnProperty('searchPaths')\r\n      ? Object.values(formData.searchPaths)\r\n      : [];\r\n    settings.searchPaths.forEach((path) => {\r\n      if (!path.source) path.source = 'data';\r\n      if (path.types) path.types = path.types.split(',');\r\n      else path.types = [];\r\n      if (path.config) {\r\n        try {\r\n          path.config = JSON.parse(path.config);\r\n        } catch (e) {\r\n          delete path.config;\r\n        }\r\n      } else delete path.config;\r\n    });\r\n\r\n    // Search Filters\r\n    for (const filter in formData.searchFilters) {\r\n      if (!this._validRegex(formData.searchFilters[filter].regex))\r\n        formData.searchFilters[filter].regex = '';\r\n    }\r\n    mergeObject(settings.searchFilters, formData.searchFilters);\r\n\r\n    // Algorithm\r\n    formData.algorithm.fuzzyLimit = parseInt(formData.algorithm.fuzzyLimit);\r\n    if (isNaN(formData.algorithm.fuzzyLimit) || formData.algorithm.fuzzyLimit < 1)\r\n      formData.algorithm.fuzzyLimit = 50;\r\n    formData.algorithm.fuzzyThreshold = (100 - formData.algorithm.fuzzyThreshold) / 100;\r\n    mergeObject(settings.algorithm, formData.algorithm);\r\n\r\n    // Randomizer\r\n    mergeObject(settings.randomizer, formData.randomizer);\r\n\r\n    // Pop-up\r\n    mergeObject(settings.popup, formData.popup);\r\n\r\n    // Permissions\r\n    mergeObject(settings.permissions, formData.permissions);\r\n\r\n    // Token HUD\r\n    mergeObject(settings.worldHud, formData.worldHud);\r\n\r\n    // Internal Effects\r\n    mergeObject(settings.internalEffects, formData.internalEffects);\r\n\r\n    // Misc\r\n    mergeObject(settings, {\r\n      keywordSearch: formData.keywordSearch,\r\n      excludedKeywords: formData.excludedKeywords,\r\n      systemHpPath: formData.systemHpPath?.trim(),\r\n      runSearchOnPath: formData.runSearchOnPath,\r\n      imgurClientId: formData.imgurClientId,\r\n      enableStatusConfig: formData.enableStatusConfig,\r\n      disableNotifs: formData.disableNotifs,\r\n      staticCache: formData.staticCache,\r\n      staticCacheFile: formData.staticCacheFile,\r\n      tilesEnabled: formData.tilesEnabled,\r\n      stackStatusConfig: formData.stackStatusConfig,\r\n      mergeGroup: formData.mergeGroup,\r\n      customImageCategories: (formData.customImageCategories || '')\r\n        .split(',')\r\n        .map((t) => t.trim())\r\n        .filter((t) => t),\r\n      disableEffectIcons: formData.disableEffectIcons,\r\n      displayEffectIconsOnHover: formData.displayEffectIconsOnHover,\r\n      filterEffectIcons: formData.filterEffectIcons,\r\n      hideElevationTooltip: formData.hideElevationTooltip,\r\n      hideTokenBorder: formData.hideTokenBorder,\r\n      filterCustomEffectIcons: formData.filterCustomEffectIcons,\r\n      filterIconList: (formData.filterIconList || '')\r\n        .split(',')\r\n        .map((t) => t.trim())\r\n        .filter((t) => t),\r\n      updateTokenProto: formData.updateTokenProto,\r\n      imgNameContainsDimensions: formData.imgNameContainsDimensions,\r\n      imgNameContainsFADimensions: formData.imgNameContainsFADimensions,\r\n      playVideoOnHover: formData.playVideoOnHover,\r\n      pauseVideoOnHoverOut: formData.pauseVideoOnHoverOut,\r\n      disableImageChangeOnPolymorphed: formData.disableImageChangeOnPolymorphed,\r\n      disableImageUpdateOnNonPrototype: formData.disableImageUpdateOnNonPrototype,\r\n      disableTokenUpdateAnimation: formData.disableTokenUpdateAnimation,\r\n      mappingsCurrentSceneOnly: formData.mappingsCurrentSceneOnly,\r\n    });\r\n\r\n    // Global Mappings\r\n    settings.globalMappings = TVA_CONFIG.globalMappings;\r\n\r\n    // Save Settings\r\n    if (this.dummySettings) {\r\n      mergeObjectFix(this.dummySettings, settings, { insertKeys: false });\r\n    } else {\r\n      updateSettings(settings);\r\n    }\r\n  }\r\n}\r\n\r\n// ========================\r\n// v8 support, broken merge\r\n// ========================\r\nexport function mergeObjectFix(\r\n  original,\r\n  other = {},\r\n  {\r\n    insertKeys = true,\r\n    insertValues = true,\r\n    overwrite = true,\r\n    recursive = true,\r\n    inplace = true,\r\n    enforceTypes = false,\r\n  } = {},\r\n  _d = 0\r\n) {\r\n  other = other || {};\r\n  if (!(original instanceof Object) || !(other instanceof Object)) {\r\n    throw new Error('One of original or other are not Objects!');\r\n  }\r\n  const options = { insertKeys, insertValues, overwrite, recursive, inplace, enforceTypes };\r\n\r\n  // Special handling at depth 0\r\n  if (_d === 0) {\r\n    if (!inplace) original = deepClone(original);\r\n    if (Object.keys(original).some((k) => /\\./.test(k))) original = expandObject(original);\r\n    if (Object.keys(other).some((k) => /\\./.test(k))) other = expandObject(other);\r\n  }\r\n\r\n  // Iterate over the other object\r\n  for (let k of Object.keys(other)) {\r\n    const v = other[k];\r\n    if (original.hasOwnProperty(k)) _mergeUpdate(original, k, v, options, _d + 1);\r\n    else _mergeInsertFix(original, k, v, options, _d + 1);\r\n  }\r\n  return original;\r\n}\r\n\r\nfunction _mergeInsertFix(original, k, v, { insertKeys, insertValues } = {}, _d) {\r\n  // Recursively create simple objects\r\n  if (v?.constructor === Object && insertKeys) {\r\n    original[k] = mergeObjectFix({}, v, { insertKeys: true, inplace: true });\r\n    return;\r\n  }\r\n\r\n  // Delete a key\r\n  if (k.startsWith('-=')) {\r\n    delete original[k.slice(2)];\r\n    return;\r\n  }\r\n\r\n  // Insert a key\r\n  const canInsert = (_d <= 1 && insertKeys) || (_d > 1 && insertValues);\r\n  if (canInsert) original[k] = v;\r\n}\r\n\r\nfunction _mergeUpdate(\r\n  original,\r\n  k,\r\n  v,\r\n  { insertKeys, insertValues, enforceTypes, overwrite, recursive } = {},\r\n  _d\r\n) {\r\n  const x = original[k];\r\n  const tv = getType(v);\r\n  const tx = getType(x);\r\n\r\n  // Recursively merge an inner object\r\n  if (tv === 'Object' && tx === 'Object' && recursive) {\r\n    return mergeObjectFix(\r\n      x,\r\n      v,\r\n      {\r\n        insertKeys: insertKeys,\r\n        insertValues: insertValues,\r\n        overwrite: overwrite,\r\n        inplace: true,\r\n        enforceTypes: enforceTypes,\r\n      },\r\n      _d\r\n    );\r\n  }\r\n\r\n  // Overwrite an existing value\r\n  if (overwrite) {\r\n    if (tx !== 'undefined' && tv !== tx && enforceTypes) {\r\n      throw new Error(`Mismatched data types encountered during object merge.`);\r\n    }\r\n    original[k] = v;\r\n  }\r\n}\r\n","import { TVA_CONFIG, updateSettings } from '../scripts/settings.js';\r\nimport { getFileName } from '../scripts/utils.js';\r\nimport { showArtSelect } from '../token-variants.mjs';\r\n\r\nexport default class MissingImageConfig extends FormApplication {\r\n  constructor() {\r\n    super({}, {});\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-missing-images',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/missingImageConfig.html',\r\n      resizable: true,\r\n      minimizable: false,\r\n      title: 'Define Missing Images',\r\n      width: 560,\r\n      height: 'auto',\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n\r\n    if (!this.missingImages)\r\n      this.missingImages = deepClone(TVA_CONFIG.compendiumMapper.missingImages);\r\n\r\n    data.missingImages = this.missingImages;\r\n\r\n    data.documents = ['all', 'Actor', 'Cards', 'Item', 'Macro', 'RollTable'];\r\n    return data;\r\n  }\r\n\r\n  _processFormData(formData) {\r\n    if (!Array.isArray(formData.document)) {\r\n      formData.document = [formData.document];\r\n      formData.image = [formData.image];\r\n    }\r\n\r\n    const missingImages = [];\r\n    for (let i = 0; i < formData.document.length; i++) {\r\n      missingImages.push({ document: formData.document[i], image: formData.image[i] });\r\n    }\r\n    return missingImages;\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n\r\n    html.on('click', '.add-row', () => {\r\n      const formData = this._getSubmitData();\r\n      this.missingImages = this._processFormData(formData);\r\n      this.missingImages.push({ document: 'all', image: CONST.DEFAULT_TOKEN });\r\n      this.render();\r\n    });\r\n\r\n    html.on('click', '.delete-row', (event) => {\r\n      const formData = this._getSubmitData();\r\n      this.missingImages = this._processFormData(formData);\r\n      const index = $(event.target).closest('li')[0].dataset.index;\r\n      this.missingImages.splice(index, 1);\r\n      this.render();\r\n    });\r\n\r\n    html.on('click', '.file-picker', (event) => {\r\n      new FilePicker({\r\n        type: 'imagevideo',\r\n        callback: (path) => {\r\n          $(event.target).closest('li').find('[name=\"image\"]').val(path);\r\n          $(event.target).closest('li').find('img').attr('src', path);\r\n        },\r\n      }).render();\r\n    });\r\n\r\n    html.on('click', '.duplicate-picker', (event) => {\r\n      let content = `<select style=\"width: 100%;\" name=\"compendium\">`;\r\n\r\n      game.packs.forEach((pack) => {\r\n        content += `<option value='${pack.collection}'>${pack.title}</option>`;\r\n      });\r\n\r\n      content += `</select>`;\r\n\r\n      new Dialog({\r\n        title: `Compendiums`,\r\n        content: content,\r\n        buttons: {\r\n          yes: {\r\n            icon: \"<i class='far fa-search'></i>\",\r\n            label: 'Search for Duplicates',\r\n            callback: (html) => {\r\n              const found = new Set();\r\n              const duplicates = new Set();\r\n              const compendium = game.packs.get(html.find(\"[name='compendium']\").val());\r\n              compendium.index.forEach((k) => {\r\n                if (found.has(k.img)) {\r\n                  duplicates.add(k.img);\r\n                }\r\n                found.add(k.img);\r\n              });\r\n              if (!duplicates.size) {\r\n                ui.notifications.info('No duplicates found in: ' + compendium.title);\r\n              }\r\n\r\n              const images = Array.from(duplicates).map((img) => {\r\n                return { path: img, name: getFileName(img) };\r\n              });\r\n              const allImages = new Map();\r\n              allImages.set('Duplicates', images);\r\n\r\n              showArtSelect('Duplicates', {\r\n                allImages,\r\n                callback: (img) => {\r\n                  $(event.target).closest('li').find('[name=\"image\"]').val(img);\r\n                  $(event.target).closest('li').find('img').attr('src', img);\r\n                },\r\n              });\r\n            },\r\n          },\r\n        },\r\n        default: 'yes',\r\n      }).render(true);\r\n    });\r\n  }\r\n\r\n  async _updateObject(event, formData) {\r\n    updateSettings({\r\n      compendiumMapper: { missingImages: this._processFormData(formData) },\r\n    });\r\n  }\r\n}\r\n","import { TVA_CONFIG, updateSettings } from '../scripts/settings.js';\r\nimport { showPathSelectCategoryDialog, showPathSelectConfigForm } from './dialogs.js';\r\n\r\nexport class ForgeSearchPaths extends FormApplication {\r\n  constructor() {\r\n    super({}, {});\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-search-paths',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/forgeSearchPaths.html',\r\n      resizable: true,\r\n      minimizable: false,\r\n      closeOnSubmit: false,\r\n      title: game.i18n.localize('token-variants.settings.search-paths.Name'),\r\n      width: 592,\r\n      height: 'auto',\r\n      scrollY: ['ol.token-variant-table'],\r\n      dragDrop: [{ dragSelector: null, dropSelector: null }],\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    if (!this.object.paths) this.object.paths = await this._getPaths();\r\n\r\n    const paths = this.object.paths.map((path) => {\r\n      const r = {};\r\n      r.text = path.text;\r\n      r.cache = path.cache;\r\n      r.share = path.share;\r\n      r.types = path.types.join(',');\r\n      r.config = JSON.stringify(path.config ?? {});\r\n      return r;\r\n    });\r\n\r\n    const data = super.getData(options);\r\n    data.paths = paths;\r\n    data.apiKey = this.apiKey;\r\n    return data;\r\n  }\r\n\r\n  async _getPaths() {\r\n    const forgePaths = deepClone(TVA_CONFIG.forgeSearchPaths) || {};\r\n    this.userId = typeof ForgeAPI !== 'undefined' ? await ForgeAPI.getUserId() : 'tempUser'; // TODO\r\n    this.apiKey = forgePaths[this.userId]?.apiKey;\r\n    return forgePaths[this.userId]?.paths || [];\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n    html.find('a.create-path').click(this._onCreatePath.bind(this));\r\n    $(html).on('click', 'a.select-category', showPathSelectCategoryDialog.bind(this));\r\n    $(html).on('click', 'a.select-config', showPathSelectConfigForm.bind(this));\r\n    html.find('a.delete-path').click(this._onDeletePath.bind(this));\r\n    html.find('button.reset').click(this._onReset.bind(this));\r\n    html.find('button.update').click(this._onUpdate.bind(this));\r\n    $(html).on('click', '.path-image.source-icon a', this._onBrowseFolder.bind(this));\r\n  }\r\n\r\n  /**\r\n   * Open a FilePicker so the user can select a local folder to use as an image source\r\n   */\r\n  async _onBrowseFolder(event) {\r\n    const pathInput = $(event.target).closest('.table-row').find('.path-text input');\r\n\r\n    new FilePicker({\r\n      type: 'folder',\r\n      activeSource: 'forgevtt',\r\n      current: pathInput.val(),\r\n      callback: (path, fp) => {\r\n        if (fp.activeSource !== 'forgevtt') {\r\n          ui.notifications.warn(\"Token Variant Art: Only 'Assets Library' paths are supported\");\r\n        } else {\r\n          pathInput.val(fp.result.target);\r\n        }\r\n      },\r\n    }).render(true);\r\n  }\r\n\r\n  async _onCreatePath(event) {\r\n    event.preventDefault();\r\n    await this._onSubmit(event);\r\n\r\n    this.object.paths.push({\r\n      text: '',\r\n      cache: true,\r\n      share: true,\r\n      types: ['Portrait', 'Token', 'PortraitAndToken'],\r\n    });\r\n    this.render();\r\n  }\r\n\r\n  async _onDeletePath(event) {\r\n    event.preventDefault();\r\n    await this._onSubmit(event);\r\n\r\n    const li = event.currentTarget.closest('.table-row');\r\n    this.object.paths.splice(li.dataset.index, 1);\r\n    this.render();\r\n  }\r\n\r\n  _onReset(event) {\r\n    event.preventDefault();\r\n    this.object.paths = this._getPaths();\r\n    this.render();\r\n  }\r\n\r\n  async _onUpdate(event) {\r\n    event.preventDefault();\r\n    await this._onSubmit(event);\r\n    this._updatePaths();\r\n  }\r\n\r\n  async _updateObject(event, formData) {\r\n    const expanded = expandObject(formData);\r\n    expanded.paths = expanded.hasOwnProperty('paths') ? Object.values(expanded.paths) : [];\r\n    expanded.paths.forEach((path, index) => {\r\n      this.object.paths[index] = {\r\n        text: path.text,\r\n        cache: path.cache,\r\n        share: path.share,\r\n        source: path.source,\r\n        types: path.types.split(','),\r\n      };\r\n      if (path.config) {\r\n        try {\r\n          path.config = JSON.parse(path.config);\r\n          if (!isEmpty(path.config)) {\r\n            this.object.paths[index].config = path.config;\r\n          }\r\n        } catch (e) {}\r\n      }\r\n    });\r\n    this.apiKey = expanded.apiKey;\r\n  }\r\n\r\n  _cleanPaths() {\r\n    // Cleanup empty and duplicate paths\r\n    let uniquePaths = new Set();\r\n    let paths = this.object.paths.filter((path) => {\r\n      if (!path.text || uniquePaths.has(path.text)) return false;\r\n      uniquePaths.add(path.text);\r\n      return true;\r\n    });\r\n    return paths;\r\n  }\r\n\r\n  _updatePaths() {\r\n    if (this.userId) {\r\n      const forgePaths = deepClone(TVA_CONFIG.forgeSearchPaths) || {};\r\n      forgePaths[this.userId] = {\r\n        paths: this._cleanPaths(),\r\n        apiKey: this.apiKey,\r\n      };\r\n\r\n      if (game.user.isGM) {\r\n        updateSettings({ forgeSearchPaths: forgePaths });\r\n      } else {\r\n        // Workaround for forgeSearchPaths setting to be updated by non-GM clients\r\n        const message = {\r\n          handlerName: 'forgeSearchPaths',\r\n          args: forgePaths,\r\n          type: 'UPDATE',\r\n        };\r\n        game.socket?.emit('module.token-variants', message);\r\n      }\r\n    }\r\n  }\r\n\r\n  async close(options = {}) {\r\n    await this._onSubmit(event);\r\n    this._updatePaths();\r\n    return super.close(options);\r\n  }\r\n}\r\n","import { TVA_CONFIG } from '../scripts/settings.js';\r\n\r\nexport default class TokenHUDClientSettings extends FormApplication {\r\n  constructor() {\r\n    super({}, { title: `Token HUD Settings` });\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-hud-settings',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/tokenHUDClientSettings.html',\r\n      resizable: false,\r\n      minimizable: false,\r\n      title: '',\r\n      width: 500,\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n    return mergeObject(data, TVA_CONFIG.hud);\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {\r\n    game.settings.set('token-variants', 'hudSettings', mergeObject(TVA_CONFIG.hud, formData));\r\n  }\r\n}\r\n","import { importSettingsFromJSON, exportSettingsToJSON } from '../scripts/settings.js';\r\n\r\nexport default class ImportExport extends FormApplication {\r\n  static get defaultOptions() {\r\n    return mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-import-export',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/importExport.html',\r\n      resizable: false,\r\n      minimizable: false,\r\n      title: 'Import/Export',\r\n      width: 250,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n    html.find('.import').click(this._importFromJSONDialog.bind(this));\r\n    html.find('.export').click(() => {\r\n      exportSettingsToJSON();\r\n      this.close();\r\n    });\r\n  }\r\n\r\n  async _importFromJSONDialog() {\r\n    const content = await renderTemplate('templates/apps/import-data.html', {\r\n      entity: 'token-variants',\r\n      name: 'settings',\r\n    });\r\n    let dialog = new Promise((resolve, reject) => {\r\n      new Dialog(\r\n        {\r\n          title: game.i18n.localize('token-variants.settings.import-export.window.import-dialog'),\r\n          content: content,\r\n          buttons: {\r\n            import: {\r\n              icon: '<i class=\"fas fa-file-import\"></i>',\r\n              label: game.i18n.localize('token-variants.common.import'),\r\n              callback: (html) => {\r\n                const form = html.find('form')[0];\r\n                if (!form.data.files.length)\r\n                  return ui.notifications?.error('You did not upload a data file!');\r\n                readTextFromFile(form.data.files[0]).then((json) => {\r\n                  importSettingsFromJSON(json);\r\n                  resolve(true);\r\n                });\r\n              },\r\n            },\r\n            no: {\r\n              icon: '<i class=\"fas fa-times\"></i>',\r\n              label: 'Cancel',\r\n              callback: (html) => resolve(false),\r\n            },\r\n          },\r\n          default: 'import',\r\n        },\r\n        {\r\n          width: 400,\r\n        }\r\n      ).render(true);\r\n    });\r\n    this.close();\r\n    return await dialog;\r\n  }\r\n}\r\n"],"names":[],"version":3,"file":"bundle.js.map","sourceRoot":"../"}