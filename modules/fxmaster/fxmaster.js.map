{"version":3,"file":"fxmaster.js","sources":["../src/constants.js","../src/utils.js","../src/logger.js","../src/migration/helpers.js","../src/migration/world/2.js","../src/migration/world/3.js","../src/migration/world/migration.js","../src/migration/client/1.js","../src/migration/client/migration.js","../src/migration/migration.js","../src/settings.js","../src/hooks.js","../src/filter-effects/filters/mixins/filter.js","../src/filter-effects/filters/mixins/fading-filter.js","../src/filter-effects/filters/bloom.js","../src/filter-effects/filters/color.js","../src/filter-effects/filters/fog.js","../src/ease.js","../src/filter-effects/filters/lightning.js","../src/filter-effects/filters/old-film.js","../src/filter-effects/filters/predator.js","../src/filter-effects/filters/underwater.js","../src/filter-effects/filter-effects-db.js","../src/particle-effects/effects/effect.js","../src/particle-effects/effects/mixins/default-retangle-spawn.js","../src/particle-effects/effects/spiders.js","../src/particle-effects/effects/helpers/with-stepped-gradient-color.js","../src/particle-effects/effects/stars.js","../src/particle-effects/effects/leaves.js","../src/particle-effects/effects/bats.js","../src/particle-effects/effects/bubbles.js","../src/particle-effects/effects/clouds.js","../src/particle-effects/effects/crows.js","../src/particle-effects/effects/fog.js","../src/particle-effects/effects/rats.js","../src/particle-effects/effects/snowstorm.js","../src/particle-effects/particle-effects-db.js","../src/config.js","../src/particle-effects/effects/birds.js","../src/particle-effects/effects/eagles.js","../src/particle-effects/effects/embers.js","../src/particle-effects/effects/rain.js","../src/particle-effects/effects/rain-top.js","../src/particle-effects/effects/rain-simple.js","../src/particle-effects/effects/snow.js","../src/special-effects/special-effects-db.js","../src/particle-effects/particle-effects-layer.js","../src/particle-effects/drawings-mask.js","../src/particle-effects/scene-mask.js","../src/filter-effects/filter-manager.js","../src/special-effects/applications/special-effect-config.js","../src/special-effects/applications/special-effects-management.js","../src/special-effects/mesh.js","../src/special-effects/special-effects-layer.js","../src/base-form.js","../src/particle-effects/applications/particle-effects-management.js","../src/filter-effects/applications/filter-effects-management.js","../src/macro.js","../src/controls.js","../src/fxmaster.js","../src/handlebars-helpers.js"],"sourcesContent":["export const packageId = \"fxmaster\";\n","import { packageId } from \"./constants.js\";\n\n/**\n * Reset a flag to a given value, replacing inner objects.\n * @param {foundry.abstract.Document} document The document on which to reset the flag\n * @param {string}                    key      The flag key\n * @param {*}                         value    The flag value\n * @return {Promise<Document>}  A Promise resolving to the updated document\n */\nexport function resetFlag(document, key, value) {\n  if (typeof value === \"object\" && !Array.isArray(value) && value !== null) {\n    const oldFlags = document.getFlag(packageId, key);\n    const keys = oldFlags ? Object.keys(oldFlags) : [];\n    keys.forEach((k) => {\n      if (value[k]) return;\n      value[`-=${k}`] = null;\n    });\n  }\n  return document.setFlag(packageId, key, value);\n}\n\n/**\n * Round a number to the given number of decimals.\n * @param {number} number   The number to round\n * @param {number} decimals The number of decimals to round to\n * @returns {number} The rounded result\n */\nexport function roundToDecimals(number, decimals) {\n  return Number(Math.round(number + \"e\" + decimals) + \"e-\" + decimals);\n}\n\n/**\n * Omit a specific key from an object.\n * @param {object} object The object from which to omit\n * @param {string|number|symbol} key The key to omit\n * @returns {object} The object without the given key.\n */\nexport function omit(object, key) {\n  const { [key]: _omitted, ...rest } = object;\n  return rest;\n}\n","const loggingContext = \"FXMaster\";\nconst loggingSeparator = \"|\";\n\n/**\n * Gets a logging function for the requested log level.\n * @typedef {'debug' | 'info' | 'warn' | 'error'} LogLevel\n * @typedef {(...args: unknown[]) => void} LoggingFunction\n * @param {LogLevel} [type = 'info'] - The log level of the requested logger\n * @returns {LoggingFunction}\n */\nfunction getLoggingFunction(type = \"info\") {\n  const log = console[type];\n  return (...data) => log(loggingContext, loggingSeparator, ...data);\n}\n\n/**\n * Format a message for logging.\n * @param {string} msg The message to format for logging.\n */\nexport function format(msg) {\n  return `${loggingContext} ${loggingSeparator} ${msg}`;\n}\n\n/**\n * A singleton logger object.\n */\nexport const logger = Object.freeze({\n  debug: getLoggingFunction(\"debug\"),\n  info: getLoggingFunction(\"info\"),\n  warn: getLoggingFunction(\"warn\"),\n  error: getLoggingFunction(\"error\"),\n  getLoggingFunction,\n});\n","import { logger } from \"../logger.js\";\n\n/**\n * Migrate a world collection.\n * @param {WorldCollection} collection The world collection to migrate\n * @param {(document: Document) => Promise<void>} migrateDocument The function to use for updating a single document\n * @returns {Promise<boolean>} Whether or not there was an error during the migration\n */\nexport async function migrateWorldCollection(collection, migrateDocument) {\n  let isError = false;\n\n  for (const document of collection) {\n    logger.debug(`Migrating ${collection.documentName} '${document.name}' (${document.id}).`);\n    try {\n      await migrateDocument(document);\n    } catch (e) {\n      logger.error(`Migration of ${collection.documentName} '${document.name}' (${document.id}) failed.`, e);\n      isError = true;\n    }\n  }\n\n  return isError;\n}\n\n/**\n * Migrate a compendium pack.\n * @param {CompendiumCollection} pack The compendium pack to migrate\n * @param {(document: Document) => Promise<void>} migrateDocument The function to use for updating a single document\n * @returns {Promise<boolean>} Whether or not there was an error during the migration\n */\nexport async function migrateCompendiumCollection(pack, migrateDocument) {\n  let isError = false;\n\n  const type = pack.metadata.type;\n\n  const wasLocked = pack.locked;\n  await pack.configure({ locked: false });\n\n  const documents = await pack.getDocuments();\n\n  for (const document of documents) {\n    logger.debug(`Migrating ${type} '${document.name}' (${document.id}) in compendium ${pack.collection}.`);\n    try {\n      await migrateDocument(document);\n    } catch (e) {\n      logger.error(\n        `Migration of ${type} '${document.name}' (${document.id}) in compendium ${pack.collection} failed.`,\n        e,\n      );\n      isError = true;\n    }\n  }\n\n  await pack.configure({ locked: wasLocked });\n\n  return isError;\n}\n\n/** @typedef {Record<string, (document: Document) => Promise<void>} MigrationConfiguration */\n\n/**\n * Migrate the given world collections according to the given migration configuration.\n * @param {Iterable<WorldCollection>} collections            The world collections to migrate\n * @param {MigrationConfiguration}    migrationConfiguration The configuration for the migration\n * @returns {Promise<boolean>} Whether or not there was an error during the migration\n */\nexport async function migrateWorldCollections(collections, migrationConfiguration) {\n  let isError = false;\n\n  for (const collection of collections) {\n    const type = collection.documentName;\n    if (!(type in migrationConfiguration)) {\n      continue;\n    }\n    isError |= await migrateWorldCollection(collection, migrationConfiguration[type]);\n  }\n\n  return isError;\n}\n\n/** @typedef {{migrateNonWorldPacks?: boolean}} MigrateCompendiumCollectionsOptions */\n\n/**\n * Migrate the given compoendium packs according to the given migration configuration.\n * @param {Iterable<CompendiumCollection>}      collections            The compendium packs to migrate\n * @param {MigrationConfiguration}              migrationConfiguration The configuration for the migration\n * @param {MigrateCompendiumCollectionsOptions} [options={}]           Additional options for the migration\n * @returns {Promise<boolean>} Whether or not there was an error during the migration\n */\nexport async function migrateCompendiumCollections(\n  packs,\n  migrationConfiguration,\n  { migrateNonWorldPacks = false } = {},\n) {\n  let isError = false;\n\n  for (const pack of packs) {\n    const type = pack.metadata.type;\n    if ((pack.metadata.package !== \"world\" && !migrateNonWorldPacks) || !(type in migrationConfiguration)) {\n      continue;\n    }\n    isError |= await migrateCompendiumCollection(pack, migrationConfiguration[type]);\n  }\n\n  return isError;\n}\n\n/**\n * Perform a migration for the given migration configuration.\n * @param {MigrationConfiguration} migrationConfiguration The configuration for the migration\n * @returns {Promise<boolean>} Whether or not there was an error during the migration\n */\nexport async function migrate(migrationConfiguration) {\n  let isError = false;\n  isError |= await migrateWorldCollections(game.collections, migrationConfiguration);\n  isError |= await migrateCompendiumCollections(game.packs, migrationConfiguration);\n  return isError;\n}\n","import { packageId } from \"../../constants.js\";\nimport { resetFlag } from \"../../utils.js\";\nimport { migrate } from \"../helpers.js\";\n\nexport async function migrate2() {\n  return migrate(migrationConfiguration2);\n}\n\n/** @type {import('../helpers.js').MigrationConfiguration} */\nexport const migrationConfiguration2 = {\n  Scene: migrateScene,\n};\n\nasync function migrateScene(scene) {\n  const particleEffects = scene.getFlag(packageId, \"effects\") ?? {};\n  if (Object.keys(particleEffects).length > 0) {\n    const newParticleEffects = Object.fromEntries(\n      Object.entries(particleEffects).map(([id, effect]) => {\n        const particleEffectClass = CONFIG.fxmaster.particleEffects[effect.type];\n        return [id, { ...effect, options: particleEffectClass.convertOptionsToV2(effect.options, scene) }];\n      }),\n    );\n    await resetFlag(scene, \"effects\", newParticleEffects);\n  }\n}\n","import { packageId } from \"../../constants.js\";\nimport { migrate } from \"../helpers.js\";\n\nexport async function migrate3() {\n  return migrate(migrationConfiguration3);\n}\n\n/** @type {import('../helpers.js').MigrationConfiguration} */\nexport const migrationConfiguration3 = {\n  Macro: migrateMacro,\n  Scene: migrateScene,\n};\n\nasync function migrateMacro(macro) {\n  /** @type {{command: string, img: string | null}} */\n  const { command, img } = macro;\n\n  const newCommand = command\n    ?.replaceAll(`${packageId}.updateWeather`, `${packageId}.updateParticleEffects`)\n    .replaceAll(`updateWeather`, `${packageId}.updateParticleEffects`)\n    .replaceAll(`${packageId}.switchWeather`, `${packageId}.switchParticleEffect`)\n    .replaceAll(`switchWeather`, `${packageId}.switchParticleEffect`)\n    .replaceAll(\"fxmaster/assets/specialEffects\", \"fxmaster/assets/special-effects\")\n    .replaceAll(\n      \"fxmaster/assets/special-effects/fxmaster/smokeBomb.webm\",\n      \"fxmaster/assets/special-effects/fxmaster/smoke-bomb.webm\",\n    );\n\n  const newImg = img?.replaceAll(\"fxmaster/assets/weatherEffects/icons\", \"fxmaster/assets/particle-effects/icons\");\n\n  if (newCommand !== command || newImg !== img) {\n    await macro.update({ command: newCommand, img: newImg });\n  }\n}\n\nasync function migrateScene(scene) {\n  if (scene.getFlag(packageId, \"filteredLayers\") !== undefined) {\n    await scene.unsetFlag(packageId, \"filteredLayers\");\n  }\n}\n","/* eslint-disable no-fallthrough */\nimport { packageId } from \"../../constants.js\";\nimport { migrate2, migrationConfiguration2 } from \"./2.js\";\nimport { migrate3, migrationConfiguration3 } from \"./3.js\";\n\nexport const targetServerMigration = 3;\n\nexport async function migrateWorld() {\n  const migration = game.settings.get(packageId, \"migration\");\n  if (migration === -1) {\n    return game.settings.set(packageId, \"migration\", targetServerMigration);\n  }\n\n  if (migration < targetServerMigration) {\n    ui.notifications.info(\"FXMASTER.MigrationWorldStart\", { localize: true, permanent: true });\n    let isError = false;\n\n    switch (migration) {\n      case 0:\n      case 1:\n        isError |= await migrate2();\n      case 2:\n        isError |= await migrate3();\n    }\n\n    if (isError) {\n      await game.settings.set(packageId, \"disableAll\", true);\n      ui.notifications.error(\"FXMASTER.MigrationWorldCompletedWithErrors\", { localize: true, permanent: true });\n    } else {\n      ui.notifications.info(\"FXMASTER.MigrationWorldCompletedSuccessfully\", { localize: true, permanent: true });\n    }\n    await game.settings.set(packageId, \"migration\", targetServerMigration);\n  }\n}\n\nexport function isOnTargetWorldMigration() {\n  return game.settings.get(packageId, \"migration\") === targetServerMigration;\n}\n\nexport const worldMigrations = {\n  2: {\n    migrate: migrate2,\n    config: migrationConfiguration2,\n  },\n  3: {\n    migrate: migrate3,\n    config: migrationConfiguration3,\n  },\n};\n","import { packageId } from \"../../constants.js\";\n\nexport async function migrate1() {\n  const effects = game.settings.get(packageId, \"specialEffects\");\n  for (let i = 0; i < effects.length; ++i) {\n    if (typeof effects[i].scale !== \"object\") {\n      effects[i].scale = {\n        x: effects[i].scale,\n        y: effects[i].scale,\n      };\n    }\n  }\n  await game.settings.set(packageId, \"specialEffects\", effects);\n  return false;\n}\n","import { packageId } from \"../../constants.js\";\nimport { migrate1 } from \"./1.js\";\n\nexport const targetClientMigration = 1;\n\nexport async function migrateClient() {\n  const migration = game.settings.get(packageId, \"clientMigration\");\n  if (migration === -1) {\n    return game.settings.set(packageId, \"clientMigration\", targetClientMigration);\n  }\n\n  if (migration < targetClientMigration) {\n    ui.notifications.info(\"FXMASTER.MigrationClientStart\", { permanent: true, localize: true });\n    let isError = false;\n\n    switch (migration) {\n      case 0:\n        isError |= await migrate1();\n    }\n\n    if (isError) {\n      ui.notifications.error(\"FXMASTER.MigrationClientCompletedWithErrors\", { localize: true, permanent: true });\n    } else {\n      ui.notifications.info(\"FXMASTER.MigrationClientCompletedSuccessfully\", { localize: true, permanent: true });\n    }\n    await game.settings.set(packageId, \"clientMigration\", targetClientMigration);\n  }\n}\n\nexport function isOnTargetClientMigration() {\n  return game.settings.get(packageId, \"clientMigration\") === targetClientMigration;\n}\n\nexport const clientMigrations = {\n  1: {\n    migrate: migrate1,\n  },\n};\n","import { isOnTargetWorldMigration, migrateWorld, worldMigrations } from \"./world/migration.js\";\nimport { clientMigrations, isOnTargetClientMigration, migrateClient } from \"./client/migration.js\";\nimport * as helpers from \"./helpers.js\";\n\nexport async function migrate() {\n  await migrateClient();\n  if (game.user.isGM) {\n    await migrateWorld();\n  }\n}\n\nexport function isOnTargetMigration() {\n  return isOnTargetWorldMigration() && isOnTargetClientMigration();\n}\n\n/**\n * Schedule a callback to be executed as soon as the world has been migrated to the target migration. If it is on the\n * latest migration already, the callback is executed immediately. Callbacks are executed in the order in that they have\n * been registered.\n * @param {() => (Promise<void> | void)} callback A callback to execute when the world is migrated\n */\nexport function executeWhenWorldIsMigratedToLatest(callback) {\n  if (!isOnTargetWorldMigration()) {\n    worldMigrationCallbacks.push(callback);\n  } else {\n    callback();\n  }\n}\n\n/** @type {Array<() => (Promise<void> | void)>} */\nconst worldMigrationCallbacks = [];\n\nexport async function onWorldMigrated() {\n  if (isOnTargetWorldMigration()) {\n    while (worldMigrationCallbacks.length > 0) {\n      const callback = worldMigrationCallbacks.shift();\n      await callback();\n    }\n  }\n}\n\nexport const migration = { client: clientMigrations, world: worldMigrations, helpers };\n","import { packageId } from \"./constants.js\";\nimport { onWorldMigrated } from \"./migration/migration.js\";\n\nexport function registerSettings() {\n  game.settings.register(packageId, \"enable\", {\n    name: \"FXMASTER.Enable\",\n    default: true,\n    scope: \"client\",\n    type: Boolean,\n    config: true,\n    requiresReload: true,\n  });\n\n  game.settings.register(packageId, \"specialEffects\", {\n    name: \"specialEffects\",\n    default: [],\n    scope: \"world\",\n    type: Array,\n    config: false,\n  });\n\n  game.settings.register(packageId, \"migration\", {\n    name: \"migration\",\n    default: -1,\n    scope: \"world\",\n    type: Number,\n    config: false,\n    onChange: onWorldMigrated,\n  });\n\n  game.settings.register(packageId, \"clientMigration\", {\n    name: \"clientMigration\",\n    default: -1,\n    scope: \"client\",\n    type: Number,\n    config: false,\n  });\n\n  game.settings.register(packageId, \"permission-create\", {\n    name: \"FXMASTER.PermissionCreate\",\n    hint: \"FXMASTER.PermissionCreateHint\",\n    scope: \"world\",\n    config: true,\n    default: foundry.CONST.USER_ROLES.ASSISTANT,\n    type: Number,\n    choices: {\n      [foundry.CONST.USER_ROLES.PLAYER]: \"USER.RolePlayer\",\n      [foundry.CONST.USER_ROLES.TRUSTED]: \"USER.RoleTrusted\",\n      [foundry.CONST.USER_ROLES.ASSISTANT]: \"USER.RoleAssistant\",\n      [foundry.CONST.USER_ROLES.GAMEMASTER]: \"USER.RoleGamemaster\",\n    },\n    requiresReload: true,\n  });\n\n  game.settings.register(packageId, \"disableAll\", {\n    name: \"FXMASTER.DisableAll\",\n    hint: \"FXMASTER.DisableAllHint\",\n    default: false,\n    scope: \"world\",\n    type: Boolean,\n    config: true,\n  });\n}\n\nexport function isEnabled() {\n  return game.settings.get(packageId, \"enable\") && !game.settings.get(packageId, \"disableAll\");\n}\n","import { packageId } from \"./constants.js\";\nimport { format } from \"./logger.js\";\nimport { omit, resetFlag } from \"./utils.js\";\n\nexport const registerHooks = function () {\n  Hooks.on(`${packageId}.switchParticleEffect`, onSwitchParticleEffects);\n  Hooks.on(`${packageId}.updateParticleEffects`, onUpdateParticleEffects);\n  Object.keys(deprecations).forEach((hook) => Hooks.on(hook, onDeprecated(hook)));\n};\n\n/**\n * Handle a request to toggle named a particle effect in the current scene.\n * @param {{name: string, type: string, options: object}} parameters The parameters that define the named particle effect\n */\nasync function onSwitchParticleEffects(parameters) {\n  if (!canvas.scene) {\n    return;\n  }\n\n  const currentEffects = canvas.scene.getFlag(packageId, \"effects\") ?? {};\n  const shouldSwitchOff = parameters.name in currentEffects;\n  const effects = shouldSwitchOff\n    ? omit(currentEffects, parameters.name)\n    : { ...currentEffects, [parameters.name]: { type: parameters.type, options: parameters.options } };\n\n  if (Object.keys(effects).length == 0) {\n    await canvas.scene.unsetFlag(packageId, \"effects\");\n  } else {\n    resetFlag(canvas.scene, \"effects\", effects);\n  }\n}\n\n/**\n * Handle a request to set the particle effects in the current scene.\n * @param {Array<object>} parametersArray The array of parameters defining the effects to be activated\n */\nasync function onUpdateParticleEffects(parametersArray) {\n  const effects = Object.fromEntries(parametersArray.map((parameters) => [foundry.utils.randomID(), parameters]));\n  resetFlag(canvas.scene, \"effects\", effects);\n}\n\nconst deprecations = {\n  updateWeather: {\n    replacedBy: `${packageId}.updateParticleEffects`,\n    callback: onUpdateParticleEffects,\n  },\n  switchWeather: {\n    replacedBy: `${packageId}.switchParticleEffects`,\n    callback: onSwitchParticleEffects,\n  },\n  [`${packageId}.updateWeather`]: {\n    replacedBy: `${packageId}.updateParticleEffects`,\n    callback: onUpdateParticleEffects,\n  },\n  [`${packageId}.switchWeather`]: {\n    replacedBy: `${packageId}.switchParticleEffects`,\n    callback: onSwitchParticleEffects,\n  },\n};\n\nfunction onDeprecated(hook) {\n  return function (...args) {\n    const deprecation = deprecations[hook];\n    const msg = format(`The '${hook}' hook is deprecated in favor of the '${deprecation.replacedBy}' hook`);\n    foundry.utils.logCompatibilityWarning(msg, {\n      mod: foundry.CONST.COMPATIBILITY_MODES.WARNING,\n      since: \"FXMaster v3.0.0\",\n      until: \"FXMaster v4.0.0\",\n      stack: false,\n    });\n    deprecation.callback(...args);\n  };\n}\n","/**\n * A mixin which extends {@link PIXI.Filter} with some common behavior.\n * @param {PIXI.Filter} Base The base filter class which this mixin extends\n * @returns The extended filter class\n */\nexport function FXMasterFilterEffectMixin(Base) {\n  return class extends Base {\n    /**\n     * @param {object} options Additional options to configure the filter\n     * @param {string} id The id which identifies this filter instance\n     * @param  {...any} args Additional arguments to pass to the Base constructor\n     */\n    constructor(options, id, ...args) {\n      super(...args);\n      this.id = id;\n      this.enabled = false;\n      this.configure(options);\n      this.applyOptions(this.constructor.neutral);\n    }\n\n    /**\n     * The id which identifies this filter effect instance.\n     * @type {string}\n     */\n    id;\n\n    /**\n     * The current options for this filter effect.\n     * @type {object}\n     */\n    options;\n\n    /**\n     * A human-readable label for the filter effect. This can be a localization string.\n     * @type {string}\n     */\n    static label = \"FXMASTER.FilterEffect\";\n\n    /**\n     * A Font Awesome icon to display for this filter effect in the {@link FilterEffectsManagementConfig}.\n     * @type {string}\n     */\n    static icon = \"fas fa-filter\";\n\n    /**\n     * The set of parameters the filter effect supports.\n     * @type {object}\n     */\n    static get parameters() {\n      return {};\n    }\n\n    /**\n     * The default values for the parameters of this filter effect.\n     * @type {object}\n     */\n    static get default() {\n      return Object.fromEntries(\n        Object.entries(this.parameters).map(([parameterName, parameterConfig]) => [\n          parameterName,\n          parameterConfig.value,\n        ]),\n      );\n    }\n\n    /**\n     * The set of options for this filter effect that represent a neutral state.\n     */\n    static get neutral() {\n      return {};\n    }\n\n    /**\n     * Configure the options for this filter.\n     * @param {object | undefined} options The options to use\n     */\n    configure(options) {\n      if (!options) {\n        return;\n      }\n      this.options = { ...this.constructor.default, ...options };\n    }\n\n    /**\n     * The context on which options should be applied.\n     * @type {object}\n     */\n    get optionContext() {\n      return this;\n    }\n\n    /**\n     * Apply options to this filter effect, setting the corresponding properties on this effect itself.\n     * @param {object} options The options to apply\n     */\n    applyOptions(options = this.options) {\n      const keys = Object.keys(options);\n      for (const key of keys) {\n        this.optionContext[key] = options[key];\n      }\n    }\n\n    /**\n     * Play this filter.\n     * @param {object} _options Additional options to adjust the playing behavior\n     */\n    play(_options = {}) {\n      this.applyOptions();\n      this.enabled = true;\n    }\n\n    /**\n     * Stop this filter.\n     * @param {object} _options Additional options to adjust the stopping behavior\n     * @returns {Promise<boolean>} A promise that resolves to `true` once the stop operation has concluded or `false` if\n     *                             the operation was cancelled.\n     */\n    async stop(_options = {}) {\n      this.enabled = false;\n      this.applyOptions(this.constructor.neutral);\n      return true;\n    }\n\n    /**\n     * Perform a step in any potential animation this filter effect might have. This is called periodically by ticker.\n     */\n    async step() {}\n  };\n}\n","import { packageId } from \"../../../constants.js\";\nimport { FXMasterFilterEffectMixin } from \"./filter\";\n\n/**\n * @typedef {Object} AnimationOptions\n * @property {number} [duration=4000] The duration of the animation\n */\n\n/**\n * A mixin which extends {@link PIXI.Filter} with some common behavior and fading.\n * @param {PIXI.Filter} Base The base filter class which this mixin extends\n * @returns The extended filter class\n */\nexport function FadingFilterMixin(Base) {\n  return class extends FXMasterFilterEffectMixin(Base) {\n    /**\n     * The currently running animation, if any.\n     * @type {Promise<boolean> | undefined}\n     */\n    currentAnimation;\n\n    /** Has this filter already been initialized? */\n    initialized = false;\n\n    /**\n     * Apply options to this filter effect as an animation.\n     * @param {object} [options] The options to animate\n     * @param {AnimationOptions} [animationOptions={}] Additional options to adjust the animation behavior\n     */\n    async animateOptions(options = this.options, { duration = 4_000 } = {}) {\n      const name = `${packageId}.${this.constructor.name}.${this.id}`;\n      if (this.currentAnimation !== undefined) {\n        CanvasAnimation.terminateAnimation(name);\n        await this.currentAnimation;\n      }\n      const data = { name, duration };\n\n      const [toAnimate, toSet] = Object.entries(options)\n        .partition(([key]) => !!this.constructor.parameters[key]?.skipInitialAnimation && !this.initialized)\n        .map(Object.fromEntries);\n\n      this.applyOptions(toSet);\n\n      const anim = Object.entries(toAnimate).map(([key, value]) => ({\n        parent: this.optionContext,\n        attribute: key,\n        to: value,\n      }));\n      this.currentAnimation = CanvasAnimation.animate(anim, data).finally(() => (this.currentAnimation = undefined));\n      return this.currentAnimation;\n    }\n\n    /** @override */\n    play({ skipFading = false, ...otherOptions } = {}) {\n      if (skipFading) {\n        super.play({ skipFading, ...otherOptions });\n      } else {\n        this.enabled = true;\n        this.animateOptions();\n      }\n      this.initialized = true;\n    }\n\n    /** @override */\n    async stop({ skipFading = false, ...otherOptions } = {}) {\n      if (skipFading) {\n        return super.stop({ skipFading, ...otherOptions });\n      } else {\n        const completed = await this.animateOptions(this.constructor.neutral);\n        if (completed) {\n          this.enabled = false;\n        }\n        return completed;\n      }\n    }\n  };\n}\n","import { FadingFilterMixin } from \"./mixins/fading-filter.js\";\n\nexport class BloomFilter extends FadingFilterMixin(PIXI.filters.AdvancedBloomFilter) {\n  /** @override */\n  static label = \"FXMASTER.FilterEffectBloom\";\n\n  /** @override */\n  static icon = \"fas fa-ghost\";\n\n  /** @override */\n  static get parameters() {\n    return {\n      blur: {\n        label: \"FXMASTER.Blur\",\n        type: \"range\",\n        max: 10.0,\n        min: 0.0,\n        step: 1.0,\n        value: 1.0,\n      },\n      bloomScale: {\n        label: \"FXMASTER.Bloom\",\n        type: \"range\",\n        max: 1.0,\n        min: 0.0,\n        step: 0.1,\n        value: 0.1,\n      },\n      threshold: {\n        label: \"FXMASTER.Threshold\",\n        type: \"range\",\n        max: 1.0,\n        min: 0.0,\n        step: 0.1,\n        value: 0.5,\n      },\n    };\n  }\n\n  /** @override */\n  static get neutral() {\n    return {\n      noise: 0.0,\n      bloomScale: 0.0,\n      threshold: 1.0,\n    };\n  }\n}\n","import { FadingFilterMixin } from \"./mixins/fading-filter.js\";\n\nexport class ColorFilter extends FadingFilterMixin(PIXI.filters.AdjustmentFilter) {\n  /** @override */\n  static label = \"FXMASTER.FilterEffectColor\";\n\n  /** @override */\n  static icon = \"fas fa-palette\";\n\n  /** @override */\n  static get parameters() {\n    return {\n      color: {\n        label: \"FXMASTER.Tint\",\n        type: \"color\",\n        value: {\n          value: \"#FFFFFF\",\n          apply: false,\n        },\n      },\n      saturation: {\n        label: \"FXMASTER.Saturation\",\n        type: \"range\",\n        max: 2.0,\n        min: 0.0,\n        step: 0.1,\n        value: 1.0,\n      },\n      contrast: {\n        label: \"FXMASTER.Contrast\",\n        type: \"range\",\n        max: 2.0,\n        min: 0.0,\n        step: 0.1,\n        value: 1.0,\n      },\n      brightness: {\n        label: \"FXMASTER.Brightness\",\n        type: \"range\",\n        max: 2.0,\n        min: 0.0,\n        step: 0.1,\n        value: 1.0,\n      },\n      gamma: {\n        label: \"FXMASTER.Gamma\",\n        type: \"range\",\n        max: 2.0,\n        min: 0.0,\n        step: 0.1,\n        value: 1.0,\n      },\n    };\n  }\n\n  /** @override */\n  static get neutral() {\n    return {\n      red: 1,\n      green: 1,\n      blue: 1,\n      saturation: 1,\n      gamma: 1,\n      brightness: 1,\n      contrast: 1,\n    };\n  }\n\n  /** @override */\n  configure(options) {\n    if (!options) {\n      return;\n    }\n    const { color, ...otherOptions } = options;\n    const { r: red, g: green, b: blue } = foundry.utils.Color.from(color.apply ? color.value : 0xffffff);\n    super.configure({ ...otherOptions, red, green, blue });\n  }\n}\n","import fog from \"./shaders/fog.frag\";\nimport customVertex2D from \"./shaders/custom-vertex-2d.vert\";\nimport { FadingFilterMixin } from \"./mixins/fading-filter.js\";\n\nexport class FogFilter extends FadingFilterMixin(PIXI.Filter) {\n  constructor(options, id) {\n    super(options, id, customVertex2D, fog);\n    this.uniforms.time = 0.0;\n    this.uniforms.dimensions = new Float32Array([0.0, 0.0]);\n    this.uniforms.color = new Float32Array([0.0, 0.0, 0.0, 1.0]);\n  }\n\n  /** @type {number} */\n  lastTick;\n\n  /** @override */\n  static label = \"FXMASTER.FilterEffectFog\";\n\n  /** @override */\n  static icon = \"fas fa-cloud\";\n\n  /** @override */\n  static get parameters() {\n    return {\n      dimensions: {\n        label: \"FXMASTER.Scale\",\n        type: \"range\",\n        max: 5,\n        min: 0,\n        step: 0.1,\n        value: 1,\n        skipInitialAnimation: true,\n      },\n      speed: {\n        label: \"FXMASTER.Speed\",\n        type: \"range\",\n        max: 5,\n        min: 0,\n        step: 0.1,\n        value: 1,\n        skipInitialAnimation: true,\n      },\n      density: {\n        label: \"FXMASTER.Density\",\n        type: \"range\",\n        max: 1,\n        min: 0,\n        step: 0.05,\n        value: 0.65,\n      },\n      color: {\n        label: \"FXMASTER.Tint\",\n        type: \"color\",\n        value: {\n          value: \"#000000\",\n          apply: false,\n        },\n        skipInitialAnimation: true,\n      },\n    };\n  }\n\n  /** @override */\n  static get neutral() {\n    return {\n      density: 0,\n    };\n  }\n\n  /** @type {number} */\n  get r() {\n    return this.uniforms.color[0];\n  }\n  set r(value) {\n    this.uniforms.color[0] = value;\n  }\n\n  /** @type {number} */\n  get g() {\n    return this.uniforms.color[1];\n  }\n  set g(value) {\n    this.uniforms.color[1] = value;\n  }\n\n  /** @type {number} */\n  get b() {\n    return this.uniforms.color[2];\n  }\n  set b(value) {\n    this.uniforms.color[2] = value;\n  }\n\n  /** @type {number} */\n  get density() {\n    return this.uniforms.density;\n  }\n  set density(value) {\n    this.uniforms.density = value;\n  }\n\n  /** @type {number} */\n  get dimensions() {\n    return this.uniforms.dimensions[0];\n  }\n  set dimensions(value) {\n    this.uniforms.dimensions[0] = this.uniforms.dimensions[1] = (value * 100) / (canvas?.dimensions?.size ?? 100);\n  }\n\n  /** @override */\n  configure(options) {\n    if (!options) {\n      return;\n    }\n    const { color, ...otherOptions } = options;\n    const { r, g, b } = foundry.utils.Color.from(color.apply ? color.value : 0x000000);\n    super.configure({ ...otherOptions, r, g, b });\n  }\n\n  /** @override */\n  play(options) {\n    this.lastTick = canvas.app.ticker.lastTime;\n    super.play(options);\n  }\n\n  /** @override */\n  async step() {\n    const delta = canvas.app.ticker.lastTime - this.lastTick;\n    this.lastTick = canvas.app.ticker.lastTime;\n    this.uniforms.time += delta * this.speed * 0.1;\n    await super.step();\n  }\n\n  apply(filterManager, input, output, clear, currentState) {\n    this.uniforms.filterMatrix ??= new PIXI.Matrix();\n    this.uniforms.filterMatrix.copyFrom(currentState.target.worldTransform).invert();\n    return super.apply(filterManager, input, output, clear, currentState);\n  }\n}\n","export const easeFunctions = {\n  Linear: easeLinear,\n  InSine: easeInSine,\n  OutSine: easeOutSine,\n  InOutSine: easeInOutSine,\n  InBack: easeInBack,\n  OutBack: easeOutBack,\n  InOutBack: easeInOutBack,\n  InCubic: easeInCubic,\n  OutCubic: easeOutCubic,\n  InOutCubic: easeInOutCubic,\n  InCirc: easeInCirc,\n  OutCirc: easeOutCirc,\n  InOutCirc: easeInOutCirc,\n};\n\nexport function easeLinear(x) {\n  return x;\n}\n\nexport function easeInSine(x) {\n  return 1 - Math.cos((x * Math.PI) / 2);\n}\n\nexport function easeOutSine(x) {\n  return Math.sin((x * Math.PI) / 2);\n}\n\nexport function easeInOutSine(x) {\n  return -(Math.cos(Math.PI * x) - 1) / 2;\n}\n\nexport function easeInBack(x) {\n  const c1 = 1.70158;\n  const c3 = c1 + 1;\n  return c3 * x * x * x - c1 * x * x;\n}\n\nexport function easeOutBack(x) {\n  const c1 = 1.70158;\n  const c3 = c1 + 1;\n  return 1 + c3 * Math.pow(x - 1, 3) + c1 * Math.pow(x - 1, 2);\n}\n\nexport function easeInOutBack(x) {\n  const c1 = 1.70158;\n  const c2 = c1 * 1.525;\n  return x < 0.5\n    ? (Math.pow(2 * x, 2) * ((c2 + 1) * 2 * x - c2)) / 2\n    : (Math.pow(2 * x - 2, 2) * ((c2 + 1) * (x * 2 - 2) + c2) + 2) / 2;\n}\n\nexport function easeInCubic(x) {\n  return x * x * x;\n}\n\nexport function easeOutCubic(x) {\n  return 1 - Math.pow(1 - x, 3);\n}\n\nexport function easeInOutCubic(x) {\n  return x < 0.5 ? 4 * x * x * x : 1 - Math.pow(-2 * x + 2, 3) / 2;\n}\n\nexport function easeInCirc(x) {\n  return 1 - Math.sqrt(1 - Math.pow(x, 2));\n}\n\nexport function easeOutCirc(x) {\n  return Math.sqrt(1 - Math.pow(x - 1, 2));\n}\n\nexport function easeInOutCirc(x) {\n  return x < 0.5 ? (1 - Math.sqrt(1 - Math.pow(2 * x, 2))) / 2 : (Math.sqrt(1 - Math.pow(-2 * x + 2, 2)) + 1) / 2;\n}\n","import { packageId } from \"../../constants.js\";\nimport { easeFunctions } from \"../../ease.js\";\nimport { FXMasterFilterEffectMixin } from \"./mixins/filter.js\";\n\nexport class LightningFilter extends FXMasterFilterEffectMixin(PIXI.filters.AdjustmentFilter) {\n  constructor(options, id) {\n    super(options, id);\n    this.nextLigthningTime = canvas.app.ticker.lastTime / 10;\n  }\n\n  /**\n   * The time when the next lightning flash should appear.\n   * @type {number}\n   */\n  nextLigthningTime;\n\n  /** @override */\n  static label = \"FXMASTER.FilterEffectLightning\";\n\n  /** @override */\n  static icon = \"fas fa-bolt-lightning\";\n\n  /** @override */\n  static get parameters() {\n    return {\n      frequency: {\n        label: \"FXMASTER.Period\",\n        type: \"range\",\n        max: 2000,\n        min: 100,\n        step: 5,\n        value: 500,\n      },\n      spark_duration: {\n        label: \"FXMASTER.Duration\",\n        type: \"range\",\n        max: 2000,\n        min: 100,\n        step: 5,\n        value: 300,\n      },\n      brightness: {\n        label: \"FXMASTER.Brightness\",\n        type: \"range\",\n        max: 4.0,\n        min: 0.0,\n        step: 0.1,\n        value: 1.3,\n      },\n    };\n  }\n\n  /** @override */\n  static get neutral() {\n    return {\n      frequency: 0.0,\n      spark_duration: 0.0,\n      brightness: 1.0,\n    };\n  }\n\n  /** @override */\n  play(_options = {}) {\n    // explicitly not applying the options, since it would change the brightness immediately\n    this.enabled = true;\n  }\n\n  /** @override */\n  async step() {\n    if (canvas.app.ticker.lastTime / 10 > this.nextLigthningTime) {\n      this.nextLigthningTime = canvas.app.ticker.lastTime / 10 + 40 + this.options.frequency * Math.random();\n\n      const animate = (value) => {\n        const attributes = [\n          {\n            parent: this,\n            attribute: \"brightness\",\n            to: value,\n          },\n        ];\n        return CanvasAnimation.animate(attributes, {\n          name: `${packageId}.${this.constructor.name}.${this.id}.${randomID()}`,\n          context: this,\n          duration: 100 + this.options.spark_duration * Math.random(),\n          easing: easeFunctions.InOutBack,\n        });\n      };\n\n      await animate(this.options.brightness);\n      await animate(1);\n      await super.step();\n    }\n  }\n}\n","import { FXMasterFilterEffectMixin } from \"./mixins/filter.js\";\n\nexport class OldFilmFilter extends FXMasterFilterEffectMixin(PIXI.filters.OldFilmFilter) {\n  constructor(options, id) {\n    super(options, id);\n    this.vignetting = 0;\n    this.vignettingAlpha = 0;\n  }\n\n  /** @override */\n  static label = \"FXMASTER.FilterEffectOldFilm\";\n\n  /** @override */\n  static icon = \"fas fa-film\";\n\n  /** @override */\n  static get parameters() {\n    return {\n      sepia: {\n        label: \"FXMASTER.Sepia\",\n        type: \"range\",\n        max: 1.0,\n        min: 0.0,\n        step: 0.1,\n        value: 0.3,\n      },\n      noise: {\n        label: \"FXMASTER.Noise\",\n        type: \"range\",\n        max: 1.0,\n        min: 0.0,\n        step: 0.1,\n        value: 0.1,\n      },\n    };\n  }\n\n  /** @override */\n  static get neutral() {\n    return {\n      sepia: 0.0,\n      noise: 0.0,\n    };\n  }\n\n  /** @override */\n  play(options = {}) {\n    this.seed = Math.random();\n    super.play(options);\n  }\n\n  /** @override */\n  async step() {\n    this.seed = Math.random();\n    await super.step();\n  }\n}\n","import { FXMasterFilterEffectMixin } from \"./mixins/filter.js\";\n\nexport class PredatorFilter extends FXMasterFilterEffectMixin(PIXI.filters.CRTFilter) {\n  constructor(options, id) {\n    super(options, id);\n    this.vignetting = 0;\n    this.curvature = 0;\n  }\n\n  /** @override */\n  static label = \"FXMASTER.FilterEffectPredator\";\n\n  /** @override */\n  static icon = \"fas fa-wave-square\";\n\n  /** @override */\n  static get parameters() {\n    return {\n      noise: {\n        label: \"FXMASTER.Noise\",\n        type: \"range\",\n        max: 1.0,\n        min: 0,\n        step: 0.1,\n        value: 0.1,\n      },\n      period: {\n        label: \"FXMASTER.Speed\",\n        type: \"range\",\n        max: 0.1,\n        min: 0,\n        step: 0.001,\n        value: 0.001,\n      },\n      lineWidth: {\n        label: \"FXMASTER.LineWidth\",\n        type: \"range\",\n        max: 10,\n        min: 0,\n        step: 0.1,\n        value: 1,\n      },\n    };\n  }\n\n  /** @override */\n  static get neutral() {\n    return {\n      noise: 0,\n      period: 1000,\n    };\n  }\n\n  /** @override */\n  play(options = {}) {\n    this.seed = Math.random();\n    super.play(options);\n  }\n\n  /** @override */\n  async step() {\n    this.seed = Math.random();\n    const frequency = 1.0 / this.options.period;\n    this.time = canvas.app.ticker.lastTime / frequency;\n    await super.step();\n  }\n}\n","import { FXMasterFilterEffectMixin } from \"./mixins/filter.js\";\n\nexport class UnderwaterFilter extends FXMasterFilterEffectMixin(PIXI.filters.DisplacementFilter) {\n  constructor(options, id) {\n    const displacemenntMap = new PIXI.Sprite.from(\n      \"modules/fxmaster/assets/filter-effects/effects/underwater/displacement-map.png\",\n    );\n    super(options, id, displacemenntMap);\n\n    this.displacementMap = displacemenntMap;\n    this.displacementMap.texture.baseTexture.wrapMode = PIXI.WRAP_MODES.REPEAT;\n    this.displacementMap.anchor.set(0.5);\n    this.displacementMap.x = canvas.scene.width / 2;\n    this.displacementMap.y = canvas.scene.height / 2;\n  }\n\n  /** @override */\n  static label = \"FXMASTER.FilterEffectUnderwater\";\n\n  /** @override */\n  static icon = \"fas fa-water\";\n\n  static get parameters() {\n    return {\n      speed: {\n        label: \"FXMASTER.Speed\",\n        type: \"range\",\n        max: 5.0,\n        min: 0.0,\n        step: 0.1,\n        value: 0.3,\n      },\n      scale: {\n        label: \"FXMASTER.Scale\",\n        type: \"number\",\n        value: 4.0,\n      },\n    };\n  }\n\n  /** @override */\n  static get neutral() {\n    return {\n      speed: 0,\n      scale: 1.0,\n    };\n  }\n\n  /** @override */\n  applyOptions() {\n    // explicitly do nothing because setting scale / speed on this breaks the DisplacementFilter\n  }\n\n  /** @override */\n  play(options = {}) {\n    this.displacementMap.scale.x = this.options.scale;\n    this.displacementMap.scale.y = this.options.scale;\n    canvas.primary.addChild(this.displacementMap);\n    super.play(options);\n  }\n\n  /** @override */\n  async stop(options = {}) {\n    await super.stop(options);\n    canvas.primary.removeChild(this.displacementMap);\n  }\n\n  /** @override */\n  async step() {\n    this.maskSprite.x += this.options.speed;\n    await super.step();\n  }\n}\n","import { BloomFilter } from \"./filters/bloom.js\";\nimport { ColorFilter } from \"./filters/color.js\";\nimport { FogFilter } from \"./filters/fog.js\";\nimport { LightningFilter } from \"./filters/lightning.js\";\nimport { OldFilmFilter } from \"./filters/old-film.js\";\nimport { PredatorFilter } from \"./filters/predator.js\";\nimport { UnderwaterFilter } from \"./filters/underwater.js\";\n\n/** @typedef {Record<string, PIXI.Filter} FilterEffects */\n\n/** @type {FilterEffects} */\nexport const filterEffects = {\n  bloom: BloomFilter,\n  color: ColorFilter,\n  fog: FogFilter,\n  lightning: LightningFilter,\n  oldfilm: OldFilmFilter,\n  predator: PredatorFilter,\n  underwater: UnderwaterFilter,\n};\n","import { roundToDecimals } from \"../../utils.js\";\n\n/**\n * An abstract base class for defining particle-based effects\n * @param {PIXI.Container} parent     The parent container within which the effect is rendered\n * @param {object} [options]          Options passed to the getParticleEmitters method which can be used to customize\n *                                    values of the emitter configuration.\n * @abstract\n */\nexport class FXMasterParticleEffect extends ParticleEffect {\n  /**\n   * A human-readable label for the particle effect. This can be a localization string.\n   * @type {string}\n   * @override\n   */\n  static label = \"FXMASTER.ParticleEffect\";\n\n  /**\n   * The weather effect group this effect belongs to.\n   * @type {string}\n   */\n  static get group() {\n    return \"other\";\n  }\n\n  /** @type {string} */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/snow.png\";\n  }\n\n  static get parameters() {\n    return {\n      scale: {\n        label: \"FXMASTER.Scale\",\n        type: \"range\",\n        min: 0.1,\n        value: 1,\n        max: 5,\n        step: 0.1,\n        decimals: 1,\n      },\n      direction: {\n        label: \"FXMASTER.Direction\",\n        type: \"range\",\n        min: 0,\n        value: this.defaultDirection,\n        max: 360,\n        step: 5,\n        decimals: 0,\n      },\n      speed: {\n        label: \"FXMASTER.Speed\",\n        type: \"range\",\n        min: 0.1,\n        value: 1,\n        max: 5,\n        step: 0.1,\n        decimals: 1,\n      },\n      lifetime: {\n        label: \"FXMASTER.Lifetime\",\n        type: \"range\",\n        min: 0.1,\n        value: 1,\n        max: 5,\n        step: 0.1,\n        decimals: 1,\n      },\n      density: {\n        label: \"FXMASTER.Density\",\n        type: \"range\",\n        min: 0.1,\n        value: 0.5,\n        max: 5,\n        step: 0.1,\n        decimals: 1,\n      },\n      alpha: {\n        label: \"FXMASTER.Opacity\",\n        type: \"range\",\n        min: 0,\n        value: 1,\n        max: 1,\n        step: 0.1,\n        decimals: 1,\n      },\n      tint: {\n        label: \"FXMASTER.Tint\",\n        type: \"color\",\n        value: {\n          value: \"#FFFFFF\",\n          apply: false,\n        },\n      },\n    };\n  }\n\n  /**\n   * Merge the given options with the default parameters.\n   */\n  static mergeWithDefaults(options) {\n    return foundry.utils.mergeObject(this.parameters, options, { insertKeys: false, inplace: false });\n  }\n\n  /**\n   * Return the default config for this effect.\n   * @abstract\n   * @returns {PIXI.particles.EmitterConfigV3}\n   */\n  static get defaultConfig() {\n    throw new Error(\"Subclasses of FXMasterParticleEffect must implement defaultConfig\");\n  }\n\n  static get defaultDirection() {\n    const rotationBehavior = this.defaultConfig.behaviors.find((behavior) => behavior.type === \"rotation\");\n\n    if (rotationBehavior !== undefined) {\n      return (rotationBehavior.config.minStart + rotationBehavior.config.maxStart) / 2;\n    }\n\n    const rotationStaticBehavior = this.defaultConfig.behaviors.find((behavior) => behavior.type === \"rotationStatic\");\n\n    if (rotationStaticBehavior !== undefined) {\n      return (rotationStaticBehavior.config.min + rotationStaticBehavior.config.max) / 2;\n    }\n\n    return undefined;\n  }\n\n  static get default() {\n    return Object.fromEntries(\n      Object.entries(this.parameters).map(([parameterName, parameterConfig]) => [parameterName, parameterConfig.value]),\n    );\n  }\n\n  applyOptionsToConfig(options, config) {\n    this._applyScaleToConfig(options, config);\n    this._applySpeedToConfig(options, config);\n    this._applyDirectionToConfig(options, config);\n    this._applyLifetimeToConfig(options, config);\n    this._applyTintToConfig(options, config);\n    this._applyAlphaToConfig(options, config);\n  }\n\n  /** @protected */\n  _applyFactorToValueList(valueList, factor) {\n    valueList.list = valueList.list.map((valueStep) => ({\n      ...valueStep,\n      value: valueStep.value * factor,\n    }));\n  }\n\n  /** @protected */\n  _applyFactorToRandNumber(randNumber, factor) {\n    randNumber.min = randNumber.min * factor;\n    randNumber.max = randNumber.max * factor;\n  }\n\n  /** @protected */\n  _applyScaleToConfig(options, config) {\n    const factor = (options.scale?.value ?? 1) * (canvas.dimensions.size / 100);\n\n    config.behaviors\n      .filter((behavior) => behavior.type === \"scale\")\n      .forEach(({ config }) => this._applyFactorToValueList(config.scale, factor));\n\n    config.behaviors\n      .filter((behavior) => behavior.type === \"scaleStatic\")\n      .forEach(({ config }) => this._applyFactorToRandNumber(config, factor));\n  }\n\n  /** @protected */\n  _applySpeedToConfig(options, config) {\n    const factor = (options.speed?.value ?? 1) * (canvas.dimensions.size / 100);\n\n    config.behaviors\n      .filter((behavior) => [\"moveSpeed\", \"movePath\"].includes(behavior.type))\n      .forEach(({ config }) => this._applyFactorToValueList(config.speed, factor));\n\n    config.behaviors\n      .filter((behavior) => behavior.type === \"moveSpeedStatic\")\n      .forEach(({ config }) => this._applyFactorToRandNumber(config, factor));\n\n    this._applyFactorToRandNumber(config.lifetime, 1 / factor);\n    config.frequency /= factor;\n  }\n\n  /** @protected */\n  _applyDirectionToConfig(options, config) {\n    const direction = options.direction?.value;\n    if (direction !== undefined) {\n      config.behaviors\n        .filter((behavior) => behavior.type === \"rotation\")\n        .forEach(({ config }) => {\n          const range = config.maxStart - config.minStart;\n          config.minStart = direction - range / 2;\n          config.maxStart = direction + range / 2;\n        });\n\n      config.behaviors\n        .filter((behavior) => behavior.type === \"rotationStatic\")\n        .forEach(({ config }) => {\n          const range = config.max - config.min;\n          config.min = direction - range / 2;\n          config.max = direction + range / 2;\n        });\n    }\n  }\n\n  /** @protected */\n  _applyLifetimeToConfig(options, config) {\n    const factor = options.lifetime?.value ?? 1;\n    this._applyFactorToRandNumber(config.lifetime, factor);\n    config.frequency *= factor;\n  }\n\n  /** @protected */\n  _applyTintToConfig(options, config) {\n    if (options.tint?.value.apply) {\n      const value = options.tint.value.value;\n      config.behaviors = config.behaviors\n        .filter(({ type }) => type !== \"color\" && type !== \"colorStatic\")\n        .concat({\n          type: \"colorStatic\",\n          config: {\n            color: value,\n          },\n        });\n    }\n  }\n\n  /** @protected */\n  _applyAlphaToConfig(options, config) {\n    const factor = options.alpha?.value ?? 1;\n\n    config.behaviors\n      .filter((behavior) => behavior.type === \"alpha\")\n      .forEach(({ config }) => this._applyFactorToValueList(config.alpha, factor));\n\n    config.behaviors\n      .filter((behavior) => behavior.type === \"alphaStatic\")\n      .forEach(({ config }) => {\n        config.alpha *= factor;\n      });\n  }\n\n  /** @override */\n  play({ prewarm = false } = {}) {\n    if (prewarm) {\n      this.emitters.forEach((emitter) => {\n        emitter.autoUpdate = false;\n        emitter.emit = true;\n        emitter.update(emitter.maxLifetime);\n        emitter.autoUpdate = true;\n      });\n    }\n    super.play();\n  }\n\n  /**\n   * Fade this effect out, playing it once and then stopping it.\n   * @param {{timeout?: number}} [options]         Additional options to configure the fade out\n   * @param {number}             [options.timeout] If given, the effect will be stopped after the given number in ms,\n   *                                               regardless of if it has finished playing or not.\n   * @returns {Promise<void>}                      A promise that resolves as soon as this effect has finished fading out\n   */\n  async fadeOut({ timeout } = {}) {\n    const emitterPromises = this.emitters.map(\n      (emitter) =>\n        new Promise((resolve) => {\n          emitter.emitterLifetime = 0.1;\n          emitter.playOnceAndDestroy(() => {\n            resolve();\n          });\n        }),\n    );\n    const promises = [Promise.all(emitterPromises)];\n    if (timeout !== undefined) {\n      promises.push(new Promise((resolve) => setTimeout(resolve, timeout)).then(this.destroy.bind(this)));\n    }\n\n    await Promise.race(promises);\n    this.stop();\n  }\n\n  static convertOptionsToV2(options, scene) {\n    return Object.fromEntries(\n      Object.entries(options).map(([optionKey, optionValue]) => {\n        switch (optionKey) {\n          case \"scale\": {\n            return [optionKey, this._convertScaleToV2(optionValue, scene)];\n          }\n          case \"speed\": {\n            return [optionKey, this._convertSpeedToV2(optionValue, scene)];\n          }\n          case \"density\": {\n            return [optionKey, this._convertDensityToV2(optionValue, scene)];\n          }\n          default: {\n            return [optionKey, optionValue];\n          }\n        }\n      }),\n    );\n  }\n\n  /** @protected */\n  static _convertScaleToV2(scale, scene) {\n    const decimals = this.parameters.scale?.decimals ?? 1;\n    return roundToDecimals(scale * (100 / scene.dimensions.size), decimals);\n  }\n\n  /** @protected */\n  static _convertSpeedToV2(speed, scene) {\n    const speeds = this.defaultConfig.behaviors\n      .filter(({ type }) => type === \"moveSpeed\")\n      .flatMap(({ config }) => config.speed.list.map((valueStep) => valueStep.value));\n    const maximumSpeed = Math.max(...speeds);\n\n    const decimals = this.parameters.speed?.decimals ?? 1;\n    return roundToDecimals((speed / maximumSpeed) * (100 / scene.dimensions.size), decimals);\n  }\n\n  /** @protected */\n  static _convertDensityToV2(density, scene) {\n    const d = scene.dimensions;\n    const gridUnits = (d.width / d.size) * (d.height / d.size);\n\n    const decimals = this.parameters.density?.decimals ?? 1;\n    return roundToDecimals(density / gridUnits, decimals);\n  }\n}\n","/**\n * A mixin which extends {@link FXMasterParticleEffect} with default rectangle spawing behavior.\n * @param {typeof import(\"../effect.js\").FXMasterParticleEffect} Base The base effect class which this mixin extends\n * @returns {import(\"../effect.js\").FXMasterParticleEffect} The extended effect class\n */\nexport function DefautlRectangleSpawnMixin(Base) {\n  return class extends Base {\n    /** @override */\n    getParticleEmitters(options = {}) {\n      options = this.constructor.mergeWithDefaults(options);\n      const d = canvas.dimensions;\n      const maxParticles = (d.width / d.size) * (d.height / d.size) * options.density.value;\n      const config = foundry.utils.deepClone(this.constructor.defaultConfig);\n      config.maxParticles = maxParticles;\n      config.frequency = config.lifetime.min / maxParticles;\n      config.behaviors.push({\n        type: \"spawnShape\",\n        config: {\n          type: \"rect\",\n          data: { x: d.sceneRect.x, y: d.sceneRect.y, w: d.sceneRect.width, h: d.sceneRect.height },\n        },\n      });\n      this.applyOptionsToConfig(options, config);\n\n      return [this.createEmitter(config)];\n    }\n  };\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\nimport { DefautlRectangleSpawnMixin } from \"./mixins/default-retangle-spawn.js\";\n\n/**\n * A full-screen particle effect which renders crawling spiders.\n */\nexport class SpiderParticleEffect extends DefautlRectangleSpawnMixin(FXMasterParticleEffect) {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectSpiders\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/spiders.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"animals\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.05, value: 0.3, max: 0.7, step: 0.05, decimals: 2 },\n        \"-=direction\": null,\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for crawling spiders\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static SPIDERS_CONFIG = {\n    lifetime: { min: 5, max: 10 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 1, time: 0.02 },\n              { value: 1, time: 0.98 },\n              { value: 0, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeed\",\n        config: {\n          speed: {\n            list: [\n              { time: 0, value: 15 },\n              { time: 1, value: 25 },\n            ],\n          },\n          minMult: 0.6,\n        },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 0.05, time: 0 },\n              { value: 0.08, time: 0.05 },\n              { value: 0.08, time: 0.95 },\n              { value: 0.05, time: 1 },\n            ],\n          },\n          minMult: 0.2,\n        },\n      },\n      {\n        type: \"rotationStatic\",\n        config: { min: 0, max: 359 },\n      },\n      {\n        type: \"animatedSingle\",\n        config: {\n          anim: {\n            framerate: 30,\n            loop: true,\n            textures: Array.fromRange(25).map((n) => ({\n              count: 1,\n              texture: `modules/fxmaster/assets/particle-effects/effects/spiders/spider${String(n + 1).padStart(\n                2,\n                \"0\",\n              )}.png`,\n            })),\n          },\n        },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.SPIDERS_CONFIG;\n  }\n}\n","/**\n * Adjust the color behavior of an emitter to use a stepped gradient instead of interpolation.\n * @param {PIXI.particles.Emitter} emitter        The emitter to adjust\n * @param {PIXI.particles.EmitterConfigV3} config The emitter config containing the original value list\n * @param {number} [steps=10]                     The number of steps to use\n * @returns {PIXI.particles.Emitter}\n */\nexport function withSteppedGradientColor(emitter, config, steps = 10) {\n  const colorBehavior = emitter.getBehavior(\"color\");\n\n  if (colorBehavior) {\n    emitter\n      .getBehavior(\"color\")\n      .list.reset(\n        PIXI.particles.ParticleUtils.createSteppedGradient(\n          config.behaviors.find(({ type }) => type === \"color\").config.color.list,\n          steps,\n        ),\n      );\n  }\n\n  return emitter;\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\nimport { withSteppedGradientColor } from \"./helpers/with-stepped-gradient-color.js\";\n/**\n * A full-screen particle effect which renders drifting stars.\n */\nexport class StarsParticleEffect extends FXMasterParticleEffect {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectStars\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/stars.png\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.05, value: 0.3, max: 1, step: 0.05, decimals: 2 },\n        tint: { value: { value: \"#bee8ee\" } },\n        \"-=direction\": null,\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for drifting stars\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static STARS_CONFIG = {\n    lifetime: { min: 8, max: 15 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 0.9, time: 0.3 },\n              { value: 0.9, time: 0.95 },\n              { value: 0, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeedStatic\",\n        config: { min: 3, max: 5 },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 0.05, time: 0 },\n              { value: 0.03, time: 1 },\n            ],\n          },\n          minMult: 0.85,\n        },\n      },\n      {\n        type: \"rotation\",\n        config: { accel: 0, minSpeed: 20, maxSpeed: 50, minStart: 0, maxStart: 365 },\n      },\n      {\n        type: \"textureRandom\",\n        config: {\n          textures: Array.fromRange(8).map(\n            (n) => `modules/fxmaster/assets/particle-effects/effects/stars/star${n + 1}.png`,\n          ),\n        },\n      },\n      {\n        type: \"color\",\n        config: {\n          color: {\n            list: [\n              { value: \"bee8ee\", time: 0 },\n              { value: \"d0e8ec\", time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"blendMode\",\n        config: {\n          blendMode: \"screen\",\n        },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.STARS_CONFIG;\n  }\n\n  /** @override */\n  getParticleEmitters(options = {}) {\n    options = this.constructor.mergeWithDefaults(options);\n    const d = canvas.dimensions;\n    const maxParticles = (d.width / d.size) * (d.height / d.size) * options.density.value;\n    const config = foundry.utils.deepClone(this.constructor.STARS_CONFIG);\n    config.maxParticles = maxParticles;\n    config.frequency = config.lifetime.min / maxParticles;\n    config.behaviors.push({\n      type: \"spawnShape\",\n      config: {\n        type: \"rect\",\n        data: { x: d.sceneRect.x, y: d.sceneRect.y, w: d.sceneRect.width, h: d.sceneRect.height },\n      },\n    });\n    this.applyOptionsToConfig(options, config);\n\n    const emitter = withSteppedGradientColor(this.createEmitter(config), config);\n    return [emitter];\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\nimport { DefautlRectangleSpawnMixin } from \"./mixins/default-retangle-spawn.js\";\n\n/**\n * A full-screen particle effect which renders gently falling autumn leaves.\n */\nexport class AutumnLeavesParticleEffect extends DefautlRectangleSpawnMixin(FXMasterParticleEffect) {\n  /** @override */\n  static label = \"WEATHER.AutumnLeaves\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/leaves.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.05, value: 0.25, max: 1, step: 0.05, decimals: 2 },\n        \"-=direction\": null,\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for falling leaves\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static LEAF_CONFIG = {\n    lifetime: { min: 10, max: 10 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { time: 0, value: 0.9 },\n              { time: 1, value: 0.5 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeed\",\n        config: {\n          speed: {\n            list: [\n              { time: 0, value: 20 },\n              { time: 1, value: 60 },\n            ],\n          },\n          minMult: 0.6,\n        },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { time: 0, value: 0.2 },\n              { time: 1, value: 0.4 },\n            ],\n          },\n          minMult: 0.5,\n        },\n      },\n      {\n        type: \"rotation\",\n        config: { accel: 0, minSpeed: 100, maxSpeed: 200, minStart: 0, maxStart: 365 },\n      },\n      {\n        type: \"textureRandom\",\n        config: {\n          textures: Array.fromRange(6).map((n) => `ui/particles/leaf${n + 1}.png`),\n        },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.LEAF_CONFIG;\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\nimport { DefautlRectangleSpawnMixin } from \"./mixins/default-retangle-spawn.js\";\n\n/**\n * A full-screen particle effect which renders flying bats.\n */\nexport class BatsParticleEffect extends DefautlRectangleSpawnMixin(FXMasterParticleEffect) {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectBats\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/bats.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"animals\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.005, value: 0.05, max: 0.1, step: 0.005, decimals: 3 },\n        \"-=direction\": null,\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for flying bats\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static BATS_CONFIG = {\n    lifetime: { min: 20, max: 40 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 1, time: 0.02 },\n              { value: 1, time: 0.98 },\n              { value: 0, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeed\",\n        config: {\n          speed: {\n            list: [\n              { time: 0, value: 200 },\n              { time: 1, value: 260 },\n            ],\n          },\n          minMult: 0.8,\n        },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 0.02, time: 0 },\n              { value: 0.1, time: 0.05 },\n              { value: 0.1, time: 0.95 },\n              { value: 0.02, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"rotationStatic\",\n        config: { min: 0, max: 359 },\n      },\n      {\n        type: \"animatedSingle\",\n        config: {\n          anim: {\n            framerate: 30,\n            loop: true,\n            textures: [\n              { texture: 1, count: 1 },\n              { texture: 2, count: 1 },\n              { texture: 3, count: 1 },\n              { texture: 4, count: 1 },\n              { texture: 5, count: 2 },\n              { texture: 4, count: 1 },\n              { texture: 3, count: 1 },\n              { texture: 2, count: 1 },\n            ].map(({ texture, count }) => ({\n              texture: `modules/fxmaster/assets/particle-effects/effects/bats/bat${texture}.png`,\n              count,\n            })),\n          },\n        },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.BATS_CONFIG;\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\nimport { DefautlRectangleSpawnMixin } from \"./mixins/default-retangle-spawn.js\";\n\n/**\n * A full-screen particle effect which renders floating bubbles.\n */\nexport class BubblesParticleEffect extends DefautlRectangleSpawnMixin(FXMasterParticleEffect) {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectBubbles\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/bubbles.png\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.01, value: 0.15, max: 0.5, step: 0.01, decimals: 2 },\n        \"-=direction\": null,\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for floating bubbles\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static BUBBLES_CONFIG = {\n    lifetime: { min: 8, max: 10 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 0.85, time: 0.05 },\n              { value: 0.85, time: 0.98 },\n              { value: 0, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeed\",\n        config: {\n          speed: {\n            list: [\n              { time: 0, value: 20 },\n              { time: 1, value: 60 },\n            ],\n          },\n          minMult: 0.6,\n        },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 0.25, time: 0 },\n              { value: 0.5, time: 1 },\n            ],\n          },\n          minMult: 0.5,\n        },\n      },\n      {\n        type: \"rotation\",\n        config: { accel: 0, minSpeed: 100, maxSpeed: 200, minStart: 0, maxStart: 365 },\n      },\n      {\n        type: \"textureSingle\",\n        config: { texture: \"modules/fxmaster/assets/particle-effects/effects/bubbles/bubble.png\" },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.BUBBLES_CONFIG;\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\n\n/**\n * A full-screen particle effect which renders drifting bubbles.\n */\nexport class CloudsParticleEffect extends FXMasterParticleEffect {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectClouds\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/clouds.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.001, value: 0.03, max: 0.2, step: 0.001, decimals: 3 },\n    });\n  }\n\n  /**\n   * Configuration for the particle emitter for drifting clouds\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static CLOUDS_CONFIG = {\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 0.5, time: 0.05 },\n              { value: 0.5, time: 0.95 },\n              { value: 0, time: 1 },\n            ],\n          },\n        },\n      },\n      { type: \"moveSpeedStatic\", config: { min: 30, max: 100 } },\n      { type: \"scaleStatic\", config: { min: 0.08, max: 0.8 } },\n      { type: \"rotationStatic\", config: { min: 80, max: 100 } },\n      {\n        type: \"textureRandom\",\n        config: {\n          textures: Array.fromRange(4).map(\n            (n) => `modules/fxmaster/assets/particle-effects/effects/clouds/cloud${n + 1}.png`,\n          ),\n        },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.CLOUDS_CONFIG;\n  }\n\n  /** @override */\n  getParticleEmitters(options = {}) {\n    options = this.constructor.mergeWithDefaults(options);\n    const d = canvas.dimensions;\n    const maxParticles = (d.width / d.size) * (d.height / d.size) * options.density.value;\n\n    const offsetFactor = 2 / 3;\n    const config = foundry.utils.deepClone(this.constructor.CLOUDS_CONFIG);\n    const speed = config.behaviors.find(({ type }) => type === \"moveSpeedStatic\")?.config;\n    if (speed === undefined) {\n      throw new Error(\"Expected CLOUDS_CONFIG to have a moveSpeedStatic behavior but it didn't.\");\n    }\n\n    const diagonal = Math.sqrt(d.sceneRect.width * d.sceneRect.width + d.sceneRect.height * d.sceneRect.height);\n    const averageSpeed = (speed.min + speed.max) / 2;\n    const averageDiagonalTime = diagonal / averageSpeed;\n    const minLifetime = averageDiagonalTime / offsetFactor / 2;\n    const maxLifetime = averageDiagonalTime / offsetFactor;\n\n    const angle = Math.toRadians(options.direction.value);\n    const directionVector = {\n      x: Math.cos(angle),\n      y: Math.sin(angle),\n    };\n\n    config.maxParticles = maxParticles;\n    config.frequency = (minLifetime + maxLifetime) / 2 / maxParticles;\n    config.lifetime = { min: minLifetime, max: maxLifetime };\n    config.behaviors.push({\n      type: \"spawnShape\",\n      config: {\n        type: \"rect\",\n        data: {\n          x: d.sceneRect.x - directionVector.x * d.sceneRect.width * offsetFactor,\n          y: d.sceneRect.y - directionVector.y * d.sceneRect.height * offsetFactor,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n      },\n    });\n    this.applyOptionsToConfig(options, config);\n\n    return [this.createEmitter(config)];\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\nimport { DefautlRectangleSpawnMixin } from \"./mixins/default-retangle-spawn.js\";\n\n/**\n * A full-screen particle effect which renders flying crows.\n */\nexport class CrowsParticleEffect extends DefautlRectangleSpawnMixin(FXMasterParticleEffect) {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectCrows\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/crows.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"animals\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.001, value: 0.006, max: 0.01, step: 0.001, decimals: 3 },\n        \"-=direction\": null,\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for flying crows\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static CROWS_CONFIG = {\n    lifetime: { min: 20, max: 40 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 1, time: 0.02 },\n              { value: 1, time: 0.98 },\n              { value: 0, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeed\",\n        config: {\n          speed: {\n            list: [\n              { time: 0, value: 90 },\n              { time: 1, value: 100 },\n            ],\n          },\n          minMult: 0.6,\n        },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 0.03, time: 0 },\n              { value: 0.12, time: 0.1 },\n              { value: 0.12, time: 0.9 },\n              { value: 0.03, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"rotationStatic\",\n        config: { min: 0, max: 359 },\n      },\n      {\n        type: \"animatedSingle\",\n        config: {\n          anim: {\n            framerate: 15,\n            loop: true,\n            textures: [\n              { texture: 1, count: 20 },\n              { texture: 2, count: 3 },\n              { texture: 3, count: 2 },\n              { texture: 4, count: 2 },\n              { texture: 3, count: 2 },\n              { texture: 2, count: 3 },\n            ].map(({ texture, count }) => ({\n              texture: `modules/fxmaster/assets/particle-effects/effects/crows/crow${texture}.png`,\n              count,\n            })),\n          },\n        },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.CROWS_CONFIG;\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\nimport { DefautlRectangleSpawnMixin } from \"./mixins/default-retangle-spawn.js\";\n\n/**\n * A full-screen particle effect which renders swirling fog.\n */\nexport class FogParticleEffect extends DefautlRectangleSpawnMixin(FXMasterParticleEffect) {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectFog\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/fog.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.01, value: 0.08, max: 0.15, step: 0.01, decimals: 2 },\n        \"-=direction\": null,\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for swirling fog\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static FOG_CONFIG = {\n    lifetime: { min: 10, max: 25 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 0.1, time: 0.1 },\n              { value: 0.3, time: 0.5 },\n              { value: 0.1, time: 0.9 },\n              { value: 0, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeed\",\n        config: {\n          speed: {\n            list: [\n              { time: 0, value: 15 },\n              { time: 1, value: 10 },\n            ],\n          },\n          minMult: 0.2,\n        },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 1.5, time: 0 },\n              { value: 1, time: 1 },\n            ],\n          },\n          minMult: 0.5,\n        },\n      },\n      {\n        type: \"rotation\",\n        config: { accel: 0, minSpeed: 0.15, maxSpeed: 0.35, minStart: 0, maxStart: 365 },\n      },\n      {\n        type: \"textureRandom\",\n        config: {\n          textures: Array.fromRange(4).map(\n            (n) => `modules/fxmaster/assets/particle-effects/effects/clouds/cloud${n + 1}.png`,\n          ),\n        },\n      },\n      {\n        type: \"colorStatic\",\n        config: {\n          color: \"dddddd\",\n        },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.FOG_CONFIG;\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\nimport { DefautlRectangleSpawnMixin } from \"./mixins/default-retangle-spawn.js\";\n\n/**\n * A full-screen particle effect which renders scurrying rats.\n */\nexport class RatsParticleEffect extends DefautlRectangleSpawnMixin(FXMasterParticleEffect) {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectRats\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/rats.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"animals\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.001, value: 0.006, max: 0.1, step: 0.001, decimals: 3 },\n        \"-=direction\": null,\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for scurrying rats\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static RATS_CONFIG = {\n    lifetime: { min: 20, max: 40 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 1, time: 0.02 },\n              { value: 1, time: 0.98 },\n              { value: 0, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeedStatic\",\n        config: { min: 120, max: 200 },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 0.03, time: 0 },\n              { value: 0.125, time: 0.1 },\n              { value: 0.125, time: 0.9 },\n              { value: 0.03, time: 1 },\n            ],\n          },\n          minMult: 0.5,\n        },\n      },\n      {\n        type: \"rotationStatic\",\n        config: { min: 0, max: 359 },\n      },\n      {\n        type: \"animatedSingle\",\n        config: {\n          anim: {\n            framerate: \"10\",\n            loop: true,\n            textures: Array.fromRange(5).map(\n              (n) => `modules/fxmaster/assets/particle-effects/effects/rats/rat${n + 1}.png`,\n            ),\n          },\n        },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.RATS_CONFIG;\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\n\n/**\n * A full-screen particle effect which renders heavy snow fall.\n */\nexport class SnowstormParticleEffect extends FXMasterParticleEffect {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectSnowstorm\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/snow-storm.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.05, value: 0.6, max: 1, step: 0.05, decimals: 2 },\n    });\n  }\n\n  /**\n   * Configuration for the particle emitter for heavy snow fall\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static SNOWSTORM_CONFIG = {\n    lifetime: { min: 2.5, max: 6 },\n    behaviors: [\n      {\n        type: \"alphaStatic\",\n        config: { alpha: 1 },\n      },\n      {\n        type: \"movePath\",\n        config: {\n          path: \"sin(x / 150) * 25\",\n          speed: {\n            list: [\n              { value: 400, time: 0 },\n              { value: 350, time: 1 },\n            ],\n          },\n          minMult: 0.2,\n        },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 0.2, time: 0 },\n              { value: 0.08, time: 1 },\n            ],\n          },\n          minMult: 0.8,\n        },\n      },\n      {\n        type: \"rotation\",\n        config: { accel: 0, minSpeed: -60, maxSpeed: 60, minStart: 86, maxStart: 94 },\n      },\n      {\n        type: \"textureRandom\",\n        config: {\n          textures: Array.fromRange(2).map(\n            (n) => `modules/fxmaster/assets/particle-effects/effects/snowstorm/snow${n + 1}.png`,\n          ),\n        },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.SNOWSTORM_CONFIG;\n  }\n\n  /** @override */\n  getParticleEmitters(options = {}) {\n    options = this.constructor.mergeWithDefaults(options);\n    const d = canvas.dimensions;\n    const maxParticles = (d.width / d.size) * (d.height / d.size) * options.density.value;\n    const config = foundry.utils.deepClone(this.constructor.defaultConfig);\n    config.maxParticles = maxParticles;\n    config.frequency = (config.lifetime.min + config.lifetime.max) / 2 / maxParticles;\n    config.behaviors.push({\n      type: \"spawnShape\",\n      config: {\n        type: \"rect\",\n        data: { x: d.sceneRect.x, y: d.sceneRect.y, w: d.sceneRect.width, h: d.sceneRect.height },\n      },\n    });\n    this.applyOptionsToConfig(options, config);\n\n    return [this.createEmitter(config)];\n  }\n}\n","import { SpiderParticleEffect } from \"./effects/spiders.js\";\nimport { StarsParticleEffect } from \"./effects/stars.js\";\nimport { AutumnLeavesParticleEffect } from \"./effects/leaves.js\";\nimport { BatsParticleEffect } from \"./effects/bats.js\";\nimport { BirdsParticleEffect } from \"./effects/birds.js\";\nimport { BubblesParticleEffect } from \"./effects/bubbles.js\";\nimport { CloudsParticleEffect } from \"./effects/clouds.js\";\nimport { CrowsParticleEffect } from \"./effects/crows.js\";\nimport { EaglesParticleEffect } from \"./effects/eagles.js\";\nimport { EmbersParticleEffect } from \"./effects/embers.js\";\nimport { FogParticleEffect } from \"./effects/fog.js\";\nimport { RainParticleEffect } from \"./effects/rain.js\";\nimport { RainSimpleParticleEffect } from \"./effects/rain-simple.js\";\nimport { RainTopParticleEffect } from \"./effects/rain-top.js\";\nimport { RatsParticleEffect } from \"./effects/rats.js\";\nimport { SnowParticleEffect } from \"./effects/snow.js\";\nimport { SnowstormParticleEffect } from \"./effects/snowstorm.js\";\n\n/** @typedef {Record<string, typeof import(\"./effects/effect.js\").FXMasterParticleEffect>} ParticleEffects */\n\n/** @type {ParticleEffects} */\nexport const particleEffects = {\n  bats: BatsParticleEffect,\n  birds: BirdsParticleEffect,\n  crows: CrowsParticleEffect,\n  eagles: EaglesParticleEffect,\n  rats: RatsParticleEffect,\n  spiders: SpiderParticleEffect,\n\n  bubbles: BubblesParticleEffect,\n  embers: EmbersParticleEffect,\n  stars: StarsParticleEffect,\n\n  leaves: AutumnLeavesParticleEffect,\n  clouds: CloudsParticleEffect,\n  fog: FogParticleEffect,\n  rain: RainParticleEffect,\n  raintop: RainTopParticleEffect,\n  rainsimple: RainSimpleParticleEffect,\n  snow: SnowParticleEffect,\n  snowstorm: SnowstormParticleEffect,\n};\n","import { filterEffects } from \"./filter-effects/filter-effects-db.js\";\nimport { particleEffects } from \"./particle-effects/particle-effects-db.js\";\nimport { specialEffects } from \"./special-effects/special-effects-db.js\";\n\nexport const FXMASTER = {\n  filterEffects,\n  particleEffects,\n  specialEffects,\n};\n","import { FXMasterParticleEffect } from \"./effect.js\";\n\n/**\n * A full-screen particle effect which renders flying birds.\n */\nexport class BirdsParticleEffect extends FXMasterParticleEffect {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectBirds\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/crows.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"animals\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.001, value: 0.006, max: 0.01, step: 0.001, decimals: 3 },\n        \"-=direction\": null,\n        animations: {\n          label: \"FXMASTER.Animations\",\n          type: \"multi-select\",\n          options: {\n            glide: \"FXMASTER.ParicleEffectBirdsAnimationsGlide\",\n            flap: \"FXMASTER.ParicleEffectBirdsAnimationsFlap\",\n            mixed: \"FXMASTER.ParicleEffectBirdsAnimationsMixed\",\n          },\n          value: [\"mixed\"],\n        },\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for flying birds\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static BIRDS_CONFIG = {\n    lifetime: { min: 20, max: 40 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 1, time: 0.02 },\n              { value: 1, time: 0.98 },\n              { value: 0, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeed\",\n        config: {\n          speed: {\n            list: [\n              { time: 0, value: 90 },\n              { time: 1, value: 100 },\n            ],\n          },\n          minMult: 0.6,\n        },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 0.3, time: 0 },\n              { value: 0.7, time: 0.1 },\n              { value: 0.7, time: 0.9 },\n              { value: 0.3, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"rotationStatic\",\n        config: { min: 0, max: 359 },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.BIRDS_CONFIG;\n  }\n\n  /** @override */\n  getParticleEmitters(options = {}) {\n    options = this.constructor.mergeWithDefaults(options);\n    const d = canvas.dimensions;\n    const maxParticles = (d.width / d.size) * (d.height / d.size) * options.density.value;\n    const config = foundry.utils.deepClone(this.constructor.BIRDS_CONFIG);\n    config.maxParticles = maxParticles;\n    config.frequency = config.lifetime.min / maxParticles;\n    config.behaviors.push({\n      type: \"spawnShape\",\n      config: {\n        type: \"rect\",\n        data: { x: d.sceneRect.x, y: d.sceneRect.y, w: d.sceneRect.width, h: d.sceneRect.height },\n      },\n    });\n    config.behaviors.push({\n      type: \"animatedRandom\",\n      config: {\n        anims: this._getAnimations(options),\n      },\n    });\n    this.applyOptionsToConfig(options, config);\n\n    return [this.createEmitter(config)];\n  }\n\n  /**\n   * Get the animation to use for this effect.\n   * @returns The animations to use for the effect\n   * @protected\n   */\n  _getAnimations(options) {\n    const animations = {\n      glide: [\n        { textureNumber: 2, count: 30 },\n        ...Array(4)\n          .fill([\n            { texture: 1, count: 3 },\n            { texture: 2, count: 2 },\n            { texture: 3, count: 3 },\n            { texture: 2, count: 2 },\n          ])\n          .deepFlatten(),\n        { texture: 2, count: 68 },\n      ],\n      flap: [\n        { texture: 1, count: 3 },\n        { texture: 2, count: 2 },\n        { texture: 3, count: 3 },\n        { texture: 2, count: 2 },\n      ],\n      mixed: [\n        { texture: 2, count: 7 },\n        { texture: 1, count: 3 },\n        { texture: 2, count: 2 },\n        { texture: 3, count: 3 },\n        { texture: 2, count: 7 },\n      ],\n    };\n\n    const getAnim = (animation) => ({\n      framerate: 20,\n      loop: true,\n      textures: animation.map(({ texture, count }) => ({\n        texture: `modules/fxmaster/assets/particle-effects/effects/birds/bird${texture}.png`,\n        count,\n      })),\n    });\n\n    const anims = (options.animations?.value ?? [])\n      .filter((animation) => Object.keys(animations).includes(animation))\n      .map((animation) => getAnim(animations[animation]));\n\n    if (anims.length === 0) {\n      anims.push(getAnim(animations.mixed));\n    }\n\n    return anims;\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\n\n/**\n * A full-screen particle effect which renders flying eagles.\n */\nexport class EaglesParticleEffect extends FXMasterParticleEffect {\n  /**\n   * The cached textures for this weather effect.\n   * @type {PIXI.Texture[] | undefined}\n   * @private\n   */\n  static _textureCache;\n\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectEagles\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/crows.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"animals\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.0005, value: 0.002, max: 0.01, step: 0.0005, decimals: 4 },\n        \"-=direction\": null,\n        animations: {\n          label: \"FXMASTER.Animations\",\n          type: \"multi-select\",\n          options: {\n            flap: \"FXMASTER.ParicleEffectBirdsAnimationsFlap\",\n            glide: \"FXMASTER.ParicleEffectBirdsAnimationsGlide\",\n          },\n          value: [\"glide\"],\n        },\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for flying eagles\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static EAGLES_CONFIG = {\n    lifetime: { min: 7, max: 14 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 1, time: 0.02 },\n              { value: 1, time: 0.98 },\n              { value: 0, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeed\",\n        config: {\n          speed: {\n            list: [\n              { time: 0, value: 360 },\n              { time: 1, value: 400 },\n            ],\n          },\n          minMult: 0.6,\n        },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 0.15, time: 0 },\n              { value: 0.3, time: 0.1 },\n              { value: 0.3, time: 0.9 },\n              { value: 0.15, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"rotationStatic\",\n        config: { min: 0, max: 359 },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.EAGLES_CONFIG;\n  }\n\n  /** @override */\n  getParticleEmitters(options = {}) {\n    options = this.constructor.mergeWithDefaults(options);\n    const d = canvas.dimensions;\n    const maxParticles = (d.width / d.size) * (d.height / d.size) * options.density.value;\n    const config = foundry.utils.deepClone(this.constructor.EAGLES_CONFIG);\n    config.maxParticles = maxParticles;\n    config.frequency = config.lifetime.min / maxParticles;\n    config.behaviors.push({\n      type: \"spawnShape\",\n      config: {\n        type: \"rect\",\n        data: { x: d.sceneRect.x, y: d.sceneRect.y, w: d.sceneRect.width, h: d.sceneRect.height },\n      },\n    });\n    config.behaviors.push({\n      type: \"animatedRandom\",\n      config: {\n        anims: this._getAnimations(options),\n      },\n    });\n    this.applyOptionsToConfig(options, config);\n\n    return [this.createEmitter(config)];\n  }\n\n  /**\n   * Get the animation to use for this effect.\n   * @returns The animations to use for the effect\n   * @protected\n   */\n  _getAnimations(options) {\n    if (!this._textures) {\n      this._initializeTextures();\n    }\n\n    const flap = Array.fromRange(19).map((textureNumber) => ({\n      textureNumber,\n      count: 1,\n    }));\n\n    const glide = [\n      { textureNumber: 0, count: 30 },\n      ...Array(4).fill(flap).deepFlatten(),\n      { textureNumber: 0, count: 68 },\n    ];\n\n    const animations = {\n      glide,\n      flap,\n    };\n\n    const getAnim = (animation) => ({\n      framerate: 20,\n      loop: true,\n      textures: animation.map(({ textureNumber, count }) => ({\n        texture: this._textures[textureNumber],\n        count,\n      })),\n    });\n\n    const anims = (options.animations?.value ?? [])\n      .filter((animation) => Object.keys(animations).includes(animation))\n      .map((animation) => getAnim(animations[animation]));\n\n    if (anims.length === 0) {\n      anims.push(getAnim(animations.glide));\n    }\n\n    return anims;\n  }\n\n  /**\n   * Get the textures for this particle effect.\n   * @private\n   * @returns {PIXI.Texture[]}\n   */\n  get _textures() {\n    if (!this.constructor._textureCache) {\n      const spriteSheetTexture = PIXI.Texture.from(\"modules/fxmaster/assets/particle-effects/effects/eagles/eagle.png\");\n      const spriteSheetData = {\n        meta: {\n          scale: \"1\",\n        },\n        frames: {\n          \"eagle0000.png\": {\n            frame: { x: 0, y: 0, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0001.png\": {\n            frame: { x: 512, y: 0, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0002.png\": {\n            frame: { x: 0, y: 512, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0003.png\": {\n            frame: { x: 512, y: 512, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0004.png\": {\n            frame: { x: 1024, y: 0, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0005.png\": {\n            frame: { x: 1024, y: 512, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0006.png\": {\n            frame: { x: 0, y: 1024, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0007.png\": {\n            frame: { x: 512, y: 1024, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0008.png\": {\n            frame: { x: 1024, y: 1024, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0009.png\": {\n            frame: { x: 1536, y: 0, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0010.png\": {\n            frame: { x: 1536, y: 512, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0011.png\": {\n            frame: { x: 1536, y: 1024, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0012.png\": {\n            frame: { x: 0, y: 1536, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0013.png\": {\n            frame: { x: 512, y: 1536, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0014.png\": {\n            frame: { x: 1024, y: 1536, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0015.png\": {\n            frame: { x: 1536, y: 1536, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0016.png\": {\n            frame: { x: 2048, y: 0, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0017.png\": {\n            frame: { x: 2048, y: 512, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0018.png\": {\n            frame: { x: 2048, y: 1024, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0019.png\": {\n            frame: { x: 2048, y: 1536, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n        },\n      };\n      const spriteSheet = new PIXI.Spritesheet(spriteSheetTexture, spriteSheetData);\n      spriteSheet.parse((textures) => {\n        this.constructor._textureCache = Object.values(textures);\n      }); // This is known to complete synchronously because there are only 20 textures and PIXI only starts batching when there are more than 1000.\n    }\n    return this.constructor._textureCache;\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\nimport { withSteppedGradientColor } from \"./helpers/with-stepped-gradient-color.js\";\n\n/**\n * A full-screen particle effect which renders floating embers.\n */\nexport class EmbersParticleEffect extends FXMasterParticleEffect {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectEmbers\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/embers.png\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.05, value: 0.7, max: 1.4, step: 0.05, decimals: 2 },\n        tint: { value: { value: \"#f77300\" } },\n        \"-=direction\": null,\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for floating embers\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static EMBERS_CONFIG = {\n    lifetime: { min: 4, max: 6 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 0.9, time: 0.3 },\n              { value: 0.9, time: 0.95 },\n              { value: 0, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeedStatic\",\n        config: { min: 24, max: 40 },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 0.15, time: 0 },\n              { value: 0.01, time: 1 },\n            ],\n          },\n          minMult: 0.85,\n        },\n      },\n      {\n        type: \"rotation\",\n        config: { accel: 0, minSpeed: 100, maxSpeed: 200, minStart: 0, maxStart: 365 },\n      },\n      {\n        type: \"textureSingle\",\n        config: { texture: \"modules/fxmaster/assets/particle-effects/effects/embers/ember.png\" },\n      },\n      {\n        type: \"color\",\n        config: {\n          color: {\n            list: [\n              { value: \"f77300\", time: 0 },\n              { value: \"f72100\", time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"blendMode\",\n        config: {\n          blendMode: \"screen\",\n        },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.EMBERS_CONFIG;\n  }\n\n  /** @override */\n  getParticleEmitters(options = {}) {\n    options = this.constructor.mergeWithDefaults(options);\n    const d = canvas.dimensions;\n    const maxParticles = (d.width / d.size) * (d.height / d.size) * options.density.value;\n    const config = foundry.utils.deepClone(this.constructor.EMBERS_CONFIG);\n    config.maxParticles = maxParticles;\n    config.frequency = config.lifetime.min / maxParticles;\n    config.behaviors.push({\n      type: \"spawnShape\",\n      config: {\n        type: \"rect\",\n        data: { x: d.sceneRect.x, y: d.sceneRect.y, w: d.sceneRect.width, h: d.sceneRect.height },\n      },\n    });\n    this.applyOptionsToConfig(options, config);\n\n    const emitter = withSteppedGradientColor(this.createEmitter(config), config);\n    return [emitter];\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\n\n/**\n * A full-screen weather effect which renders rain drops and splashes.\n */\nexport class RainParticleEffect extends FXMasterParticleEffect {\n  /** @override */\n  static label = \"WEATHER.Rain\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/rain.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  /**\n   * Configuration for the particle emitter for rain\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static RAIN_CONFIG = {\n    lifetime: { min: 0.5, max: 0.5 },\n    pos: { x: 0, y: 0 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { time: 0, value: 0.7 },\n              { time: 1, value: 0.1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeedStatic\",\n        config: { min: 2800, max: 3500 },\n      },\n      {\n        type: \"scaleStatic\",\n        config: { min: 0.8, max: 1 },\n      },\n      {\n        type: \"rotationStatic\",\n        config: { min: 75, max: 75 },\n      },\n      {\n        type: \"textureSingle\",\n        config: { texture: \"ui/particles/rain.png\" },\n      },\n    ],\n  };\n\n  /**\n   * Configuration for the particle emitter for splashes\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static SPLASH_CONFIG = {\n    lifetime: { min: 0.5, max: 0.5 },\n    pos: { x: 0, y: 0 },\n    behaviors: [\n      {\n        type: \"moveSpeedStatic\",\n        config: { min: 0, max: 0 },\n      },\n      {\n        type: \"scaleStatic\",\n        config: { min: 0.48, max: 0.6 },\n      },\n      {\n        type: \"rotationStatic\",\n        config: { min: -90, max: -90 },\n      },\n      {\n        type: \"noRotation\",\n        config: {},\n      },\n      {\n        type: \"textureSingle\",\n        config: { texture: \"ui/particles/drop.png\" },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.RAIN_CONFIG;\n  }\n\n  /** @override */\n  getParticleEmitters(options = {}) {\n    options = this.constructor.mergeWithDefaults(options);\n    const d = canvas.dimensions;\n    const maxParticles = (d.width / d.size) * (d.height / d.size) * options.density.value;\n\n    // Create an emitter for rain drops\n    const rainConfig = foundry.utils.deepClone(this.constructor.RAIN_CONFIG);\n    rainConfig.maxParticles = maxParticles;\n    rainConfig.frequency = 1 / maxParticles;\n    rainConfig.behaviors.push({\n      type: \"spawnShape\",\n      config: {\n        type: \"rect\",\n        data: {\n          x: -0.05 * d.width,\n          y: -0.1 * d.height,\n          w: d.width,\n          h: 0.8 * d.height,\n        },\n      },\n    });\n    this.applyOptionsToConfig(options, rainConfig);\n\n    // Create a second emitter for splashes\n    const splashConfig = foundry.utils.deepClone(this.constructor.SPLASH_CONFIG);\n    splashConfig.maxParticles = 0.5 * maxParticles;\n    splashConfig.frequency = 2 / maxParticles;\n    splashConfig.behaviors.push({\n      type: \"spawnShape\",\n      config: {\n        type: \"rect\",\n        data: {\n          x: 0,\n          y: 0.25 * d.height,\n          w: d.width,\n          h: 0.75 * d.height,\n        },\n      },\n    });\n    this.applyOptionsToConfig(options, splashConfig);\n\n    // Return both emitters\n    return [this.createEmitter(rainConfig), this.createEmitter(splashConfig)];\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\n\n/**\n * A full-screen weather effect which renders rain drops from top down.\n */\nexport class RainTopParticleEffect extends FXMasterParticleEffect {\n  /**\n   * The id of the canvasPan hook registered by this effect.\n   * @type {number|undefined}\n   * @private\n   */\n  _canvasPanHookId;\n\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectRainTop\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/rain.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.01, value: 0.3, max: 1, step: 0.01, decimals: 2 },\n        \"-=direction\": null,\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for raindrops from top down\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static RAIN_TOP_CONFIG = {\n    lifetime: { min: 0.6, max: 0.7 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 0.6, time: 0.8 },\n              { value: 0.23, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 3, time: 0 },\n              { value: 0.4, time: 1 },\n            ],\n          },\n          minMult: 0.7,\n        },\n      },\n      {\n        type: \"rotationStatic\",\n        config: { min: 180, max: 180 },\n      },\n      {\n        type: \"textureSingle\",\n        config: { texture: \"ui/particles/rain.png\" },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.RAIN_TOP_CONFIG;\n  }\n\n  /** @override */\n  getParticleEmitters(options = {}) {\n    options = this.constructor.mergeWithDefaults(options);\n    const d = canvas.dimensions;\n    const maxParticles = (d.width / d.size) * (d.height / d.size) * options.density.value;\n    const sceneRadius = Math.sqrt(d.sceneWidth * d.sceneWidth + d.sceneHeight * d.sceneHeight) / 2;\n    const config = foundry.utils.deepClone(this.constructor.RAIN_TOP_CONFIG);\n    config.maxParticles = maxParticles;\n    config.frequency = config.lifetime.min / maxParticles;\n    config.behaviors.push({\n      type: \"moveSpeed\",\n      config: {\n        speed: {\n          list: [\n            { time: 0, value: 1600 },\n            { time: 1, value: 2000 },\n          ],\n        },\n        minMult: 0.8,\n      },\n    });\n    this.applyOptionsToConfig(options, config);\n    const moveSpeedList = config.behaviors.find(({ type }) => type === \"moveSpeed\").config.speed.list;\n    const averageSpeed = moveSpeedList.reduce((acc, cur) => acc + cur.value, 0) / moveSpeedList.length;\n    config.behaviors.push({\n      type: \"spawnShape\",\n      config: {\n        type: \"torus\",\n        data: {\n          x: d.sceneRect.x + d.sceneWidth / 2,\n          y: d.sceneRect.y + d.sceneHeight / 2,\n          radius: averageSpeed * config.lifetime.max + sceneRadius * 2,\n          innerRadius: averageSpeed * config.lifetime.max,\n          affectRotation: true,\n        },\n      },\n    });\n\n    const emitter = this.createEmitter(config);\n    emitter.updateOwnerPos(\n      canvas.stage.pivot.x - d.sceneX - d.sceneWidth / 2,\n      canvas.stage.pivot.y - d.sceneY - d.sceneHeight / 2,\n    );\n    return [emitter];\n  }\n\n  /** @override */\n  play() {\n    this._unregisterCanvasPanHook();\n    this._canvasPanHookId = Hooks.on(\"canvasPan\", (_canvas, position) => {\n      const d = canvas.dimensions;\n      for (let e of this.emitters) {\n        e.updateOwnerPos(position.x - d.sceneX - d.sceneWidth / 2, position.y - d.sceneY - d.sceneHeight / 2);\n      }\n    });\n    super.play();\n  }\n\n  /** @override */\n  stop() {\n    this._unregisterCanvasPanHook();\n    super.stop();\n  }\n\n  /**\n   * Unregister the canvasPan hook used by this effect.\n   * @private\n   */\n  _unregisterCanvasPanHook() {\n    if (this._canvasPanHookId !== undefined) {\n      Hooks.off(\"canvasPan\", this._canvasPanHookId);\n      this._canvasPanHookId = undefined;\n    }\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\n\n/**\n * A full-screen weather effect which renders rain drops.\n */\nexport class RainSimpleParticleEffect extends FXMasterParticleEffect {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectRainSimple\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/rain.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  /**\n   * Configuration for the particle emitter for rain\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static RAIN_CONFIG = {\n    lifetime: { min: 0.5, max: 0.5 },\n    pos: { x: 0, y: 0 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { time: 0, value: 0.7 },\n              { time: 1, value: 0.1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeedStatic\",\n        config: { min: 2800, max: 3500 },\n      },\n      {\n        type: \"scaleStatic\",\n        config: { min: 0.8, max: 1 },\n      },\n      {\n        type: \"rotationStatic\",\n        config: { min: 75, max: 75 },\n      },\n      {\n        type: \"textureSingle\",\n        config: { texture: \"ui/particles/rain.png\" },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.RAIN_CONFIG;\n  }\n\n  /** @override */\n  getParticleEmitters(options = {}) {\n    options = this.constructor.mergeWithDefaults(options);\n    const d = canvas.dimensions;\n    const maxParticles = (d.width / d.size) * (d.height / d.size) * options.density.value;\n\n    const config = foundry.utils.deepClone(this.constructor.RAIN_CONFIG);\n    config.maxParticles = maxParticles;\n    config.frequency = 1 / maxParticles;\n    config.behaviors.push({\n      type: \"spawnShape\",\n      config: {\n        type: \"rect\",\n        data: {\n          x: -0.05 * d.width,\n          y: -0.1 * d.height,\n          w: d.width,\n          h: 0.8 * d.height,\n        },\n      },\n    });\n    this.applyOptionsToConfig(options, config);\n\n    return [this.createEmitter(config)];\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\n\n/**\n * A full-screen weather effect which renders drifting snowflakes.\n */\nexport class SnowParticleEffect extends FXMasterParticleEffect {\n  /** @override */\n  static label = \"WEATHER.Snow\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/snow.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  /**\n   * Configuration for the particle emitter for snow\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static SNOW_CONFIG = {\n    lifetime: { min: 4, max: 4 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { time: 0, value: 0.9 },\n              { time: 1, value: 0.5 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeed\",\n        config: {\n          speed: {\n            list: [\n              { time: 0, value: 190 },\n              { time: 1, value: 210 },\n            ],\n          },\n          minMult: 0.6,\n        },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { time: 0, value: 0.2 },\n              { time: 1, value: 0.4 },\n            ],\n          },\n          minMult: 0.5,\n        },\n      },\n      {\n        type: \"rotation\",\n        config: { accel: 0, minSpeed: 0, maxSpeed: 200, minStart: 50, maxStart: 75 },\n      },\n      {\n        type: \"textureSingle\",\n        config: {\n          texture: \"ui/particles/snow.png\",\n        },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.SNOW_CONFIG;\n  }\n\n  /** @override */\n  getParticleEmitters(options = {}) {\n    options = this.constructor.mergeWithDefaults(options);\n    const d = canvas.dimensions;\n    const maxParticles = (d.width / d.size) * (d.height / d.size) * options.density.value;\n    const config = foundry.utils.deepClone(this.constructor.SNOW_CONFIG);\n    config.maxParticles = maxParticles;\n    config.frequency = (config.lifetime.min + config.lifetime.max) / 2 / maxParticles;\n    config.behaviors.push({\n      type: \"spawnShape\",\n      config: {\n        type: \"rect\",\n        data: { x: 0, y: -0.1 * d.height, w: d.width, h: d.height },\n      },\n    });\n    this.applyOptionsToConfig(options, config);\n    return [this.createEmitter(config)];\n  }\n}\n","export const specialEffects = {\n  fxmaster: {\n    label: \"FXMaster\",\n    effects: [\n      {\n        label: \"Smoke Bomb\",\n        file: \"modules/fxmaster/assets/special-effects/fxmaster/smoke-bomb.webm\",\n        scale: {\n          x: 1.0,\n          y: 1.0,\n        },\n        angle: 0,\n        anchor: {\n          x: 0.5,\n          y: 0.5,\n        },\n        speed: 0,\n        author: \"U~man\",\n      },\n      {\n        label: \"Fireball\",\n        file: \"modules/fxmaster/assets/special-effects/fxmaster/fireball.webm\",\n        scale: {\n          x: 1.0,\n          y: 1.0,\n        },\n        angle: 0,\n        anchor: {\n          x: 0.5,\n          y: 0.5,\n        },\n        author: \"U~man\",\n      },\n      {\n        label: \"Blood Splatter\",\n        file: \"modules/fxmaster/assets/special-effects/fxmaster/blood.webm\",\n        scale: {\n          x: 0.7,\n          y: 0.7,\n        },\n        angle: 0,\n        anchor: {\n          x: 0.5,\n          y: 0.5,\n        },\n        author: \"U~man\",\n      },\n      {\n        label: \"Red Fire Cone\",\n        file: \"modules/fxmaster/assets/special-effects/jinker/dragonBornGold-RedFire15Cone.webm\",\n        scale: {\n          x: 1.0,\n          y: 1.0,\n        },\n        angle: 0,\n        anchor: {\n          x: 0,\n          y: 0.5,\n        },\n        author: \"Jinker\",\n      },\n      {\n        label: \"Acid Line\",\n        file: \"modules/fxmaster/assets/special-effects/jinker/dragonBornBlack-CopperAcid30x5Line.webm\",\n        scale: {\n          x: 1.0,\n          y: 1.0,\n        },\n        angle: 0,\n        anchor: {\n          x: 0,\n          y: 0.5,\n        },\n        author: \"Jinker\",\n      },\n      {\n        label: \"Witch Bolt\",\n        file: \"modules/fxmaster/assets/special-effects/jb2a/Witch_Bolt_Blue_600x200.webm\",\n        scale: {\n          x: 0.7,\n          y: 0.7,\n        },\n        angle: 0,\n        anchor: {\n          x: 0,\n          y: 0.5,\n        },\n        author: \"JB2A\",\n      },\n    ],\n  },\n};\n","import { packageId } from \"../constants.js\";\nimport { logger } from \"../logger.js\";\nimport { executeWhenWorldIsMigratedToLatest, isOnTargetMigration } from \"../migration/migration.js\";\nimport { isEnabled } from \"../settings.js\";\n\nexport class ParticleEffectsLayer extends CanvasLayer {\n  /**\n   * The particle overlay container.\n   * @type {FullCanvasContainer| undefined}\n   */\n  particleEffectsContainer;\n\n  /**\n   * The currently active particle effects.\n   * @type {Record<string, {type: string, fx: import('./effects/effect.js').FXMasterParticleEffect}>}\n   */\n  particleEffects = {};\n\n  /**\n   * An occlusion filter that prevents particle effects from being displayed in certain regions.\n   * @type {InverseOcclusionMaskFilter | undefined}\n   */\n  particleEffectOcclusionFilter;\n\n  /**\n   * Define an elevation property on the ParticleEffectsLayer layer.\n   * For now, it simply referenes the elevation property of the {@link WeatherEffects} provided by\n   * foundry.\n   * @type {number}\n   */\n  get elevation() {\n    return canvas.weather?.elevation ?? Infinity;\n  }\n\n  set elevation(value) {\n    const weatherEffects = canvas.weather;\n    if (weatherEffects) {\n      weatherEffects.elevation = value;\n    }\n  }\n\n  /** @override */\n  static get layerOptions() {\n    return foundry.utils.mergeObject(super.layerOptions, { name: \"particle-effects\" });\n  }\n\n  /** @override */\n  async _draw() {\n    if (!isEnabled()) {\n      return;\n    }\n    if (isOnTargetMigration()) {\n      await this.#draw();\n    } else {\n      // If migrations need to be performed, defer drawing to when they are done.\n      executeWhenWorldIsMigratedToLatest(this.#draw.bind(this));\n    }\n  }\n\n  /** @override */\n  async _tearDown() {\n    Object.values(this.particleEffects).forEach(({ fx }) => fx.destroy());\n\n    this.particleEffectsContainer = undefined;\n    this.particleEffects = {};\n    this.particleEffectOcclusionFilter = undefined;\n\n    return super._tearDown();\n  }\n\n  /**\n   * Actual implementation of drawing the layer.\n   * @private\n   */\n  async #draw() {\n    this.particleEffectOcclusionFilter = this.#createParticleEffectOcclusionFilter();\n    await this.drawParticleEffects();\n  }\n\n  async drawParticleEffects({ soft = false } = {}) {\n    if (!canvas.scene) {\n      return;\n    }\n    if (!this.particleEffectsContainer) {\n      const particleEffectsContainer = new FullCanvasContainer();\n      particleEffectsContainer.accessibleChildren = particleEffectsContainer.interactiveChildren = false;\n      particleEffectsContainer.filterArea = canvas.app.renderer.screen;\n      this.particleEffectsContainer = this.addChild(particleEffectsContainer);\n      if (this.particleEffectOcclusionFilter) {\n        this.particleEffectsContainer.filters = [this.particleEffectOcclusionFilter];\n      }\n    }\n\n    const stopPromise = Promise.all(\n      Object.entries(this.particleEffects).map(async ([id, effect]) => {\n        if (soft) {\n          await effect.fx.fadeOut({ timeout: 20000 });\n        } else {\n          effect.fx.stop();\n        }\n        // The check is needed because a new effect might have been set already.\n        if (this.particleEffects[id] === effect) {\n          delete this.particleEffects[id];\n        }\n      }),\n    );\n\n    const flags = canvas.scene.getFlag(packageId, \"effects\") ?? {};\n    if (Object.keys(flags).length > 0) {\n      this.particleEffectOcclusionFilter.enabled = true;\n    }\n    for (const id in flags) {\n      if (!(flags[id].type in CONFIG.fxmaster.particleEffects)) {\n        logger.warn(`Particle effect '${id}' is of unknown type '${flags[id].type}', skipping it.`);\n        continue;\n      }\n      const options = Object.fromEntries(\n        Object.entries(flags[id].options).map(([optionName, value]) => [optionName, { value }]),\n      );\n\n      this.particleEffects[id] = {\n        type: flags[id].type,\n        fx: new CONFIG.fxmaster.particleEffects[flags[id].type](this.particleEffectsContainer, options),\n      };\n      this.particleEffects[id].fx.play({ prewarm: !soft });\n    }\n\n    await stopPromise;\n\n    if (Object.keys(this.particleEffects).length === 0) {\n      this.particleEffectOcclusionFilter.enabled = false;\n    }\n  }\n\n  /**\n   * Create the occlusion filter.\n   * @returns {InverseOcclusionMaskFilter} The occlusion filter\n   * @private\n   */\n  #createParticleEffectOcclusionFilter() {\n    const particleOcclusionFilter = InverseOcclusionMaskFilter.create({\n      alphaOcclusion: 0,\n      uMaskSampler: canvas.masks.depth.renderTexture,\n      channel: \"b\",\n    });\n    return particleOcclusionFilter;\n  }\n}\n","import { packageId } from \"../constants.js\";\n\nexport function registeDrawingsMaskFunctionality() {\n  Hooks.on(\"canvasReady\", drawDrawingsMask);\n\n  for (const hook of [\"updateDrawing\", \"createDrawing\", \"deleteDrawing\"]) {\n    Hooks.on(hook, (drawing) => {\n      drawDrawingsMaskIfCurrentScene(drawing.parent);\n    });\n  }\n\n  Hooks.on(\"updateScene\", (scene, data) => {\n    if (\n      foundry.utils.hasProperty(data, \"flags.fxmaster.invert\") ||\n      foundry.utils.hasProperty(data, \"flags.fxmaster.-=invert\")\n    ) {\n      drawDrawingsMaskIfCurrentScene(scene);\n    }\n  });\n}\n\nfunction drawDrawingsMaskIfCurrentScene(scene) {\n  if (scene === canvas.scene) {\n    drawDrawingsMask();\n  }\n}\n\nfunction drawDrawingsMask() {\n  const msk = canvas.masks.depth;\n  if (msk.fxmasterDrawingsMask) {\n    msk.removeChild(msk.fxmasterDrawingsMask);\n    delete msk.fxmasterDrawingsMask;\n  }\n  const invert = canvas.scene.getFlag(packageId, \"invert\");\n  const mask = invert ? createInvertedMask() : createMask();\n  mask.mask = new PIXI.MaskData();\n  mask.mask.colorMask = PIXI.COLOR_MASK_BITS.BLUE;\n  msk.fxmasterDrawingsMask = msk.addChild(mask);\n}\n\nfunction createMask() {\n  const mask = new PIXI.LegacyGraphics();\n  canvas.drawings.placeables.forEach((drawing) => {\n    const isMask = drawing.document.getFlag(packageId, \"masking\");\n    if (!isMask) return;\n    mask.beginFill(0x0000ff);\n    drawShapeToMask(mask, drawing);\n    mask.endFill();\n  });\n  return mask;\n}\n\nfunction createInvertedMask() {\n  const mask = new PIXI.LegacyGraphics();\n  mask.beginFill(0x0000ff).drawShape(canvas.dimensions.rect).endFill();\n\n  canvas.drawings.placeables.forEach((drawing) => {\n    const isMask = drawing.document.getFlag(packageId, \"masking\");\n    if (!isMask) return;\n    mask.beginHole();\n    drawShapeToMask(mask, drawing);\n    mask.endHole();\n  });\n  return mask;\n}\n\n/**\n * Draw a shape to a mask.\n * @param {PIXI.Graphics} mask    The mask to draw to\n * @param {Drawing}       drawing The drawing of which to draw the dhape\n */\nfunction drawShapeToMask(mask, drawing) {\n  const shape = drawing.shape.geometry.graphicsData[0].shape.clone();\n  switch (drawing.type) {\n    case Drawing.SHAPE_TYPES.ELLIPSE: {\n      shape.x = drawing.center.x;\n      shape.y = drawing.center.y;\n      mask.drawShape(shape);\n      break;\n    }\n    case Drawing.SHAPE_TYPES.POLYGON: {\n      const points = drawing.document.shape.points.map((p, i) => (i % 2 === 0 ? p + drawing.x : p + drawing.y));\n      mask.drawPolygon(points);\n      break;\n    }\n    default: {\n      const s = drawing.document.shape;\n      shape.x = drawing.center.x - s.width / 2;\n      shape.y = drawing.center.y - s.height / 2;\n      mask.drawShape(shape);\n    }\n  }\n}\n","export function registerSceneMaskFunctionality() {\n  Hooks.on(\"canvasReady\", drawSceneMask);\n}\n\nfunction drawSceneMask() {\n  const msk = canvas.masks.depth;\n  if (msk.fxmasterSceneMask) {\n    msk.removeChild(msk.fxmasterSceneMask);\n    delete msk.fxmasterSceneMask;\n  }\n  if (shouldMaskToScene()) {\n    const mask = new PIXI.LegacyGraphics()\n      .beginFill(0x0000ff)\n      .drawShape(canvas.dimensions.rect)\n      .endFill()\n      .beginHole()\n      .drawShape(canvas.dimensions.sceneRect.intersection(canvas.dimensions.rect))\n      .endHole();\n    mask.mask = new PIXI.MaskData();\n    mask.mask.colorMask = PIXI.COLOR_MASK_BITS.BLUE;\n    msk.fxmasterSceneMask = msk.addChild(mask);\n  }\n}\n\n/**\n * Whether or not the particle effects should be masked to the scene.\n * @type {boolean}\n */\nfunction shouldMaskToScene() {\n  return !!(canvas.scene?.background?.src || canvas.scene?.foreground);\n}\n","import { packageId } from \"../constants.js\";\nimport { logger } from \"../logger.js\";\nimport { executeWhenWorldIsMigratedToLatest, isOnTargetMigration } from \"../migration/migration.js\";\nimport { isEnabled } from \"../settings.js\";\nimport { resetFlag } from \"../utils.js\";\n\nexport class FilterManager {\n  /** @private */\n  constructor() {\n    this.filters = {};\n    this._ticker = false;\n    this.#registerHooks();\n  }\n\n  /**\n   * A private reference for the global {@link FilterManager} instance.\n   * @type {FilterManager | undefined}\n   */\n  static #instance;\n\n  /**\n   * The container effects should be a pplied to.\n   * @type {PIXI.Container}\n   */\n  static get container() {\n    return canvas.environment;\n  }\n\n  /**\n   * The singleton {@link FilterManager} instance.\n   * @type {FilterManager}\n   */\n  static get instance() {\n    if (!this.#instance) {\n      this.#instance = new this();\n    }\n    return this.#instance;\n  }\n\n  /**\n   * Activate this {@link FilterManager}. This includes creating all the necessary filters, attaching them to the\n   * configured layers, starting their animations.\n   * @returns {Promise<void>} A promise that resolves as soon as filters are activated\n   */\n  async #activate() {\n    await this.#update({ skipFading: true });\n\n    if (!this._ticker) {\n      canvas.app.ticker.add(this.#animate, this);\n      this._ticker = true;\n    }\n  }\n\n  /**\n   * Update the filters to the state that is configured for the active scene.\n   * @param {{skipFading?: boolean}} [options]            Additional options to configure this update\n   * @param {boolean}                [options.skipFading] Whether or not newly created filters should skip their fading\n   * @returns {Promise<void>}                             A promise that resolves as soon as the filters have been updated\n   */\n  async #update({ skipFading = false } = {}) {\n    if (!canvas.scene) {\n      return;\n    }\n    const filterInfos = Object.fromEntries(\n      Object.entries(canvas.scene.getFlag(packageId, \"filters\") ?? {}).filter(([id, filterInfo]) => {\n        if (!(filterInfo.type in CONFIG.fxmaster.filterEffects)) {\n          logger.warn(`Filter effect '${id}' is of unknown type '${filterInfo.type}', skipping it.`);\n          return false;\n        }\n        return true;\n      }),\n    );\n\n    const filtersToCreate = Object.keys(filterInfos).filter((key) => !(key in this.filters));\n    const filtersToUpdate = Object.keys(filterInfos).filter((key) => key in this.filters);\n    const filtersToDelete = Object.keys(this.filters).filter((key) => !(key in filterInfos));\n\n    for (const key of filtersToCreate) {\n      const { type, options } = filterInfos[key];\n      this.filters[key] = new CONFIG.fxmaster.filterEffects[type](options, key);\n      this.filters[key].play({ skipFading });\n    }\n\n    for (const key of filtersToUpdate) {\n      const { options } = filterInfos[key];\n      const filter = this.filters[key];\n      filter.configure(options);\n      filter.play({ skipFading });\n    }\n\n    const deletePromises = filtersToDelete.map(async (key) => {\n      const filter = this.filters[key];\n      const completed = await filter.stop({ skipFading });\n      if (completed) {\n        delete this.filters[key];\n        FilterManager.#removeFilterFromContainer(this.constructor.container, filter);\n      }\n    });\n    await Promise.all(deletePromises);\n\n    this.#applyFilters();\n  }\n\n  /**\n   * Apply the filters to the configured canvas layers.\n   */\n  #applyFilters() {\n    const filters = Object.values(this.filters);\n    const otherFilters = this.constructor.container.filters?.filter((f) => !filters.includes(f)) ?? [];\n    this.constructor.container.filters = otherFilters.concat(filters);\n  }\n\n  /**\n   * Remove a filter from a container.\n   * @param {PIXI.container} container A container\n   * @param {PIXI.Filter} filter A filter\n   */\n  static #removeFilterFromContainer(container, filter) {\n    container.filters = container.filters?.filter((f) => f !== filter) ?? null;\n  }\n\n  /**\n   * Stop all filters and remove them from the manager.\n   * @remarks This does _not_ remove the filters from the canvas layers.\n   * @returns {Promise<void>} A promise that resolves as soon as all filters have been stopped and removed from the\n   *                          manager\n   */\n  async #clear() {\n    const promises = Object.values(this.filters).map((filter) => filter.stop());\n    this.filters = {};\n    await Promise.all(promises);\n  }\n\n  /**\n   * Add a named filter.\n   * @param {string | undefined} name The name of the filter\n   * @param {string} type             The type of the filter\n   * @param {object} options          The options for the filter\n   * @returns {Prmise<void>} A promise that resolves as soon as the filter has been added to the scene's fxmaster flags\n   */\n  async addFilter(name, type, options) {\n    name = name ?? foundry.utils.randomID();\n    await canvas.scene?.setFlag(packageId, \"filters\", { [name]: { type, options } });\n  }\n\n  /**\n   * Remove a named filter.\n   * @param {string} name     The name of the filter to remove\n   * @returns {Promise<void>} A promise that resolves when the filter has been removed from the scene's fxmaster flags\n   */\n  async removeFilter(name) {\n    await canvas.scene?.setFlag(packageId, \"filters\", { [`-=${name}`]: null });\n  }\n\n  /**\n   * Remove all filters.\n   * @returns {Promise<void>} A promise that resolves as soon as all filters have been removed from the scene's fxmaster\n   *                          flags\n   */\n  async removeAll() {\n    await canvas.scene?.unsetFlag(packageId, \"filters\");\n  }\n\n  /**\n   * Toggle a named filter on or off.\n   * @param {string} name     The name of the filter\n   * @param {string} type     The type of the filter\n   * @param {object} options  The options for the filter\n   * @returns {Promise<void>} A promise that resolves as soon as the filter has been toggled\n   */\n  async switch(name, type, options) {\n    if (!canvas.scene) {\n      return;\n    }\n    const filterInfos = canvas.scene.getFlag(packageId, \"filters\") ?? {};\n    if (filterInfos[name]) {\n      return this.removeFilter(name);\n    } else {\n      return this.addFilter(name, type, options);\n    }\n  }\n\n  async setFilters(filterInfoArray) {\n    const filterInfos = Object.fromEntries(filterInfoArray.map((filterInfo) => [foundry.utils.randomID(), filterInfo]));\n    await resetFlag(canvas.scene, \"filters\", filterInfos);\n  }\n\n  #animate() {\n    for (const key in this.filters) {\n      this.filters[key].step();\n    }\n  }\n\n  #registerHooks() {\n    Hooks.on(\"canvasInit\", () => {\n      if (isEnabled()) {\n        this.#clear();\n      }\n    });\n\n    Hooks.on(\"canvasReady\", () => {\n      executeWhenWorldIsMigratedToLatest(async () => {\n        if (isEnabled()) {\n          await this.#activate();\n        }\n      });\n    });\n\n    Hooks.on(\"updateScene\", (scene, data) => {\n      if (!isEnabled() || !isOnTargetMigration() || scene !== canvas.scene) {\n        return;\n      }\n      if (\n        foundry.utils.hasProperty(data, \"flags.fxmaster.filters\") ||\n        foundry.utils.hasProperty(data, \"flags.fxmaster.-=filters\")\n      ) {\n        this.#update();\n      }\n    });\n  }\n}\n","import { easeFunctions } from \"../../ease.js\";\nimport { packageId } from \"../../constants.js\";\n\nexport class SpecialEffectConfig extends FormApplication {\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: [\"form\"],\n      closeOnSubmit: true,\n      submitOnChange: false,\n      submitOnClose: false,\n      popOut: true,\n      editable: game.user.isGM,\n      width: 320,\n      height: \"auto\",\n      template: \"modules/fxmaster/templates/special-effect-config.hbs\",\n      id: \"add-effect\",\n      title: game.i18n.localize(\"FXMASTER.AddSpecialEffect\"),\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  setDefault(object) {\n    this.default = object;\n  }\n\n  /**\n   * Obtain module metadata and merge it with game settings which track current module visibility\n   * @return {Object}   The data provided to the template when rendering the form\n   */\n  getData() {\n    const eases = easeFunctions;\n    const values = foundry.utils.mergeObject(\n      {\n        folder: \"Custom\",\n        angle: 0,\n        position: {\n          x: 0,\n          y: 0,\n        },\n        anchor: {\n          x: 0.5,\n          y: 0.5,\n        },\n        scale: {\n          x: 1.0,\n          y: 1.0,\n        },\n        speed: 0,\n        animationDelay: {\n          start: 0,\n          end: 0,\n        },\n        ease: \"Linear\",\n        author: \"\",\n        preset: false,\n      },\n      this.default,\n    );\n\n    // Return data to the template\n    return {\n      default: values,\n      ease: Object.keys(eases),\n    };\n  }\n\n  /* -------------------------------------------- */\n  /*  Event Listeners and Handlers                */\n  /* -------------------------------------------- */\n\n  /** @override */\n  activateListeners(html) {\n    super.activateListeners(html);\n    html.find('input[type=\"range\"]').on(\"input\", (event) => this._onChangeRange(event));\n  }\n\n  /**\n   * This method is called upon form submission after form data is validated\n   * @param event {Event}       The initial triggering submission event\n   * @param formData {object}   The object of validated form data with which to update the object\n   * @protected\n   */\n  async _updateObject(_, formData) {\n    const fxs = game.settings.get(packageId, \"specialEffects\");\n\n    const newData = {\n      folder: formData[\"folder\"],\n      label: formData[\"label\"],\n      file: formData[\"file\"],\n      scale: {\n        x: parseFloat(formData[\"scaleX\"]),\n        y: parseFloat(formData[\"scaleY\"]),\n      },\n      angle: parseFloat(formData[\"angle\"]),\n      anchor: {\n        x: formData[\"anchorX\"],\n        y: formData[\"anchorY\"],\n      },\n      speed: parseFloat(formData[\"speed\"]),\n      animationDelay: {\n        start: parseFloat(formData[\"animationDelayStart\"]),\n        end: parseFloat(formData[\"animationDelayEnd\"]),\n      },\n      ease: formData[\"ease\"],\n      preset: false,\n      author: \"\",\n    };\n    const fx = fxs.filter((f) => f.label == newData.label);\n    if (fx.length > 0) {\n      fx[0] = foundry.utils.mergeObject(fx[0], newData);\n    } else {\n      fxs.push(newData);\n    }\n    await game.settings.set(packageId, \"specialEffects\", fxs);\n  }\n}\n","import { SpecialEffectConfig } from \"./special-effect-config.js\";\nimport { packageId } from \"../../constants.js\";\n\nimport \"../../../css/specials-config.css\";\n\nexport class SpecialEffectsManagement extends Application {\n  /** @override */\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: [\"fxmaster\", \"specials\", \"sidebar-popout\"],\n      closeOnSubmit: true,\n      submitOnChange: false,\n      submitOnClose: false,\n      popOut: true,\n      editable: game.user.isGM,\n      width: 120,\n      height: 200,\n      resizable: true,\n      dragDrop: [{ dragSelector: \".special-effects\" }],\n      template: \"modules/fxmaster/templates/special-effects-management.hbs\",\n      id: \"specials-config\",\n      title: game.i18n.localize(\"FXMASTER.SpecialEffectsManagementTitle\"),\n    });\n  }\n\n  /** @override */\n  getData() {\n    return {\n      folders: CONFIG.fxmaster.userSpecials,\n    };\n  }\n\n  /** @override */\n  activateListeners(html) {\n    html.find(\".special-effects .description\").click((event) => {\n      let list = event.currentTarget.closest(\".directory-list\");\n      let items = $(list).find(\".directory-item\");\n      for (let i = 0; i < items.length; i++) {\n        items[i].classList.remove(\"active\");\n      }\n      event.currentTarget.parentElement.classList.add(\"active\");\n    });\n\n    // Dialog\n    html.find(\"a[data-action=add-effect]\").click(async () => {\n      new SpecialEffectConfig().render(true);\n    });\n\n    html.find(\".preview video\").hover((ev) => {\n      ev.currentTarget.play();\n    });\n\n    html.find(\".del-effect\").click((ev) => {\n      const folderId = ev.currentTarget.closest(\".folder\").dataset[\"folderId\"];\n      const effectId = ev.currentTarget.closest(\".special-effects\").dataset[\"effectId\"];\n      const data = CONFIG.fxmaster.userSpecials[folderId].effects[effectId];\n      const settings = game.settings.get(packageId, \"specialEffects\");\n      const id = settings.findIndex((v) => {\n        return v.label === data.label && v.folder === data.folder;\n      });\n      if (id === -1) {\n        return;\n      }\n      settings.splice(id, 1);\n      game.settings.set(packageId, \"specialEffects\", settings);\n    });\n\n    html.find(\".edit-effect\").click((ev) => {\n      const folderId = ev.currentTarget.closest(\".folder\").dataset[\"folderId\"];\n      const effectId = ev.currentTarget.closest(\".special-effects\").dataset[\"effectId\"];\n      const d = new SpecialEffectConfig();\n      d.setDefault(CONFIG.fxmaster.userSpecials[folderId].effects[effectId]);\n      d.render(true);\n    });\n\n    html.find(\".action-toggle\").click((ev) => {\n      for (const c of ev.currentTarget.parentElement.children) {\n        c.classList.remove(\"active\");\n      }\n      ev.currentTarget.classList.add(\"active\");\n    });\n\n    const directory = html.find(\".directory-list\");\n    directory.on(\"click\", \".folder-header\", this._toggleFolder.bind(this));\n  }\n\n  _toggleFolder(event) {\n    let folder = $(event.currentTarget.parentElement);\n    let collapsed = folder.hasClass(\"collapsed\");\n\n    // Expand\n    if (collapsed) folder.removeClass(\"collapsed\");\n    // Collapse\n    else {\n      folder.addClass(\"collapsed\");\n      folder.find(\".folder\").addClass(\"collapsed\");\n    }\n  }\n\n  /** @override */\n  _onDragStart(event) {\n    const effectId = event.currentTarget.closest(\".special-effects\").dataset.effectId;\n    const folderId = event.currentTarget.closest(\".folder\").dataset.folderId;\n    const effectData = CONFIG.fxmaster.userSpecials[folderId].effects[effectId];\n    effectData.type = \"SpecialEffect\";\n    event.dataTransfer.setData(\"text/plain\", JSON.stringify(effectData));\n  }\n}\n","/**\n * A SpriteMesh which visualizes a special effect object in the PrimaryCanvasGroup.\n */\nexport class SpecialEffectMesh extends SpriteMesh {\n  /** @type {number} */\n  get elevation() {\n    return this.#elevation;\n  }\n\n  set elevation(value) {\n    this.#elevation = value;\n  }\n\n  #elevation = 0;\n}\n","import { packageId } from \"../constants.js\";\nimport { easeFunctions } from \"../ease.js\";\nimport { SpecialEffectMesh } from \"./mesh.js\";\n\nexport class SpecialEffectsLayer extends InteractionLayer {\n  constructor() {\n    super();\n    this.videos = [];\n    this._dragging = false;\n    this.ruler = null;\n    this.windowVisible = false;\n    // Listen to the socket\n    game.socket.on(`module.${packageId}`, (data) => {\n      this.playVideo(data);\n    });\n  }\n\n  static get layerOptions() {\n    return foundry.utils.mergeObject(super.layerOptions, {\n      name: \"specials\",\n      zIndex: 245,\n    });\n  }\n\n  /** @override */\n  async _draw() {\n    await super._draw();\n    this.ruler = this.addChild(new PIXI.Graphics());\n  }\n\n  /** @inheritdoc */\n  async _tearDown() {\n    this.ruler = null;\n    for (const video of this.videos) {\n      video.remove();\n    }\n    this.videos = [];\n    return super._tearDown();\n  }\n\n  _configureProjectile(mesh, data) {\n    if (data.distance && (!data.speed || data.speed == \"auto\")) {\n      data.speed = data.distance / data.duration;\n    }\n    // Compute final position\n    const delta = data.duration * data.speed;\n    const deltaX = delta * Math.cos(data.rotation);\n    const deltaY = delta * Math.sin(data.rotation);\n\n    // Move the sprite\n    const attributes = [\n      {\n        parent: mesh,\n        attribute: \"x\",\n        to: data.position.x + deltaX,\n      },\n      {\n        parent: mesh,\n        attribute: \"y\",\n        to: data.position.y + deltaY,\n      },\n    ];\n\n    let animationDuration = data.duration * 1000;\n    if (foundry.utils.hasProperty(data, \"animationDelay\")) {\n      animationDuration -= Math.max(0, 1000 * (data.animationDelay.end + data.animationDelay.start));\n    }\n    const animationName = `${packageId}.video.${randomID()}.move`;\n    const animate = function () {\n      CanvasAnimation.animate(attributes, {\n        name: animationName,\n        context: this,\n        duration: animationDuration,\n        easing: easeFunctions[data.ease],\n      });\n    };\n    if (foundry.utils.hasProperty(data, \"animationDelay.start\")) {\n      setTimeout(animate, data.animationDelay.start * 1000.0);\n    } else {\n      animate();\n    }\n    return () => CanvasAnimation.terminateAnimation(animationName);\n  }\n\n  _configureRotate(mesh, data) {\n    const attributes = [\n      {\n        parent: mesh,\n        attribute: \"angle\",\n        to: 90 * data.rotationSpeed,\n      },\n    ];\n    let animationDuration = data.duration * 1000;\n    if (foundry.utils.hasProperty(data, \"animationDelay\")) {\n      animationDuration -= Math.max(0, 1000 * (data.animationDelay.end + data.animationDelay.start));\n    }\n    const animationName = `${packageId}.video.${randomID()}.rotate`;\n\n    const animate = function () {\n      CanvasAnimation.animate(attributes, {\n        name: animationName,\n        context: this,\n        duration: animationDuration,\n        easing: easeFunctions[data.ease],\n      });\n    };\n    if (foundry.utils.hasProperty(data, \"animationDelay.start\")) {\n      setTimeout(animate, data.animationDelay.start * 1000.0);\n    } else {\n      animate();\n    }\n    return () => CanvasAnimation.terminateAnimation(animationName);\n  }\n\n  #configureSpecialEffectMesh(mesh, data) {\n    mesh.anchor.set(data.anchor.x, data.anchor.y);\n    mesh.rotation = Math.normalizeRadians(data.rotation - Math.toRadians(data.angle));\n    mesh.scale.set(data.scale.x, data.scale.y);\n    mesh.position.set(data.position.x, data.position.y);\n    mesh.elevation = data.elevation ?? 1;\n\n    if (data.width) {\n      if (data.keepAspect) {\n        const aspectRatio = mesh.height / mesh.width;\n        mesh.height = data.width * aspectRatio;\n      }\n      mesh.width = data.width;\n    }\n\n    /** @type {(() => void) | undefined} */\n    let terminateMovementAnimation;\n    if (data.speed || data.distance) {\n      terminateMovementAnimation = this._configureProjectile(mesh, data);\n    }\n    /** @type {(() => void) | undefined} */\n    let terminateRotationtAnimation;\n    if (data.rotationSpeed) {\n      terminateRotationtAnimation = this._configureRotate(mesh, data);\n    }\n\n    return () => {\n      terminateMovementAnimation?.();\n      terminateRotationtAnimation?.();\n    };\n  }\n\n  playVideo(data) {\n    return new Promise((resolve) => {\n      // Set default values\n      data = foundry.utils.mergeObject(\n        {\n          anchor: { x: 0.5, y: 0.5 },\n          rotation: 0,\n          scale: { x: 1.0, y: 1.0 },\n          position: { x: 0, y: 0 },\n          playbackRate: 1.0,\n          ease: \"Linear\",\n        },\n        data,\n      );\n\n      // Create video\n      const video = document.createElement(\"video\");\n      video.preload = \"auto\";\n      video.crossOrigin = \"anonymous\";\n      video.src = data.file;\n      video.playbackRate = data.playbackRate;\n      this.videos.push(video);\n\n      /** @type {SpriteMesh | undefined} */\n      let mesh;\n      /** @type {(() => void) | undefined} */\n      let terminateAnimation;\n\n      const onCanPlay = () => {\n        mesh = new SpecialEffectMesh(PIXI.Texture.from(video));\n\n        data.dimensions = { w: video.videoWidth, h: video.videoHeight };\n        data.duration = video.duration;\n        terminateAnimation = this.#configureSpecialEffectMesh(mesh, data);\n\n        canvas.primary.addChild(mesh);\n        canvas.primary.videoMeshes.add(mesh);\n      };\n\n      const onEnd = () => {\n        terminateAnimation?.();\n        canvas.primary.removeChild(mesh);\n        canvas.primary.videoMeshes.delete(mesh);\n        resolve();\n        if (!mesh?._destroyed) mesh?.destroy({ children: true });\n      };\n\n      video.oncanplay = onCanPlay;\n      video.onerror = onEnd;\n      video.onended = onEnd;\n    });\n  }\n\n  static _createMacro(effectData) {\n    return `\n      const data = {\n        file: \"${effectData.file}\",\n        position: {\n          x: canvas.scene.dimensions.width / 2,\n          y: canvas.scene.dimensions.height / 2\n        },\n        anchor : {\n          x: ${effectData.anchor.x},\n          y: ${effectData.anchor.y}\n        },\n        angle: ${effectData.angle},\n        speed: ${effectData.speed},\n        scale: {\n          x: ${effectData.scale.x},\n          y: ${effectData.scale.y}\n        }\n      };\n      const tokens = canvas.tokens.controlled;\n      // No tokens are selected, play in a random position\n      if (tokens.length === 0) {\n        canvas.specials.playVideo(data);\n        game.socket.emit(\"module.${packageId}\", data);\n        return;\n      }\n      const targets = game.user.targets;\n      if (targets.size !== 0) {\n        tokens.forEach(t1 => {\n          targets.forEach(t2 => {\n            canvas.specials.drawFacing(data, t1, t2);\n          })\n        })\n        return;\n      }\n      // Play effect on each token\n      tokens.forEach(t => {\n        data.position = {\n          x: t.position.x + t.w / 2,\n          y: t.position.y + t.h / 2\n        };\n        canvas.specials.playVideo(data);\n        game.socket.emit(\"module.${packageId}\", data);\n      })\n\n    `;\n  }\n\n  drawSpecialToward(effect, tok1, tok2) {\n    const origin = {\n      x: tok1.position.x + tok1.w / 2,\n      y: tok1.position.y + tok1.h / 2,\n    };\n    const effectData = foundry.utils.mergeObject(effect, {\n      position: {\n        x: origin.x,\n        y: origin.y,\n      },\n    });\n    const target = {\n      x: tok2.position.x + tok2.w / 2,\n      y: tok2.position.y + tok2.h / 2,\n    };\n    // Compute angle\n    const ray = new Ray(origin, target);\n    effectData.distance = ray.distance;\n    effectData.rotation = ray.angle;\n    // Play to other clients\n    game.socket.emit(`module.${packageId}`, effectData);\n    // Play effect locally\n    return this.playVideo(effectData);\n  }\n\n  drawFacing(effect, tok1, tok2) {\n    const origin = {\n      x: tok1.position.x + tok1.w / 2,\n      y: tok1.position.y + tok1.h / 2,\n    };\n    const effectData = foundry.utils.mergeObject(effect, {\n      position: {\n        x: origin.x,\n        y: origin.y,\n      },\n    });\n    const target = {\n      x: tok2.position.x + tok2.w / 2,\n      y: tok2.position.y + tok2.h / 2,\n    };\n    // Compute angle\n    const ray = new Ray(origin, target);\n    effectData.rotation = ray.angle;\n    // Play to other clients\n    game.socket.emit(`module.${packageId}`, effectData);\n    // Play effect locally\n    return this.playVideo(effectData);\n  }\n\n  /**\n   * Draw a special effect.\n   * @param {PIXI.InteractionEvent} event         The event that triggered the drawing of the special effect\n   * @param {PIXI.Point}            [savedOrigin] The point that was originally clicked on\n   * @returns {Promise<void>}\n   * @remarks\n   * The savedOrigin parameter is required for regular click events because for some reason, the origin has been removed\n   * from the event's data by the time the event is handled.\n   * TODO: investigate further.\n   */\n  _drawSpecial(event, savedOrigin) {\n    event.stopPropagation();\n\n    const windows = Object.values(ui.windows);\n    const effectConfig = windows.find((w) => w.id == \"specials-config\");\n    if (!effectConfig) return;\n    const active = effectConfig.element.find(\".special-effects.active\");\n    if (active.length == 0) return;\n\n    const id = active[0].dataset.effectId;\n    const folder = active[0].closest(\".folder\").dataset.folderId;\n    const effect = CONFIG.fxmaster.userSpecials[folder].effects[id];\n\n    const effectData = foundry.utils.deepClone(effect);\n    const { x, y } = event.data.origin ?? savedOrigin;\n    const data = {\n      ...effectData,\n      position: { x, y },\n      rotation: event.data.rotation,\n      elevation: this.#elevation,\n    };\n\n    if (!event.data.destination) {\n      game.socket.emit(`module.${packageId}`, data);\n      return this.playVideo(data);\n    }\n\n    // Handling different casting modes\n    const actionToggle = effectConfig.element.find(\".action-toggle.active a\");\n    const mode = actionToggle[0].dataset.action;\n    const ray = new Ray(event.data.origin, event.data.destination);\n    switch (mode) {\n      case \"cast-throw\":\n        data.distance = ray.distance;\n        data.speed = \"auto\";\n        break;\n      case \"cast-extend\":\n        data.width = ray.distance || data.width;\n        data.speed = 0;\n        break;\n      case \"cast-expand\":\n        data.width = ray.distance || data.width;\n        data.keepAspect = true;\n        data.speed = 0;\n        break;\n      case \"cast-rotate\":\n        data.rotationSpeed = ray.distance / canvas.grid.w;\n        data.speed = 0;\n        break;\n      case \"cast-static\":\n        break;\n    }\n\n    game.socket.emit(`module.${packageId}`, data);\n    return this.playVideo(data);\n  }\n\n  /** @override */\n  _onDragLeftDrop(event) {\n    const u = {\n      x: event.data.destination.x - event.data.origin.x,\n      y: event.data.destination.y - event.data.origin.y,\n    };\n    const cos = u.x / Math.hypot(u.x, u.y);\n    event.data.rotation = u.y > 0 ? Math.acos(cos) : -Math.acos(cos);\n    this._drawSpecial(event);\n    this.ruler.clear();\n  }\n\n  /** @override */\n  _onDragLeftStart() {\n    this.windowVisible = this._isWindowVisible();\n    if (!this.windowVisible) return;\n    this._dragging = true;\n  }\n\n  /** @override */\n  _onDragLeftMove(event) {\n    if (!this.windowVisible) return;\n    const ray = new Ray(event.data.origin, event.data.destination);\n    this.ruler.clear();\n    this.ruler\n      .lineStyle(3, 0xaa0033, 0.6)\n      .drawCircle(ray.A.x, ray.A.y, 2)\n      .moveTo(ray.A.x, ray.A.y)\n      .lineTo(ray.B.x, ray.B.y)\n      .drawCircle(ray.B.x, ray.B.y, 2);\n  }\n\n  _isWindowVisible() {\n    const windows = Object.values(ui.windows);\n    const effectConfig = windows.find((w) => w.id == \"specials-config\");\n    if (!effectConfig) return false;\n    return true;\n  }\n\n  /** @override */\n  _onClickLeft(event) {\n    this._dragging = false;\n    const origin = event.data.origin;\n    setTimeout(() => {\n      if (!this._dragging) {\n        event.data.rotation = 0;\n        event.data.destination = undefined;\n        this._drawSpecial(event, origin);\n      }\n      this._dragging = false;\n    }, 400);\n  }\n\n  get #elevation() {\n    const effectConfig = Object.values(ui.windows).find((w) => w.id == \"specials-config\");\n    const elevationString = effectConfig?.element.find(\"input[name='elevation']\").val();\n    const elevation = Number.parseFloat(elevationString);\n    if (Number.isNaN(elevation) || !Number.isFinite(elevation)) return 1;\n    return elevation;\n  }\n}\n","/**\n * An abstract FormApplication that handles functionality common to multiple FXMaster forms.\n * In particular, it provides the following functionality:\n * * Handling of collapsible elements\n * * Making slider changes for range inputs update the accompanying text box immediately\n * * Handling the disabled state of the submission button\n *\n * @extends FormApplication\n * @abstract\n * @interface\n *\n * @param {Object} object                     Some object which is the target data structure to be be updated by the form.\n * @param {FormApplicationOptions} [options]  Additional options which modify the rendering of the sheet.\n */\nexport class FXMasterBaseForm extends FormApplication {\n  /** @override */\n  activateListeners(html) {\n    super.activateListeners(html);\n    html\n      .find(\".fxmaster-groups-list__collapse\")\n      .click((event) =>\n        this._onClickCollapse(\n          event,\n          \"fxmaster-groups-list__item\",\n          \"fxmaster-groups-list__collapsible\",\n          \"fxmaster-groups-list__collapse-icon\",\n        ),\n      );\n    html\n      .find(\".fxmaster-list__collapse\")\n      .click((event) =>\n        this._onClickCollapse(\n          event,\n          \"fxmaster-list__item\",\n          \"fxmaster-list__collapsible\",\n          \"fxmaster-list__collapse-icon\",\n        ),\n      );\n    html.find(\".fxmaster-range-input\").on(\"input\", this._onChangeRange.bind(this));\n  }\n\n  /**\n   * Handle toggling a a collapsible. To collapse the collapsible, the class `${collapsibleClass}--collapsed` is\n   * added to it.\n   *\n   * @param {JQuery.ClickEvent} event            The originating click event\n   * @param {string}            parentClass      The CSS class for selecting the parent that contains both the collapse\n   *                                             \"button\" and the collapsible\n   * @param {string}            collapsibleClass The CSS class for selecting the collapsible inside the parent\n   * @param {string}            [iconClass]      An optional CSS class to select an up/down arrow icon to be toggled\n   * @private\n   */\n  _onClickCollapse(event, parentClass, collapsibleClass, iconClass) {\n    const parentItem = $(event.currentTarget).parents(`.${parentClass}`);\n    const collapsible = parentItem.children(`.${collapsibleClass}`);\n    const icon = iconClass !== undefined ? parentItem.find(`.${iconClass}`) : undefined;\n    this._collapse(collapsible, icon, `${collapsibleClass}--collapsed`);\n  }\n\n  /**\n   * Toggle the collapsed state of an element.\n   * @param {JQuery}      collapsible                 The element to collapse\n   * @param {JQuery|null} [icon]                      An up/down arrow icon to be toggled\n   * @param {string}      [collapsedClass=\"collaped\"] The CSS clas to use to mark the element as collapsed\n   * @param {number}      [speed=250]                 The speed for sliding the element in and out, in milliseconds\n   * @private\n   */\n  _collapse(collapsible, icon, collapsedClass = \"collapsed\", speed = 250) {\n    const shouldCollapse = !collapsible.hasClass(collapsedClass);\n\n    if (shouldCollapse) {\n      collapsible.slideUp(speed, () => {\n        collapsible.addClass(collapsedClass);\n        icon?.removeClass(\"fa-angle-down\").addClass(\"fa-angle-up\");\n      });\n    } else {\n      collapsible.slideDown(speed, () => {\n        collapsible.removeClass(collapsedClass);\n        icon?.removeClass(\"fa-angle-up\").addClass(\"fa-angle-down\");\n      });\n    }\n  }\n\n  /** @override */\n  async _onChangeInput(...args) {\n    this.element.find('button[type=\"submit\"]').prop(\"disabled\", false);\n    return super._onChangeInput(...args);\n  }\n\n  /** @override */\n  async _onSubmit(...args) {\n    this.element.find('button[type=\"submit\"]').prop(\"disabled\", true);\n    return super._onSubmit(...args);\n  }\n}\n","import \"../../../css/particle-effects-config.css\";\n\nimport { packageId } from \"../../constants.js\";\nimport { FXMasterBaseForm } from \"../../base-form.js\";\nimport { resetFlag } from \"../../utils.js\";\n\nexport class ParticleEffectsManagement extends FXMasterBaseForm {\n  /** @override */\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: [\"form\", \"fxmaster\", \"particle-effects\", \"sidebar-popout\"],\n      closeOnSubmit: false,\n      submitOnChange: false,\n      submitOnClose: false,\n      popOut: true,\n      editable: game.user.isGM,\n      width: 300,\n      height: \"auto\",\n      template: \"modules/fxmaster/templates/particle-effects-management.hbs\",\n      id: \"effects-config\",\n      title: game.i18n.localize(\"FXMASTER.ParticleEffectsManagementTitle\"),\n    });\n  }\n\n  /** @override */\n  getData() {\n    const currentParticleEffects = canvas.scene?.getFlag(packageId, \"effects\") ?? {};\n\n    const activeParticleEffects = Object.fromEntries(\n      Object.values(currentParticleEffects).map((effect) => [effect.type, effect.options]),\n    );\n\n    /** @type {import(\"../particle-effects-db.js\").ParticleEffects} */\n    const { particleEffects } = CONFIG.fxmaster;\n\n    /** @type {Record<string, {label: string, expanded: boolean, effects: import(\"../particle-effects-db.js\").ParticleEffects}>}} */\n    const initialParticleEffectGroups = {};\n\n    const particleEffectGroups = Object.entries(particleEffects)\n      .sort(([, clsA], [, clsB]) => clsA.group.localeCompare(clsB.group) || clsA.label.localeCompare(clsB.label))\n      .reduce((groups, [type, cls]) => {\n        const group = cls.group;\n        return {\n          ...groups,\n          [group]: {\n            label: `FXMASTER.ParticleEffectsGroup${group.titleCase()}`,\n            expanded: groups[group]?.expanded || Object.keys(activeParticleEffects).includes(type),\n            effects: {\n              ...groups[group]?.effects,\n              [type]: cls,\n            },\n          },\n        };\n      }, initialParticleEffectGroups);\n\n    return {\n      particleEffectGroups,\n      effects: particleEffects,\n      activeEffects: activeParticleEffects,\n    };\n  }\n\n  /** @override */\n  async _updateObject(_, formData) {\n    /** @type {import(\"../particle-effects-db.js\").ParticleEffects} */\n    const { particleEffects } = CONFIG.fxmaster;\n    const effects = Object.fromEntries(\n      Object.entries(particleEffects)\n        .filter(([type]) => !!formData[type])\n        .map(([type, particleEffectCls]) => {\n          const label = particleEffectCls.label;\n\n          const options = Object.fromEntries(\n            Object.entries(particleEffectCls.parameters).map(([key, parameter]) => {\n              const optionValue =\n                parameter.type === \"color\"\n                  ? { apply: formData[`${label}_${key}_apply`], value: formData[`${label}_${key}`] }\n                  : formData[`${label}_${key}`];\n\n              return [key, optionValue];\n            }),\n          );\n\n          const particleEffect = {\n            type,\n            options,\n          };\n          return [`core_${type}`, particleEffect];\n        }),\n    );\n    resetFlag(canvas.scene, \"effects\", effects);\n  }\n}\n","import \"../../../css/filters-config.css\";\n\nimport { packageId } from \"../../constants.js\";\nimport { FXMasterBaseForm } from \"../../base-form.js\";\nimport { resetFlag } from \"../../utils.js\";\n\nexport class FilterEffectsManagementConfig extends FXMasterBaseForm {\n  /** @override */\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: [\"form\", \"fxmaster\", \"filters\", \"sidebar-popout\"],\n      closeOnSubmit: false,\n      submitOnChange: false,\n      submitOnClose: false,\n      popOut: true,\n      editable: game.user.isGM,\n      width: 300,\n      height: \"auto\",\n      template: \"modules/fxmaster/templates/filter-effects-management.hbs\",\n      id: \"filters-config\",\n      title: game.i18n.localize(\"FXMASTER.FilterEffectsManagementTitle\"),\n    });\n  }\n\n  /** @override */\n  getData() {\n    const currentFilters = canvas.scene?.getFlag(packageId, \"filters\") ?? {};\n    const activeFilters = Object.fromEntries(\n      Object.values(currentFilters).map((filter) => [filter.type, filter.options]),\n    );\n\n    const filters = Object.fromEntries(\n      Object.entries(CONFIG.fxmaster.filterEffects).sort(([, clsA], [, clsB]) => clsA.label.localeCompare(clsB.label)),\n    );\n\n    return {\n      filters,\n      activeFilters,\n    };\n  }\n\n  /** @override */\n  async _updateObject(_, formData) {\n    if (!canvas.scene) {\n      return;\n    }\n    const filtersDB = CONFIG.fxmaster.filterEffects;\n\n    const filters = Object.fromEntries(\n      Object.entries(filtersDB)\n        .filter(([type]) => !!formData[type])\n        .map(([filterName, filterCls]) => {\n          const label = filterCls.label;\n\n          const options = Object.fromEntries(\n            Object.entries(filterCls.parameters).map(([key, parameter]) => {\n              const optionValue =\n                parameter.type === \"color\"\n                  ? { apply: formData[`${label}_${key}_apply`], value: formData[`${label}_${key}`] }\n                  : formData[`${label}_${key}`];\n\n              return [key, optionValue];\n            }),\n          );\n\n          const filter = {\n            type: filterName,\n            options,\n          };\n          return [`core_${filterName}`, filter];\n        }),\n    );\n\n    resetFlag(canvas.scene, \"filters\", filters);\n  }\n}\n","import { logger } from \"./logger.js\";\nimport { packageId } from \"./constants.js\";\n\nconst defaultMacroImg = \"icons/svg/windmill.svg\";\n\nexport async function saveParticleAndFilterEffectsAsMacro() {\n  const particleEffectFlags = canvas.scene?.getFlag(packageId, \"effects\") ?? {};\n  const particleEffects = Object.values(particleEffectFlags);\n\n  const filterFlags = canvas.scene?.getFlag(packageId, \"filters\") ?? {};\n  const filterEffects = Object.values(filterFlags);\n\n  const { name, img } = getMacroNameAndImg(particleEffects, filterEffects);\n\n  const commands = [];\n  if (particleEffects.length > 0) {\n    commands.push(`Hooks.call('${packageId}.updateParticleEffects', ${JSON.stringify(particleEffects)});`);\n  }\n  if (filterEffects.length > 0) {\n    commands.push(`FXMASTER.filters.setFilters(${JSON.stringify(filterEffects)});`);\n  }\n  const command = commands.join(\"\\n\");\n\n  await Macro.create({ type: \"script\", name, command, img });\n  ui.notifications.info(`Macro '${name}' has been saved in the macro directory`);\n}\n\nfunction getMacroNameAndImg(particleEffects, filterEffects) {\n  const particleEffectLabelsAndIcons = particleEffects.flatMap(({ type }) => {\n    const particleEffectCls = CONFIG.fxmaster.particleEffects[type];\n    if (!particleEffectCls) {\n      logger.warn(`Encountered unknown particle effect type '${type}' during macro creation, skipping it.`);\n      return [];\n    }\n    return [{ label: game.i18n.localize(particleEffectCls.label), icon: particleEffectCls.icon }];\n  });\n  const filterLabels = filterEffects.flatMap(({ type }) => {\n    const filterEffectCls = CONFIG.fxmaster.filterEffects[type];\n    if (!filterEffectCls) {\n      logger.warn(`Encountered unknown filter effect type '${type}' during macro creation, skipping it.`);\n      return [];\n    }\n    return [{ label: game.i18n.localize(filterEffectCls.label) }];\n  });\n\n  if (filterLabels.length === 0) {\n    return particleEffectLabelsAndIcons.length === 1\n      ? {\n          name: `Particle Effect: ${particleEffectLabelsAndIcons[0].label}`,\n          img: particleEffectLabelsAndIcons[0].icon,\n        }\n      : { name: \"Particle Effects\", img: defaultMacroImg };\n  } else if (particleEffectLabelsAndIcons.length === 0) {\n    return filterLabels.length === 1\n      ? {\n          name: `Filter Effect: ${filterLabels[0].label}`,\n          img: defaultMacroImg,\n        }\n      : { name: \"Filter Effects\", img: defaultMacroImg };\n  } else {\n    return { name: `Particle & Filter Effects`, img: defaultMacroImg };\n  }\n}\n","import { packageId } from \"./constants.js\";\nimport { FilterManager } from \"./filter-effects/filter-manager.js\";\nimport { ParticleEffectsManagement } from \"./particle-effects/applications/particle-effects-management.js\";\nimport { SpecialEffectsManagement } from \"./special-effects/applications/special-effects-management.js\";\nimport { FilterEffectsManagementConfig } from \"./filter-effects/applications/filter-effects-management.js\";\nimport { saveParticleAndFilterEffectsAsMacro } from \"./macro.js\";\n\nexport function registerGetSceneControlButtonsHook() {\n  Hooks.on(\"getSceneControlButtons\", getSceneControlButtons);\n}\n\nfunction getSceneControlButtons(controls) {\n  if (canvas == null) {\n    return;\n  }\n  controls.push({\n    name: \"effects\",\n    title: \"CONTROLS.Effects\",\n    icon: \"fas fa-wand-magic-sparkles\",\n    layer: \"specials\",\n    visible: game.user.role >= game.settings.get(packageId, \"permission-create\"),\n    tools: [\n      {\n        name: \"specials\",\n        title: \"CONTROLS.SpecialFX\",\n        icon: \"fas fa-hat-wizard\",\n        onClick: () => {\n          new SpecialEffectsManagement().render(true);\n        },\n        button: true,\n      },\n      {\n        name: \"particle-effects\",\n        title: \"CONTROLS.ParticleEffects\",\n        icon: \"fas fa-cloud-rain\",\n        onClick: () => {\n          new ParticleEffectsManagement().render(true);\n        },\n        visible: game.user.isGM,\n        button: true,\n      },\n      {\n        name: \"invertmask\",\n        title: \"CONTROLS.InvertMask\",\n        icon: \"fas fa-mask\",\n        onClick: () => {\n          if (canvas.scene) {\n            const invert = canvas.scene.getFlag(packageId, \"invert\") ?? false;\n            canvas.scene.setFlag(packageId, \"invert\", !invert);\n          }\n        },\n        visible: game.user.isGM,\n        active: canvas.scene?.getFlag(packageId, \"invert\") ?? false,\n        toggle: true,\n      },\n      {\n        name: \"filters\",\n        title: \"CONTROLS.Filters\",\n        icon: \"fas fa-filter\",\n        onClick: () => {\n          new FilterEffectsManagementConfig().render(true);\n        },\n        visible: game.user.isGM,\n        button: true,\n      },\n      {\n        name: \"save\",\n        title: \"CONTROLS.SaveMacro\",\n        icon: \"fas fa-floppy-disk\",\n        onClick: saveParticleAndFilterEffectsAsMacro,\n        visible: game.user.isGM,\n        button: true,\n      },\n      {\n        name: \"clearfx\",\n        title: \"CONTROLS.ClearFX\",\n        icon: \"fas fa-trash\",\n        onClick: () => {\n          Dialog.confirm({\n            title: game.i18n.localize(\"FXMASTER.ClearParticleAndFilterEffectsTitle\"),\n            content: game.i18n.localize(\"FXMASTER.ClearParticleAndFilterEffectsContent\"),\n            yes: () => {\n              if (canvas.scene) {\n                FilterManager.instance.removeAll();\n                canvas.scene.unsetFlag(packageId, \"effects\");\n              }\n            },\n            defaultYes: true,\n          });\n        },\n        visible: game.user.isGM,\n        button: true,\n      },\n    ],\n    activeTool: \"effect\",\n  });\n}\n","import { isEnabled, registerSettings } from \"./settings.js\";\nimport { registerHooks } from \"./hooks.js\";\nimport { FXMASTER } from \"./config.js\";\nimport { ParticleEffectsLayer } from \"./particle-effects/particle-effects-layer.js\";\nimport { registeDrawingsMaskFunctionality } from \"./particle-effects/drawings-mask.js\";\nimport { registerSceneMaskFunctionality } from \"./particle-effects/scene-mask.js\";\nimport { FilterManager } from \"./filter-effects/filter-manager.js\";\nimport { isOnTargetMigration, migrate, migration } from \"./migration/migration.js\";\nimport { SpecialEffectsManagement } from \"./special-effects/applications/special-effects-management.js\";\nimport { SpecialEffectsLayer } from \"./special-effects/special-effects-layer.js\";\nimport { registerHandlebarsHelpers } from \"./handlebars-helpers.js\";\nimport { registerGetSceneControlButtonsHook } from \"./controls.js\";\nimport { format } from \"./logger.js\";\n\nimport \"../css/common.css\";\n\nwindow.FXMASTER = {\n  filters: FilterManager.instance,\n  migration,\n};\n\nfunction registerLayers() {\n  CONFIG.Canvas.layers.fxmaster = { layerClass: ParticleEffectsLayer, group: \"primary\" };\n  CONFIG.Canvas.layers.specials = { layerClass: SpecialEffectsLayer, group: \"interface\" };\n}\n\nfunction parseSpecialEffects() {\n  const effectData = game.settings.get(\"fxmaster\", \"specialEffects\");\n  const specialEffects = foundry.utils.deepClone(CONFIG.fxmaster.specialEffects);\n  effectData.reduce((acc, cur) => {\n    if (!cur.folder) cur.folder = \"Custom\";\n    const normalizedFolder = cur.folder.toLowerCase().replace(/ /g, \"\");\n    if (!acc[normalizedFolder]) acc[normalizedFolder] = { label: cur.folder, effects: [] };\n    acc[normalizedFolder].effects.push(cur);\n    return acc;\n  }, specialEffects);\n  Object.keys(specialEffects).forEach((k) => {\n    specialEffects[k].effects.sort((a, b) => (\"\" + a.label).localeCompare(b.label));\n  });\n  CONFIG.fxmaster.userSpecials = specialEffects;\n}\n\nHooks.once(\"init\", function () {\n  registerSettings();\n  registerHooks();\n  registerLayers();\n  registerHandlebarsHelpers();\n\n  if (!CONFIG.fxmaster) CONFIG.fxmaster = {};\n\n  const configDeprecations = {\n    weather: \"particleEffects\",\n    filters: \"filterEffects\",\n    specials: \"specialEffects\",\n  };\n\n  const getConfigDeprecationMessage = (old, replacement) =>\n    format(`CONFIG#fxmaster#${old} is deprecated in favor of CONFIG#fxmaster#${replacement}'`);\n\n  for (const [old, replacement] of Object.entries(configDeprecations)) {\n    if (CONFIG.fxmaster[old]) {\n      CONFIG.fxmaster[replacement] = CONFIG.fxmaster[old];\n      delete CONFIG.fxmaster[old];\n      const msg = getConfigDeprecationMessage(old, replacement);\n      foundry.utils.logCompatibilityWarning(msg, {\n        mod: foundry.CONST.COMPATIBILITY_MODES.WARNING,\n        since: \"FXMaster v3.0.0\",\n        until: \"FXMaster v4.0.0\",\n        stack: false,\n      });\n    }\n  }\n\n  foundry.utils.mergeObject(CONFIG.fxmaster, {\n    filterEffects: FXMASTER.filterEffects,\n    particleEffects: FXMASTER.particleEffects,\n    specialEffects: FXMASTER.specialEffects,\n  });\n\n  for (const [old, replacement] of Object.entries(configDeprecations)) {\n    Object.defineProperty(CONFIG.fxmaster, old, {\n      get: () => {\n        const msg = getConfigDeprecationMessage(old, replacement);\n        foundry.utils.logCompatibilityWarning(msg, {\n          mod: foundry.CONST.COMPATIBILITY_MODES.WARNING,\n          since: \"FXMaster v3.0.0\",\n          until: \"FXMaster v4.0.0\",\n          stack: false,\n        });\n        return CONFIG.fxmaster[replacement];\n      },\n    });\n  }\n\n  foundry.utils.mergeObject(CONFIG.weatherEffects, CONFIG.fxmaster.particleEffects);\n});\n\nHooks.once(\"ready\", () => {\n  migrate();\n});\n\nHooks.on(\"canvasInit\", () => {\n  if (isEnabled()) {\n    parseSpecialEffects();\n  }\n});\n\nHooks.on(\"updateScene\", (scene, data) => {\n  if (!isEnabled() || !isOnTargetMigration() || scene !== canvas.scene) {\n    return;\n  }\n  if (\n    foundry.utils.hasProperty(data, \"flags.fxmaster.effects\") ||\n    foundry.utils.hasProperty(data, \"flags.fxmaster.-=effects\")\n  ) {\n    canvas.fxmaster.drawParticleEffects({ soft: true });\n  }\n});\n\nHooks.on(\"dropCanvasData\", async (canvas, data) => {\n  if (!(canvas.activeLayer instanceof SpecialEffectsLayer) || !canvas.scene) return;\n  if (data.type !== \"SpecialEffect\") return;\n\n  await new Promise((resolve) => {\n    const vid = document.createElement(\"video\");\n    vid.addEventListener(\n      \"loadedmetadata\",\n      () => {\n        data.width = vid.videoWidth * data.scale.x;\n        data.height = vid.videoHeight * data.scale.y;\n        resolve();\n      },\n      false,\n    );\n    vid.src = data.file;\n  });\n\n  const tileData = {\n    alpha: 1,\n    flags: {},\n    height: data.height,\n    hidden: false,\n    img: data.file,\n    locked: false,\n    occlusion: { mode: 1, alpha: 0 },\n    overHead: false,\n    rotation: 0,\n    tileSize: 100,\n    video: { loop: true, autoplay: true, volume: 0 },\n    width: data.width,\n    x: data.x - data.anchor.x * data.width,\n    y: data.y - data.anchor.y * data.height,\n    z: 100,\n  };\n  ui.notifications.info(`A new Tile was created for effect ${data.label}`);\n  canvas.scene.createEmbeddedDocuments(\"Tile\", [tileData]).then(() => {});\n});\n\nHooks.on(\"hotbarDrop\", (hotbar, data) => {\n  if (data.type !== \"SpecialEffect\") return;\n  const macroCommand = SpecialEffectsLayer._createMacro(data);\n  data.type = \"Macro\";\n  data.data = {\n    command: macroCommand,\n    name: data.label,\n    type: \"script\",\n    author: game.user.id,\n  };\n});\n\nHooks.on(\"updateSetting\", (setting) => {\n  if (setting.key === \"fxmaster.specialEffects\") {\n    parseSpecialEffects();\n    Object.values(ui.windows).forEach((w) => {\n      if (w instanceof SpecialEffectsManagement) {\n        w.render(false);\n      }\n    });\n  }\n});\n\nHooks.on(\"renderDrawingHUD\", (hud, html) => {\n  const maskToggle = document.createElement(\"div\");\n  maskToggle.classList.add(\"control-icon\");\n  if (hud.object.document.flags?.fxmaster?.masking) {\n    maskToggle.classList.add(\"active\");\n  }\n  maskToggle.setAttribute(\"title\", game.i18n.localize(\"FXMASTER.MaskParticleEffects\"));\n  maskToggle.dataset.action = \"mask\";\n  maskToggle.innerHTML = `<i class=\"fas fa-cloud\"></i>`;\n  html.find(\".col.left\").append(maskToggle);\n\n  html.find(\".control-icon[data-action='mask']\").on(\"click\", (event) => {\n    event.preventDefault();\n\n    const isMask = hud.object.document.flags?.fxmaster?.masking;\n    const updates = hud.layer.controlled.map((object) => {\n      return { _id: object.id, \"flags.fxmaster.masking\": !isMask };\n    });\n\n    event.currentTarget.classList.toggle(\"active\", !isMask);\n    canvas.scene.updateEmbeddedDocuments(hud.object.document.documentName, updates);\n  });\n});\n\nregisterGetSceneControlButtonsHook();\nregisterSceneMaskFunctionality();\nregisteDrawingsMaskFunctionality();\n","export function registerHandlebarsHelpers() {\n  Handlebars.registerHelper(\"fxmasterParameter\", (effectCls, parameterConfig, parameterName, options = {}) => {\n    const _default = options[parameterName] ?? effectCls.default[parameterName];\n\n    switch (parameterConfig.type) {\n      case \"color\":\n        return `\n              <input type=\"checkbox\" name=\"${effectCls.label}_${parameterName}_apply\" ${\n          _default.apply ? \"checked\" : \"\"\n        }/>\n              <input type=\"color\" name=\"${effectCls.label}_${parameterName}\" value=\"${_default.value}\">\n              `;\n      case \"range\":\n        return `\n              <input class=\"fxmaster-range-input\" type=\"range\" step=\"${parameterConfig.step}\" min=\"${parameterConfig.min}\" max=\"${parameterConfig.max}\" name=\"${effectCls.label}_${parameterName}\" value=\"${_default}\">\n              <span class=\"range-value\">${_default}</span>\n              `;\n      case \"number\":\n        return `\n              <input class=\"fxmaster-text-input\" type=\"text\" data-dtype=\"Number\" name=\"${effectCls.label}_${parameterName}\" value=\"${_default}\">\n              `;\n      case \"multi-select\":\n        return `<select class=\"fxmaster-multi-select\" multiple name=\"${\n          effectCls.label\n        }_${parameterName}\">${Object.entries(parameterConfig.options).map(\n          ([key, name]) =>\n            `<option class=\"fxmaster-multi-select__option\" value=\"${key}\"${\n              _default.includes(key) ? \" selected\" : \"\"\n            }>${game.i18n.localize(name)}</option>`,\n        )}</select>`;\n    }\n    return \"\";\n  });\n}\n"],"names":["packageId","resetFlag","document","key","value","Array","isArray","oldFlags","getFlag","Object","keys","forEach","k","setFlag","roundToDecimals","number","decimals","Number","Math","round","loggingContext","loggingSeparator","getLoggingFunction","type","log","console","data","format","msg","logger","freeze","debug","info","warn","error","async","migrateWorldCollection","collection","migrateDocument","isError","documentName","name","id","e","migrateCompendiumCollection","pack","metadata","wasLocked","locked","configure","documents","getDocuments","migrateWorldCollections","collections","migrationConfiguration","migrateCompendiumCollections","packs","migrateNonWorldPacks","package","migrate","game","migrate2","migrationConfiguration2","Scene","migrateScene","scene","particleEffects","length","newParticleEffects","fromEntries","entries","map","effect","particleEffectClass","CONFIG","fxmaster","options","convertOptionsToV2","migrate3","migrationConfiguration3","Macro","migrateMacro","macro","command","img","newCommand","replaceAll","newImg","update","undefined","unsetFlag","targetServerMigration","isOnTargetWorldMigration","settings","get","migrate1","effects","i","scale","x","y","set","targetClientMigration","migrateClient","migration","ui","notifications","permanent","localize","user","isGM","migrateWorld","isOnTargetMigration","isOnTargetClientMigration","executeWhenWorldIsMigratedToLatest","callback","worldMigrationCallbacks","push","onWorldMigrated","shift","client","world","config","helpers","isEnabled","registerHooks","Hooks","on","onSwitchParticleEffects","onUpdateParticleEffects","deprecations","hook","onDeprecated","args","deprecation","replacedBy","foundry","utils","logCompatibilityWarning","mod","CONST","COMPATIBILITY_MODES","WARNING","since","until","stack","parameters","canvas","currentEffects","omit","object","_omitted","rest","parametersArray","randomID","updateWeather","switchWeather","FXMasterFilterEffectMixin","Base","constructor","super","this","enabled","applyOptions","neutral","static","default","parameterName","parameterConfig","optionContext","play","_options","FadingFilterMixin","currentAnimation","initialized","duration","CanvasAnimation","terminateAnimation","toAnimate","toSet","partition","skipInitialAnimation","anim","parent","attribute","to","animate","finally","skipFading","otherOptions","animateOptions","stop","completed","BloomFilter","PIXI","filters","AdvancedBloomFilter","blur","label","max","min","step","bloomScale","threshold","noise","ColorFilter","AdjustmentFilter","color","apply","saturation","contrast","brightness","gamma","red","green","blue","r","g","b","Color","from","FogFilter","Filter","uniforms","time","dimensions","Float32Array","lastTick","speed","density","size","app","ticker","lastTime","delta","filterManager","input","output","clear","currentState","filterMatrix","Matrix","copyFrom","target","worldTransform","invert","easeFunctions","Linear","easeLinear","InSine","easeInSine","cos","PI","OutSine","easeOutSine","sin","InOutSine","easeInOutSine","InBack","easeInBack","c1","OutBack","easeOutBack","pow","InOutBack","easeInOutBack","c2","InCubic","easeInCubic","OutCubic","easeOutCubic","InOutCubic","easeInOutCubic","InCirc","easeInCirc","sqrt","OutCirc","easeOutCirc","InOutCirc","easeInOutCirc","LightningFilter","nextLigthningTime","frequency","spark_duration","random","attributes","context","easing","OldFilmFilter","vignetting","vignettingAlpha","sepia","seed","PredatorFilter","CRTFilter","curvature","period","lineWidth","UnderwaterFilter","DisplacementFilter","displacemenntMap","Sprite","displacementMap","texture","baseTexture","wrapMode","WRAP_MODES","REPEAT","anchor","width","height","primary","addChild","removeChild","maskSprite","filterEffects","bloom","fog","lightning","oldfilm","predator","underwater","FXMasterParticleEffect","ParticleEffect","group","icon","direction","defaultDirection","lifetime","alpha","tint","mergeObject","insertKeys","inplace","defaultConfig","Error","rotationBehavior","behaviors","find","behavior","minStart","maxStart","rotationStaticBehavior","applyOptionsToConfig","_applyScaleToConfig","_applySpeedToConfig","_applyDirectionToConfig","_applyLifetimeToConfig","_applyTintToConfig","_applyAlphaToConfig","_applyFactorToValueList","valueList","factor","list","valueStep","_applyFactorToRandNumber","randNumber","filter","includes","range","concat","prewarm","emitters","emitter","autoUpdate","emit","maxLifetime","timeout","emitterPromises","Promise","resolve","emitterLifetime","playOnceAndDestroy","promises","all","setTimeout","then","destroy","bind","race","optionKey","optionValue","_convertScaleToV2","_convertSpeedToV2","_convertDensityToV2","speeds","flatMap","maximumSpeed","d","DefautlRectangleSpawnMixin","getParticleEmitters","mergeWithDefaults","maxParticles","deepClone","sceneRect","w","h","createEmitter","SpiderParticleEffect","performDeletions","minMult","framerate","loop","textures","fromRange","n","count","String","padStart","SPIDERS_CONFIG","withSteppedGradientColor","steps","getBehavior","reset","particles","ParticleUtils","createSteppedGradient","StarsParticleEffect","accel","minSpeed","maxSpeed","blendMode","STARS_CONFIG","AutumnLeavesParticleEffect","LEAF_CONFIG","BatsParticleEffect","BATS_CONFIG","BubblesParticleEffect","BUBBLES_CONFIG","CloudsParticleEffect","CLOUDS_CONFIG","offsetFactor","averageDiagonalTime","minLifetime","angle","toRadians","directionVector","CrowsParticleEffect","CROWS_CONFIG","FogParticleEffect","FOG_CONFIG","RatsParticleEffect","RATS_CONFIG","SnowstormParticleEffect","path","SNOWSTORM_CONFIG","FXMASTER","bats","birds","BirdsParticleEffect","animations","glide","flap","mixed","BIRDS_CONFIG","anims","_getAnimations","textureNumber","fill","deepFlatten","getAnim","animation","crows","eagles","EaglesParticleEffect","EAGLES_CONFIG","_textures","_initializeTextures","_textureCache","spriteSheetTexture","Texture","spriteSheetData","meta","frames","frame","rotated","trimmed","spriteSourceSize","sourceSize","Spritesheet","parse","values","rats","spiders","bubbles","embers","EmbersParticleEffect","EMBERS_CONFIG","stars","leaves","clouds","rain","RainParticleEffect","pos","RAIN_CONFIG","rainConfig","splashConfig","SPLASH_CONFIG","raintop","RainTopParticleEffect","_canvasPanHookId","RAIN_TOP_CONFIG","sceneRadius","sceneWidth","sceneHeight","moveSpeedList","averageSpeed","reduce","acc","cur","radius","innerRadius","affectRotation","updateOwnerPos","stage","pivot","sceneX","sceneY","_unregisterCanvasPanHook","_canvas","position","off","rainsimple","RainSimpleParticleEffect","snow","SnowParticleEffect","SNOW_CONFIG","snowstorm","specialEffects","file","author","ParticleEffectsLayer","CanvasLayer","particleEffectsContainer","particleEffectOcclusionFilter","elevation","weather","Infinity","weatherEffects","layerOptions","draw","fx","_tearDown","createParticleEffectOcclusionFilter","drawParticleEffects","soft","FullCanvasContainer","accessibleChildren","interactiveChildren","filterArea","renderer","screen","stopPromise","fadeOut","flags","optionName","InverseOcclusionMaskFilter","create","alphaOcclusion","uMaskSampler","masks","depth","renderTexture","channel","drawDrawingsMaskIfCurrentScene","drawDrawingsMask","msk","fxmasterDrawingsMask","mask","createInvertedMask","LegacyGraphics","beginFill","drawShape","rect","endFill","drawings","placeables","drawing","beginHole","drawShapeToMask","endHole","createMask","MaskData","colorMask","COLOR_MASK_BITS","BLUE","shape","geometry","graphicsData","clone","Drawing","SHAPE_TYPES","ELLIPSE","center","POLYGON","points","p","drawPolygon","s","drawSceneMask","fxmasterSceneMask","shouldMaskToScene","background","src","foreground","intersection","FilterManager","_ticker","container","environment","instance","add","filterInfos","filterInfo","filtersToCreate","filtersToUpdate","filtersToDelete","deletePromises","removeFilterFromContainer","applyFilters","otherFilters","f","removeFilter","addFilter","filterInfoArray","activate","hasProperty","SpecialEffectConfig","FormApplication","defaultOptions","classes","closeOnSubmit","submitOnChange","submitOnClose","popOut","editable","template","title","i18n","setDefault","getData","eases","folder","animationDelay","start","end","ease","preset","activateListeners","html","event","_onChangeRange","_","formData","fxs","newData","parseFloat","SpecialEffectsManagement","Application","resizable","dragDrop","dragSelector","folders","userSpecials","click","currentTarget","closest","items","$","classList","remove","parentElement","render","hover","ev","folderId","dataset","effectId","findIndex","v","splice","c","children","_toggleFolder","hasClass","removeClass","addClass","_onDragStart","effectData","dataTransfer","setData","JSON","stringify","SpecialEffectMesh","SpriteMesh","SpecialEffectsLayer","InteractionLayer","videos","_dragging","ruler","windowVisible","socket","playVideo","zIndex","_draw","Graphics","video","_configureProjectile","mesh","distance","deltaX","rotation","deltaY","animationDuration","animationName","_configureRotate","rotationSpeed","configureSpecialEffectMesh","normalizeRadians","keepAspect","aspectRatio","terminateMovementAnimation","terminateRotationtAnimation","playbackRate","createElement","preload","crossOrigin","onEnd","videoMeshes","delete","_destroyed","oncanplay","videoWidth","videoHeight","onerror","onended","drawSpecialToward","tok1","tok2","origin","ray","Ray","drawFacing","_drawSpecial","savedOrigin","stopPropagation","effectConfig","windows","active","element","destination","mode","action","grid","_onDragLeftDrop","u","hypot","acos","_onDragLeftStart","_isWindowVisible","_onDragLeftMove","lineStyle","drawCircle","A","moveTo","lineTo","B","_onClickLeft","elevationString","val","isNaN","isFinite","FXMasterBaseForm","_onClickCollapse","parentClass","collapsibleClass","iconClass","parentItem","parents","collapsible","_collapse","collapsedClass","slideUp","slideDown","prop","_onChangeInput","_onSubmit","ParticleEffectsManagement","currentParticleEffects","activeParticleEffects","particleEffectGroups","sort","clsA","clsB","localeCompare","groups","cls","titleCase","expanded","activeEffects","particleEffectCls","parameter","FilterEffectsManagementConfig","currentFilters","activeFilters","filtersDB","filterName","filterCls","defaultMacroImg","saveParticleAndFilterEffectsAsMacro","particleEffectFlags","filterFlags","getMacroNameAndImg","particleEffectLabelsAndIcons","filterLabels","filterEffectCls","commands","join","getSceneControlButtons","controls","layer","visible","role","tools","onClick","button","toggle","Dialog","confirm","content","yes","removeAll","defaultYes","activeTool","parseSpecialEffects","normalizedFolder","toLowerCase","replace","a","window","once","registerSettings","register","scope","Boolean","requiresReload","onChange","hint","USER_ROLES","ASSISTANT","choices","PLAYER","TRUSTED","GAMEMASTER","registerLayers","Canvas","layers","layerClass","specials","registerHandlebarsHelpers","Handlebars","registerHelper","effectCls","_default","configDeprecations","getConfigDeprecationMessage","old","replacement","defineProperty","activeLayer","vid","addEventListener","tileData","hidden","occlusion","overHead","tileSize","autoplay","volume","z","createEmbeddedDocuments","hotbar","macroCommand","_createMacro","setting","hud","maskToggle","masking","setAttribute","innerHTML","append","preventDefault","isMask","updates","controlled","_id","updateEmbeddedDocuments","registerGetSceneControlButtonsHook","registerSceneMaskFunctionality","registeDrawingsMaskFunctionality"],"mappings":"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"}